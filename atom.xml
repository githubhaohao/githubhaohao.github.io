<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>haohao</title>
  <subtitle>ä¸å¿˜åˆå¿ƒ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://githubhaohao.github.io/"/>
  <updated>2018-10-05T03:06:02.085Z</updated>
  <id>https://githubhaohao.github.io/</id>
  
  <author>
    <name>haohao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åŸºäºä»¥å¤ªåŠæ­å»ºç§æœ‰é“¾</title>
    <link href="https://githubhaohao.github.io/2018/10/02/Building-a-private-chain-based-on-Ethereum/"/>
    <id>https://githubhaohao.github.io/2018/10/02/Building-a-private-chain-based-on-Ethereum/</id>
    <published>2018-10-02T13:49:47.000Z</published>
    <updated>2018-10-05T03:06:02.085Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20181003.jpg" alt="Markdown"></p><p></p>
<p><div align="center">ç©ç©åŒºå—é“¾</div><br></p>
<h2 id="åŒºå—é“¾"><a href="#åŒºå—é“¾" class="headerlink" title="åŒºå—é“¾"></a>åŒºå—é“¾</h2><p>ç›®å‰ä¸šç•Œå…³äºåŒºå—é“¾å°šæ— æƒå¨ç»Ÿä¸€çš„å®šä¹‰ã€‚åŒºå—é“¾ç®€å•æ¥è¯´ï¼Œæ˜¯ä¸€ç§é“¾å¼çš„æ•°æ®ç»“æ„ï¼ŒåŒºå—ä¹‹é—´æŒ‰ç…§æ—¶é—´é¡ºåºè¿æ¥ï¼Œåˆ©ç”¨å¯†ç å­¦æ–¹å¼ä¿è¯æ•°æ®ä¸æ˜“ä¸²æ”¹å’Œä¸æ˜“ä¼ªé€ ï¼Œå¹¶åœ¨ç½‘ç»œæ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œ<strong>åˆ†å¸ƒå¼å­˜å‚¨çš„å…±äº«è´¦æœ¬</strong>ã€‚</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/btc_trend.jpg" alt="BTCä»·æ ¼"></p>
<p>è°ˆåˆ°åŒºå—é“¾å°±ä¸å¾—ä¸æåŠæœ€è¿‘ä»·æ ¼ç»å†è¿‡å±±è½¦çš„æ¯”ç‰¹å¸ï¼ˆBTCï¼‰ï¼Œæ¯”ç‰¹å¸å¯¹ç¤¾ä¼šçš„è´¡çŒ®å’Œä»·å€¼ä¸»è¦åœ¨äºï¼Œé€šè¿‡å®è·µéªŒè¯äº†èƒŒåæ”¯æ’‘å…¶è¿ä½œçš„åŒºå—é“¾æŠ€æœ¯ã€‚äº†è§£æ¯”ç‰¹å¸çš„åŸºæœ¬åŸç†ï¼Œè¯·ç§»æ­¥<a href="http://blog.codinglabs.org/articles/bitcoin-mechanism-make-easy.html" target="_blank" rel="external">ä¸€ä¸ªæ•…äº‹å‘Šè¯‰ä½ æ¯”ç‰¹å¸çš„åŸç†åŠè¿ä½œæœºåˆ¶</a></p>
<p>ç›®å‰äº’è”ç½‘ä¸»è¦ä½œä¸ºâ€œä¿¡æ¯â€ä¼ é€’çš„å¹³å°ï¼Œè€ŒåŒºå—é“¾æŠ€æœ¯çš„å‘å±•å’Œå®Œå–„å°†èµ‹äºˆäº’è”ç½‘ä¼ é€’â€œä¿¡ä»»â€å’Œâ€œä»·å€¼â€çš„èƒ½åŠ›ï¼Œå°±ç›®å‰çš„ç¯å¢ƒè€Œè¨€ï¼ŒåŒºå—é“¾æŠ€æœ¯çš„ç‚’ä½œå¯èƒ½è¦å¤šäºæŠ€æœ¯æœ¬èº«çš„è½åœ°å’Œåˆ›æ–°ã€‚åŒºå—é“¾æŠ€æœ¯ä½œä¸ºäº’è”ç½‘ä¼ é€’â€œä¿¡ä»»â€å’Œä»·å€¼çš„è§£å†³æ–¹æ¡ˆï¼Œæœ¬èº«ä¹Ÿæœ‰å…¶ç›¸åº”çš„ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ç”±äºåŒºå—é“¾åŸºäº P2P ç½‘ç»œï¼Œè¦æ±‚å…¨ç½‘èŠ‚ç‚¹ä¿å­˜åŒä¸€ä»½æ•°æ®ï¼Œä»¥æ•ˆç‡æ¥æ¢å–å®‰å…¨æ€§ï¼ˆæ‰§è¡Œå¤§é‡çš„æœ¬è´¨ä¸Šæ¯«æ— æ„ä¹‰çš„è®¡ç®—ï¼Œæµªè´¹å¤§é‡çš„ç”µåŠ›ï¼‰ï¼Œå› æ­¤å¯¹æ•ˆç‡è¦æ±‚å¾ˆé«˜çš„åœºæ™¯å¹¶ä¸é€‚åˆåŒºå—é“¾æŠ€æœ¯ã€‚</p>
<h2 id="ä»¥å¤ªåŠ"><a href="#ä»¥å¤ªåŠ" class="headerlink" title="ä»¥å¤ªåŠ"></a>ä»¥å¤ªåŠ</h2><blockquote>
<p>ä»¥å¤ªåŠï¼ˆè‹±è¯­ï¼šEthereumï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„æœ‰æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å…¬å…±åŒºå—é“¾å¹³å°ã€‚é€šè¿‡å…¶ä¸“ç”¨åŠ å¯†è´§å¸ä»¥å¤ªå¸ï¼ˆ Ether ï¼Œåˆç§°â€œä»¥å¤ªå¸â€ï¼‰æä¾›å»ä¸­å¿ƒåŒ–çš„è™šæ‹Ÿæœºï¼ˆç§°ä¸ºâ€œä»¥å¤ªè™šæ‹Ÿæœºâ€ Ethereum Virtual Machine ï¼‰æ¥å¤„ç†ç‚¹å¯¹ç‚¹åˆçº¦ã€‚</p>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œä»¥å¤ªåŠå°±æ˜¯<strong>ä¸€ä¸ªå»ºç«‹åœ¨åŒºå—é“¾æŠ€æœ¯ä¹‹ä¸Šçš„æ”¯æŒå»ä¸­å¿ƒåŒ–åº”ç”¨å¼€å‘çš„åŸºç¡€å¹³å°</strong>ã€‚ä»¥å¤ªåŠä¸å»ä¸­å¿ƒåŒ– App ä¹‹é—´çš„å…³ç³»ç›¸å½“äºæ“ä½œç³»ç»Ÿä¸è¿è¡Œåœ¨è¯¥æ“ä½œç³»ç»Ÿä¹‹ä¸Š App ä¹‹é—´çš„å…³ç³»ã€‚</p>
<blockquote>
<p>åœ¨ä»¥å¤ªåŠå‡ºç°ä¹‹å‰ï¼ŒåŒºå—é“¾åº”ç”¨æ˜¯è¿™æ ·ç©çš„ï¼šæ‹·è´ä¸€ä»½æ¯”ç‰¹å¸ä»£ç ï¼Œç„¶åå»æ”¹åº•å±‚ä»£ç å¦‚åŠ å¯†ç®—æ³•ï¼Œå…±è¯†æœºåˆ¶ï¼Œç½‘ç»œåè®®ç­‰ç­‰ï¼ˆå¾ˆå¤šå±±å¯¨å¸å°±æ˜¯è¿™æ ·è¯ç”Ÿçš„ï¼Œæ”¹æ”¹å°±å‡ºæ¥ä¸€ä¸ªæ–°å¸ï¼Œç„¶åå» ICO å‰²éŸ­èœï¼Œä¿—ç§°â€œç©ºæ°”å¸â€ï¼‰ã€‚ä»¥å¤ªåŠå¹³å°å¯¹åº•å±‚åŒºå—é“¾æŠ€æœ¯è¿›è¡Œäº†å°è£…ï¼Œè®©åŒºå—é“¾åº”ç”¨å¼€å‘è€…å¯ä»¥ç›´æ¥åŸºäºä»¥å¤ªåŠå¹³å°è¿›è¡Œå¼€å‘ï¼Œå¼€å‘è€…åªè¦ä¸“æ³¨äºåº”ç”¨æœ¬èº«çš„å¼€å‘ï¼Œä»è€Œå¤§å¤§é™ä½äº†éš¾åº¦ã€‚</p>
</blockquote>
<p><img src="http://pg12w9eve.bkt.clouddn.com/god_v.jpg" alt="Vitalik Buterin"></p>
<p>ä¸‹é¢æ‰’ä¸€æ‰’ä»¥å¤ªåŠçš„åˆ›å§‹äººã€‚ä»¥å¤ªåŠæœ€åˆç”± Vitalik Buterin åœ¨ 2013 å¹´æå‡ºï¼ŒVitalik Buterin ä½•è®¸äººä¹Ÿï¼Œä¸šå†…ç§°ä¹‹ä¸º V ç¥ï¼Œ1994 å¹´ç”Ÿäºä¿„ç½—æ–¯ï¼Œé»‘å®¢èƒŒæ™¯ã€‚</p>
<ul>
<li>17 å²å¼€å§‹ç ”ç©¶æ¯”ç‰¹å¸ï¼Œåˆ›ã€Šæ¯”ç‰¹å¸æ‚å¿—ã€‹ï¼›</li>
<li>19 å²è‡ªåŠ æ‹¿å¤§æ»‘é“å¢å¤§å­¦ä¼‘å­¦ï¼Œå¹¶åœ¨è¯¥å¹´ 11 æœˆï¼Œå…¬å¸ƒã€Šä»¥å¤ªåŠç™½çš®ä¹¦ã€‹åˆç‰ˆï¼Œå¼€å§‹å‹Ÿé›†å¼€å‘è€…ï¼›</li>
<li>20 å²è·å¾—æå°”å¥–å­¦é‡‘ã€æˆç«‹éè¥åˆ©ç»„ç»‡ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼Œåœ¨è¿ˆé˜¿å¯†çš„æ¯”ç‰¹å¸ä¼šè®®å…¬å¼€å‘è¡¨ä»¥å¤ªåŠè®¡ç”»ï¼Œè¯¥å¹´ 7 æœˆï¼Œå¯åŠ¨ä»¥å¤ªåŠè®¡ç”»ä¼—å”®å‹Ÿèµ„ï¼Œå‹Ÿå¾— 3.1 ä¸‡æšæ¯”ç‰¹å¸ï¼ˆå½“æ—¶çº¦åˆ 1840 ä¸‡ç¾å…ƒï¼‰ï¼›</li>
<li>21 å²ä»¥å¤ªåŠæœ€åˆç‰ˆæœ¬ Frontier é—®ä¸–ã€ä»¥å¤ªå¸å¼€å§‹åœ¨ä¸–ç•Œå„åœ°äº¤æ˜“æ‰€å…¬å¼€äº¤æ˜“ï¼›</li>
<li>22 å²è¢«ã€Šè´¢æ˜Ÿã€‹æ‚å¿—è¯„é€‰ä¸º 2016 å¹´ 40 å²ä»¥ä¸‹çš„ 40 å¤§æ°å‡ºäººç‰©ã€‚</li>
</ul>
<h2 id="æ­å»ºç§æœ‰é“¾"><a href="#æ­å»ºç§æœ‰é“¾" class="headerlink" title="æ­å»ºç§æœ‰é“¾"></a>æ­å»ºç§æœ‰é“¾</h2><h3 id="å®‰è£…ä»¥å¤ªåŠå®¢æˆ·ç«¯"><a href="#å®‰è£…ä»¥å¤ªåŠå®¢æˆ·ç«¯" class="headerlink" title="å®‰è£…ä»¥å¤ªåŠå®¢æˆ·ç«¯"></a>å®‰è£…ä»¥å¤ªåŠå®¢æˆ·ç«¯</h3><p><img src="http://pg12w9eve.bkt.clouddn.com/geth_client.png" alt="ä»¥å¤ªåŠå®¢æˆ·ç«¯"></p>
<p>ç§»æ­¥<a href="https://github.com/ethereum/mist/releases" target="_blank" rel="external">https://github.com/ethereum/mist/releases</a> ä¸‹è½½å¯¹åº”æ“ä½œç³»ç»Ÿçš„ä»¥å¤ªåŠé’±åŒ…å’Œ Mistï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨æµè§ˆå™¨ï¼‰ã€‚</p>
<p>ä»¥å¤ªåŠé’±åŒ…å¯åŠ¨åä¼šè‡ªåŠ¨ä¸‹è½½ä»¥å¤ªåŠå‘½ä»¤è¡Œå®¢æˆ·ç«¯ Geth ï¼ŒGeth ç›®å‰ä½¿ç”¨éå¸¸å¹¿æ³›ï¼ŒåŸºäº GO è¯­è¨€å¼€å‘ã€‚å®‰è£…åçš„è·¯å¾„ C:\Users\haohao\AppData\Roaming\Ethereum Wallet\binaries\Geth\unpacked ï¼Œå°†è¯¥è·¯å¾„é…ç½®ä¸ºç¯å¢ƒå˜é‡ï¼ˆæ³¨æ„è‹±æ–‡åˆ†å·ï¼‰ã€‚å¯ä»¥é€šè¿‡ <code>geth --help</code> æŸ¥çœ‹ Geth æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h3 id="å®šä¹‰åˆ›ä¸–åŒºå—"><a href="#å®šä¹‰åˆ›ä¸–åŒºå—" class="headerlink" title="å®šä¹‰åˆ›ä¸–åŒºå—"></a>å®šä¹‰åˆ›ä¸–åŒºå—</h3><p>åŒºå—é“¾çš„ç¬¬ä¸€ä¸ªåŒºå—ç§°ä¸ºåˆ›ä¸–åŒºå—ï¼Œå®ƒæ˜¯åŒºå—é“¾é‡Œé¢æ‰€æœ‰åŒºå—çš„å…±åŒç¥–å…ˆï¼Œè¿™æ„å‘³ç€ä½ ä»ä»»ä¸€åŒºå—ï¼Œå¾ªé“¾å‘åå›æº¯ï¼Œæœ€ç»ˆéƒ½å°†åˆ°è¾¾åˆ›ä¸–åŒºå—ã€‚ä»¥å¤ªåŠæ”¯æŒè‡ªå®šä¹‰åˆ›ä¸–åŒºå—ï¼Œè¦è¿è¡Œç§æœ‰é“¾ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰è‡ªå·±çš„åˆ›ä¸–åŒºå—ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ª JSON æ–‡ä»¶è¡¨ç¤ºåˆ›ä¸–åŒºå—çš„ä¿¡æ¯ã€‚</p>
<p>åœ¨ C ç›˜åˆ›å»ºç›®å½• <code>C:\MyChains\T1</code> ï¼Œè¯¥ç›®å½•ä¸»è¦ç”¨äºå­˜å‚¨ç§æœ‰é“¾æ•°æ®ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º MyGenesis.json æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"config"</span>: &#123;</div><div class="line">        <span class="attr">"chainId"</span>: <span class="number">2048</span>, </div><div class="line">        <span class="attr">"homesteadBlock"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"eip155Block"</span>: <span class="number">0</span>,</div><div class="line">        <span class="attr">"eip158Block"</span>: <span class="number">0</span></div><div class="line">    &#125;,</div><div class="line">  <span class="attr">"alloc"</span>      : &#123;&#125;,</div><div class="line">  <span class="attr">"coinbase"</span>   : <span class="string">"0x0000000000000000000000000000000000000000"</span>,</div><div class="line">  <span class="attr">"difficulty"</span> : <span class="string">"0x10"</span>,</div><div class="line">  <span class="attr">"extraData"</span>  : <span class="string">""</span>,</div><div class="line">  <span class="attr">"gasLimit"</span>   : <span class="string">"0x222222"</span>,</div><div class="line">  <span class="attr">"nonce"</span>      : <span class="string">"0x000000000000001"</span>,</div><div class="line">  <span class="attr">"mixhash"</span>    : <span class="string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,</div><div class="line">  <span class="attr">"parentHash"</span> : <span class="string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>,</div><div class="line">  <span class="attr">"timestamp"</span>  : <span class="string">"0x00"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–åŒºå—é“¾"><a href="#åˆå§‹åŒ–åŒºå—é“¾" class="headerlink" title="åˆå§‹åŒ–åŒºå—é“¾"></a>åˆå§‹åŒ–åŒºå—é“¾</h3><p>å‘½ä»¤è¡Œåœ¨ <code>C:\MyChains\T1</code> è·¯å¾„ä¸‹ï¼Œå…³é—­ä»¥å¤ªåŠé’±åŒ…å’Œ Mist ï¼Œåˆå§‹åŒ–åŒºå—é“¾æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">geth --identity <span class="string">"dev"</span> --rpc --rpccorsdomain <span class="string">"*"</span> --datadir <span class="string">"C:\MyChains\T1"</span> --rpcapi <span class="string">"db,eth,net,web3"</span> --networkid 100 init <span class="string">"./MyGenesis.json"</span></div></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæˆåŠŸåæ˜¾ç¤ºï¼š</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/bolckchain_init.png" alt="blockchain_init"></p>
<h3 id="å¯åŠ¨ç§æœ‰é“¾"><a href="#å¯åŠ¨ç§æœ‰é“¾" class="headerlink" title="å¯åŠ¨ç§æœ‰é“¾"></a>å¯åŠ¨ç§æœ‰é“¾</h3><p>å‘½ä»¤è¡Œåœ¨ <code>C:\MyChains\T1</code> è·¯å¾„ä¸‹ï¼Œå…³é—­ä»¥å¤ªåŠé’±åŒ…å’Œ Mist ï¼Œå¯åŠ¨ç§æœ‰é“¾é“¾æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">geth --datadir <span class="string">"C:\MyChains\T1"</span> --identity <span class="string">"dev"</span> --rpccorsdomain <span class="string">"*"</span> --networkid 100 console</div></pre></td></tr></table></figure>
<p>æ‰§è¡ŒæˆåŠŸåæ˜¾ç¤ºï¼š</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/blockchain_start.png" alt="blockchain_start"></p>
<h3 id="åˆ›å»ºä»¥å¤ªåŠè´¦æˆ·"><a href="#åˆ›å»ºä»¥å¤ªåŠè´¦æˆ·" class="headerlink" title="åˆ›å»ºä»¥å¤ªåŠè´¦æˆ·"></a>åˆ›å»ºä»¥å¤ªåŠè´¦æˆ·</h3><p>ç§æœ‰é“¾å¯åŠ¨æˆåŠŸåï¼Œä¾¿ä¼šè¿›å…¥ä»¥å¤ªåŠ Geth Console æ§åˆ¶å°ï¼Œä»¥ <code>&gt;</code> ç¬¦å·å¼€å§‹ã€‚æŸ¥çœ‹ç§æœ‰é“¾ä¸Šçš„è´¦æˆ·ï¼ˆç›®å‰è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•è´¦æˆ·ï¼‰ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; eth.accounts</div><div class="line">[]</div></pre></td></tr></table></figure>
<p>é€šè¿‡ <code>personal.newAccount()</code> æŒ‡ä»¤ï¼ˆè¾“å…¥ä¸¤æ¬¡å¯†ç ï¼‰åˆ›å»º 2 ä¸ªæ–°è´¦æˆ·ã€‚</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/blockchain_newaccount.png" alt="newaccount"></p>
<p>æŸ¥çœ‹è´¦æˆ·ä½™é¢(ç›®å‰ä¸¤ä¸ªè´¦æˆ·ä½™é¢å‡ä¸º 0 )ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; eth.getBalance(eth.accounts[0])</div><div class="line">0</div><div class="line">&gt; eth.getBalance(eth.accounts[1])</div><div class="line">0</div></pre></td></tr></table></figure>
<p>è¦ä½¿è´¦æˆ·æœ‰ä½™é¢ï¼Œå¯ä»¥é€šè¿‡è½¬è´¦æˆ–è€…æŒ–çŸ¿æ¥è·å–ä»¥å¤ªå¸ï¼ˆETHï¼‰ã€‚</p>
<h3 id="æŒ–çŸ¿"><a href="#æŒ–çŸ¿" class="headerlink" title="æŒ–çŸ¿"></a>æŒ–çŸ¿</h3><p>ä»¥å¤ªåŠé€šè¿‡å‘½ä»¤ <code>miner.start([çº¿ç¨‹æ•°])</code> æ¥å¯åŠ¨æŒ–çŸ¿ï¼Œè¿™é‡Œå¯åŠ¨ 5 ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ–çŸ¿ï¼š</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/blockchain_miner_start.png" alt="miner_start"></p>
<p>å½“ percentage=100 åï¼Œé€šè¿‡å‘½ä»¤ <code>miner.stop()</code> ç»ˆæ­¢æŒ–çŸ¿ã€‚åœæ­¢æŒ–çŸ¿åï¼ŒæŸ¥çœ‹è´¦æˆ·ä½™é¢ï¼š</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/blockchain_miner_stop.png" alt="miner_stop"></p>
<p>PS: <code>getBalance()</code> è¿”å›å€¼çš„å•ä½æ˜¯ wei ï¼Œ wei æ˜¯ä»¥å¤ªå¸çš„æœ€å°å•ä½ï¼Œ1 ä¸ªä»¥å¤ªå¸ = 10 çš„ 18 æ¬¡æ–¹ä¸ª wei ã€‚æŸ¥çœ‹è´¦æˆ·æœ‰å¤šå°‘ä¸ªä»¥å¤ªå¸ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ <code>web3.fromWei()</code> å°† wei æ¢ç®—æˆä»¥å¤ªå¸ã€‚</p>
<h3 id="è½¬è´¦"><a href="#è½¬è´¦" class="headerlink" title="è½¬è´¦"></a>è½¬è´¦</h3><p>ç›®å‰æˆ‘ä»¬æœ‰ä¸¤ä¸ªè´¦æˆ·ï¼Œè´¦æˆ· 0 æœ‰ 105 ä¸ªä»¥å¤ªå¸ï¼Œ è´¦æˆ· 1 æœ‰ 0 ä¸ªä»¥å¤ªå¸ã€‚ç°åœ¨é€šè¿‡æ“ä½œè´¦æˆ· 0 å‘è´¦æˆ· 1 è½¬ 10 ä¸ªä»¥å¤ªå¸ã€‚</p>
<p>é¦–å…ˆé€šè¿‡è´¦æˆ· 0 çš„å¯†ç å¯¹è´¦æˆ· 0 è¿›è¡Œè§£é”ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; personal.unlockAccount(eth.accounts[0])</div><div class="line">Unlock account 0x33213084015dab454fee16eb369fa2a8e6e65eee</div><div class="line">Passphrase:</div><div class="line"><span class="literal">true</span></div></pre></td></tr></table></figure>
<p>æ“ä½œè´¦æˆ· 0 å‘è´¦æˆ· 1 è½¬ 10 ä¸ªä»¥å¤ªå¸:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; count = web3.toWei(10,<span class="string">'ether'</span>)</div><div class="line"><span class="string">"10000000000000000000"</span></div><div class="line">&gt; eth.sendTransaction(&#123;from:eth.accounts[0],to:eth.accounts[1],value:count&#125;)</div><div class="line">INFO [10-02|21:28:11.870] Setting new <span class="built_in">local</span> account                address=0x33213084015DAB454fEe16eb369FA2a8E6E65eEE</div><div class="line">INFO [10-02|21:28:11.885] Submitted transaction                    fullhash=0xa7adb20<span class="built_in">cd</span>2665d888b64bbccbf29ad5a5a1feb461ffb940</div><div class="line"><span class="string">"0xa7adb20cd2665d888b64bbccbf29ad5a5a1feb461ffb9407447c8dc608886a7e"</span></div></pre></td></tr></table></figure>
<p>äº¤æ˜“å‘é€åï¼ŒæŸ¥çœ‹è´¦æˆ· 1 çš„ä½™é¢ï¼Œå‘ç°è¿˜æ˜¯ 0 ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; eth.getBalance(eth.accounts[1])</div><div class="line">0</div><div class="line">&gt; txpool.status</div><div class="line">&#123;</div><div class="line">  pending: 1,</div><div class="line">  queued: 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è´¦æˆ· 0 è½¬ç»™è´¦æˆ· 1 çš„ä»¥å¤ªå¸è¿˜æœªåˆ°è´¦ï¼Œé€šè¿‡ <code>txpool.status</code> å‘½ä»¤æŸ¥çœ‹ï¼Œæœ‰ä¸€ç¬”äº¤æ˜“æœªå¤„ç†ï¼Œpending å­—æ®µè¡¨ç¤ºäº¤æ˜“å·²æäº¤ä½†è¿˜æœªè¢«å¤„ç†çš„äº¤æ˜“ã€‚ä¸ºä»€ä¹ˆäº¤æ˜“æœªè¢«å¤„ç†å‘¢ï¼Ÿå› ä¸ºå½“å‰é“¾ä¸Šæ²¡æœ‰çŸ¿å·¥åœ¨æŒ–çŸ¿ï¼Œå³è¯¥åŒºå—é“¾æ²¡æœ‰ç®—åŠ›æ¥å¤„ç†äº¤æ˜“ã€‚é€šè¿‡å‘½ä»¤ <code>miner.start(1);admin.sleepBlocks(1);miner.stop();</code> å¯åŠ¨æŒ–çŸ¿ï¼Œå¹¶åœ¨æŒ–åˆ°ä¸€ä¸ªåŒºå—ååœæ­¢æŒ–çŸ¿ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">&gt; miner.start(1);admin.sleepBlocks(1);miner.stop();</div><div class="line">INFO [10-02|21:29:01.378] Updated mining threads                   threads=1</div><div class="line">INFO [10-02|21:29:01.390] Transaction pool price threshold updated price=1000000000</div><div class="line">INFO [10-02|21:29:01.396] Commit new mining work                   number=22 sealhash=ee23d4â€¦78362e uncles=0 txs=0</div><div class="line">INFO [10-02|21:29:01.434] Commit new mining work                   number=22 sealhash=3ca4ddâ€¦c456e1 uncles=0 txs=1</div><div class="line">INFO [10-02|21:29:04.772] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=0 elapsed=2.123s</div><div class="line">INFO [10-02|21:29:06.896] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=1 elapsed=4.246s</div><div class="line">INFO [10-02|21:29:08.924] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=2 elapsed=6.274s</div><div class="line">INFO [10-02|21:29:10.851] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=3 elapsed=8.201s</div><div class="line">INFO [10-02|21:29:12.717] Successfully sealed new block            number=22 sealhash=3ca4ddâ€¦c456e1 <span class="built_in">hash</span>=0d293aâ€¦f</div><div class="line">INFO [10-02|21:29:12.881] ğŸ”¨ mined potential block                  number=22 <span class="built_in">hash</span>=0d293aâ€¦fa74a1</div><div class="line">INFO [10-02|21:29:12.892] Commit new mining work                   number=23 sealhash=e1b40bâ€¦1b3631 uncles=0 txs=0</div><div class="line">INFO [10-02|21:29:13.023] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=4 elapsed=10.373s</div><div class="line">null</div><div class="line">&gt; INFO [10-02|21:29:14.682] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=5 elapsed=12.032s</div><div class="line">INFO [10-02|21:29:16.528] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=6 elapsed=13.878s</div><div class="line">INFO [10-02|21:29:18.519] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=7 elapsed=15.869s</div><div class="line">INFO [10-02|21:29:20.207] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=8 elapsed=17.558s</div><div class="line">INFO [10-02|21:29:22.042] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=9 elapsed=19.393s</div><div class="line">INFO [10-02|21:29:23.899] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=10 elapsed=21.249s</div><div class="line">INFO [10-02|21:29:25.817] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=11 elapsed=23.167s</div><div class="line">INFO [10-02|21:29:27.605] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=12 elapsed=24.955s</div><div class="line">INFO [10-02|21:29:29.529] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=13 elapsed=26.879s</div><div class="line">INFO [10-02|21:29:31.255] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=14 elapsed=28.605s</div><div class="line">INFO [10-02|21:29:33.227] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=15 elapsed=30.577s</div><div class="line">INFO [10-02|21:29:35.041] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=16 elapsed=32.391s</div><div class="line">INFO [10-02|21:29:36.542] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=17 elapsed=33.892s</div><div class="line">INFO [10-02|21:29:38.093] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=18 elapsed=35.444s</div><div class="line">INFO [10-02|21:29:39.928] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=19 elapsed=37.279s</div><div class="line">INFO [10-02|21:29:41.835] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=20 elapsed=39.185s</div><div class="line">INFO [10-02|21:29:43.817] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=21 elapsed=41.167s</div><div class="line">INFO [10-02|21:29:45.506] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=22 elapsed=42.856s</div><div class="line">INFO [10-02|21:29:47.383] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=23 elapsed=44.733s</div><div class="line">INFO [10-02|21:29:49.006] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=24 elapsed=46.356s</div><div class="line">INFO [10-02|21:29:51.061] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=25 elapsed=48.411s</div><div class="line">INFO [10-02|21:29:52.928] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=26 elapsed=50.278s</div><div class="line">INFO [10-02|21:29:54.690] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=27 elapsed=52.040s</div><div class="line">INFO [10-02|21:29:56.612] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=28 elapsed=53.963s</div><div class="line">INFO [10-02|21:29:58.547] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=29 elapsed=55.897s</div><div class="line">INFO [10-02|21:30:00.662] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=30 elapsed=58.012s</div><div class="line">INFO [10-02|21:30:02.853] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=31 elapsed=1m0.203s</div><div class="line">INFO [10-02|21:30:04.967] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=32 elapsed=1m2.317s</div><div class="line">INFO [10-02|21:30:07.100] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=33 elapsed=1m4.450s</div><div class="line">INFO [10-02|21:30:09.305] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=34 elapsed=1m6.655s</div><div class="line">INFO [10-02|21:30:12.027] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=35 elapsed=1m9.377s</div><div class="line">INFO [10-02|21:30:15.647] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=36 elapsed=1m12.997s</div><div class="line">INFO [10-02|21:30:18.841] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=37 elapsed=1m16.191s</div><div class="line">INFO [10-02|21:30:21.048] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=38 elapsed=1m18.398s</div><div class="line">INFO [10-02|21:30:22.907] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=39 elapsed=1m20.257s</div><div class="line">INFO [10-02|21:30:25.220] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=40 elapsed=1m22.570s</div><div class="line">ERROR[10-02|21:30:25.367] The pipe is being closed.</div><div class="line"></div><div class="line">INFO [10-02|21:30:27.847] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=41 elapsed=1m25.197s</div><div class="line">INFO [10-02|21:30:30.042] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=42 elapsed=1m27.392s</div><div class="line">INFO [10-02|21:30:32.096] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=43 elapsed=1m29.447s</div><div class="line">INFO [10-02|21:30:34.722] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=44 elapsed=1m32.072s</div><div class="line">INFO [10-02|21:30:36.573] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=45 elapsed=1m33.923s</div><div class="line">INFO [10-02|21:30:38.233] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=46 elapsed=1m35.583s</div><div class="line">INFO [10-02|21:30:40.176] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=47 elapsed=1m37.526s</div><div class="line">INFO [10-02|21:30:41.973] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=48 elapsed=1m39.323s</div><div class="line">INFO [10-02|21:30:43.541] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=49 elapsed=1m40.891s</div><div class="line">ERROR[10-02|21:30:45.251] The pipe is being closed.</div><div class="line"></div><div class="line">INFO [10-02|21:30:45.603] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=50 elapsed=1m42.953s</div><div class="line">INFO [10-02|21:30:47.923] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=51 elapsed=1m45.274s</div><div class="line">INFO [10-02|21:30:49.805] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=52 elapsed=1m47.156s</div><div class="line">INFO [10-02|21:30:51.919] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=53 elapsed=1m49.269s</div><div class="line">INFO [10-02|21:30:53.608] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=54 elapsed=1m50.958s</div><div class="line">INFO [10-02|21:30:55.495] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=55 elapsed=1m52.845s</div><div class="line">INFO [10-02|21:30:57.525] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=56 elapsed=1m54.875s</div><div class="line">INFO [10-02|21:30:59.282] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=57 elapsed=1m56.632s</div><div class="line">INFO [10-02|21:31:01.103] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=58 elapsed=1m58.453s</div><div class="line">INFO [10-02|21:31:02.786] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=59 elapsed=2m0.136s</div><div class="line">INFO [10-02|21:31:04.432] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=60 elapsed=2m1.782s</div><div class="line">INFO [10-02|21:31:06.310] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=61 elapsed=2m3.661s</div><div class="line">INFO [10-02|21:31:08.257] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=62 elapsed=2m5.607s</div><div class="line">INFO [10-02|21:31:10.020] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=63 elapsed=2m7.370s</div><div class="line">INFO [10-02|21:31:11.977] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=64 elapsed=2m9.327s</div><div class="line">INFO [10-02|21:31:13.658] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=65 elapsed=2m11.008s</div><div class="line">INFO [10-02|21:31:15.305] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=66 elapsed=2m12.655s</div><div class="line">INFO [10-02|21:31:17.153] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=67 elapsed=2m14.503s</div><div class="line">INFO [10-02|21:31:19.010] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=68 elapsed=2m16.360s</div><div class="line">INFO [10-02|21:31:20.714] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=69 elapsed=2m18.064s</div><div class="line">INFO [10-02|21:31:22.771] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=70 elapsed=2m20.122s</div><div class="line">INFO [10-02|21:31:24.663] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=71 elapsed=2m22.014s</div><div class="line">INFO [10-02|21:31:26.595] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=72 elapsed=2m23.945s</div><div class="line">INFO [10-02|21:31:28.383] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=73 elapsed=2m25.733s</div><div class="line">INFO [10-02|21:31:30.136] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=74 elapsed=2m27.486s</div><div class="line">INFO [10-02|21:31:31.953] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=75 elapsed=2m29.303s</div><div class="line">INFO [10-02|21:31:33.914] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=76 elapsed=2m31.264s</div><div class="line">INFO [10-02|21:31:35.726] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=77 elapsed=2m33.076s</div><div class="line">INFO [10-02|21:31:37.357] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=78 elapsed=2m34.707s</div><div class="line">INFO [10-02|21:31:39.145] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=79 elapsed=2m36.495s</div><div class="line">INFO [10-02|21:31:40.857] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=80 elapsed=2m38.208s</div><div class="line">INFO [10-02|21:31:42.481] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=81 elapsed=2m39.832s</div><div class="line">INFO [10-02|21:31:44.210] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=82 elapsed=2m41.560s</div><div class="line">INFO [10-02|21:31:46.065] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=83 elapsed=2m43.415s</div><div class="line">INFO [10-02|21:31:48.009] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=84 elapsed=2m45.359s</div><div class="line">INFO [10-02|21:31:49.535] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=85 elapsed=2m46.885s</div><div class="line">INFO [10-02|21:31:51.370] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=86 elapsed=2m48.720s</div><div class="line">INFO [10-02|21:31:53.217] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=87 elapsed=2m50.567s</div><div class="line">INFO [10-02|21:31:55.001] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=88 elapsed=2m52.351s</div><div class="line">INFO [10-02|21:31:56.863] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=89 elapsed=2m54.213s</div><div class="line">INFO [10-02|21:31:58.758] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=90 elapsed=2m56.109s</div><div class="line">INFO [10-02|21:32:01.015] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=91 elapsed=2m58.365s</div><div class="line">INFO [10-02|21:32:02.656] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=92 elapsed=3m0.006s</div><div class="line">INFO [10-02|21:32:04.260] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=93 elapsed=3m1.610s</div><div class="line">INFO [10-02|21:32:06.299] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=94 elapsed=3m3.649s</div><div class="line">INFO [10-02|21:32:08.470] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=95 elapsed=3m5.820s</div><div class="line">INFO [10-02|21:32:10.052] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=96 elapsed=3m7.402s</div><div class="line">INFO [10-02|21:32:12.307] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=97 elapsed=3m9.657s</div><div class="line">INFO [10-02|21:32:15.145] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=98 elapsed=3m12.496s</div><div class="line">INFO [10-02|21:32:19.571] Generating DAG <span class="keyword">in</span> progress               epoch=1 percentage=99 elapsed=3m16.921s</div><div class="line">INFO [10-02|21:32:19.586] Generated ethash verification cache      epoch=1 elapsed=3m16.936s</div></pre></td></tr></table></figure>
<p>åœ¨æŸ¥çœ‹æœªå¤„ç†çš„äº¤æ˜“æ•°åŠä¸¤ä¸ªè´¦æˆ·çš„ä½™é¢ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> txpool.status</div><div class="line">&#123;</div><div class="line">  pending: 0,</div><div class="line">  queued: 0</div><div class="line">&#125;</div><div class="line">&gt;</div><div class="line">&gt; web3.fromWei(eth.getBalance(eth.accounts[1]),<span class="string">'ether'</span>)</div><div class="line">10</div><div class="line">&gt; web3.fromWei(eth.getBalance(eth.accounts[0]),<span class="string">'ether'</span>)</div><div class="line">95</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœªå¤„ç†äº¤æ˜“æ•°ä¸º 0 ï¼Œè´¦æˆ· 0 ä½™é¢ä¸º 10 ä¸ªä»¥å¤ªå¸ã€‚ä¹Ÿå¯ä»¥æ‰“å¼€ä»¥å¤ªåŠé’±åŒ…æˆ– Mist æŸ¥çœ‹è´¦æˆ·åŠä½™é¢ã€‚</p>
<p><img src="http://pg12w9eve.bkt.clouddn.com/mist_account.png" alt="mist_account"></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20181003.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;ç©ç©
    
    </summary>
    
      <category term="åŒºå—é“¾" scheme="https://githubhaohao.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    
      <category term="åŒºå—é“¾" scheme="https://githubhaohao.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
      <category term="ä»¥å¤ªåŠ" scheme="https://githubhaohao.github.io/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/"/>
    
  </entry>
  
  <entry>
    <title>æ¯•ä¸šåçš„è¿™åŠå¹´</title>
    <link href="https://githubhaohao.github.io/2018/09/09/half-a-year-after-graduation/"/>
    <id>https://githubhaohao.github.io/2018/09/09/half-a-year-after-graduation/</id>
    <published>2018-09-09T06:39:23.000Z</published>
    <updated>2018-09-09T09:23:53.416Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180909.jpg" alt="Markdown"></p><p></p>
<p><div align="center">è¿™åŠå¹´éƒ½åœ¨å¹²å•¥</div><br></p>
<h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>åˆšæ¥å…¬å¸å‡ å¤©ï¼ŒTeam Leader ä¾¿ç»™æˆ‘åˆ†é…äº†ä¸€ä¸ªç‹¬ç«‹å¼€å‘çš„ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡æœ‰ç›¸å½“ä¸€éƒ¨åˆ†å¯¹æˆ‘æ¥è¯´æ˜¯é™Œç”Ÿçš„é¢†åŸŸã€‚Leader é—®æˆ‘ï¼Œå°ä¼™å­ï¼Œå‡ å¤©å¯ä»¥æå®šå•Šï¼Ÿç„¶åï¼Œå½“æ—¶ä¸çŸ¥é“è‡ªå·±å“ªæ¥çš„è‡ªä¿¡ï¼Œéšå£ä¸€å¥ï¼Œä¸¤å¤©å¯ä»¥æå®šï¼è¯´å®Œä¹‹åå½“æ—¶å°±åæ‚”äº†ã€‚è¯´å®åœ¨è¯ï¼Œè¯„ä¼°å·¥ä½œé‡çš„ç¡®ä¹Ÿæ˜¯ä¸€ç§èƒ½åŠ›ã€‚äº‹å®è¯æ˜æ¬ ç¼ºè¿™ç§èƒ½åŠ›çš„æˆ‘ï¼Œè¢«ç»“ç»“å®å®æ‰“è„¸ã€‚è¿™ä¸ªé¡¹ç›®æœ€ååŸºæœ¬å®Œæˆç”¨äº†ä¸€å‘¨ï¼ŒJava å±‚å°±æäº†å¿«ä¸¤å¤©ï¼ŒæœŸé—´é¡¹ç›®ç»ç†æ¯å¤©è¿‡æ¥å‚¬ä¸€ä¸‹ï¼Œé—®ä¸€ä¸‹è¿›åº¦ï¼Œè¯´ä¸€ä¸‹ deadline ï¼Œæå¾—æˆ‘æ¯å¤©â€œå‹åŠ›å±±å¤§â€ï¼Œä¸€æƒ³åˆ°â€œè¢«æ‰“è„¸â€ï¼Œåˆ†åˆ†é’Ÿæƒ³åˆ‡è…¹ï¼Œå¥½åœ¨ Leader å’Œé¡¹ç›®ç»ç†æœ€åéƒ½æ²¡è·Ÿæˆ‘è®¡è¾ƒï¼Œä¼°è®¡ä¹Ÿæ˜¯æ— è¯­å•Šã€‚å“ï¼Œä»¥åé•¿ç‚¹å¿ƒå•Šã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯ï¼Œèº«è¾¹æœ‰å¾ˆæ£’çš„åŒäº‹ã€‚æç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸æˆ‘ä»¬ Team æ— å…³çš„ç®—æ³•å“¥ï¼Œå ç”¨è‡ªå·±çš„å·¥ä½œæ—¶é—´è€å¿ƒè·Ÿæˆ‘åˆ†ææˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œæ•²ä»£ç ä¸€ä¸ä¸è‹Ÿï¼Œé—®é¢˜å¿…é¡»æ‰¾åˆ° root cause ï¼Œä¸èƒ½é€ƒé¿é—®é¢˜ï¼Œç€å®ç»™æˆ‘ä¸Šäº†ä¸€è¯¾ã€‚</p>
<p>è¿™å‡ ä¸ªæœˆï¼Œå‰å‰ååä¹Ÿç‹¬ç«‹æäº†å¥½å‡ ä¸ªé¡¹ç›®ï¼Œå¯¹æœ¬ Team çš„ç›¸å…³ä¸šåŠ¡ä¸Šæ‰‹äº†ï¼Œå¯ä»¥æŒ¤æŒ¤æ—¶é—´æ‰©å±•ä¸€ä¸‹å·¥ä½œä¸­ç”¨åˆ°çš„é™Œç”ŸçŸ¥è¯†é¢†åŸŸï¼Œå¯ä»¥æ‹†æ‹†è½®å­äº†ã€‚</p>
<h2 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h2><p>ç¦»å¼€å­¦æ ¡ä¹‹åï¼Œå­¦ä¹ çš„å½¢å¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå·¥ä½œä¹‹å¤–çš„å­¦ä¹ ä¸»è¦å‘ç”Ÿåœ¨é€šå‹¤æ—¶é—´ï¼ŒèŠ±é’±è®¢é˜…äº†å¾—åˆ°ã€å–œé©¬æ‹‰é›… FM ç­‰ä¸€äº›ä»˜è´¹ä¸“æ ï¼Œè¿›äº†å‡ ä¸ªå¤§ä½¬çš„çŸ¥è¯†æ˜Ÿçƒï¼Œä¸»è¦çš„è®¢é˜…ç±»å‹æ˜¯æŠ•èµ„ç†è´¢ï¼ˆè™½ç„¶æ²¡é’±ä¹Ÿåè¦å­¦ï¼‰ã€å†å²ã€å¿ƒç†å­¦ã€ç»æµå­¦ã€‚æœ€è¿‘å¬ä¸‹æ¥ï¼Œç¡®å®æƒ³åæ§½ä¸€ä¸‹éƒ¨åˆ†å¿ƒç†å­¦ä¸“æ ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒåƒåœ¾ï¼Œè®²çš„è§‚ç‚¹åŠä¾‹å­å¤§éƒ¨åˆ†ç¼ºä¹é€»è¾‘å…³è”æ€§å’Œè¯´æœåŠ›ï¼Œå‡ ä¸ªè—¤æ ¡æ¯•ä¸šçš„å–è¿‡ä¸å°‘æ´‹å¢¨æ°´å°±æ•¢è·‘å›å›½å†…çŸ¥è¯†ä»˜è´¹å¹³å°åœˆé’±ï¼Œè¿˜æœ‰ä¸ªäººæ„Ÿè§‰å¾—åˆ°çš„ 19.9 å…ƒçš„ç²¾å“è¯¾ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åƒåœ¾ï¼Œå†æ¬¡å°è¯ä¾¿å®œæ²¡å¥½è´§è¿™ç§æœ´ç´ çš„é“ç†ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸å°‘è´¨é‡è¿‡ç¡¬çš„ä»˜è´¹è¯¾ï¼Œæ¯”å¦‚æ–½å±•è€å¸ˆçš„ã€Šä¸­å›½å²çº²äº”åè®²ã€‹ï¼Œè§‚ç‚¹ç‹¬ç‰¹ï¼Œåˆ†æè§’åº¦å¤šå…ƒï¼Œè¿˜æœ‰å»å¹´å§šå…†ä¸°çš„ç»æµå­¦è¯¾ç­‰ã€‚</p>
<p>è¦é—®å¬äº†è¿™äº›ä»˜è´¹è¯¾æœ‰ä»€ä¹ˆæ”¶è·ï¼Ÿä»˜è´¹åªæ˜¯åšä¸€ä¸‹ç­›é€‰ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„æ”¶è·ï¼ˆå¯èƒ½ä¸ªäººé¢†æ‚Ÿèƒ½åŠ›æœ‰é™ï¼‰ï¼Œåªæ˜¯æ»¡è¶³ä¸€ä¸‹å¥½å¥‡å¿ƒå’Œå…´è¶£ï¼Œç¼“è§£ä¸€ä¸‹ç„¦è™‘ï¼ˆä¸ªäººæ„Ÿè§‰çŸ¥è¯†ä»˜è´¹å®é™…ä¸Šæ˜¯åˆ¶é€ ç„¦è™‘ï¼‰ã€‚</p>
<p>è¿˜æœ‰å°±æ˜¯è®¢é˜…äº†ä¸å°‘è´¨é‡ä¸é”™çš„å…¬å·ï¼Œç¢ç‰‡åŒ–é˜…è¯»ï¼ŒåŸ¹å…»è‡ªå·±çš„é˜…è¯»ä¹ æƒ¯ï¼Œæ¯•ä¸šåï¼Œæ²¡äº†è€ƒè¯•ï¼Œç°åœ¨å·²ç»æ²¡æœ‰è€å¿ƒå°†ä¸€æœ¬ä¹¦å®Œå®Œæ•´æ•´çš„çœ‹ä¸€éã€‚ç­‰ç­‰ï¼Œç¬‘æ¥å¥½åƒè¯´è¿‡ï¼Œä»–è®¤ä¸ºç¢ç‰‡åŒ–é˜…è¯»ï¼ˆå­¦ä¹ ï¼‰éƒ½æ˜¯æ‰¯æ·¡ï¼Œä½ è§è¿‡é æ¡ç¡¬å¸æˆä¸ºå¯Œç¿çš„å—ï¼Œäº‘äº‘ã€‚</p>
<h2 id="å®¶åº­"><a href="#å®¶åº­" class="headerlink" title="å®¶åº­"></a>å®¶åº­</h2><p>åœ¨æ­å·ç”Ÿæ´»çš„è¿™å‡ å¹´ï¼Œè§è¯äº†æˆ¿ä»·å¦‚åç«ç®­èˆ¬ä¸Šæ¶¨ï¼Œæ˜çŸ¥å‰å‡ å¹´ä¸Šè½¦åˆ†åˆ†é’Ÿç¿»å€ï¼Œå¯æ˜¯æ²¡é’±ï¼Œå€Ÿéƒ½å€Ÿä¸åˆ°é‚£ç§ï¼Œä½ è¯´æ°”ä¸æ°”ã€‚æœ€è¿‘ 1 å¹´æˆ¿ä»·é™äº†ï¼Œæˆ¿ç§Ÿæ¶¨äº†èµ·æ¥ï¼Œå†åŠ ä¸Šé‡è›®èµ„æœ¬å…¥å±€ï¼Œæœ€è¿‘æäº†å¥½å‡ ä¸ªçƒ­ç‚¹ã€‚æˆ‘ä»¬çš„æˆ¿ç§Ÿä»ä¸€å¼€å§‹çš„ 1000 å¤šä¹Ÿåˆ°ç°åœ¨çš„ 3000 å¤šï¼Œæ¢æˆä¸¤å±…ä¸»è¦æ˜¯è¦æœ‰å°å®å®äº†ï¼Œå¦å¤–æ­å·ç‰©ä»·ä¹Ÿé«˜çš„ä¸€ç¬”ï¼Œæˆ‘å¦ˆä»è€å®¶è¿‡æ¥ï¼Œéƒ½èˆä¸å¾—ä¹°èœã€‚</p>
<p></p><p align="center"><img src="http://pes05nlxb.bkt.clouddn.com/baby.jpg" alt="Markdown"></p><p></p>
<p></p><p align="center">ä»–æ¥äº†ï¼Œæˆ‘å°±è¦å°½æˆ‘æ‰€èƒ½ç»™ä»–æœ€å¥½çš„ </p><br>ä¸Šä¸ªæœˆåº•ï¼Œæˆ‘å®¶å°å®å®é™ç”Ÿäº†ã€‚è¾›è‹¦åª³å¦‡å„¿äº†ï¼Œ12 çº§çš„é˜µç—›æŒç»­äº†ä¸€ä¸ªä¸‹åˆï¼Œç–¼åˆ°è‡ªå·±ç²¾ç¥éƒ½å·²ç»å´©æºƒäº†ï¼Œè¿˜åœ¨ä¸ºå®å®çš„å®‰å…¨æ‹…å¿§ï¼ŒåŠªåŠ›é…åˆåŒ»ç”Ÿã€‚åªæœ‰è¿›äº†äº§æˆ¿ä½ æ‰çŸ¥é“ï¼Œæ¯ä¸€ä¸ªæ¯äº²éƒ½éå¸¸ä¼Ÿå¤§ã€‚<p></p>
<p>ä¸€äº›è€å¸ˆæœ‹å‹éƒ½è¯´ï¼Œæˆ‘è¿™ä¸ªå¹´é¾„æ®µæœ‰å°å®å®æœ‰ç‚¹æ—©ï¼Œæ¥ä¸‹æ¥åœ¨è¿™ä¸ªåŸå¸‚ç”Ÿæ´»çš„æ‹…å­å¯èƒ½ä¼šæ›´é‡ã€‚æ‰€ä»¥ï¼Œç‰¹åˆ«æ„Ÿæ¿€æˆ‘çš„çˆ¶æ¯å’Œå²³çˆ¶å²³æ¯å¯¹æˆ‘ä»¬çš„æ”¯æŒå’Œå¸®åŠ©ï¼Œå¸®æˆ‘ä»¬åˆ†æ‹…äº†ç”Ÿæ´»çš„å‹åŠ›ã€‚ä»–æ¥äº†ï¼Œæˆ‘å°±è¦å°½æˆ‘æ‰€èƒ½ç»™ä»–æœ€å¥½çš„ï¼Œåœ¨æˆ‘æ‡ˆæ€ çš„æ—¶å€™ï¼Œèº«åä¼šå¤šä¸€åŒå°æ‰‹æ¨ç€æˆ‘ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180909.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;è¿™åŠ
    
    </summary>
    
      <category term="ç”Ÿæ´»" scheme="https://githubhaohao.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="æ€»ç»“" scheme="https://githubhaohao.github.io/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>ä¸¤ä¸ªå¸¸è§çš„ NDK ç¼–è¯‘é”™è¯¯</title>
    <link href="https://githubhaohao.github.io/2018/06/16/Two-common-ndk-compilation-errors/"/>
    <id>https://githubhaohao.github.io/2018/06/16/Two-common-ndk-compilation-errors/</id>
    <published>2018-06-16T09:21:43.000Z</published>
    <updated>2018-06-16T09:34:49.531Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180616.png" alt="Markdown"></p><p></p>
<p><div align="center"> NDK ç¼–è¯‘ä¸­ç»å¸¸å‡ºç°çš„ä¸¤ä¸ªé—®é¢˜</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ NDK ç¼–è¯‘ä¸­ç»å¸¸å‡ºç°çš„ä¸¤ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•ã€‚</p>
</blockquote>
<h1 id="å¸¸è§é”™è¯¯ä¸€"><a href="#å¸¸è§é”™è¯¯ä¸€" class="headerlink" title="å¸¸è§é”™è¯¯ä¸€"></a>å¸¸è§é”™è¯¯ä¸€</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">error: undefined reference to &apos;omp_set_num_threads&apos;</div><div class="line">error: undefined reference to &apos;omp_get_num_threads&apos;</div><div class="line">error: undefined reference to &apos;GOMP_parallel&apos;</div></pre></td></tr></table></figure>
<p>åŸå› ï¼šæœªæä¾›æ”¯æŒ OpenMP</p>
<p>OpenMPï¼ˆOpen Multi-Processingï¼‰æ˜¯ç”± OpenMP Architecture Review Board æå‡ºçš„ï¼Œå¹¶å·²è¢«å¹¿æ³›æ¥å—çš„ï¼Œç”¨äºå…±äº«å†…å­˜å¹¶è¡Œç³»ç»Ÿå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„ä¸€å¥—æŒ‡å¯¼æ€§æ³¨é‡Šã€‚OpenMP æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ C è¯­è¨€ã€C++ ç­‰ã€‚OpenMP æä¾›äº†å¯¹å¹¶è¡Œç®—æ³•çš„é«˜å±‚çš„æŠ½è±¡æè¿°ï¼Œç¨‹åºå‘˜é€šè¿‡åœ¨æºä»£ç ä¸­åŠ å…¥ä¸“ç”¨çš„ pragma æ¥æŒ‡æ˜è‡ªå·±çš„æ„å›¾ï¼Œç”±æ­¤ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨å°†ç¨‹åºè¿›è¡Œå¹¶è¡ŒåŒ–ï¼Œå¹¶åœ¨å¿…è¦ä¹‹å¤„åŠ å…¥åŒæ­¥äº’æ–¥ä»¥åŠé€šä¿¡ã€‚å½“é€‰æ‹©å¿½ç•¥è¿™äº› pragma ï¼Œæˆ–è€…ç¼–è¯‘å™¨ä¸æ”¯æŒ OpenMP æ—¶ï¼Œç¨‹åºåˆå¯é€€åŒ–ä¸ºé€šå¸¸çš„ç¨‹åºï¼ˆä¸€èˆ¬ä¸ºä¸²è¡Œï¼‰ï¼Œä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸è¿ä½œï¼Œåªæ˜¯ä¸èƒ½åˆ©ç”¨å¤šçº¿ç¨‹æ¥åŠ é€Ÿç¨‹åºæ‰§è¡Œã€‚</p>
<p>åœ¨ local_ldlibs æ·»åŠ æ”¯æŒ OpenMP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LOCAL_LDLIBS := -llog -fopenmp</div></pre></td></tr></table></figure></p>
<h1 id="å¸¸è§é”™è¯¯äºŒ"><a href="#å¸¸è§é”™è¯¯äºŒ" class="headerlink" title="å¸¸è§é”™è¯¯äºŒ"></a>å¸¸è§é”™è¯¯äºŒ</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">error: undefined reference to &apos;std::ios_base::Init::Init()&apos;</div><div class="line">error: undefined reference to &apos;std::ios_base::Init::~Init()&apos;</div><div class="line">error: undefined reference to &apos;std::__throw_length_error(char const*)&apos;</div></pre></td></tr></table></figure>
<p>åŸå› ï¼šæœªæä¾›æ”¯æŒ GNU STL</p>
<p>Android NDK é»˜è®¤æ”¯æŒçš„æ˜¯æœ€å°ç³»ç»Ÿ C++ è¿è¡Œæ—¶åº“ï¼ˆlibstdc++ï¼‰</p>
<p>NDK è¿è¡Œæ—¶åº“<br><img src="http://ovv1lq7pk.bkt.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20180616154000.png" alt="ndk"></p>
<p>è¯¦ç»†è§ï¼š<a href="https://developer.android.com/ndk/guides/cpp-support?hl=zh-cn" target="_blank" rel="external">https://developer.android.com/ndk/guides/cpp-support?hl=zh-cn</a></p>
<p>åœ¨ Android.mk æ–‡ä»¶ä¸­è®¾ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#STL path and libs</div><div class="line">GNU_STL_PATH :=$(NDK_ROOT)/sources/cxx-stl/gnu-libstdc++/$(NDK_TOOLCHAIN_VERSION)/libs/$(TARGET_ARCH_ABI)</div><div class="line">GNU_STL_LIB_NAME :=gnustl_static</div><div class="line"></div><div class="line">#link system libs and stl</div><div class="line">LOCAL_LDLIBS := -llog -L$(GNU_STL_PATH) -l$(GNU_STL_LIB_NAME)</div></pre></td></tr></table></figure>
<p>åœ¨ Application.mk æ–‡ä»¶ä¸­è®¾ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">APP_STL := gnustl_static</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180616.png&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt; N
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="ç¼–è¯‘é—®é¢˜" scheme="https://githubhaohao.github.io/tags/%E7%BC%96%E8%AF%91%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>NDK ç›´æ’­æ¨æµä¸å¼•æµ</title>
    <link href="https://githubhaohao.github.io/2018/02/10/NDK-live-streaming-push-and-pull/"/>
    <id>https://githubhaohao.github.io/2018/02/10/NDK-live-streaming-push-and-pull/</id>
    <published>2018-02-10T05:28:00.000Z</published>
    <updated>2018-02-10T07:57:47.222Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180229.jpeg" alt="Markdown"></p><p></p>
<p><div align="center">æœ€å¥½çš„å¹´ç»ˆå¥–æ˜¯æ‹¥æœ‰éšæ—¶å¯ä»¥è·³æ§½çš„èƒ½åŠ›ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ç›´æ’­æŠ€æœ¯ä¸­æ¨æµä¸å¼•æµçš„ç®€å•å®ç°ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š                                                                                                                                                                                          </p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
<li><a href="http://haohaochang.cn/2018/01/09/NDK-posix-multi-thread/" target="_blank" rel="external">NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
<li><a href="http://haohaochang.cn/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/" target="_blank" rel="external">NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸æ’­æ”¾</a></li>
<li><a href="http://haohaochang.cn/2018/01/20/NDK-FFmpeg-compile/" target="_blank" rel="external">NDK FFmpeg ç¼–è¯‘</a></li>
<li><a href="http://haohaochang.cn/2018/01/24/NDK-FFmpeg-video-decoding/" target="_blank" rel="external">NDK FFmpeg éŸ³è§†é¢‘è§£ç </a></li>
<li><a href="http://haohaochang.cn/2018/02/03/NDK-set-up-streaming-media-server/" target="_blank" rel="external">NDK ç›´æ’­æµåª’ä½“æœåŠ¡å™¨æ­å»º</a></li>
</ul>
<h1 id="æµåª’ä½“æœåŠ¡å™¨æµ‹è¯•"><a href="#æµåª’ä½“æœåŠ¡å™¨æµ‹è¯•" class="headerlink" title="æµåª’ä½“æœåŠ¡å™¨æµ‹è¯•"></a>æµåª’ä½“æœåŠ¡å™¨æµ‹è¯•</h1><p>é¦–å…ˆåˆ©ç”¨<a href="https://apkpure.biz/cn.nodemedia.qlive/%E5%BF%AB%E7%9B%B4%E6%92%AD" target="_blank" rel="external">å¿«ç›´æ’­ app</a>ï¼ˆå…¶ä»–æ”¯æŒ RTMP æ¨æµä¸å¼•æµçš„ app äº¦å¯ï¼‰å’Œ ffplay.exe å¯¹æµåª’ä½“æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>å¿«ç›´æ’­çš„æ¨æµç•Œé¢å’Œå¼•æµç•Œé¢<br><img src="http://ovv1lq7pk.bkt.clouddn.com/live/qlive_push.jpg" alt=""></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/live/qlive_play.jpg" alt=""></p>
<p>Windows ä¸‹åˆ©ç”¨ ffplay è¿›è¡Œå¼•æµï¼Œå‘½ä»¤è¡Œæ‰§è¡Œï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ffplay rtmp://192.168.0.0/live/<span class="built_in">test</span>  </div><div class="line"><span class="comment"># ip åœ°å€æ¢æˆæµåª’ä½“æœåŠ¡å™¨çš„åœ°å€ï¼Œ test è¡¨ç¤ºç›´æ’­æˆ¿é—´å·</span></div></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ç»“æœï¼š<br><img src="http://ovv1lq7pk.bkt.clouddn.com/live/live_test.png" alt=""></p>
<h1 id="æ¨æµ"><a href="#æ¨æµ" class="headerlink" title="æ¨æµ"></a>æ¨æµ</h1><p>æœ¬æ–‡ç›´æ’­æ¨æµæ­¥éª¤ï¼š</p>
<ul>
<li>ä½¿ç”¨ AudioRecord é‡‡é›†éŸ³é¢‘ï¼Œä½¿ç”¨ Camera API é‡‡é›†è§†é¢‘æ•°æ®</li>
<li>åˆ†åˆ«ä½¿ç”¨ faac å’Œ xh264 ç¬¬ä¸‰æ–¹åº“åœ¨ Native å±‚å¯¹éŸ³é¢‘å’Œè§†é¢‘è¿›è¡Œç¼–ç </li>
<li>åˆ©ç”¨ rtmp-dump ç¬¬ä¸‰æ–¹åº“è¿›è¡Œæ‰“åŒ…å’Œæ¨æµ</li>
</ul>
<p>å·¥ç¨‹ç›®å½•ï¼š<br><img src="http://ovv1lq7pk.bkt.clouddn.com/live/project_structure.png" alt=""></p>
<p>ä¸»è¦çš„ JNI æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NativePush</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">startPush</span><span class="params">(String url)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">stopPush</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¾ç½®è§†é¢‘å‚æ•°</div><div class="line">     * <span class="doctag">@param</span> width</div><div class="line">     * <span class="doctag">@param</span> height</div><div class="line">     * <span class="doctag">@param</span> bitrate</div><div class="line">     * <span class="doctag">@param</span> fps</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">setVideoOptions</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> bitrate, <span class="keyword">int</span> fps)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è®¾ç½®éŸ³é¢‘å‚æ•°</div><div class="line">     * <span class="doctag">@param</span> sampleRateInHz</div><div class="line">     * <span class="doctag">@param</span> channel</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">setAudioOptions</span><span class="params">(<span class="keyword">int</span> sampleRateInHz, <span class="keyword">int</span> channel)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å‘é€è§†é¢‘æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> data</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">fireVideo</span><span class="params">(<span class="keyword">byte</span>[] data)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * å‘é€éŸ³é¢‘æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> data</div><div class="line">     * <span class="doctag">@param</span> len</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">fireAudio</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> len)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="è§†é¢‘é‡‡é›†"><a href="#è§†é¢‘é‡‡é›†" class="headerlink" title="è§†é¢‘é‡‡é›†"></a>è§†é¢‘é‡‡é›†</h2><p>è§†é¢‘é‡‡é›†ä¸»è¦åŸºäº Camera ç›¸å…³ API ï¼Œåˆ©ç”¨ SurfaceView è¿›è¡Œé¢„è§ˆï¼Œé€šè¿‡ PreviewCallback è·å–ç›¸æœºé¢„è§ˆæ•°æ®ã€‚</p>
<p>è§†é¢‘é¢„è§ˆä¸»è¦ä»£ç å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startPreview</span><span class="params">()</span></span>&#123;</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">         mCamera = Camera.open(mVideoParams.getCameraId());</div><div class="line">         Camera.Parameters param = mCamera.getParameters();</div><div class="line"></div><div class="line">         List&lt;Camera.Size&gt; previewSizes = param.getSupportedPreviewSizes();</div><div class="line">         <span class="keyword">int</span> length = previewSizes.size();</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">             Log.i(TAG, <span class="string">"SupportedPreviewSizes : "</span> + previewSizes.get(i).width + <span class="string">"x"</span> + previewSizes.get(i).height);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         mVideoParams.setWidth(previewSizes.get(<span class="number">0</span>).width);</div><div class="line">         mVideoParams.setHeight(previewSizes.get(<span class="number">0</span>).height);</div><div class="line"></div><div class="line">         param.setPreviewFormat(ImageFormat.NV21);</div><div class="line">         param.setPreviewSize(mVideoParams.getWidth(), mVideoParams.getHeight());</div><div class="line"></div><div class="line">         mCamera.setParameters(param);</div><div class="line">         <span class="comment">//mCamera.setDisplayOrientation(90); // ç«–å±</span></div><div class="line">         mCamera.setPreviewDisplay(mSurfaceHolder);</div><div class="line"></div><div class="line">         buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[mVideoParams.getWidth() * mVideoParams.getHeight() * <span class="number">4</span>];</div><div class="line">         mCamera.addCallbackBuffer(buffer);</div><div class="line">         mCamera.setPreviewCallbackWithBuffer(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">         mCamera.startPreview();</div><div class="line">     &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">         e.printStackTrace();</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨ FrameCallback è·å–é¢„è§ˆæ•°æ®ä¼ å…¥ Native å±‚ï¼Œç„¶åè¿›è¡Œç¼–ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPreviewFrame</span><span class="params">(<span class="keyword">byte</span>[] bytes, Camera camera)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (mCamera != <span class="keyword">null</span>) &#123;</div><div class="line">        mCamera.addCallbackBuffer(buffer);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mIsPushing) &#123;</div><div class="line">        mNativePush.fireVideo(bytes);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="éŸ³é¢‘é‡‡é›†"><a href="#éŸ³é¢‘é‡‡é›†" class="headerlink" title="éŸ³é¢‘é‡‡é›†"></a>éŸ³é¢‘é‡‡é›†</h2><p>éŸ³é¢‘é‡‡é›†åŸºäº AudioRecord å®ç°ï¼Œåœ¨ä¸€ä¸ªå­çº¿ç¨‹é‡‡é›†éŸ³é¢‘ PCM æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¸æ–­ä¼ å…¥ Native å±‚è¿›è¡Œç¼–ç ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">AudioRecordRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        mAudioRecord.startRecording();</div><div class="line">        <span class="keyword">while</span> (mIsPushing) &#123;</div><div class="line">            <span class="comment">//é€šè¿‡AudioRecordä¸æ–­è¯»å–éŸ³é¢‘æ•°æ®</span></div><div class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[mMinBufferSize];</div><div class="line">            <span class="keyword">int</span> length = mAudioRecord.read(buffer, <span class="number">0</span>, buffer.length);</div><div class="line">            <span class="keyword">if</span> (length &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">//ä¼ é€’ç»™ Native ä»£ç ï¼Œè¿›è¡ŒéŸ³é¢‘ç¼–ç </span></div><div class="line">                mNativePush.fireAudio(buffer, length);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ç¼–ç å’Œæ¨æµ"><a href="#ç¼–ç å’Œæ¨æµ" class="headerlink" title="ç¼–ç å’Œæ¨æµ"></a>ç¼–ç å’Œæ¨æµ</h2><p>éŸ³è§†é¢‘æ•°æ®ç¼–ç å’Œæ¨æµåœ¨ Native å±‚å®ç°ï¼Œé¦–å…ˆæ·»åŠ  faac ï¼Œ x264 ï¼Œ librtmp ç¬¬ä¸‰æ–¹åº“åˆ° AS å·¥ç¨‹ï¼Œç„¶ååˆå§‹åŒ–ç›¸å…³è®¾ç½®ï¼ŒåŸºäºç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå°†ç¼–ç åçš„éŸ³è§†é¢‘æ•°æ®ï¼Œåœ¨ç”Ÿäº§è€…çº¿ç¨‹ä¸­æ‰“åŒ… RTMPPacket æ”¾å…¥åŒå‘é“¾è¡¨ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ä»é“¾è¡¨ä¸­å– RTMPPacket ï¼Œé€šè¿‡ RTMP_SendPacket æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ã€‚</p>
<p>x264 åˆå§‹åŒ–ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_live_jni_NativePush_setVideoOptions</span><span class="params">(JNIEnv *env, jobject instance, jint width,</span></div><div class="line">                                                    jint height, jint bitRate, jint fps) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">x264_param_t</span> param;</div><div class="line">    <span class="comment">//x264_param_default_preset è®¾ç½®</span></div><div class="line">    x264_param_default_preset(&amp;param, <span class="string">"ultrafast"</span>, <span class="string">"zerolatency"</span>);</div><div class="line">    <span class="comment">//ç¼–ç è¾“å…¥çš„åƒç´ æ ¼å¼YUV420P</span></div><div class="line">    param.i_csp = X264_CSP_I420;</div><div class="line">    param.i_width = width;</div><div class="line">    param.i_height = height;</div><div class="line"></div><div class="line">    y_len = width * height;</div><div class="line">    u_len = y_len / <span class="number">4</span>;</div><div class="line">    v_len = u_len;</div><div class="line"></div><div class="line">    <span class="comment">//å‚æ•°i_rc_methodè¡¨ç¤ºç ç‡æ§åˆ¶ï¼ŒCQP(æ’å®šè´¨é‡)ï¼ŒCRF(æ’å®šç ç‡)ï¼ŒABR(å¹³å‡ç ç‡)</span></div><div class="line">    <span class="comment">//æ’å®šç ç‡ï¼Œä¼šå°½é‡æ§åˆ¶åœ¨å›ºå®šç ç‡</span></div><div class="line">    param.rc.i_rc_method = X264_RC_CRF;</div><div class="line">    param.rc.i_bitrate = bitRate / <span class="number">1000</span>; <span class="comment">//* ç ç‡(æ¯”ç‰¹ç‡,å•ä½Kbps)</span></div><div class="line">    param.rc.i_vbv_max_bitrate = bitRate / <span class="number">1000</span> * <span class="number">1.2</span>; <span class="comment">//ç¬æ—¶æœ€å¤§ç ç‡</span></div><div class="line"></div><div class="line">    <span class="comment">//ç ç‡æ§åˆ¶ä¸é€šè¿‡timebaseå’Œtimestampï¼Œè€Œæ˜¯fps</span></div><div class="line">    param.b_vfr_input = <span class="number">0</span>;</div><div class="line">    param.i_fps_num = fps; <span class="comment">//* å¸§ç‡åˆ†å­</span></div><div class="line">    param.i_fps_den = <span class="number">1</span>; <span class="comment">//* å¸§ç‡åˆ†æ¯</span></div><div class="line">    param.i_timebase_den = param.i_fps_num;</div><div class="line">    param.i_timebase_num = param.i_fps_den;</div><div class="line">    param.i_threads = <span class="number">1</span>;<span class="comment">//å¹¶è¡Œç¼–ç çº¿ç¨‹æ•°é‡ï¼Œ0é»˜è®¤ä¸ºå¤šçº¿ç¨‹</span></div><div class="line"></div><div class="line">    <span class="comment">//æ˜¯å¦æŠŠSPSå’ŒPPSæ”¾å…¥æ¯ä¸€ä¸ªå…³é”®å¸§</span></div><div class="line">    <span class="comment">//SPS Sequence Parameter Set åºåˆ—å‚æ•°é›†ï¼ŒPPS Picture Parameter Set å›¾åƒå‚æ•°é›†</span></div><div class="line">    <span class="comment">//ä¸ºäº†æé«˜å›¾åƒçš„çº é”™èƒ½åŠ›</span></div><div class="line">    param.b_repeat_headers = <span class="number">1</span>;</div><div class="line">    <span class="comment">//è®¾ç½®Levelçº§åˆ«</span></div><div class="line">    param.i_level_idc = <span class="number">51</span>;</div><div class="line">    <span class="comment">//è®¾ç½®Profileæ¡£æ¬¡</span></div><div class="line">    <span class="comment">//baselineçº§åˆ«ï¼Œæ²¡æœ‰Bå¸§,åªæœ‰ I å¸§å’Œ P å¸§</span></div><div class="line">    x264_param_apply_profile(&amp;param, <span class="string">"baseline"</span>);</div><div class="line"></div><div class="line">    <span class="comment">//x264_picture_tï¼ˆè¾“å…¥å›¾åƒï¼‰åˆå§‹åŒ–</span></div><div class="line">    x264_picture_alloc(&amp;pic_in, param.i_csp, param.i_width, param.i_height);</div><div class="line">    pic_in.i_pts = <span class="number">0</span>;</div><div class="line">    <span class="comment">//æ‰“å¼€ç¼–ç å™¨</span></div><div class="line">    video_encode_handle = x264_encoder_open(&amp;param);</div><div class="line">    <span class="keyword">if</span> (video_encode_handle) &#123;</div><div class="line">        LOGI(<span class="string">"æ‰“å¼€è§†é¢‘ç¼–ç å™¨æˆåŠŸ"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        throwNativeError(env, INIT_FAILED);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>faac åˆå§‹åŒ–ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_live_jni_NativePush_setAudioOptions</span><span class="params">(JNIEnv *env, jobject instance,</span></div><div class="line">                                                    jint sampleRateInHz, jint channel) &#123;</div><div class="line">    audio_encode_handle = faacEncOpen(sampleRateInHz, channel, &amp;nInputSamples,</div><div class="line">                                      &amp;nMaxOutputBytes);</div><div class="line">    <span class="keyword">if</span> (!audio_encode_handle) &#123;</div><div class="line">        LOGE(<span class="string">"éŸ³é¢‘ç¼–ç å™¨æ‰“å¼€å¤±è´¥"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è®¾ç½®éŸ³é¢‘ç¼–ç å‚æ•°</span></div><div class="line">    faacEncConfigurationPtr p_config = faacEncGetCurrentConfiguration(audio_encode_handle);</div><div class="line">    p_config-&gt;mpegVersion = MPEG4;</div><div class="line">    p_config-&gt;allowMidside = <span class="number">1</span>;</div><div class="line">    p_config-&gt;aacObjectType = LOW;</div><div class="line">    p_config-&gt;outputFormat = <span class="number">0</span>; <span class="comment">//è¾“å‡ºæ˜¯å¦åŒ…å«ADTSå¤´</span></div><div class="line">    p_config-&gt;useTns = <span class="number">1</span>; <span class="comment">//æ—¶åŸŸå™ªéŸ³æ§åˆ¶,å¤§æ¦‚å°±æ˜¯æ¶ˆçˆ†éŸ³</span></div><div class="line">    p_config-&gt;useLfe = <span class="number">0</span>;</div><div class="line"><span class="comment">//	p_config-&gt;inputFormat = FAAC_INPUT_16BIT;</span></div><div class="line">    p_config-&gt;quantqual = <span class="number">100</span>;</div><div class="line">    p_config-&gt;bandWidth = <span class="number">0</span>; <span class="comment">//é¢‘å®½</span></div><div class="line">    p_config-&gt;shortctl = SHORTCTL_NORMAL;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!faacEncSetConfiguration(audio_encode_handle, p_config)) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"éŸ³é¢‘ç¼–ç å™¨é…ç½®å¤±è´¥.."</span>);</div><div class="line">        throwNativeError(env, INIT_FAILED);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    LOGI(<span class="string">"%s"</span>, <span class="string">"éŸ³é¢‘ç¼–ç å™¨é…ç½®æˆåŠŸ"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯¹è§†é¢‘æ•°æ®è¿›è¡Œç¼–ç æ‰“åŒ…ï¼Œé€šè¿‡ add_rtmp_packet æ”¾å…¥é“¾è¡¨ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_live_jni_NativePush_fireVideo</span><span class="params">(JNIEnv *env, jobject instance, jbyteArray buffer_)</span> &#123;</div><div class="line">    <span class="comment">//è§†é¢‘æ•°æ®è½¬ä¸ºYUV420P</span></div><div class="line">    <span class="comment">//NV21-&gt;YUV420P</span></div><div class="line">    jbyte *nv21_buffer = (*env)-&gt;GetByteArrayElements(env, buffer_, <span class="literal">NULL</span>);</div><div class="line">    jbyte *u = pic_in.img.plane[<span class="number">1</span>];</div><div class="line">    jbyte *v = pic_in.img.plane[<span class="number">2</span>];</div><div class="line">    <span class="comment">//nv21 4:2:0 Formats, 12 Bits per Pixel</span></div><div class="line">    <span class="comment">//nv21ä¸yuv420pï¼Œyä¸ªæ•°ä¸€è‡´ï¼Œuvä½ç½®å¯¹è°ƒ</span></div><div class="line">    <span class="comment">//nv21è½¬yuv420p  y = w*h,u/v=w*h/4</span></div><div class="line">    <span class="comment">//nv21 = yvu yuv420p=yuv y=y u=y+1+1 v=y+1</span></div><div class="line">    <span class="comment">//å¦‚æœè¦è¿›è¡Œå›¾åƒå¤„ç†ï¼ˆç¾é¢œï¼‰ï¼Œå¯ä»¥å†è½¬æ¢ä¸ºRGB</span></div><div class="line">    <span class="comment">//è¿˜å¯ä»¥ç»“åˆOpenCVè¯†åˆ«äººè„¸ç­‰ç­‰</span></div><div class="line">    <span class="built_in">memcpy</span>(pic_in.img.plane[<span class="number">0</span>], nv21_buffer, y_len);</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; u_len; i++) &#123;</div><div class="line">        *(u + i) = *(nv21_buffer + y_len + i * <span class="number">2</span> + <span class="number">1</span>);</div><div class="line">        *(v + i) = *(nv21_buffer + y_len + i * <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//h264ç¼–ç å¾—åˆ°NALUæ•°ç»„</span></div><div class="line">    <span class="keyword">x264_nal_t</span> *nal = <span class="literal">NULL</span>; <span class="comment">//NAL</span></div><div class="line">    <span class="keyword">int</span> n_nal = <span class="number">-1</span>; <span class="comment">//NALUçš„ä¸ªæ•°</span></div><div class="line">    <span class="comment">//è¿›è¡Œh264ç¼–ç </span></div><div class="line">    <span class="keyword">if</span> (x264_encoder_encode(video_encode_handle, &amp;nal, &amp;n_nal, &amp;pic_in, &amp;pic_out) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"ç¼–ç å¤±è´¥"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä½¿ç”¨rtmpåè®®å°†h264ç¼–ç çš„è§†é¢‘æ•°æ®å‘é€ç»™æµåª’ä½“æœåŠ¡å™¨</span></div><div class="line">    <span class="comment">//å¸§åˆ†ä¸ºå…³é”®å¸§å’Œæ™®é€šå¸§ï¼Œä¸ºäº†æé«˜ç”»é¢çš„çº é”™ç‡ï¼Œå…³é”®å¸§åº”åŒ…å«SPSå’ŒPPSæ•°æ®</span></div><div class="line">    <span class="keyword">int</span> sps_len, pps_len;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sps[<span class="number">100</span>];</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> pps[<span class="number">100</span>];</div><div class="line">    <span class="built_in">memset</span>(sps, <span class="number">0</span>, <span class="number">100</span>);</div><div class="line">    <span class="built_in">memset</span>(pps, <span class="number">0</span>, <span class="number">100</span>);</div><div class="line">    pic_in.i_pts += <span class="number">1</span>; <span class="comment">//é¡ºåºç´¯åŠ </span></div><div class="line">    <span class="comment">//éå†NALUæ•°ç»„ï¼Œæ ¹æ®NALUçš„ç±»å‹åˆ¤æ–­</span></div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n_nal; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (nal[i].i_type == NAL_SPS) &#123;</div><div class="line">            <span class="comment">//å¤åˆ¶SPSæ•°æ®ï¼Œåºåˆ—å‚æ•°é›†(Sequence parameter set)</span></div><div class="line">            sps_len = nal[i].i_payload - <span class="number">4</span>;</div><div class="line">            <span class="built_in">memcpy</span>(sps, nal[i].p_payload + <span class="number">4</span>, sps_len); <span class="comment">//ä¸å¤åˆ¶å››å­—èŠ‚èµ·å§‹ç </span></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nal[i].i_type == NAL_PPS) &#123;</div><div class="line">            <span class="comment">//å¤åˆ¶PPSæ•°æ®ï¼Œå›¾åƒå‚æ•°é›†ï¼ˆPicture parameter setï¼‰</span></div><div class="line">            pps_len = nal[i].i_payload - <span class="number">4</span>;</div><div class="line">            <span class="built_in">memcpy</span>(pps, nal[i].p_payload + <span class="number">4</span>, pps_len); <span class="comment">//ä¸å¤åˆ¶å››å­—èŠ‚èµ·å§‹ç </span></div><div class="line"></div><div class="line">            <span class="comment">//å‘é€åºåˆ—ä¿¡æ¯</span></div><div class="line">            <span class="comment">//h264å…³é”®å¸§ä¼šåŒ…å«SPSå’ŒPPSæ•°æ®</span></div><div class="line">            add_264_sequence_header(pps, sps, pps_len, sps_len);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">//å‘é€å¸§ä¿¡æ¯</span></div><div class="line">            add_264_body(nal[i].p_payload, nal[i].i_payload);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    (*env)-&gt;ReleaseByteArrayElements(env, buffer_, nv21_buffer, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åŒæ ·ï¼Œå¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œç¼–ç æ‰“åŒ…æ”¾å…¥é“¾è¡¨ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_live_jni_NativePush_fireAudio</span><span class="params">(JNIEnv *env, jobject instance, jbyteArray buffer_,</span></div><div class="line">                                              jint length) &#123;</div><div class="line">    <span class="keyword">int</span> *pcmbuf;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *bitbuf;</div><div class="line">    jbyte *b_buffer = (*env)-&gt;GetByteArrayElements(env, buffer_, <span class="number">0</span>);</div><div class="line">    pcmbuf = (<span class="keyword">short</span> *) <span class="built_in">malloc</span>(nInputSamples * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line">    bitbuf = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) <span class="built_in">malloc</span>(nMaxOutputBytes * <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">char</span>));</div><div class="line">    <span class="keyword">int</span> nByteCount = <span class="number">0</span>;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> nBufferSize = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) length / <span class="number">2</span>;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> *buf = (<span class="keyword">unsigned</span> <span class="keyword">short</span> *) b_buffer;</div><div class="line">    <span class="keyword">while</span> (nByteCount &lt; nBufferSize) &#123;</div><div class="line">        <span class="keyword">int</span> audioLength = nInputSamples;</div><div class="line">        <span class="keyword">if</span> ((nByteCount + nInputSamples) &gt;= nBufferSize) &#123;</div><div class="line">            audioLength = nBufferSize - nByteCount;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; audioLength; i++) &#123;<span class="comment">//æ¯æ¬¡ä»å®æ—¶çš„pcméŸ³é¢‘é˜Ÿåˆ—ä¸­è¯»å‡ºé‡åŒ–ä½æ•°ä¸º8çš„pcmæ•°æ®ã€‚</span></div><div class="line">            <span class="keyword">int</span> s = ((<span class="keyword">int16_t</span> *) buf + nByteCount)[i];</div><div class="line">            pcmbuf[i] = s &lt;&lt; <span class="number">8</span>;<span class="comment">//ç”¨8ä¸ªäºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºä¸€ä¸ªé‡‡æ ·é‡åŒ–ç‚¹ï¼ˆæ¨¡æ•°è½¬æ¢ï¼‰</span></div><div class="line">        &#125;</div><div class="line">        nByteCount += nInputSamples;</div><div class="line">        <span class="comment">//åˆ©ç”¨FAACè¿›è¡Œç¼–ç ï¼Œpcmbufä¸ºè½¬æ¢åçš„pcmæµæ•°æ®ï¼ŒaudioLengthä¸ºè°ƒç”¨faacEncOpenæ—¶å¾—åˆ°çš„è¾“å…¥é‡‡æ ·æ•°ï¼Œbitbufä¸ºç¼–ç åçš„æ•°æ®buffï¼ŒnMaxOutputBytesä¸ºè°ƒç”¨faacEncOpenæ—¶å¾—åˆ°çš„æœ€å¤§è¾“å‡ºå­—èŠ‚æ•°</span></div><div class="line">        <span class="keyword">int</span> byteslen = faacEncEncode(audio_encode_handle, pcmbuf, audioLength,</div><div class="line">                                     bitbuf, nMaxOutputBytes);</div><div class="line">        <span class="keyword">if</span> (byteslen &lt; <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        add_aac_body(bitbuf, byteslen);<span class="comment">//ä»bitbufä¸­å¾—åˆ°ç¼–ç åçš„aacæ•°æ®æµï¼Œæ”¾åˆ°æ•°æ®é˜Ÿåˆ—</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (bitbuf)</div><div class="line">        <span class="built_in">free</span>(bitbuf);</div><div class="line">    <span class="keyword">if</span> (pcmbuf)</div><div class="line">        <span class="built_in">free</span>(pcmbuf);</div><div class="line"></div><div class="line">    (*env)-&gt;ReleaseByteArrayElements(env, buffer_, b_buffer, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­ä»é“¾è¡¨ä¸­å– RTMPPacket å‘é€ç»™æœåŠ¡å™¨ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">push_thread</span><span class="params">(<span class="keyword">void</span> *arg)</span> </span>&#123;</div><div class="line">    JNIEnv *env;<span class="comment">//è·å–å½“å‰çº¿ç¨‹JNIEnv</span></div><div class="line">    (*javaVM)-&gt;AttachCurrentThread(javaVM, &amp;env, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    <span class="comment">//å»ºç«‹RTMPè¿æ¥</span></div><div class="line">    RTMP *rtmp = RTMP_Alloc();</div><div class="line">    <span class="keyword">if</span> (!rtmp) &#123;</div><div class="line">        LOGE(<span class="string">"rtmpåˆå§‹åŒ–å¤±è´¥"</span>);</div><div class="line">        <span class="keyword">goto</span> end;</div><div class="line">    &#125;</div><div class="line">    RTMP_Init(rtmp);</div><div class="line">    rtmp-&gt;Link.timeout = <span class="number">5</span>; <span class="comment">//è¿æ¥è¶…æ—¶çš„æ—¶é—´</span></div><div class="line">    <span class="comment">//è®¾ç½®æµåª’ä½“åœ°å€</span></div><div class="line">    RTMP_SetupURL(rtmp, rtmp_path);</div><div class="line">    <span class="comment">//å‘å¸ƒrtmpæ•°æ®æµ</span></div><div class="line">    RTMP_EnableWrite(rtmp);</div><div class="line">    <span class="comment">//å»ºç«‹è¿æ¥</span></div><div class="line">    <span class="keyword">if</span> (!RTMP_Connect(rtmp, <span class="literal">NULL</span>)) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"RTMP è¿æ¥å¤±è´¥"</span>);</div><div class="line">        throwNativeError(env, CONNECT_FAILED);</div><div class="line">        <span class="keyword">goto</span> end;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è®¡æ—¶</span></div><div class="line">    start_time = RTMP_GetTime();</div><div class="line">    <span class="keyword">if</span> (!RTMP_ConnectStream(rtmp, <span class="number">0</span>)) &#123; <span class="comment">//è¿æ¥æµ</span></div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"RTMP ConnectStream failed"</span>);</div><div class="line">        throwNativeError(env, CONNECT_FAILED);</div><div class="line">        <span class="keyword">goto</span> end;</div><div class="line">    &#125;</div><div class="line">    is_pushing = TRUE;</div><div class="line">    <span class="comment">//å‘é€AACå¤´ä¿¡æ¯</span></div><div class="line">    add_aac_sequence_header();</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (is_pushing) &#123;</div><div class="line">        <span class="comment">//å‘é€</span></div><div class="line">        pthread_mutex_lock(&amp;mutex);</div><div class="line">        pthread_cond_wait(&amp;cond, &amp;mutex);</div><div class="line">        <span class="comment">//å–å‡ºé˜Ÿåˆ—ä¸­çš„RTMPPacket</span></div><div class="line">        RTMPPacket *packet = queue_get_first();</div><div class="line">        <span class="keyword">if</span> (packet) &#123;</div><div class="line">            queue_delete_first(); <span class="comment">//ç§»é™¤</span></div><div class="line">            packet-&gt;m_nInfoField2 = rtmp-&gt;m_stream_id; <span class="comment">//RTMPåè®®ï¼Œstream_idæ•°æ®</span></div><div class="line">            <span class="keyword">int</span> i = RTMP_SendPacket(rtmp, packet, TRUE); <span class="comment">//TRUEæ”¾å…¥librtmpé˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸æ˜¯ç«‹å³å‘é€</span></div><div class="line">            <span class="keyword">if</span> (!i) &#123;</div><div class="line">                LOGE(<span class="string">"RTMP æ–­å¼€"</span>);</div><div class="line">                RTMPPacket_Free(packet);</div><div class="line">                pthread_mutex_unlock(&amp;mutex);</div><div class="line">                <span class="keyword">goto</span> end;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                LOGI(<span class="string">"%s"</span>, <span class="string">"rtmp send packet"</span>);</div><div class="line">            &#125;</div><div class="line">            RTMPPacket_Free(packet);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        pthread_mutex_unlock(&amp;mutex);</div><div class="line">    &#125;</div><div class="line">    end:</div><div class="line">    LOGI(<span class="string">"%s"</span>, <span class="string">"é‡Šæ”¾èµ„æº"</span>);</div><div class="line">    <span class="built_in">free</span>(rtmp_path);</div><div class="line">    RTMP_Close(rtmp);</div><div class="line">    RTMP_Free(rtmp);</div><div class="line">    (*javaVM)-&gt;DetachCurrentThread(javaVM);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="å¼•æµ"><a href="#å¼•æµ" class="headerlink" title="å¼•æµ"></a>å¼•æµ</h1><p>è¿™é‡Œå¼•æµå°±ä¸åšå±•å¼€è®²ï¼Œå¯ä»¥é€šè¿‡ QLive çš„ SDK æˆ–è€… vitamio ï¼ˆå°æ¥ æ€»ï¼‰ç­‰ç¬¬ä¸‰æ–¹åº“å®ç°ã€‚</p>
<p>åŸºäº vitamio å®ç°å¼•æµï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">    mVideoView = (VideoView) findViewById(R.id.live_player_view);</div><div class="line">    mVideoView.setVideoPath(SPUtils.getInstance(<span class="keyword">this</span>).getString(SPUtils.KEY_NGINX_SER_URI));</div><div class="line">    mVideoView.setMediaController(<span class="keyword">new</span> MediaController(<span class="keyword">this</span>));</div><div class="line">    mVideoView.requestFocus();</div><div class="line"></div><div class="line">    mVideoView.setOnPreparedListener(<span class="keyword">new</span> MediaPlayer.OnPreparedListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</div><div class="line">            mp.setPlaybackSpeed(<span class="number">1.0f</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>PSï¼šæºç åœ°å€ï¼š<a href="https://github.com/githubhaohao/NDKLive" target="_blank" rel="external">https://github.com/githubhaohao/NDKLive</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180229.jpeg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;æœ€
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="ç›´æ’­" scheme="https://githubhaohao.github.io/tags/%E7%9B%B4%E6%92%AD/"/>
    
  </entry>
  
  <entry>
    <title>NDK ç›´æ’­æµåª’ä½“æœåŠ¡å™¨æ­å»º</title>
    <link href="https://githubhaohao.github.io/2018/02/03/NDK-set-up-streaming-media-server/"/>
    <id>https://githubhaohao.github.io/2018/02/03/NDK-set-up-streaming-media-server/</id>
    <published>2018-02-03T05:42:32.000Z</published>
    <updated>2018-02-03T08:22:12.720Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180218.jpeg" alt="Markdown"></p><p></p>
<p><div align="center">æ ‘ç«‹ä¸€ä¸ªè¿œå¤§çš„ç›®æ ‡æ˜¯å¿…è¦çš„ï¼Œç„¶è€Œä»…é ç›®æ ‡åšåŠ¨åŠ›ï¼Œè¿™ç§åŠ¨åŠ›å°±æ˜¯å¼ºè¿«å¼çš„ï¼Œè€Œæœ‰è¿™ç§åŠ¨åŠ›çš„äººéå¸¸å®¹æ˜“ç„¦è™‘ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹åŸºäº Nginx æ­å»ºä¸€ä¸ªéå¸¸ç®€å•çš„æµåª’ä½“æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š                                                                                                                                                                                          </p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
<li><a href="http://haohaochang.cn/2018/01/09/NDK-posix-multi-thread/" target="_blank" rel="external">NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
<li><a href="http://haohaochang.cn/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/" target="_blank" rel="external">NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸æ’­æ”¾</a></li>
<li><a href="http://haohaochang.cn/2018/01/20/NDK-FFmpeg-compile/" target="_blank" rel="external">NDK FFmpeg ç¼–è¯‘</a></li>
<li><a href="http://haohaochang.cn/2018/01/24/NDK-FFmpeg-video-decoding/" target="_blank" rel="external">NDK FFmpeg éŸ³è§†é¢‘è§£ç </a></li>
</ul>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>Nginx æ˜¯ç”±ä¿„ç½—æ–¯äºº <a href="https://zh.wikipedia.org/wiki/%E4%BC%8A%E6%88%88%E7%88%BE%C2%B7%E8%B3%BD%E7%B4%A2%E8%80%B6%E5%A4%AB" title="Igor Sysoev" target="_blank" rel="external">Igor Sysoev</a> ç¼–å†™çš„è½»é‡çº§ Web æœåŠ¡å™¨ï¼Œå‘éŸ³ä¸º â€œengine xâ€ï¼Œä¹Ÿå¯ç”¨ä½œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œäº 2004 å¹´å…¬å¼€å‘å¸ƒï¼Œéµå¾ª BSD å¼€æºè®¸å¯ï¼Œå®ƒä»¥é«˜ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½ä»¥åŠä½ç³»ç»Ÿå¼€é”€è€Œå‡ºåã€‚Nginx ä¹Ÿæ˜¯ä¸€ç§æ¨¡å—åŒ–çš„æœåŠ¡å™¨ï¼ŒåŸºäº Nginx å¯ä»¥çµæ´»æ·»åŠ å„ç§åŠŸèƒ½æ¨¡å—ï¼Œå¦‚ HTTP æ¨¡å—ã€WebSocket æ¨¡å—ã€RTMP æ¨¡å—ç­‰ï¼Œä¸åŒæ¨¡å—å ç”¨ä¸åŒçš„ç«¯å£ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œå¦‚æœ¬æ–‡ä¸­è¦ä½¿ç”¨çš„ RTMP æ¨¡å—é»˜è®¤ç«¯å£ä¸º 1935 ã€‚</p>
<p>æœ¬æ–‡ä¸­çš„ Nginx æœåŠ¡å™¨åªæ·»åŠ äº†ä¸€ä¸ª RTMP æ¨¡å—ï¼Œç”¨ä½œä¸€ä¸ªç®€å•çš„æµåª’ä½“æœåŠ¡å™¨ã€‚</p>
<h1 id="RTMP-åè®®"><a href="#RTMP-åè®®" class="headerlink" title="RTMP åè®®"></a>RTMP åè®®</h1><p>RTMP ï¼ˆ Real Time Message Protocol ï¼‰åè®®æ˜¯ä¸€ç§å®æ—¶ä¿¡æ¯ä¼ è¾“åè®®ï¼Œç”± Adobe å…¬å¸å¼€å‘ï¼Œç”¨æ¥è§£å†³å¤šåª’ä½“æ•°æ®ä¼ è¾“æµçš„å¤šè·¯å¤ç”¨ï¼ˆ Multiplexing ï¼‰å’Œåˆ†åŒ…ï¼ˆ packetizing ï¼‰çš„é—®é¢˜ï¼Œå®ƒæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¼ è¾“å±‚é€šå¸¸åŸºäº TCP å®ç°ã€‚RTMP åè®®åœ¨å‰æœŸå¹¶æœªå—åˆ°å¤ªå¤šçš„é‡è§†ï¼Œè¿‘ä¸¤å¹´éšç€ VR ä»¥åŠè§†é¢‘ç›´æ’­é¢†åŸŸçš„ç«çƒ­ï¼ŒRTMP åè®®æ­£é€æ¸æˆä¸ºä¸»æµã€‚</p>
<h1 id="ç›´æ’­æ¡†æ¶"><a href="#ç›´æ’­æ¡†æ¶" class="headerlink" title="ç›´æ’­æ¡†æ¶"></a>ç›´æ’­æ¡†æ¶</h1><p><img src="http://ovv1lq7pk.bkt.clouddn.com/livelive-framework.png" alt=""></p>
<p>æ­å»ºä¸€ä¸ªç®€æ˜“çš„ç›´æ’­æ¡†æ¶éœ€è¦ä¸‰ä¸ªè§’è‰²ï¼šç›´æ’­ï¼ˆæ¨æµï¼‰å®¢æˆ·ç«¯ï¼Œæµåª’ä½“æœåŠ¡å™¨å’Œå¼•æµå®¢æˆ·ç«¯ã€‚</p>
<h1 id="å®‰è£…-Nginx"><a href="#å®‰è£…-Nginx" class="headerlink" title="å®‰è£… Nginx"></a>å®‰è£… Nginx</h1><p>ç¯å¢ƒï¼š Ubuntu 16.04 ï¼Œæ³¨æ„ï¼šè‹¥ä½¿ç”¨é˜¿é‡Œäº‘ä¸»æœºéœ€è¦é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼Œå¼€æ”¾ 80 ã€1935 ç­‰ç«¯å£ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/livemanager-port.png" alt=""></p>
<p>å®‰è£… nginx å’Œ nginx-rtmp ç¼–è¯‘ä¾èµ–å·¥å…·:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential libpcre3 libpcre3-dev libssl-dev</div></pre></td></tr></table></figure></p>
<p>å·¥ä½œç›®å½•ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir nginx</div><div class="line">chmod +x -R nginx/</div><div class="line"><span class="built_in">cd</span> live</div></pre></td></tr></table></figure></p>
<p>ä¸‹è½½ nginx å’Œ nginx-rtmp æºç :<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget http://nginx.org/download/nginx-1.8.1.tar.gz</div><div class="line">wget https://github.com/arut/nginx-rtmp-module/archive/master.zip</div></pre></td></tr></table></figure></p>
<p>è§£å‹ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å®‰è£… unzip</span></div><div class="line"><span class="comment"># sudo apt-get install unzip</span></div><div class="line">tar -zxvf nginx-1.8.1.tar.gz</div><div class="line">unzip master.zip</div></pre></td></tr></table></figure></p>
<p>æ·»åŠ  rtmp-nginx æ¨¡å—:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> nginx-1.8.1</div><div class="line">./configure --with-http_ssl_module --add-module=../nginx-rtmp-module-master</div></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘ã€å®‰è£…ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ç¼–è¯‘ nginx æºç </span></div><div class="line">make</div><div class="line"><span class="comment"># å®‰è£…</span></div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>å¯åŠ¨ Nginx æœåŠ¡ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo service nginx start</div><div class="line"><span class="comment"># sudo service nginx stop åœæ­¢</span></div></pre></td></tr></table></figure></p>
<p>æ‰“å¼€æµè§ˆå™¨ <a href="http://127.0.0.1/" target="_blank" rel="external">http://127.0.0.1/</a> æˆ–è€…è¾“å…¥é˜¿é‡Œäº‘ä¸»æœºçš„å…¬ç½‘ ip :</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/livenginx-index.png" alt=""></p>
<p>å®‰è£… FFmpegï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install ffmpeg</div><div class="line"><span class="comment"># æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span></div><div class="line">ffmpeg -v</div></pre></td></tr></table></figure></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/liveffmapeg-version.png" alt=""><br>é…ç½® nginx æœåŠ¡å™¨ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># è¿›å…¥ nginx å®‰è£…ç›®å½•</span></div><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/nginx</div><div class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶ /usr/local/nginx/conf/nginx.conf</span></div><div class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </span></div><div class="line">rtmp &#123;</div><div class="line">    server &#123;</div><div class="line">            listen 1935;</div><div class="line">            chunk_size 4096;</div><div class="line"></div><div class="line">            application live &#123;</div><div class="line">                    live on;</div><div class="line">                    record off;</div><div class="line">                    <span class="built_in">exec</span> ffmpeg -i rtmp://localhost/live/<span class="variable">$name</span> -threads 1 -c:v libx264 -profile:v baseline -b:v 350K <span class="_">-s</span> 640x360 <span class="_">-f</span> flv -c:a aac -ac 1 -strict -2 -b:a 56k rtmp://localhost/live360p/<span class="variable">$name</span>;</div><div class="line">            &#125;</div><div class="line">            application live360p &#123;</div><div class="line">                    live on;</div><div class="line">                    record off;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>é‡å¯ nginx æœåŠ¡å™¨ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service nginx restart</div></pre></td></tr></table></figure></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€ä¸ªç®€å•çš„æµåª’ä½“æœåŠ¡å™¨æ­å»ºå®Œæˆï¼Œæ¥ä¸‹æ¥å°†å®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æ¨æµå’Œå¼•æµã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180218.jpeg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;æ ‘
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="Nginx" scheme="https://githubhaohao.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>NDK FFmpeg éŸ³è§†é¢‘è§£ç </title>
    <link href="https://githubhaohao.github.io/2018/01/24/NDK-FFmpeg-video-decoding/"/>
    <id>https://githubhaohao.github.io/2018/01/24/NDK-FFmpeg-video-decoding/</id>
    <published>2018-01-24T13:36:08.000Z</published>
    <updated>2018-01-29T07:12:19.149Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180204.jpeg" alt="Markdown"></p><p></p>
<p><div align="center">è¯¸è‘›äº®èº¬è€•éš†ä¸­çš„æ—¶å€™ï¼Œä¸å¥½å‹çŸ³å¹¿å…ƒã€å¾åº¶ã€å­Ÿå…¬å¨åœ¨ä¸€èµ·æ±‚å­¦ï¼Œå…¶ä»–ä¸‰äººè¯»ä¹¦éƒ½æ˜¯ä¸€å®šè¦æ»šç“œçƒ‚ç†Ÿï¼Œåªæœ‰è¯¸è‘›äº®åªè§‚å…¶å¤§ç•¥ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ FFmpeg éŸ³è§†é¢‘è§£ç ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š                                                                                                                                                                                          </p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
<li><a href="http://haohaochang.cn/2018/01/09/NDK-posix-multi-thread/" target="_blank" rel="external">NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
<li><a href="http://haohaochang.cn/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/" target="_blank" rel="external">NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸æ’­æ”¾</a></li>
<li><a href="http://haohaochang.cn/2018/01/20/NDK-FFmpeg-compile/" target="_blank" rel="external">NDK FFmpeg ç¼–è¯‘</a></li>
</ul>
<h1 id="å°è£…æ ¼å¼"><a href="#å°è£…æ ¼å¼" class="headerlink" title="å°è£…æ ¼å¼"></a>å°è£…æ ¼å¼</h1><p>æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„è§†é¢‘æ ¼å¼ï¼Œå¦‚ mp4 ã€ mkv ã€ rmvb ã€flv ç­‰ï¼Œè¡¨ç¤ºçš„æ˜¯éŸ³è§†é¢‘çš„å°è£…æ ¼å¼ï¼Œå°è£…æ ¼å¼å®è´¨ä¸Šæ˜¯æŠŠéŸ³é¢‘æ•°æ®ã€è§†é¢‘æ•°æ®å’Œå­—å¹•æ•°æ®æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶çš„è§„èŒƒã€‚ä»æŠ€æœ¯çš„è§’åº¦æ¥è®²ï¼Œä¼˜ç§€çš„éŸ³è§†é¢‘å°è£…æ ¼å¼åº”è¯¥æ”¯æŒå¤§å¤šæ•°éŸ³è§†é¢‘ç¼–ç æ ‡å‡†ã€‚<br>ä¸»è¦çš„å°è£…æ ¼å¼:</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æœºæ„</th>
<th style="text-align:center">æ”¯æŒçš„è§†é¢‘ç¼–ç </th>
<th style="text-align:center">æ”¯æŒçš„éŸ³é¢‘ç¼–ç </th>
<th style="text-align:center">ä½¿ç”¨é¢†åŸŸ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AVI</td>
<td style="text-align:center">å¾®è½¯</td>
<td style="text-align:center">å‡ ä¹æ‰€æœ‰æ ¼å¼</td>
<td style="text-align:center">å‡ ä¹æ‰€æœ‰æ ¼å¼</td>
<td style="text-align:center">BT ä¸‹è½½å½±è§†</td>
</tr>
<tr>
<td style="text-align:center">MP4</td>
<td style="text-align:center">MPEG</td>
<td style="text-align:center">MPEG-4 ï¼Œ H.264 ï¼Œ H.263 ç­‰</td>
<td style="text-align:center">AAC ï¼Œ MPEG-1 ç­‰</td>
<td style="text-align:center">äº’è”ç½‘è§†é¢‘ç½‘ç«™</td>
</tr>
<tr>
<td style="text-align:center">FLV</td>
<td style="text-align:center">Adobe</td>
<td style="text-align:center">VP6 ï¼Œ H.264</td>
<td style="text-align:center">MP3 ï¼Œ AAC ç­‰</td>
<td style="text-align:center">äº’è”ç½‘è§†é¢‘ç½‘ç«™</td>
</tr>
<tr>
<td style="text-align:center">MKV</td>
<td style="text-align:center">CoreCodec</td>
<td style="text-align:center">å‡ ä¹æ‰€æœ‰æ ¼å¼</td>
<td style="text-align:center">å‡ ä¹æ‰€æœ‰æ ¼å¼</td>
<td style="text-align:center">äº’è”ç½‘è§†é¢‘ç½‘ç«™</td>
</tr>
<tr>
<td style="text-align:center">RMVB</td>
<td style="text-align:center">Real Networks</td>
<td style="text-align:center">RealVideo 8 ï¼Œ 9 ï¼Œ 10</td>
<td style="text-align:center">AAC ï¼Œ Cook Codec</td>
<td style="text-align:center">BT ä¸‹è½½å½±è§†</td>
</tr>
</tbody>
</table>
<h1 id="ç¼–ç æ ¼å¼"><a href="#ç¼–ç æ ¼å¼" class="headerlink" title="ç¼–ç æ ¼å¼"></a>ç¼–ç æ ¼å¼</h1><p>ç¼–ç çš„ç›®çš„åœ¨äºé€šè¿‡å‹ç¼©ç®—æ³•é™ä½æ•°æ®é‡ï¼Œæé«˜æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“æ•ˆç‡ã€‚è§†é¢‘ç¼–ç æ˜¯å°†è§†é¢‘åƒç´ æ•°æ®ï¼ˆ RGB ï¼Œ YUV ç­‰ï¼‰å‹ç¼©æˆä¸ºè§†é¢‘ç æµã€‚éŸ³é¢‘ç¼–ç æ˜¯å°†éŸ³é¢‘é‡‡æ ·æ•°æ®ï¼ˆ PCM ç­‰ï¼‰å‹ç¼©æˆä¸ºéŸ³é¢‘ç æµã€‚<br>ä¸»è¦è§†é¢‘ç¼–ç æ ¼å¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æœºæ„</th>
<th style="text-align:center">æ¨å‡ºæ—¶é—´</th>
<th style="text-align:center">ä½¿ç”¨é¢†åŸŸ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">H.265</td>
<td style="text-align:center">MPEG/ITU-T</td>
<td style="text-align:center">2013</td>
<td style="text-align:center">ç ”å‘ä¸­</td>
</tr>
<tr>
<td style="text-align:center">H.264</td>
<td style="text-align:center">MPEG/ITU-T</td>
<td style="text-align:center">2003</td>
<td style="text-align:center">å„ä¸ªé¢†åŸŸ</td>
</tr>
<tr>
<td style="text-align:center">MPEG4</td>
<td style="text-align:center">MPEG</td>
<td style="text-align:center">2001</td>
<td style="text-align:center">å°ä¼—</td>
</tr>
<tr>
<td style="text-align:center">MPEG2</td>
<td style="text-align:center">MPEG</td>
<td style="text-align:center">1994</td>
<td style="text-align:center">æ•°å­—ç”µè§†</td>
</tr>
<tr>
<td style="text-align:center">VP9</td>
<td style="text-align:center">Google</td>
<td style="text-align:center">2013</td>
<td style="text-align:center">ç ”å‘ä¸­</td>
</tr>
<tr>
<td style="text-align:center">VP8</td>
<td style="text-align:center">Google</td>
<td style="text-align:center">2008</td>
<td style="text-align:center">å°ä¼—</td>
</tr>
</tbody>
</table>
<p>ä¸»è¦éŸ³é¢‘ç¼–ç æ ¼å¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">æœºæ„</th>
<th style="text-align:center">æ¨å‡ºæ—¶é—´</th>
<th style="text-align:center">ä½¿ç”¨é¢†åŸŸ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AAC</td>
<td style="text-align:center">MPEG</td>
<td style="text-align:center">1997</td>
<td style="text-align:center">å„ä¸ªé¢†åŸŸ</td>
</tr>
<tr>
<td style="text-align:center">AC-3</td>
<td style="text-align:center">Dolby</td>
<td style="text-align:center">1992</td>
<td style="text-align:center">ç”µå½±</td>
</tr>
<tr>
<td style="text-align:center">MP3</td>
<td style="text-align:center">MPEG</td>
<td style="text-align:center">1993</td>
<td style="text-align:center">æ—©æœŸæ™®åŠ</td>
</tr>
<tr>
<td style="text-align:center">WMV</td>
<td style="text-align:center">å¾®è½¯</td>
<td style="text-align:center">1999</td>
<td style="text-align:center">Windows</td>
</tr>
</tbody>
</table>
<h1 id="éŸ³è§†é¢‘è§£ç æµç¨‹"><a href="#éŸ³è§†é¢‘è§£ç æµç¨‹" class="headerlink" title="éŸ³è§†é¢‘è§£ç æµç¨‹"></a>éŸ³è§†é¢‘è§£ç æµç¨‹</h1><p><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/decode_video.png" alt=""></p>
<ol>
<li>è§£å°è£…æ ¼å¼ã€‚å°†è¾“å…¥çš„æŒ‰ç…§ä¸€å®šæ ¼å¼å°è£…çš„éŸ³è§†é¢‘æ•°æ®ï¼Œåˆ†ç¦»æˆä¸ºéŸ³é¢‘æµå‹ç¼©ç¼–ç æ•°æ®å’Œè§†é¢‘æµå‹ç¼©ç¼–ç æ•°æ®ã€‚</li>
<li>è§£ç ã€‚å°†è§†é¢‘å’ŒéŸ³é¢‘çš„å‹ç¼©ç¼–ç æ•°æ®ï¼Œè§£ç æˆä¸ºéå‹ç¼©çš„è§†é¢‘å’ŒéŸ³é¢‘åŸå§‹æ•°æ®ã€‚è§†é¢‘å‹ç¼©æ•°æ®é€šè¿‡è§£ç è¾“å‡ºä¸ºåƒç´ æ•°æ®ï¼Œå¦‚ YUV420P ã€ RGB ç­‰ï¼›éŸ³é¢‘å‹ç¼©æ•°æ®é€šè¿‡è§£ç è¾“å‡ºä¸ºéå‹ç¼©çš„éŸ³é¢‘æŠ½æ ·æ•°æ®ï¼Œå¦‚ PCM æ•°æ®ã€‚</li>
<li>éŸ³è§†é¢‘åŒæ­¥ã€‚åŒæ­¥è§£ç å‡ºæ¥çš„è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ï¼Œå¹¶å°†éŸ³è§†é¢‘æ•°æ®é€è‡³ç³»ç»Ÿçš„å£°å¡å’Œæ˜¾å¡ï¼Œæ’­æ”¾å’Œæ˜¾ç¤ºå‡ºæ¥ã€‚</li>
</ol>
<h1 id="FFmpeg-å‡½æ•°åº“"><a href="#FFmpeg-å‡½æ•°åº“" class="headerlink" title="FFmpeg å‡½æ•°åº“"></a>FFmpeg å‡½æ•°åº“</h1><p>FFmpeg ä¸€èˆ¬æœ‰ 8 ä¸ªå‡½æ•°åº“ï¼Œå„ä¸ªå‡½æ•°åº“çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å‡½æ•°åº“</th>
<th style="text-align:center">åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">avcodec</td>
<td style="text-align:center">éŸ³è§†é¢‘ç¼–è§£ç </td>
</tr>
<tr>
<td style="text-align:center">avdevice</td>
<td style="text-align:center">å¤šåª’ä½“è®¾å¤‡è¾“å…¥è¾“å‡º</td>
</tr>
<tr>
<td style="text-align:center">avfilter</td>
<td style="text-align:center">æ»¤é•œç‰¹æ•ˆ</td>
</tr>
<tr>
<td style="text-align:center">avformat</td>
<td style="text-align:center">å°è£…æ ¼å¼å¤„ç†</td>
</tr>
<tr>
<td style="text-align:center">postproc</td>
<td style="text-align:center">ååŠ å·¥</td>
</tr>
<tr>
<td style="text-align:center">avutil</td>
<td style="text-align:center">å·¥å…·åº“</td>
</tr>
<tr>
<td style="text-align:center">swresample</td>
<td style="text-align:center">éŸ³é¢‘é‡‡æ ·æ•°æ®æ ¼å¼è½¬æ¢</td>
</tr>
<tr>
<td style="text-align:center">swscale</td>
<td style="text-align:center">è§†é¢‘åƒç´ æ•°æ®æ ¼å¼è½¬æ¢</td>
</tr>
</tbody>
</table>
<h1 id="FFmpeg-éŸ³è§†é¢‘è§£ç "><a href="#FFmpeg-éŸ³è§†é¢‘è§£ç " class="headerlink" title="FFmpeg éŸ³è§†é¢‘è§£ç "></a>FFmpeg éŸ³è§†é¢‘è§£ç </h1><p>FFmpeg éŸ³è§†é¢‘è§£ç ä¸»è¦æµç¨‹ä»£ç æè¿°ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1. av_register_all() //æ³¨å†Œç»„ä»¶</div><div class="line">2. avformat_alloc_context //è·å–å°è£…æ ¼å¼ä¸Šä¸‹æ–‡</div><div class="line">3. avformat_find_stream_info //è·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯</div><div class="line">4. avcodec_find_decoder //è·å–è§£ç å™¨</div><div class="line">5. avcodec_open2 //æ‰“å¼€è§£ç å™¨</div><div class="line">6. avcodec_decode_video2 æˆ– avcodec_decode_audio4 //è§£ç éŸ³è§†é¢‘å¸§</div></pre></td></tr></table></figure></p>
<p>åœ¨ AS å·¥ç¨‹ä¸­å¼•å…¥ FFmpeg 8 ä¸ªåŠ¨æ€åº“å’Œ libyuv ï¼ˆè´Ÿè´£è§†é¢‘åƒç´ æ•°æ®æ ¼å¼è½¬æ¢ï¼‰åŠ¨æ€åº“ã€‚<br>å·¥ç¨‹çš„å¤´æ–‡ä»¶ç›®å½•ï¼š<br><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/ffmpeg_so_header_file.png" alt=""><br>å·¥ç¨‹çš„åŠ¨æ€åº“ç›®å½•ï¼š<br><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/ffmpeg_so.png" alt=""></p>
<p>Java å±‚ API ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.haohao.ffmpeg;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.media.AudioFormat;</div><div class="line"><span class="keyword">import</span> android.media.AudioManager;</div><div class="line"><span class="keyword">import</span> android.media.AudioTrack;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.Surface;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * author: haohao</div><div class="line"> * time: 2017/12/19</div><div class="line"> * mail: haohaochang86@gmail.com</div><div class="line"> * desc: AVUtils</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AVUtils</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"AVUtils"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AVCallback AVCallback;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AVCallback sAVCallback;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerCallback</span><span class="params">(AVCallback callback)</span> </span>&#123;</div><div class="line">        sAVCallback = callback;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"avfilter-5"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"avdevice-56"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"yuv"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"avutil-54"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"swresample-1"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"avcodec-56"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"avformat-56"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"swscale-3"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"postproc-53"</span>);</div><div class="line">        System.loadLibrary(<span class="string">"native-lib"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è§£ç è§†é¢‘ä¸­çš„è§†é¢‘å‹ç¼©æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> input_file_path è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„</div><div class="line">     * <span class="doctag">@param</span> output_file_path è§†é¢‘å‹ç¼©æ•°æ®è§£ç åè¾“å‡ºçš„ YUV æ–‡ä»¶è·¯å¾„</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">videoDecode</span><span class="params">(String input_file_path, String output_file_path)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ˜¾ç¤ºè§†é¢‘è§†é¢‘è§£ç ååƒç´ æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„</div><div class="line">     * <span class="doctag">@param</span> surface ç”¨äºæ˜¾ç¤ºè§†é¢‘è§†é¢‘è§£ç åçš„ RGBA åƒç´ æ•°æ®</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">videoRender</span><span class="params">(String input, Surface surface)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è§£ç è§†é¢‘ä¸­çš„éŸ³é¢‘å‹ç¼©æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„</div><div class="line">     * <span class="doctag">@param</span> output éŸ³é¢‘å‹ç¼©æ•°æ®è§£ç åè¾“å‡ºçš„ PCM æ–‡ä»¶è·¯å¾„</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">audioDecode</span><span class="params">(String input, String output)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * æ’­æ”¾è§†é¢‘ä¸­çš„éŸ³é¢‘æ•°æ®</div><div class="line">     * <span class="doctag">@param</span> input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">audioPlay</span><span class="params">(String input)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * åˆ›å»ºä¸€ä¸ª AudioTrack å¯¹è±¡ï¼Œç”¨äºæ’­æ”¾éŸ³é¢‘,åœ¨ Native å±‚ä¸­è°ƒç”¨ã€‚</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AudioTrack <span class="title">createAudioTrack</span><span class="params">(<span class="keyword">int</span> sampleRate, <span class="keyword">int</span> num_channel)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> audioFormat = AudioFormat.ENCODING_PCM_16BIT;</div><div class="line">        Log.i(TAG, <span class="string">"å£°é“æ•°:"</span> + num_channel);</div><div class="line">        <span class="keyword">int</span> channelConfig;</div><div class="line">        <span class="keyword">if</span> (num_channel == <span class="number">1</span>) &#123;</div><div class="line">            channelConfig = android.media.AudioFormat.CHANNEL_OUT_MONO;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num_channel == <span class="number">2</span>) &#123;</div><div class="line">            channelConfig = android.media.AudioFormat.CHANNEL_OUT_STEREO;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            channelConfig = android.media.AudioFormat.CHANNEL_OUT_STEREO;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> bufferSize = AudioTrack.getMinBufferSize(sampleRate, channelConfig, audioFormat);</div><div class="line"></div><div class="line">        AudioTrack audioTrack = <span class="keyword">new</span> AudioTrack(</div><div class="line">                AudioManager.STREAM_MUSIC,</div><div class="line">                sampleRate, channelConfig,</div><div class="line">                audioFormat,</div><div class="line">                bufferSize, AudioTrack.MODE_STREAM);</div><div class="line">        <span class="keyword">return</span> audioTrack;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AVCallback</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>MySurfaceView.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * author: haohao</div><div class="line"> * time: 2017/12/20</div><div class="line"> * mail: haohaochang86@gmail.com</div><div class="line"> * desc: MySurfaceView</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySurfaceView</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">// è®¾ç½®åƒç´ ç»˜åˆ¶æ ¼å¼ä¸º RGBA_8888</span></div><div class="line">        SurfaceHolder holder = getHolder();</div><div class="line">        holder.setFormat(PixelFormat.RGBA_8888);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>activity_main.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">com.haohao.ffmpeg.MySurfaceView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/my_surface_view"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:alpha</span>=<span class="string">"0.7"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/video_decode_btn"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"è§†é¢‘è§£ç "</span> /&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/video_render_btn"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"è§†é¢‘æ¸²æŸ“"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:alpha</span>=<span class="string">"0.7"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/audio_decode_btn"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"éŸ³é¢‘è§£ç "</span> /&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/audio_play_btn"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">                <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:text</span>=<span class="string">"éŸ³é¢‘æ’­æ”¾"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">AVUtils</span>.<span class="title">AVCallback</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BASE_PATH = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separatorChar;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String input_video_file_path = BASE_PATH</div><div class="line">            + <span class="string">"input.mp4"</span>;</div><div class="line">    <span class="keyword">private</span> String output_video_file_path = BASE_PATH</div><div class="line">            + <span class="string">"output.yuv"</span>;</div><div class="line">    <span class="keyword">private</span> String input_audio_file_path = BASE_PATH</div><div class="line">            + <span class="string">"hello.mp3"</span>;</div><div class="line">    <span class="keyword">private</span> String output_audio_file_path = BASE_PATH</div><div class="line">            + <span class="string">"hello.pcm"</span>;</div><div class="line">    <span class="keyword">private</span> String video_src = BASE_PATH</div><div class="line">            + <span class="string">"ffmpeg.mp4"</span>;</div><div class="line">    <span class="keyword">private</span> Button mDecodeVideoBtn;</div><div class="line">    <span class="keyword">private</span> Button mVideoRenderBtn;</div><div class="line">    <span class="keyword">private</span> Button mAudioPlayBtn, mAudioDecodeBtn;</div><div class="line">    <span class="keyword">private</span> ProgressDialog mProgressDialog;</div><div class="line">    <span class="keyword">private</span> ExecutorService mExecutorService;</div><div class="line">    <span class="keyword">private</span> MySurfaceView mySurfaceView;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</div><div class="line">            requestPermissions(<span class="keyword">new</span> String[]&#123;Manifest.permission.READ_EXTERNAL_STORAGE, Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.MOUNT_UNMOUNT_FILESYSTEMS&#125;, <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mDecodeVideoBtn = (Button)findViewById(R.id.video_decode_btn);</div><div class="line">        mVideoRenderBtn = (Button)findViewById(R.id.video_render_btn);</div><div class="line">        mAudioDecodeBtn = (Button) findViewById(R.id.audio_decode_btn);</div><div class="line">        mAudioPlayBtn = (Button)findViewById(R.id.audio_play_btn);</div><div class="line"></div><div class="line">        mySurfaceView = (MySurfaceView) findViewById(R.id.my_surface_view);</div><div class="line">        mDecodeVideoBtn.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        mVideoRenderBtn.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        mAudioDecodeBtn.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        mAudioPlayBtn.setOnClickListener(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        AVUtils.registerCallback(<span class="keyword">this</span>);</div><div class="line">        mProgressDialog = <span class="keyword">new</span> ProgressDialog(<span class="keyword">this</span>);</div><div class="line">        mProgressDialog.setCanceledOnTouchOutside(<span class="keyword">false</span>);</div><div class="line">        mExecutorService = Executors.newFixedThreadPool(<span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> id = view.getId();</div><div class="line">        <span class="keyword">switch</span> (id) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.video_decode_btn:</div><div class="line">                mProgressDialog.setMessage(<span class="string">"æ­£åœ¨è§£ç ..."</span>);</div><div class="line">                mProgressDialog.show();</div><div class="line">                mExecutorService.submit(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        AVUtils.videoDecode(input_video_file_path, output_video_file_path);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line"></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.video_render_btn:</div><div class="line">                mExecutorService.submit(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        AVUtils.videoRender(input_video_file_path, mySurfaceView.getHolder().getSurface());</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.audio_decode_btn:</div><div class="line">                mProgressDialog.setMessage(<span class="string">"æ­£åœ¨è§£ç ..."</span>);</div><div class="line">                mProgressDialog.show();</div><div class="line">                mExecutorService.submit(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        AVUtils.audioDecode(input_audio_file_path, output_audio_file_path);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.audio_play_btn:</div><div class="line">                mExecutorService.submit(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        AVUtils.audioPlay(input_video_file_path);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFinish</span><span class="params">()</span> </span>&#123;</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span> (mProgressDialog.isShowing()) &#123;</div><div class="line">                    mProgressDialog.dismiss();</div><div class="line">                &#125;</div><div class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"è§£ç å®Œæˆ"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        mExecutorService.shutdown();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>nativelib.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;libavutil/time.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="comment">//ç¼–ç </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"include/libavcodec/avcodec.h"</span></span></div><div class="line"><span class="comment">//å°è£…æ ¼å¼å¤„ç†</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"include/libavformat/avformat.h"</span></span></div><div class="line"><span class="comment">//åƒç´ å¤„ç†</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"include/libswscale/swscale.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGI(FORMAT, ...) __android_log_print(ANDROID_LOG_INFO,<span class="meta-string">"haohao"</span>,FORMAT,##__VA_ARGS__);</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGE(FORMAT, ...) __android_log_print(ANDROID_LOG_ERROR,<span class="meta-string">"haohao"</span>,FORMAT,##__VA_ARGS__);</span></div><div class="line"></div><div class="line"><span class="comment">//ä¸­æ–‡å­—ç¬¦ä¸²è½¬æ¢</span></div><div class="line"><span class="function">jstring <span class="title">charsToUTF8String</span><span class="params">(JNIEnv *env, <span class="keyword">char</span> *s)</span> </span>&#123;</div><div class="line">    jclass string_cls = (*env)-&gt;FindClass(env, <span class="string">"java/lang/String"</span>);</div><div class="line">    jmethodID mid = (*env)-&gt;GetMethodID(env, string_cls, <span class="string">"&lt;init&gt;"</span>, <span class="string">"([BLjava/lang/String;)V"</span>);</div><div class="line"></div><div class="line">    jbyteArray jb_arr = (*env)-&gt;NewByteArray(env, <span class="built_in">strlen</span>(s));</div><div class="line">    (*env)-&gt;SetByteArrayRegion(env, jb_arr, <span class="number">0</span>, <span class="built_in">strlen</span>(s), s);</div><div class="line"></div><div class="line">    jstring charset = (*env)-&gt;NewStringUTF(env, <span class="string">"UTF-8"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (*env)-&gt;NewObject(env, string_cls, mid, jb_arr, charset);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ffmpeg_AVUtils_videoDecode</span><span class="params">(JNIEnv *env, jclass type, jstring input_,</span></div><div class="line">                                           jstring output_) &#123;</div><div class="line"></div><div class="line">    <span class="comment">//è®¿é—®é™æ€æ–¹æ³•</span></div><div class="line">    jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, <span class="string">"onNativeCallback"</span>, <span class="string">"()V"</span>);</div><div class="line">    <span class="comment">//éœ€è¦è½¬ç çš„è§†é¢‘æ–‡ä»¶(è¾“å…¥çš„è§†é¢‘æ–‡ä»¶)</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *input = (*env)-&gt;GetStringUTFChars(env, input_, <span class="number">0</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *output = (*env)-&gt;GetStringUTFChars(env, output_, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="comment">//æ³¨å†Œæ‰€æœ‰ç»„ä»¶</span></div><div class="line">    av_register_all();</div><div class="line"></div><div class="line">    <span class="comment">//å°è£…æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œç»Ÿé¢†å…¨å±€çš„ç»“æ„ä½“ï¼Œä¿å­˜äº†è§†é¢‘æ–‡ä»¶å°è£…æ ¼å¼çš„ç›¸å…³ä¿¡æ¯</span></div><div class="line">    AVFormatContext *pFormatCtx = avformat_alloc_context();</div><div class="line"></div><div class="line">    <span class="comment">//æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶</span></div><div class="line">    <span class="keyword">if</span> (avformat_open_input(&amp;pFormatCtx, input, <span class="literal">NULL</span>, <span class="literal">NULL</span>) != <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼Œä¾‹å¦‚å¾—åˆ°è§†é¢‘çš„å®½é«˜</span></div><div class="line">    <span class="keyword">if</span> (avformat_find_stream_info(pFormatCtx, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§†é¢‘æµçš„ç´¢å¼•ä½ç½®</span></div><div class="line">    <span class="comment">//éå†æ‰€æœ‰ç±»å‹çš„æµï¼ˆéŸ³é¢‘æµã€è§†é¢‘æµã€å­—å¹•æµï¼‰ï¼Œæ‰¾åˆ°è§†é¢‘æµ</span></div><div class="line">    <span class="keyword">int</span> v_stream_idx = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123;</div><div class="line">        <span class="comment">//åˆ¤æ–­è§†é¢‘æµ</span></div><div class="line">        <span class="keyword">if</span> (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123;</div><div class="line">            v_stream_idx = i;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (v_stream_idx == <span class="number">-1</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ‰¾ä¸åˆ°è§†é¢‘æµ\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//æ ¹æ®è§†é¢‘çš„ç¼–ç æ–¹å¼ï¼Œè·å–å¯¹åº”çš„è§£ç å™¨</span></div><div class="line">    AVCodecContext *pCodecCtx = pFormatCtx-&gt;streams[v_stream_idx]-&gt;codec;</div><div class="line"></div><div class="line">    <span class="comment">//æ ¹æ®ç¼–è§£ç ä¸Šä¸‹æ–‡ä¸­çš„ç¼–ç  id æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨</span></div><div class="line">    AVCodec *pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (pCodec == <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ‰¾ä¸åˆ°è§£ç å™¨ï¼Œæˆ–è€…è§†é¢‘å·²åŠ å¯†\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//æ‰“å¼€è§£ç å™¨ï¼Œè§£ç å™¨æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬ç¼–è¯‘FFmpegçš„æ—¶å€™æ²¡æœ‰ç¼–è¯‘å¯¹åº”ç±»å‹çš„è§£ç å™¨ï¼‰</span></div><div class="line">    <span class="keyword">if</span> (avcodec_open2(pCodecCtx, pCodec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"è§£ç å™¨æ— æ³•æ‰“å¼€\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è¾“å‡ºè§†é¢‘ä¿¡æ¯</span></div><div class="line">    LOGI(<span class="string">"è§†é¢‘çš„æ–‡ä»¶æ ¼å¼ï¼š%s"</span>, pFormatCtx-&gt;iformat-&gt;name);</div><div class="line">    LOGI(<span class="string">"è§†é¢‘æ—¶é•¿ï¼š%lld"</span>, (pFormatCtx-&gt;duration) / (<span class="number">1000</span> * <span class="number">1000</span>));</div><div class="line">    LOGI(<span class="string">"è§†é¢‘çš„å®½é«˜ï¼š%d,%d"</span>, pCodecCtx-&gt;width, pCodecCtx-&gt;height);</div><div class="line">    LOGI(<span class="string">"è§£ç å™¨çš„åç§°ï¼š%s"</span>, pCodec-&gt;name);</div><div class="line"></div><div class="line">    <span class="comment">//å‡†å¤‡è¯»å–</span></div><div class="line">    <span class="comment">//AVPacketç”¨äºå­˜å‚¨ä¸€å¸§ä¸€å¸§çš„å‹ç¼©æ•°æ®ï¼ˆH264ï¼‰</span></div><div class="line">    <span class="comment">//ç¼“å†²åŒºï¼Œå¼€è¾Ÿç©ºé—´</span></div><div class="line">    AVPacket *packet = (AVPacket *) av_malloc(<span class="keyword">sizeof</span>(AVPacket));</div><div class="line"></div><div class="line">    <span class="comment">//AVFrameç”¨äºå­˜å‚¨è§£ç åçš„åƒç´ æ•°æ®(YUV)</span></div><div class="line">    <span class="comment">//å†…å­˜åˆ†é…</span></div><div class="line">    AVFrame *pFrame = av_frame_alloc();</div><div class="line">    <span class="comment">//YUV420</span></div><div class="line">    AVFrame *pFrameYUV = av_frame_alloc();</div><div class="line">    <span class="comment">//åªæœ‰æŒ‡å®šäº†AVFrameçš„åƒç´ æ ¼å¼ã€ç”»é¢å¤§å°æ‰èƒ½çœŸæ­£åˆ†é…å†…å­˜</span></div><div class="line">    <span class="comment">//ç¼“å†²åŒºåˆ†é…å†…å­˜</span></div><div class="line">    <span class="keyword">uint8_t</span> *out_buffer = (<span class="keyword">uint8_t</span> *) av_malloc(</div><div class="line">            avpicture_get_size(AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height));</div><div class="line">    <span class="comment">//åˆå§‹åŒ–ç¼“å†²åŒº</span></div><div class="line">    avpicture_fill((AVPicture *) pFrameYUV, out_buffer, AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width,</div><div class="line">                   pCodecCtx-&gt;height);</div><div class="line"></div><div class="line">    <span class="comment">//ç”¨äºè½¬ç ï¼ˆç¼©æ”¾ï¼‰çš„å‚æ•°ï¼Œè½¬ä¹‹å‰çš„å®½é«˜ï¼Œè½¬ä¹‹åçš„å®½é«˜ï¼Œæ ¼å¼ç­‰</span></div><div class="line">    <span class="keyword">struct</span> SwsContext *sws_ctx = sws_getContext(pCodecCtx-&gt;width, pCodecCtx-&gt;height,</div><div class="line">                                                pCodecCtx-&gt;pix_fmt,</div><div class="line">                                                pCodecCtx-&gt;width, pCodecCtx-&gt;height,</div><div class="line">                                                AV_PIX_FMT_YUV420P,</div><div class="line">                                                SWS_BICUBIC, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">int</span> got_picture, ret;</div><div class="line"></div><div class="line">    <span class="comment">//è¾“å‡ºæ–‡ä»¶</span></div><div class="line">    FILE *fp_yuv = fopen(output, <span class="string">"wb+"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> frame_count = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">//ä¸€å¸§ä¸€å¸§çš„è¯»å–å‹ç¼©æ•°æ®</span></div><div class="line">    <span class="keyword">while</span> (av_read_frame(pFormatCtx, packet) &gt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//åªè¦è§†é¢‘å‹ç¼©æ•°æ®ï¼ˆæ ¹æ®æµçš„ç´¢å¼•ä½ç½®åˆ¤æ–­ï¼‰</span></div><div class="line">        <span class="keyword">if</span> (packet-&gt;stream_index == v_stream_idx) &#123;</div><div class="line">            <span class="comment">//è§£ç ä¸€å¸§è§†é¢‘å‹ç¼©æ•°æ®ï¼Œå¾—åˆ°è§†é¢‘åƒç´ æ•°æ®</span></div><div class="line">            ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;got_picture, packet);</div><div class="line">            <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</div><div class="line">                LOGE(<span class="string">"%s"</span>, <span class="string">"è§£ç é”™è¯¯"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">//ä¸º 0 è¯´æ˜è§£ç å®Œæˆï¼Œé0æ­£åœ¨è§£ç </span></div><div class="line">            <span class="keyword">if</span> (got_picture) &#123;</div><div class="line">                <span class="comment">//AVFrameè½¬ä¸ºåƒç´ æ ¼å¼YUV420ï¼Œå®½é«˜</span></div><div class="line">                <span class="comment">//2 6è¾“å…¥ã€è¾“å‡ºæ•°æ®</span></div><div class="line">                <span class="comment">//3 7è¾“å…¥ã€è¾“å‡ºç”»é¢ä¸€è¡Œçš„æ•°æ®çš„å¤§å° AVFrame è½¬æ¢æ˜¯ä¸€è¡Œä¸€è¡Œè½¬æ¢çš„</span></div><div class="line">                <span class="comment">//4 è¾“å…¥æ•°æ®ç¬¬ä¸€åˆ—è¦è½¬ç çš„ä½ç½® ä»0å¼€å§‹</span></div><div class="line">                <span class="comment">//5 è¾“å…¥ç”»é¢çš„é«˜åº¦</span></div><div class="line">                sws_scale(sws_ctx, pFrame-&gt;data, pFrame-&gt;linesize, <span class="number">0</span>, pCodecCtx-&gt;height,</div><div class="line">                          pFrameYUV-&gt;data, pFrameYUV-&gt;linesize);</div><div class="line"></div><div class="line">                <span class="comment">//è¾“å‡ºåˆ°YUVæ–‡ä»¶</span></div><div class="line">                <span class="comment">//AVFrameåƒç´ å¸§å†™å…¥æ–‡ä»¶</span></div><div class="line">                <span class="comment">//dataè§£ç åçš„å›¾åƒåƒç´ æ•°æ®ï¼ˆéŸ³é¢‘é‡‡æ ·æ•°æ®ï¼‰</span></div><div class="line">                <span class="comment">//Y äº®åº¦ UV è‰²åº¦ï¼ˆå‹ç¼©äº†ï¼‰ äººå¯¹äº®åº¦æ›´åŠ æ•æ„Ÿ</span></div><div class="line">                <span class="comment">//U V ä¸ªæ•°æ˜¯Yçš„1/4</span></div><div class="line">                <span class="keyword">int</span> y_size = pCodecCtx-&gt;width * pCodecCtx-&gt;height;</div><div class="line">                fwrite(pFrameYUV-&gt;data[<span class="number">0</span>], <span class="number">1</span>, y_size, fp_yuv);</div><div class="line">                fwrite(pFrameYUV-&gt;data[<span class="number">1</span>], <span class="number">1</span>, y_size / <span class="number">4</span>, fp_yuv);</div><div class="line">                fwrite(pFrameYUV-&gt;data[<span class="number">2</span>], <span class="number">1</span>, y_size / <span class="number">4</span>, fp_yuv);</div><div class="line"></div><div class="line">                frame_count++;</div><div class="line">                LOGI(<span class="string">"è§£ç ç¬¬%då¸§"</span>, frame_count);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">        av_free_packet(packet);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fclose(fp_yuv);</div><div class="line"></div><div class="line">    av_frame_free(&amp;pFrame);</div><div class="line"></div><div class="line">    avcodec_close(pCodecCtx);</div><div class="line"></div><div class="line">    avformat_free_context(pFormatCtx);</div><div class="line"></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, input_, input);</div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, output_, output);</div><div class="line">    <span class="comment">//é€šçŸ¥ Java å±‚è§£ç å®Œæ¯•</span></div><div class="line">    (*env)-&gt;CallStaticVoidMethod(env, type, mid);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//ä½¿ç”¨è¿™ä¸¤ä¸ª Window ç›¸å…³çš„å¤´æ–‡ä»¶éœ€è¦åœ¨ CMake è„šæœ¬ä¸­å¼•å…¥ android åº“</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/native_window_jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/native_window.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"include/yuv/libyuv.h"</span></span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ffmpeg_AVUtils_videoRender</span><span class="params">(JNIEnv *env, jclass type, jstring input_,</span></div><div class="line">                                           jobject surface) &#123;</div><div class="line">    <span class="comment">//éœ€è¦è½¬ç çš„è§†é¢‘æ–‡ä»¶(è¾“å…¥çš„è§†é¢‘æ–‡ä»¶)</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *input = (*env)-&gt;GetStringUTFChars(env, input_, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="comment">//æ³¨å†Œæ‰€æœ‰ç»„ä»¶</span></div><div class="line">    av_register_all();</div><div class="line">    <span class="comment">//avcodec_register_all();</span></div><div class="line"></div><div class="line">    <span class="comment">//å°è£…æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œç»Ÿé¢†å…¨å±€çš„ç»“æ„ä½“ï¼Œä¿å­˜äº†è§†é¢‘æ–‡ä»¶å°è£…æ ¼å¼çš„ç›¸å…³ä¿¡æ¯</span></div><div class="line">    AVFormatContext *pFormatCtx = avformat_alloc_context();</div><div class="line"></div><div class="line">    <span class="comment">//æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶</span></div><div class="line">    <span class="keyword">if</span> (avformat_open_input(&amp;pFormatCtx, input, <span class="literal">NULL</span>, <span class="literal">NULL</span>) != <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼Œä¾‹å¦‚å¾—åˆ°è§†é¢‘çš„å®½é«˜</span></div><div class="line">    <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºä½ éœ€è¦è·å–ä»€ä¹ˆä¿¡æ¯ï¼Œæ¯”å¦‚è§†é¢‘çš„å…ƒæ•°æ®</span></div><div class="line">    <span class="keyword">if</span> (avformat_find_stream_info(pFormatCtx, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§†é¢‘æµçš„ç´¢å¼•ä½ç½®</span></div><div class="line">    <span class="comment">//éå†æ‰€æœ‰ç±»å‹çš„æµï¼ˆéŸ³é¢‘æµã€è§†é¢‘æµã€å­—å¹•æµï¼‰ï¼Œæ‰¾åˆ°è§†é¢‘æµ</span></div><div class="line">    <span class="keyword">int</span> v_stream_idx = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    <span class="comment">//number of streams</span></div><div class="line">    <span class="keyword">for</span> (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123;</div><div class="line">        <span class="comment">//æµçš„ç±»å‹</span></div><div class="line">        <span class="keyword">if</span> (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123;</div><div class="line">            v_stream_idx = i;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (v_stream_idx == <span class="number">-1</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ‰¾ä¸åˆ°è§†é¢‘æµ\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§†é¢‘æµä¸­çš„ç¼–è§£ç ä¸Šä¸‹æ–‡</span></div><div class="line">    AVCodecContext *pCodecCtx = pFormatCtx-&gt;streams[v_stream_idx]-&gt;codec;</div><div class="line"></div><div class="line">    <span class="comment">//æ ¹æ®ç¼–è§£ç ä¸Šä¸‹æ–‡ä¸­çš„ç¼–ç  id æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨</span></div><div class="line">    AVCodec *pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (pCodec == <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"æ‰¾ä¸åˆ°è§£ç å™¨ï¼Œæˆ–è€…è§†é¢‘å·²åŠ å¯†\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//æ‰“å¼€è§£ç å™¨ï¼Œè§£ç å™¨æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬ç¼–è¯‘FFmpegçš„æ—¶å€™æ²¡æœ‰ç¼–è¯‘å¯¹åº”ç±»å‹çš„è§£ç å™¨ï¼‰</span></div><div class="line">    <span class="keyword">if</span> (avcodec_open2(pCodecCtx, pCodec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGE(<span class="string">"%s"</span>, <span class="string">"è§£ç å™¨æ— æ³•æ‰“å¼€\n"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//å‡†å¤‡è¯»å–</span></div><div class="line">    <span class="comment">//AVPacketç”¨äºå­˜å‚¨ä¸€å¸§ä¸€å¸§çš„å‹ç¼©æ•°æ®ï¼ˆH264ï¼‰</span></div><div class="line">    <span class="comment">//ç¼“å†²åŒºï¼Œå¼€è¾Ÿç©ºé—´</span></div><div class="line">    AVPacket *packet = (AVPacket *) av_malloc(<span class="keyword">sizeof</span>(AVPacket));</div><div class="line"></div><div class="line">    <span class="comment">//AVFrameç”¨äºå­˜å‚¨è§£ç åçš„åƒç´ æ•°æ®(YUV)</span></div><div class="line">    <span class="comment">//å†…å­˜åˆ†é…</span></div><div class="line">    AVFrame *yuv_frame = av_frame_alloc();</div><div class="line">    AVFrame *rgb_frame = av_frame_alloc();</div><div class="line"></div><div class="line">    <span class="keyword">int</span> got_picture, ret;</div><div class="line">    <span class="keyword">int</span> frame_count = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">//çª—ä½“</span></div><div class="line">    ANativeWindow *pWindow = ANativeWindow_fromSurface(env, surface);</div><div class="line">    <span class="comment">//ç»˜åˆ¶æ—¶çš„ç¼“å†²åŒº</span></div><div class="line">    ANativeWindow_Buffer out_buffer;</div><div class="line"></div><div class="line">    <span class="comment">//ä¸€å¸§ä¸€å¸§çš„è¯»å–å‹ç¼©æ•°æ®</span></div><div class="line">    <span class="keyword">while</span> (av_read_frame(pFormatCtx, packet) &gt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//åªè¦è§†é¢‘å‹ç¼©æ•°æ®ï¼ˆæ ¹æ®æµçš„ç´¢å¼•ä½ç½®åˆ¤æ–­ï¼‰</span></div><div class="line">        <span class="keyword">if</span> (packet-&gt;stream_index == v_stream_idx) &#123;</div><div class="line">            <span class="comment">//7.è§£ç ä¸€å¸§è§†é¢‘å‹ç¼©æ•°æ®ï¼Œå¾—åˆ°è§†é¢‘åƒç´ æ•°æ®</span></div><div class="line">            ret = avcodec_decode_video2(pCodecCtx, yuv_frame, &amp;got_picture, packet);</div><div class="line">            <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</div><div class="line">                LOGE(<span class="string">"%s"</span>, <span class="string">"è§£ç é”™è¯¯"</span>);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">//ä¸º0è¯´æ˜è§£ç å®Œæˆï¼Œé0æ­£åœ¨è§£ç </span></div><div class="line">            <span class="keyword">if</span> (got_picture) &#123;</div><div class="line"></div><div class="line">                <span class="comment">//lock window</span></div><div class="line">                <span class="comment">//è®¾ç½®ç¼“å†²åŒºçš„å±æ€§ï¼šå®½é«˜ã€åƒç´ æ ¼å¼ï¼ˆéœ€è¦ä¸Javaå±‚çš„æ ¼å¼ä¸€è‡´ï¼‰</span></div><div class="line">                ANativeWindow_setBuffersGeometry(pWindow, pCodecCtx-&gt;width, pCodecCtx-&gt;height,</div><div class="line">                                                 WINDOW_FORMAT_RGBA_8888);</div><div class="line">                ANativeWindow_lock(pWindow, &amp;out_buffer, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">                <span class="comment">//åˆå§‹åŒ–ç¼“å†²åŒº</span></div><div class="line">                <span class="comment">//è®¾ç½®å±æ€§ï¼Œåƒç´ æ ¼å¼ã€å®½é«˜</span></div><div class="line">                <span class="comment">//rgb_frameçš„ç¼“å†²åŒºå°±æ˜¯Windowçš„ç¼“å†²åŒºï¼ŒåŒä¸€ä¸ªï¼Œè§£é”çš„æ—¶å€™å°±ä¼šè¿›è¡Œç»˜åˆ¶</span></div><div class="line">                avpicture_fill((AVPicture *) rgb_frame, out_buffer.bits, AV_PIX_FMT_RGBA,</div><div class="line">                               pCodecCtx-&gt;width,</div><div class="line">                               pCodecCtx-&gt;height);</div><div class="line"></div><div class="line">                <span class="comment">//YUVæ ¼å¼çš„æ•°æ®è½¬æ¢æˆRGBA 8888æ ¼å¼çš„æ•°æ®, FFmpeg ä¹Ÿå¯ä»¥è½¬æ¢ï¼Œä½†æ˜¯å­˜åœ¨é—®é¢˜ï¼Œä½¿ç”¨libyuvè¿™ä¸ªåº“å®ç°</span></div><div class="line">                I420ToARGB(yuv_frame-&gt;data[<span class="number">0</span>], yuv_frame-&gt;linesize[<span class="number">0</span>],</div><div class="line">                           yuv_frame-&gt;data[<span class="number">2</span>], yuv_frame-&gt;linesize[<span class="number">2</span>],</div><div class="line">                           yuv_frame-&gt;data[<span class="number">1</span>], yuv_frame-&gt;linesize[<span class="number">1</span>],</div><div class="line">                           rgb_frame-&gt;data[<span class="number">0</span>], rgb_frame-&gt;linesize[<span class="number">0</span>],</div><div class="line">                           pCodecCtx-&gt;width, pCodecCtx-&gt;height);</div><div class="line"></div><div class="line">                <span class="comment">//3ã€unlock window</span></div><div class="line">                ANativeWindow_unlockAndPost(pWindow);</div><div class="line"></div><div class="line">                frame_count++;</div><div class="line">                LOGI(<span class="string">"è§£ç ç»˜åˆ¶ç¬¬%då¸§"</span>, frame_count);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">        av_free_packet(packet);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    av_frame_free(&amp;yuv_frame);</div><div class="line">    avcodec_close(pCodecCtx);</div><div class="line">    avformat_free_context(pFormatCtx);</div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, input_, input);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"libswresample/swresample.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_AUDIO_FRME_SIZE 48000 * 4</span></div><div class="line"></div><div class="line"><span class="comment">//éŸ³é¢‘è§£ç ï¼ˆé‡é‡‡æ ·ï¼‰</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ffmpeg_AVUtils_audioDecode</span><span class="params">(JNIEnv *env, jclass type, jstring input_,</span></div><div class="line">                                           jstring output_) &#123;</div><div class="line">    <span class="comment">//è®¿é—®é™æ€æ–¹æ³•</span></div><div class="line">    jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, <span class="string">"onNativeCallback"</span>, <span class="string">"()V"</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *input = (*env)-&gt;GetStringUTFChars(env, input_, <span class="number">0</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *output = (*env)-&gt;GetStringUTFChars(env, output_, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="comment">//æ³¨å†Œç»„ä»¶</span></div><div class="line">    av_register_all();</div><div class="line">    AVFormatContext *pFormatCtx = avformat_alloc_context();</div><div class="line">    <span class="comment">//æ‰“å¼€éŸ³é¢‘æ–‡ä»¶</span></div><div class="line">    <span class="keyword">if</span> (avformat_open_input(&amp;pFormatCtx, input, <span class="literal">NULL</span>, <span class="literal">NULL</span>) != <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€éŸ³é¢‘æ–‡ä»¶"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯</span></div><div class="line">    <span class="keyword">if</span> (avformat_find_stream_info(pFormatCtx, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è·å–éŸ³é¢‘æµç´¢å¼•ä½ç½®</span></div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, audio_stream_idx = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_AUDIO) &#123;</div><div class="line">            audio_stream_idx = i;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§£ç å™¨</span></div><div class="line">    AVCodecContext *codecCtx = pFormatCtx-&gt;streams[audio_stream_idx]-&gt;codec;</div><div class="line">    AVCodec *codec = avcodec_find_decoder(codecCtx-&gt;codec_id);</div><div class="line">    <span class="keyword">if</span> (codec == <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è§£ç å™¨"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ‰“å¼€è§£ç å™¨</span></div><div class="line">    <span class="keyword">if</span> (avcodec_open2(codecCtx, codec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€è§£ç å™¨"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//å‹ç¼©æ•°æ®</span></div><div class="line">    AVPacket *packet = (AVPacket *) av_malloc(<span class="keyword">sizeof</span>(AVPacket));</div><div class="line">    <span class="comment">//è§£å‹ç¼©æ•°æ®</span></div><div class="line">    AVFrame *frame = av_frame_alloc();</div><div class="line">    <span class="comment">//frame-&gt;16bit 44100 PCM ç»Ÿä¸€éŸ³é¢‘é‡‡æ ·æ ¼å¼ä¸é‡‡æ ·ç‡</span></div><div class="line">    SwrContext *swrCtx = swr_alloc();</div><div class="line"></div><div class="line">    <span class="comment">//é‡é‡‡æ ·è®¾ç½®å‚æ•°</span></div><div class="line">    <span class="comment">//è¾“å…¥çš„é‡‡æ ·æ ¼å¼</span></div><div class="line">    <span class="keyword">enum</span> AVSampleFormat in_sample_fmt = codecCtx-&gt;sample_fmt;</div><div class="line">    <span class="comment">//è¾“å‡ºé‡‡æ ·æ ¼å¼16bit PCM</span></div><div class="line">    <span class="keyword">enum</span> AVSampleFormat out_sample_fmt = AV_SAMPLE_FMT_S16;</div><div class="line">    <span class="comment">//è¾“å…¥é‡‡æ ·ç‡</span></div><div class="line">    <span class="keyword">int</span> in_sample_rate = codecCtx-&gt;sample_rate;</div><div class="line">    <span class="comment">//è¾“å‡ºé‡‡æ ·ç‡</span></div><div class="line">    <span class="keyword">int</span> out_sample_rate = <span class="number">44100</span>;</div><div class="line">    <span class="comment">//è·å–è¾“å…¥çš„å£°é“å¸ƒå±€</span></div><div class="line">    <span class="comment">//æ ¹æ®å£°é“ä¸ªæ•°è·å–é»˜è®¤çš„å£°é“å¸ƒå±€ï¼ˆ2ä¸ªå£°é“ï¼Œé»˜è®¤ç«‹ä½“å£°stereoï¼‰</span></div><div class="line">    <span class="comment">//av_get_default_channel_layout(codecCtx-&gt;channels);</span></div><div class="line">    <span class="keyword">uint64_t</span> in_ch_layout = codecCtx-&gt;channel_layout;</div><div class="line">    <span class="comment">//è¾“å‡ºçš„å£°é“å¸ƒå±€ï¼ˆç«‹ä½“å£°ï¼‰</span></div><div class="line">    <span class="keyword">uint64_t</span> out_ch_layout = AV_CH_LAYOUT_STEREO;</div><div class="line"></div><div class="line">    swr_alloc_set_opts(swrCtx,</div><div class="line">                       out_ch_layout, out_sample_fmt, out_sample_rate,</div><div class="line">                       in_ch_layout, in_sample_fmt, in_sample_rate,</div><div class="line">                       <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">    swr_init(swrCtx);</div><div class="line"></div><div class="line">    <span class="comment">//è¾“å‡ºçš„å£°é“ä¸ªæ•°</span></div><div class="line">    <span class="keyword">int</span> out_channel_nb = av_get_channel_layout_nb_channels(out_ch_layout);</div><div class="line"></div><div class="line">    <span class="comment">//é‡é‡‡æ ·è®¾ç½®å‚æ•°</span></div><div class="line"></div><div class="line">    <span class="comment">//ä½å®½16bit é‡‡æ ·ç‡ 44100HZ çš„ PCM æ•°æ®</span></div><div class="line">    <span class="keyword">uint8_t</span> *out_buffer = (<span class="keyword">uint8_t</span> *) av_malloc(MAX_AUDIO_FRME_SIZE);</div><div class="line"></div><div class="line">    FILE *fp_pcm = fopen(output, <span class="string">"wb"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> got_frame = <span class="number">0</span>, index = <span class="number">0</span>, ret;</div><div class="line">    <span class="comment">//ä¸æ–­è¯»å–å‹ç¼©æ•°æ®</span></div><div class="line">    <span class="keyword">while</span> (av_read_frame(pFormatCtx, packet) &gt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//è§£ç </span></div><div class="line">        ret = avcodec_decode_audio4(codecCtx, frame, &amp;got_frame, packet);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</div><div class="line">            LOGI(<span class="string">"%s"</span>, <span class="string">"è§£ç å®Œæˆ"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//è§£ç ä¸€å¸§æˆåŠŸ</span></div><div class="line">        <span class="keyword">if</span> (got_frame &gt; <span class="number">0</span>) &#123;</div><div class="line">            LOGI(<span class="string">"è§£ç ï¼š%d"</span>, index++);</div><div class="line">            swr_convert(swrCtx, &amp;out_buffer, MAX_AUDIO_FRME_SIZE, frame-&gt;data, frame-&gt;nb_samples);</div><div class="line">            <span class="comment">//è·å–sampleçš„size</span></div><div class="line">            <span class="keyword">int</span> out_buffer_size = av_samples_get_buffer_size(<span class="literal">NULL</span>, out_channel_nb,</div><div class="line">                                                             frame-&gt;nb_samples, out_sample_fmt, <span class="number">1</span>);</div><div class="line">            fwrite(out_buffer, <span class="number">1</span>, out_buffer_size, fp_pcm);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        av_free_packet(packet);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fclose(fp_pcm);</div><div class="line">    av_frame_free(&amp;frame);</div><div class="line">    av_free(out_buffer);</div><div class="line"></div><div class="line">    swr_free(&amp;swrCtx);</div><div class="line">    avcodec_close(codecCtx);</div><div class="line">    avformat_close_input(&amp;pFormatCtx);</div><div class="line"></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, input_, input);</div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, output_, output);</div><div class="line">    <span class="comment">//é€šçŸ¥ Java å±‚è§£ç å®Œæˆ</span></div><div class="line">    (*env)-&gt;CallStaticVoidMethod(env, type, mid);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ffmpeg_AVUtils_audioPlay</span><span class="params">(JNIEnv *env, jclass type, jstring input_)</span> &#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *input = (*env)-&gt;GetStringUTFChars(env, input_, <span class="number">0</span>);</div><div class="line">    LOGI(<span class="string">"%s"</span>, <span class="string">"sound"</span>);</div><div class="line">    <span class="comment">//æ³¨å†Œç»„ä»¶</span></div><div class="line">    av_register_all();</div><div class="line">    AVFormatContext *pFormatCtx = avformat_alloc_context();</div><div class="line">    <span class="comment">//æ‰“å¼€éŸ³é¢‘æ–‡ä»¶</span></div><div class="line">    <span class="keyword">if</span> (avformat_open_input(&amp;pFormatCtx, input, <span class="literal">NULL</span>, <span class="literal">NULL</span>) != <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€éŸ³é¢‘æ–‡ä»¶"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯</span></div><div class="line">    <span class="keyword">if</span> (avformat_find_stream_info(pFormatCtx, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//è·å–éŸ³é¢‘æµç´¢å¼•ä½ç½®</span></div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, audio_stream_idx = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_AUDIO) &#123;</div><div class="line">            audio_stream_idx = i;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//è·å–è§£ç å™¨</span></div><div class="line">    AVCodecContext *codecCtx = pFormatCtx-&gt;streams[audio_stream_idx]-&gt;codec;</div><div class="line">    AVCodec *codec = avcodec_find_decoder(codecCtx-&gt;codec_id);</div><div class="line">    <span class="keyword">if</span> (codec == <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•è·å–è§£ç å™¨"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//æ‰“å¼€è§£ç å™¨</span></div><div class="line">    <span class="keyword">if</span> (avcodec_open2(codecCtx, codec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) &#123;</div><div class="line">        LOGI(<span class="string">"%s"</span>, <span class="string">"æ— æ³•æ‰“å¼€è§£ç å™¨"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//å‹ç¼©æ•°æ®</span></div><div class="line">    AVPacket *packet = (AVPacket *) av_malloc(<span class="keyword">sizeof</span>(AVPacket));</div><div class="line">    <span class="comment">//è§£å‹ç¼©æ•°æ®</span></div><div class="line">    AVFrame *frame = av_frame_alloc();</div><div class="line">    <span class="comment">//frame-&gt;16bit 44100 PCM ç»Ÿä¸€éŸ³é¢‘é‡‡æ ·æ ¼å¼ä¸é‡‡æ ·ç‡</span></div><div class="line">    SwrContext *swrCtx = swr_alloc();</div><div class="line"></div><div class="line">    <span class="comment">//è¾“å…¥çš„é‡‡æ ·æ ¼å¼</span></div><div class="line">    <span class="keyword">enum</span> AVSampleFormat in_sample_fmt = codecCtx-&gt;sample_fmt;</div><div class="line">    <span class="comment">//è¾“å‡ºé‡‡æ ·æ ¼å¼16bit PCM</span></div><div class="line">    <span class="keyword">enum</span> AVSampleFormat out_sample_fmt = AV_SAMPLE_FMT_S16;</div><div class="line">    <span class="comment">//è¾“å…¥é‡‡æ ·ç‡</span></div><div class="line">    <span class="keyword">int</span> in_sample_rate = codecCtx-&gt;sample_rate;</div><div class="line">    <span class="comment">//è¾“å‡ºé‡‡æ ·ç‡</span></div><div class="line">    <span class="keyword">int</span> out_sample_rate = in_sample_rate;</div><div class="line">    <span class="comment">//è·å–è¾“å…¥çš„å£°é“å¸ƒå±€</span></div><div class="line">    <span class="comment">//æ ¹æ®å£°é“ä¸ªæ•°è·å–é»˜è®¤çš„å£°é“å¸ƒå±€ï¼ˆ2ä¸ªå£°é“ï¼Œé»˜è®¤ç«‹ä½“å£°stereoï¼‰</span></div><div class="line">    <span class="comment">//av_get_default_channel_layout(codecCtx-&gt;channels);</span></div><div class="line">    <span class="keyword">uint64_t</span> in_ch_layout = codecCtx-&gt;channel_layout;</div><div class="line">    <span class="comment">//è¾“å‡ºçš„å£°é“å¸ƒå±€ï¼ˆç«‹ä½“å£°ï¼‰</span></div><div class="line">    <span class="keyword">uint64_t</span> out_ch_layout = AV_CH_LAYOUT_STEREO;</div><div class="line"></div><div class="line">    swr_alloc_set_opts(swrCtx,</div><div class="line">                       out_ch_layout, out_sample_fmt, out_sample_rate,</div><div class="line">                       in_ch_layout, in_sample_fmt, in_sample_rate,</div><div class="line">                       <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">    swr_init(swrCtx);</div><div class="line"></div><div class="line">    <span class="comment">//è¾“å‡ºçš„å£°é“ä¸ªæ•°</span></div><div class="line">    <span class="keyword">int</span> out_channel_nb = av_get_channel_layout_nb_channels(out_ch_layout);</div><div class="line">    <span class="comment">//AudioTrackå¯¹è±¡</span></div><div class="line">    jmethodID create_audio_track_mid = (*env)-&gt;GetStaticMethodID(env, type, <span class="string">"createAudioTrack"</span>,</div><div class="line">                                                                 <span class="string">"(II)Landroid/media/AudioTrack;"</span>);</div><div class="line">    jobject audio_track = (*env)-&gt;CallStaticObjectMethod(env, type, create_audio_track_mid,</div><div class="line">                                                         out_sample_rate, out_channel_nb);</div><div class="line"></div><div class="line">    <span class="comment">//è°ƒç”¨AudioTrack.playæ–¹æ³•</span></div><div class="line">    jclass audio_track_class = (*env)-&gt;GetObjectClass(env, audio_track);</div><div class="line">    jmethodID audio_track_play_mid = (*env)-&gt;GetMethodID(env, audio_track_class, <span class="string">"play"</span>, <span class="string">"()V"</span>);</div><div class="line">    jmethodID audio_track_stop_mid = (*env)-&gt;GetMethodID(env, audio_track_class, <span class="string">"stop"</span>, <span class="string">"()V"</span>);</div><div class="line">    (*env)-&gt;CallVoidMethod(env, audio_track, audio_track_play_mid);</div><div class="line"></div><div class="line">    <span class="comment">//AudioTrack.write</span></div><div class="line">    jmethodID audio_track_write_mid = (*env)-&gt;GetMethodID(env, audio_track_class, <span class="string">"write"</span>,</div><div class="line">                                                          <span class="string">"([BII)I"</span>);</div><div class="line">    <span class="comment">//16bit 44100 PCM æ•°æ®</span></div><div class="line">    <span class="keyword">uint8_t</span> *out_buffer = (<span class="keyword">uint8_t</span> *) av_malloc(MAX_AUDIO_FRME_SIZE);</div><div class="line"></div><div class="line">    <span class="keyword">int</span> got_frame = <span class="number">0</span>, index = <span class="number">0</span>, ret;</div><div class="line">    <span class="comment">//ä¸æ–­è¯»å–å‹ç¼©æ•°æ®</span></div><div class="line">    <span class="keyword">while</span> (av_read_frame(pFormatCtx, packet) &gt;= <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">//è§£ç éŸ³é¢‘ç±»å‹çš„Packet</span></div><div class="line">        <span class="keyword">if</span> (packet-&gt;stream_index == audio_stream_idx) &#123;</div><div class="line">            <span class="comment">//è§£ç </span></div><div class="line">            ret = avcodec_decode_audio4(codecCtx, frame, &amp;got_frame, packet);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</div><div class="line">                LOGI(<span class="string">"%s"</span>, <span class="string">"è§£ç å®Œæˆ"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//è§£ç ä¸€å¸§æˆåŠŸ</span></div><div class="line">            <span class="keyword">if</span> (got_frame &gt; <span class="number">0</span>) &#123;</div><div class="line">                LOGI(<span class="string">"è§£ç ï¼š%d"</span>, index++);</div><div class="line">                swr_convert(swrCtx, &amp;out_buffer, MAX_AUDIO_FRME_SIZE,</div><div class="line">                            (<span class="keyword">const</span> <span class="keyword">uint8_t</span> **) frame-&gt;data, frame-&gt;nb_samples);</div><div class="line">                <span class="comment">//è·å–sampleçš„size</span></div><div class="line">                <span class="keyword">int</span> out_buffer_size = av_samples_get_buffer_size(<span class="literal">NULL</span>, out_channel_nb,</div><div class="line">                                                                 frame-&gt;nb_samples, out_sample_fmt,</div><div class="line">                                                                 <span class="number">1</span>);</div><div class="line"></div><div class="line">                <span class="comment">//out_bufferç¼“å†²åŒºæ•°æ®ï¼Œè½¬æˆbyteæ•°ç»„</span></div><div class="line">                jbyteArray audio_sample_array = (*env)-&gt;NewByteArray(env, out_buffer_size);</div><div class="line">                jbyte *sample_bytep = (*env)-&gt;GetByteArrayElements(env, audio_sample_array, <span class="literal">NULL</span>);</div><div class="line">                <span class="comment">//out_bufferçš„æ•°æ®å¤åˆ¶åˆ°sampe_bytep</span></div><div class="line">                <span class="built_in">memcpy</span>(sample_bytep, out_buffer, out_buffer_size);</div><div class="line">                <span class="comment">//åŒæ­¥</span></div><div class="line">                (*env)-&gt;ReleaseByteArrayElements(env, audio_sample_array, sample_bytep, <span class="number">0</span>);</div><div class="line"></div><div class="line">                <span class="comment">//AudioTrack.write PCMæ•°æ®</span></div><div class="line">                (*env)-&gt;CallIntMethod(env, audio_track, audio_track_write_mid,</div><div class="line">                                      audio_sample_array, <span class="number">0</span>, out_buffer_size);</div><div class="line">                <span class="comment">//é‡Šæ”¾å±€éƒ¨å¼•ç”¨</span></div><div class="line">                (*env)-&gt;DeleteLocalRef(env, audio_sample_array);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        av_free_packet(packet);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    (*env)-&gt;CallVoidMethod(env, audio_track, audio_track_stop_mid);</div><div class="line"></div><div class="line">    av_frame_free(&amp;frame);</div><div class="line">    av_free(out_buffer);</div><div class="line"></div><div class="line">    swr_free(&amp;swrCtx);</div><div class="line">    avcodec_close(codecCtx);</div><div class="line">    avformat_close_input(&amp;pFormatCtx);</div><div class="line"></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, input_, input);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CMakeLists.txt<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line"></div><div class="line">include_directories(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/src/main/cpp/include)</div><div class="line"><span class="built_in">set</span>(jnilibs <span class="string">"<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/src/main/jniLibs"</span>)</div><div class="line"><span class="built_in">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library( <span class="comment"># Sets the name of the library.</span></div><div class="line">             native-lib</div><div class="line"></div><div class="line">             <span class="comment"># Sets the library as a shared library.</span></div><div class="line">             SHARED</div><div class="line"></div><div class="line">             <span class="comment"># Provides a relative path to your source file(s).</span></div><div class="line">             src/main/cpp/native-lib.c)</div><div class="line"></div><div class="line"><span class="comment"># æ·»åŠ  FFmpeg çš„ 8 ä¸ªå‡½æ•°åº“å’Œ yuvlib åº“</span></div><div class="line">add_library(avutil-54 SHARED IMPORTED )</div><div class="line">set_target_properties(avutil-54 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libavutil-54.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(swresample-1 SHARED IMPORTED )</div><div class="line">set_target_properties(swresample-1 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libswresample-1.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(avcodec-56 SHARED IMPORTED )</div><div class="line">set_target_properties(avcodec-56 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libavcodec-56.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(avformat-56 SHARED IMPORTED )</div><div class="line">set_target_properties(avformat-56 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libavformat-56.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(swscale-3 SHARED IMPORTED )</div><div class="line">set_target_properties(swscale-3 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libswscale-3.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(postproc-53 SHARED IMPORTED )</div><div class="line">set_target_properties(postproc-53 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libpostproc-53.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(avfilter-5 SHARED IMPORTED )</div><div class="line">set_target_properties(avfilter-5 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libavfilter-5.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(avdevice-56 SHARED IMPORTED )</div><div class="line">set_target_properties(avdevice-56 PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libavdevice-56.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">add_library(yuv SHARED IMPORTED )</div><div class="line">set_target_properties(yuv PROPERTIES IMPORTED_LOCATION <span class="string">"<span class="variable">$&#123;jnilibs&#125;</span>/<span class="variable">$&#123;ANDROID_ABI&#125;</span>/libyuv.so"</span>)</div><div class="line"></div><div class="line"></div><div class="line">find_library( <span class="comment"># Sets the name of the path variable.</span></div><div class="line">              <span class="built_in">log</span>-lib</div><div class="line"></div><div class="line">              <span class="comment"># Specifies the name of the NDK library that</span></div><div class="line">              <span class="comment"># you want CMake to locate.</span></div><div class="line">              <span class="built_in">log</span> )</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#æ‰¾åˆ° Android ç³»ç»Ÿ Window ç»˜åˆ¶ç›¸å…³çš„åº“</span></div><div class="line">find_library(</div><div class="line">            android-lib</div><div class="line">            android</div><div class="line">            )</div><div class="line"></div><div class="line"></div><div class="line">target_link_libraries( native-lib </div><div class="line">                       <span class="variable">$&#123;log-lib&#125;</span> </div><div class="line">                       <span class="variable">$&#123;android-lib&#125;</span> </div><div class="line">                       avutil-54 </div><div class="line">                       swresample-1</div><div class="line">                       avcodec-56</div><div class="line">                       avformat-56</div><div class="line">                       swscale-3</div><div class="line">                       postproc-53</div><div class="line">                       avfilter-5</div><div class="line">                       avdevice-56</div><div class="line">                       yuv)</div></pre></td></tr></table></figure></p>
<p>PSï¼š</p>
<ol>
<li>æ³¨æ„æ·»åŠ æ–‡ä»¶è¯»å†™æƒé™ã€‚</li>
<li>å…³æ³¨å…¬ä¼—å· <code>AndroidGeeks</code> ï¼Œå¹¶åœ¨åå°å›å¤ <code>ffmpeglib</code> è·å–ç›¸åº”çš„å‡½æ•°åº“ã€‚</li>
</ol>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="http://blog.csdn.net/leixiaohua1020/article/details/15811977" title="é›·éœ„éª…" target="_blank" rel="external">é›·éœ„éª…åšå®¢ http://blog.csdn.net/leixiaohua1020/article/details/15811977</a><br>Jason çš„ NDK å¼€å‘é«˜çº§æ•™ç¨‹</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180204.jpeg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;è¯¸
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="FFmpeg" scheme="https://githubhaohao.github.io/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>NDK FFmpeg ç¼–è¯‘</title>
    <link href="https://githubhaohao.github.io/2018/01/20/NDK-FFmpeg-compile/"/>
    <id>https://githubhaohao.github.io/2018/01/20/NDK-FFmpeg-compile/</id>
    <published>2018-01-20T01:35:06.000Z</published>
    <updated>2018-01-20T08:44:36.117Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180120.jpg" alt="Markdown"></p><p></p>
<p><div align="center">äº’è”ç½‘æ—¶ä»£é™åˆ¶ä¸ªäººå‘å±•çš„ä¸å†æ˜¯æŒæ¡çŸ¥è¯†å’Œä¿¡æ¯çš„å¤šå°‘ï¼Œè€Œæ˜¯ä¸ªäººçš„è®¤çŸ¥æ°´å¹³ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ Linux ç¯å¢ƒä¸‹ FFmpeg çš„ç¼–è¯‘ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š                                                                                                                                                                                          </p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
<li><a href="http://haohaochang.cn/2018/01/09/NDK-posix-multi-thread/" target="_blank" rel="external">NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
<li><a href="http://haohaochang.cn/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/" target="_blank" rel="external">NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸æ’­æ”¾</a></li>
</ul>
<h1 id="FFmpeg-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#FFmpeg-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="FFmpeg æ˜¯ä»€ä¹ˆï¼Ÿ"></a>FFmpeg æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>FFmpeg å…¨ç§°ï¼ˆFirst Forward MPEGï¼‰ï¼Œæ˜¯ä¸€æ¬¾é¢†å…ˆçš„å¼€æºå¤šåª’ä½“æ¡†æ¶ï¼Œé‡‡ç”¨ LGPL æˆ– GPL è®¸å¯è¯ï¼Œé™¤äº†å…·æœ‰éŸ³è§†é¢‘ç¼–è§£ç åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰è§†é¢‘æ ¼å¼è½¬æ¢ã€è§†é¢‘æŠ“å›¾ã€è§†é¢‘æ°´å°ã€æ¨æµç­‰åŠŸèƒ½ã€‚ FFmpeg åœ¨ Linux å¹³å°ä¸‹å¼€å‘ï¼Œä½†å®ƒåŒæ ·ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿç¯å¢ƒä¸­ç¼–è¯‘è¿è¡Œï¼ŒåŒ…æ‹¬ Windows ã€Mac OS X ç­‰ã€‚</p>
<p>FFmpegçš„å®˜æ–¹ç½‘ç«™æ˜¯ï¼š<a href="http://ffmpeg.org/" target="_blank" rel="external">http://ffmpeg.org/</a></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/TIM%E6%88%AA%E5%9B%BE20180120153405.png" alt=""></p>
<p>Windows å¹³å°ä¸‹ï¼Œç¼–è¯‘å¥½çš„å¯ç”¨ç‰ˆæœ¬ä¸€èˆ¬æœ‰ä¸‰ä¸ªï¼š Static ï¼ŒShared ï¼ŒDev ã€‚Static é‡Œé¢æœ‰ 3 ä¸ªåº”ç”¨ç¨‹åºï¼šffmpeg.exe ï¼Œffplay.exe ï¼Œffprobe.exe ï¼ŒåŠ¨æ€é“¾æ¥åº“éƒ½è¢«ç¼–è¯‘åœ¨ exe æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ª exe çš„ä½“ç§¯éƒ½å¾ˆå¤§ï¼Œå¯ç›´æ¥è¿è¡Œï¼Œå¦‚æ’­æ”¾ä¸€æ®µè§†é¢‘ï¼Œå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼š<code>ffmpeg video.mp4</code>ã€‚Shared é‡Œé¢é™¤äº† 3 ä¸ªåº”ç”¨ç¨‹åºï¼šffmpeg.exe ï¼Œffplay.exe ï¼Œffprobe.exe ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›åŠ¨æ€é“¾æ¥åº“ï¼Œå¦‚ avcodec-54.dll ä¹‹ç±»çš„ï¼ŒShared é‡Œé¢çš„ exe ä½“ç§¯è¾ƒå°ã€‚Dev ç‰ˆæœ¬ä¸»è¦ç”¨äºå¼€å‘çš„ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›åº“æ–‡ä»¶ xxx.lib å’Œæ–‡ä»¶ xxx.h ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/TIM%E6%88%AA%E5%9B%BE20180120154626.png" alt=""></p>
<p>Linux å¹³å°ä¸‹ï¼Œæœ¬æ–‡é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯ 2.6.9 ï¼Œåœ°å€ï¼š<a href="http://ffmpeg.org/olddownload.html" target="_blank" rel="external">http://ffmpeg.org/olddownload.html</a> </p>
<h1 id="ç¼–è¯‘-FFmpeg"><a href="#ç¼–è¯‘-FFmpeg" class="headerlink" title="ç¼–è¯‘ FFmpeg"></a>ç¼–è¯‘ FFmpeg</h1><p>æ­å»º Linux å¼€å‘ç¯å¢ƒï¼Œå®‰è£… Ubuntu è™šæ‹Ÿæœºæˆ–è€…ç”µè„‘è£…æˆåŒç³»ç»Ÿï¼Œæˆ–è€…è´­ä¹°ä¸€ä¸ªä½é…çš„é˜¿é‡Œäº‘ä¸»æœºï¼Œæ–‡ä»¶ä¼ è¾“å·¥å…·æ¨è FileZilla æˆ– XFTP ã€‚</p>
<h2 id="Linux-ç¯å¢ƒä¸‹é…ç½®-NDK"><a href="#Linux-ç¯å¢ƒä¸‹é…ç½®-NDK" class="headerlink" title="Linux ç¯å¢ƒä¸‹é…ç½® NDK"></a>Linux ç¯å¢ƒä¸‹é…ç½® NDK</h2><p>é¦–å…ˆä¸‹è½½ Linux ç¯å¢ƒä¸‹çš„ NDK ï¼ˆæ³¨æ„ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œå¦‚ <code>android-ndk-r11c-linux-x86_64.bin</code> ã€‚<br>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹ç¼©ï¼š<br><code>./android-ndk-r11c-linux-x86_64.bin</code><br>é…ç½®ç¯å¢ƒå˜é‡ï¼Œé¦–å…ˆç¼–è¾‘ .bashrc æ–‡ä»¶ã€‚<br><code>vim ~/.bashrc</code><br>åœ¨æ–‡ä»¶ç»“å°¾æ·»åŠ ä¸¤è¡Œä»£ç ï¼š<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> NDKROOT=( NDK è§£å‹çš„æ ¹ç›®å½•ï¼‰å¦‚ ã€/usr/workspace/ndk/android-ndk-r11c</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$NDKROOT</span>:<span class="variable">$PATH</span></div></pre></td></tr></table></figure></p>
<p>æ›´æ–°ç¯å¢ƒå˜é‡ï¼š<br><code>source ~/.bashrc</code></p>
<h2 id="ç¼–è¯‘å‡†å¤‡"><a href="#ç¼–è¯‘å‡†å¤‡" class="headerlink" title="ç¼–è¯‘å‡†å¤‡"></a>ç¼–è¯‘å‡†å¤‡</h2><p>é¦–å…ˆä¸‹è½½ FFmpeg ï¼Œåœ°å€ï¼š<a href="http://ffmpeg.org/olddownload.html" target="_blank" rel="external">http://ffmpeg.org/olddownload.html</a>ã€‚<br>è§£å‹ï¼š<code>uzip ffmpeg-2.6.9.zip</code><br>ç„¶åç¼–å†™ç”¨äºç¼–è¯‘çš„ Shell è„šæœ¬ï¼Œåœ¨ ffmpeg-2.6.9 æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š<code>vim build_android.sh</code><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">make clean</div><div class="line"><span class="built_in">export</span> NDK=/home/wuhuannan/Android/Sdk/ndk-bundle</div><div class="line"><span class="built_in">export</span> SYSROOT=<span class="variable">$NDK</span>/platforms/android-14/arch-arm/</div><div class="line"><span class="built_in">export</span> TOOLCHAIN=<span class="variable">$NDK</span>/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64</div><div class="line"><span class="built_in">export</span> CPU=arm</div><div class="line"><span class="built_in">export</span> PREFIX=$(<span class="built_in">pwd</span>)/android/<span class="variable">$CPU</span></div><div class="line"><span class="built_in">export</span> ADDI_CFLAGS=<span class="string">"-marm"</span></div><div class="line"></div><div class="line">./configure --target-os=linux \</div><div class="line">--prefix=<span class="variable">$PREFIX</span> --arch=arm \</div><div class="line">--disable-doc \</div><div class="line">--enable-shared \</div><div class="line">--disable-static \</div><div class="line">--disable-yasm \</div><div class="line">--disable-symver \</div><div class="line">--enable-gpl \</div><div class="line">--disable-ffmpeg \</div><div class="line">--disable-ffplay \</div><div class="line">--disable-ffprobe \</div><div class="line">--disable-ffserver \</div><div class="line">--disable-doc \</div><div class="line">--disable-symver \</div><div class="line">--cross-prefix=<span class="variable">$TOOLCHAIN</span>/bin/arm-linux-androideabi- \</div><div class="line">--enable-cross-compile \</div><div class="line">--sysroot=<span class="variable">$SYSROOT</span> \</div><div class="line">--extra-cflags=<span class="string">"-Os -fpic <span class="variable">$ADDI_CFLAGS</span>"</span> \</div><div class="line">--extra-ldflags=<span class="string">"<span class="variable">$ADDI_LDFLAGS</span>"</span> \</div><div class="line"><span class="variable">$ADDITIONAL_CONFIGURE_FLAG</span></div><div class="line">make clean</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>ç„¶åä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ configure æ–‡ä»¶ã€‚<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#æ‰¾åˆ°å¹¶æ³¨é‡Šä»¥ä¸‹ä»£ç </span></div><div class="line"><span class="comment">#SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBMAJOR)'</span></div><div class="line"><span class="comment">#LIB_INSTALL_EXTRA_CMD='$$(RANLIB) "$(LIBDIR)/$(LIBNAME)"'</span></div><div class="line"><span class="comment">#SLIB_INSTALL_NAME='$(SLIBNAME_WITH_VERSION)'</span></div><div class="line"><span class="comment">#SLIB_INSTALL_LINKS='$(SLIBNAME_WITH_MAJOR) $(SLIBNAME)'</span></div><div class="line"></div><div class="line"><span class="comment">#åœ¨ä¸Šè¿°ä»£ç ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç </span></div><div class="line">SLIBNAME_WITH_MAJOR=<span class="string">'$(SLIBPREF)$(FULLNAME)-$(LIBMAJOR)$(SLIBSUF)'</span></div><div class="line">LIB_INSTALL_EXTRA_CMD=<span class="string">'$$(RANLIB)"$(LIBDIR)/$(LIBNAME)"'</span></div><div class="line">SLIB_INSTALL_NAME=<span class="string">'$(SLIBNAME_WITH_MAJOR)'</span></div><div class="line">SLIB_INSTALL_LINKS=<span class="string">'$(SLIBNAME)'</span></div></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š</p>
<p><code>chmod +x build_android.sh configure</code></p>
<p>æ‰§è¡Œä¸€ä¸‹è„šæœ¬å¼€å§‹ç¼–è¯‘ï¼š</p>
<p><code>./build_android.sh</code></p>
<p>çº¦å‡ åˆ†é’Ÿåï¼Œç¼–è¯‘ç”Ÿæˆçš„åŠ¨æ€åº“æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ffmpeg/TIM%E6%88%AA%E5%9B%BE20171219183959.png" alt=""></p>
<p>åç»­æˆ‘ä»¬å°†åœ¨ Android ç¯å¢ƒä¸‹çš„éŸ³è§†é¢‘ç¼–è§£ç ä¸­ä½¿ç”¨è¿™ä¸ªåŠ¨æ€åº“ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180120.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;äº’è”
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="FFmpeg" scheme="https://githubhaohao.github.io/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸æ’­æ”¾</title>
    <link href="https://githubhaohao.github.io/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/"/>
    <id>https://githubhaohao.github.io/2018/01/15/NDK-Android-OpenSL-ES-Tutorial/</id>
    <published>2018-01-15T02:16:29.000Z</published>
    <updated>2018-01-15T10:46:29.213Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171202.jpg" alt="Markdown"></p><p></p>
<p><div align="center">ä¸è¦ç”¨æˆ˜æœ¯ä¸Šçš„å‹¤å¥‹æ©ç›–æˆ˜ç•¥ä¸Šçš„æ‡’æƒ°ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹åŸºäº Android OpenSL ES å®ç°éŸ³é¢‘çš„é‡‡é›†ä¸æ’­æ”¾ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š</p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
<li><a href="http://haohaochang.cn/2018/01/09/NDK-posix-multi-thread/" target="_blank" rel="external">NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</a></li>
</ul>
<h1 id="OpenSL-ES-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#OpenSL-ES-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="OpenSL ES æ˜¯ä»€ä¹ˆï¼Ÿ"></a>OpenSL ES æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>OpenSL ES æ˜¯ä¸€ä¸ªé’ˆå¯¹åµŒå…¥å¼ç³»ç»Ÿçš„å¼€æ”¾ç¡¬ä»¶éŸ³é¢‘åŠ é€Ÿåº“ï¼Œä¹Ÿå¯ä»¥å°†å…¶è§†ä¸ºä¸€å¥—é’ˆå¯¹åµŒå…¥å¼å¹³å°çš„éŸ³é¢‘æ ‡å‡†ï¼Œå…¨ç§°ä¸ºï¼š Open Sound Library for Embedded Systems ï¼Œå®ƒæä¾›äº†ä¸€å¥—é«˜æ€§èƒ½ã€ ä½å»¶è¿Ÿçš„éŸ³é¢‘åŠŸèƒ½å®ç°æ–¹æ³•ï¼Œå¹¶ä¸”å®ç°äº†è½¯ç¡¬ä»¶éŸ³é¢‘æ€§èƒ½çš„è·¨å¹³å°éƒ¨ç½²ï¼Œå¤§å¤§é™ä½äº†ä¸Šå±‚å¤„ç†éŸ³é¢‘åº”ç”¨çš„å¼€å‘éš¾åº¦ã€‚</p>
<p>åœ¨ Android å¼€å‘ä¸­ï¼ŒGoogle å®˜æ–¹ä» Android 2.3 ï¼ˆAPI 9ï¼‰å¼€å§‹ï¼Œä¾¿æ”¯æŒäº† OpenSL ES æ ‡å‡† ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œäº†æ‰©å±•ã€‚æœ¬æ–‡ä»‹ç»çš„ OpenSL ES æ˜¯é’ˆå¯¹ Android NDK å¼€å‘æ¥è¯´ã€‚</p>
<h1 id="OpenSL-ES-çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ"><a href="#OpenSL-ES-çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="OpenSL ES çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ"></a>OpenSL ES çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µ</h1><h2 id="åŸºäº-c-è¯­è¨€çš„é¢å‘å¯¹è±¡æ¥å£"><a href="#åŸºäº-c-è¯­è¨€çš„é¢å‘å¯¹è±¡æ¥å£" class="headerlink" title="åŸºäº c è¯­è¨€çš„é¢å‘å¯¹è±¡æ¥å£"></a>åŸºäº c è¯­è¨€çš„é¢å‘å¯¹è±¡æ¥å£</h2><p>OpenSL ES æ˜¯åŸºäº c è¯­è¨€å®ç°çš„ï¼Œä½†å…¶æä¾›çš„æ¥å£æ˜¯é‡‡ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å®ç°ï¼ŒOpenSL ES çš„å¤§å¤šæ•° API æ˜¯é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨çš„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œä¸»è¦çš„é€»è¾‘æ˜¯å®ä¾‹åŒ–å¼•æ“å¯¹è±¡å’Œè·å–å¼•æ“å¯¹è±¡æ¥å£ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">SLresult result;</div><div class="line"></div><div class="line"><span class="comment">// realize the engine</span></div><div class="line">result = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div><div class="line"></div><div class="line">result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div></pre></td></tr></table></figure></p>
<h2 id="å¯¹è±¡å’Œæ¥å£æ¦‚å¿µ"><a href="#å¯¹è±¡å’Œæ¥å£æ¦‚å¿µ" class="headerlink" title="å¯¹è±¡å’Œæ¥å£æ¦‚å¿µ"></a>å¯¹è±¡å’Œæ¥å£æ¦‚å¿µ</h2><p>Object å’Œ Interface OpenSL ES ä¸­çš„ä¸¤å¤§åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥ç±»æ¯”ä¸º Java ä¸­çš„å¯¹è±¡å’Œæ¥å£ã€‚åœ¨ OpenSL ES ä¸­ï¼Œ æ¯ä¸ª Object å¯ä»¥å­˜åœ¨ä¸€ç³»åˆ—çš„ Interface ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªå¯¹è±¡éƒ½æä¾›äº†ä¸€ç³»åˆ—çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ Realizeï¼ŒGetStateï¼ŒDestroy ç­‰ã€‚é‡è¦çš„ä¸€ç‚¹ï¼Œåªæœ‰é€šè¿‡ GetInterface æ–¹æ³•æ‹¿åˆ° Object çš„ Interface ï¼Œæ‰èƒ½ä½¿ç”¨ Object æä¾›çš„åŠŸèƒ½ã€‚</p>
<h2 id="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>OpenSL ES çš„ Object ä¸€èˆ¬æœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼š SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰ï¼ŒSL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰ï¼ŒSL_OBJECT_STATE_SUSPENDEDï¼ˆæŒ‚èµ·ï¼‰ã€‚</p>
<p>Object å¤„äº SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶åˆ†é…èµ„æºï¼›è°ƒç”¨ Realize æ–¹æ³•åä¾¿è¿›å…¥ SL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰çŠ¶æ€ï¼Œæ­¤æ—¶å¯¹è±¡çš„å„ä¸ªåŠŸèƒ½å’Œèµ„æºå¯ä»¥æ­£å¸¸è®¿é—®ï¼›å½“ç³»ç»ŸéŸ³é¢‘ç›¸å…³çš„ç¡¬ä»¶è®¾å¤‡è¢«å…¶ä»–è¿›ç¨‹å ç”¨æ—¶ï¼ŒOpenSL ES Object ä¾¿ä¼šè¿›å…¥ SL_OBJECT_STATE_SUSPENDED ï¼ˆæŒ‚èµ·ï¼‰çŠ¶æ€ï¼Œéšåè°ƒç”¨ Resume æ–¹æ³•å¯ä½¿å¯¹è±¡é‡å› SL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰çŠ¶æ€ï¼›å½“ Object ä½¿ç”¨ç»“æŸåï¼Œè°ƒç”¨ Destroy æ–¹æ³•é‡Šæ”¾èµ„æºï¼Œæ˜¯å¯¹è±¡é‡å› SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰çŠ¶æ€ã€‚</p>
<h1 id="OpenSL-ES-å¸¸ç”¨çš„-Object-å’Œ-Interface"><a href="#OpenSL-ES-å¸¸ç”¨çš„-Object-å’Œ-Interface" class="headerlink" title="OpenSL ES å¸¸ç”¨çš„ Object å’Œ Interface"></a>OpenSL ES å¸¸ç”¨çš„ Object å’Œ Interface</h1><h2 id="Audio-å¼•æ“å¯¹è±¡å’Œæ¥å£"><a href="#Audio-å¼•æ“å¯¹è±¡å’Œæ¥å£" class="headerlink" title="Audio å¼•æ“å¯¹è±¡å’Œæ¥å£"></a>Audio å¼•æ“å¯¹è±¡å’Œæ¥å£</h2><p>Audio å¼•æ“å¯¹è±¡å’Œæ¥å£ï¼Œå³ Engine Object å’Œ SLEngineItf Interface ã€‚Engine Object çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç† Audio Engine çš„ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›å¼•æ“å¯¹è±¡çš„ç®¡ç†æ¥å£ã€‚å¼•æ“å¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">SLresult result;</div><div class="line"><span class="comment">// åˆ›å»ºå¼•æ“å¯¹è±¡</span></div><div class="line">result = slCreateEngine(&amp;engineObject, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div><div class="line"></div><div class="line"><span class="comment">// å®ä¾‹åŒ–</span></div><div class="line">result = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div><div class="line"></div><div class="line"><span class="comment">// è·å–å¼•æ“å¯¹è±¡æ¥å£</span></div><div class="line">result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div><div class="line"></div><div class="line"><span class="comment">// é‡Šæ”¾å¼•æ“å¯¹è±¡çš„èµ„æº</span></div><div class="line">result = (*engineObject)-&gt;Destroy(engineObject, SL_BOOLEAN_FALSE);</div><div class="line">assert(SL_RESULT_SUCCESS == result);</div><div class="line">(<span class="keyword">void</span>)result;</div></pre></td></tr></table></figure></p>
<h2 id="SLRecordItf-å’Œ-SLPlayItf"><a href="#SLRecordItf-å’Œ-SLPlayItf" class="headerlink" title="SLRecordItf å’Œ SLPlayItf"></a>SLRecordItf å’Œ SLPlayItf</h2><p>SLRecordItf å’Œ SLPlayItf åˆ†åˆ«æŠ½è±¡å¤šåª’ä½“åŠŸèƒ½ recorder å’Œ player ï¼Œé€šè¿‡ SLEngineItf çš„ CreateAudioPlayer å’Œ CreateAudioRecorder æ–¹æ³•åˆ†åˆ«åˆ›å»º player å’Œ recorder å¯¹è±¡å®ä¾‹ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»º audio recorder å¯¹è±¡</span></div><div class="line">result = (*engineEngine)-&gt;CreateAudioRecorder(engineEngine, &amp;recorderObject , &amp;recSource, &amp;dataSink,</div><div class="line">                                                  NUM_RECORDER_EXPLICIT_INTERFACES, iids, required);</div><div class="line"></div><div class="line"><span class="comment">// åˆ›å»º audio player å¯¹è±¡</span></div><div class="line">SLresult result = (*engineEngine)-&gt;CreateAudioPlayer(</div><div class="line">        engineEngine,</div><div class="line">        &amp;audioPlayerObject,</div><div class="line">        &amp;dataSource,</div><div class="line">        &amp;dataSink,</div><div class="line">        <span class="number">1</span>,</div><div class="line">        interfaceIDs,</div><div class="line">        requiredInterfaces</div><div class="line">);</div></pre></td></tr></table></figure></p>
<h2 id="SLDataSource-å’Œ-SLDataSink"><a href="#SLDataSource-å’Œ-SLDataSink" class="headerlink" title="SLDataSource å’Œ SLDataSink"></a>SLDataSource å’Œ SLDataSink</h2><p>OpenSL ES ä¸­çš„ SLDataSource å’Œ SLDataSink ç»“æ„ä½“ï¼Œä¸»è¦ç”¨äºæ„å»º audio player å’Œ recorder å¯¹è±¡ï¼Œå…¶ä¸­ SLDataSource è¡¨ç¤ºéŸ³é¢‘æ•°æ®æ¥æºçš„ä¿¡æ¯ï¼ŒSLDataSink è¡¨ç¤ºéŸ³é¢‘æ•°æ®è¾“å‡ºä¿¡æ¯ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ•°æ®æºç®€å•ç¼“å†²é˜Ÿåˆ—å®šä½å™¨</span></div><div class="line">SLDataLocator_AndroidSimpleBufferQueue dataSou</div><div class="line">        SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEU</div><div class="line">        <span class="number">1</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">// PCM æ•°æ®æºæ ¼å¼</span></div><div class="line">SLDataFormat_PCM dataSourceFormat = &#123;</div><div class="line">        SL_DATAFORMAT_PCM, <span class="comment">// æ ¼å¼ç±»å‹</span></div><div class="line">        wav_get_channels(wav), <span class="comment">// é€šé“æ•°</span></div><div class="line">        wav_get_rate(wav) * <span class="number">1000</span>, <span class="comment">//é‡‡æ ·ç‡</span></div><div class="line">        wav_get_bits(wav), <span class="comment">// ä½å®½</span></div><div class="line">        wav_get_bits(wav),</div><div class="line">        SL_SPEAKER_FRONT_CENTER, <span class="comment">// é€šé“å±è”½</span></div><div class="line">        SL_BYTEORDER_LITTLEENDIAN <span class="comment">// å­—èŠ‚é¡ºåº</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// æ•°æ®æº</span></div><div class="line">SLDataSource dataSource = &#123;</div><div class="line">        &amp;dataSourceLocator,</div><div class="line">        &amp;dataSourceFormat</div><div class="line">&#125;;</div><div class="line"><span class="comment">// é’ˆå¯¹æ•°æ®æ¥æ”¶å™¨çš„è¾“å‡ºæ··åˆå®šä½å™¨(æ··éŸ³å™¨)</span></div><div class="line">SLDataLocator_OutputMix dataSinkLocator = &#123;</div><div class="line">        SL_DATALOCATOR_OUTPUTMIX, <span class="comment">// å®šä½å™¨ç±»å‹</span></div><div class="line">        outputMixObject <span class="comment">// è¾“å‡ºæ··åˆ</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">// è¾“å‡º</span></div><div class="line">SLDataSink dataSink = &#123;</div><div class="line">        &amp;dataSinkLocator, <span class="comment">// å®šä½å™¨</span></div><div class="line">        <span class="number">0</span>,</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h1 id="OpenSL-ES-Recorder-å’Œ-Player-åŠŸèƒ½æ„å»º"><a href="#OpenSL-ES-Recorder-å’Œ-Player-åŠŸèƒ½æ„å»º" class="headerlink" title="OpenSL ES Recorder å’Œ Player åŠŸèƒ½æ„å»º"></a>OpenSL ES Recorder å’Œ Player åŠŸèƒ½æ„å»º</h1><p>Audio Recorder<br><img src="http://ovv1lq7pk.bkt.clouddn.com/opensles_recorder.png" alt="opensles_recorder"><br>Audio Player<br><img src="http://ovv1lq7pk.bkt.clouddn.com/opensles_player.png" alt="opensles_player"></p>
<p>PSï¼š Audio Player çš„ Data Source ä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°å­˜å‚¨æˆ–ç¼“å­˜çš„éŸ³é¢‘æ•°æ®ï¼Œä»¥ä¸Šå›¾ç‰‡æ¥è‡ªäº Jhuster çš„åšå®¢ã€‚</p>
<h1 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h1><p>ä»¥ä¸‹ä»£ç ä¸»è¦å®ç°éŸ³é¢‘æ•°æ®çš„é‡‡é›†ã€ä¿å­˜å’Œæ’­æ”¾ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Created by haohao on 2018/1/12.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SLES/OpenSLES.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;SLES/OpenSLES_Android.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> AUDIO_SRC_PATH <span class="meta-string">"/sdcard/audio.pcm"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGI(FORMAT, ...) __android_log_print(ANDROID_LOG_INFO,<span class="meta-string">"haohao"</span>,FORMAT,##__VA_ARGS__);</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGE(FORMAT, ...) __android_log_print(ANDROID_LOG_ERROR,<span class="meta-string">"haohao"</span>,FORMAT,##__VA_ARGS__);</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM_RECORDER_EXPLICIT_INTERFACES 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM_BUFFER_QUEUE 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SAMPLE_RATE 44100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PERIOD_TIME 20  <span class="comment">// 20ms</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FRAME_SIZE SAMPLE_RATE * PERIOD_TIME / 1000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CHANNELS 2</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BUFFER_SIZE   (FRAME_SIZE * CHANNELS)</span></div><div class="line"></div><div class="line"><span class="comment">// engine interfaces</span></div><div class="line"><span class="keyword">static</span> SLObjectItf engineObject = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLEngineItf engineEngine = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="comment">// audio recorder interfaces</span></div><div class="line"><span class="keyword">static</span> SLObjectItf recorderObject = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLRecordItf recorderRecord = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLAndroidSimpleBufferQueueItf recorderBuffQueueItf = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLAndroidConfigurationItf configItf = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="comment">// pcm audio player interfaces</span></div><div class="line"><span class="keyword">static</span> SLObjectItf playerObject = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLPlayItf playerPlay = <span class="literal">NULL</span>;</div><div class="line"><span class="keyword">static</span> SLObjectItf outputMixObjext = <span class="literal">NULL</span>; <span class="comment">// æ··éŸ³å™¨</span></div><div class="line"><span class="keyword">static</span> SLAndroidSimpleBufferQueueItf playerBufferQueueItf = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEngine</span><span class="params">()</span></span>&#123;</div><div class="line">    SLEngineOption EngineOption[] = &#123;</div><div class="line">            &#123;(SLuint32) SL_ENGINEOPTION_THREADSAFE, (SLuint32) SL_BOOLEAN_TRUE&#125;</div><div class="line">    &#125;;</div><div class="line">    SLresult result;</div><div class="line">    result = slCreateEngine(&amp;engineObject, <span class="number">1</span>, EngineOption, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">/* Realizing the SL Engine in synchronous mode. */</span></div><div class="line">    result = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">// get the engine interface, which is needed in order to create other objects</span></div><div class="line">    result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> AudioContext &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    FILE *pfile;</div><div class="line">    <span class="keyword">uint8_t</span> *buffer;</div><div class="line">    <span class="keyword">size_t</span> bufferSize;</div><div class="line"></div><div class="line">    AudioContext(FILE *pfile, <span class="keyword">uint8_t</span> *buffer, <span class="keyword">size_t</span> bufferSize)&#123;</div><div class="line">        <span class="keyword">this</span>-&gt;pfile = pfile;</div><div class="line">        <span class="keyword">this</span>-&gt;buffer = buffer;</div><div class="line">        <span class="keyword">this</span>-&gt;bufferSize = bufferSize;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> AudioContext *recorderContext = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="comment">// å½•åˆ¶éŸ³é¢‘æ—¶çš„å›è°ƒ</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">AudioRecorderCallback</span><span class="params">(SLAndroidSimpleBufferQueueItf bufferQueueItf, <span class="keyword">void</span> *context)</span></span>&#123;</div><div class="line">    AudioContext *recorderContext = (AudioContext*)context;</div><div class="line">    assert(recorderContext != <span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">if</span> (recorderContext-&gt;buffer != <span class="literal">NULL</span>) &#123;</div><div class="line">        fwrite(recorderContext-&gt;buffer, recorderContext-&gt;bufferSize, <span class="number">1</span>, recorderContext-&gt;pfile);</div><div class="line">        LOGI(<span class="string">"save a frame audio data."</span>);</div><div class="line">        SLresult result;</div><div class="line">        SLuint32 state;</div><div class="line">        result = (*recorderRecord)-&gt;GetRecordState(recorderRecord, &amp;state);</div><div class="line">        assert(SL_RESULT_SUCCESS == result);</div><div class="line">        (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (state == SL_RECORDSTATE_RECORDING) &#123;</div><div class="line">            result = (*bufferQueueItf)-&gt;Enqueue(bufferQueueItf, recorderContext-&gt;buffer, recorderContext-&gt;bufferSize);</div><div class="line">            assert(SL_RESULT_SUCCESS == result);</div><div class="line">            (<span class="keyword">void</span>) result;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// æ’­æ”¾éŸ³é¢‘æ—¶çš„å›è°ƒ</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">AudioPlayerCallback</span><span class="params">(SLAndroidSimpleBufferQueueItf bufferQueueItf, <span class="keyword">void</span> *context)</span></span>&#123;</div><div class="line">    AudioContext *playerContext = (AudioContext*)context;</div><div class="line">    <span class="keyword">if</span> (!feof(playerContext-&gt;pfile)) &#123;</div><div class="line">        fread(playerContext-&gt;buffer, playerContext-&gt;bufferSize, <span class="number">1</span>, playerContext-&gt;pfile);</div><div class="line">        LOGI(<span class="string">"read a frame audio data."</span>);</div><div class="line">        (*bufferQueueItf)-&gt;Enqueue(bufferQueueItf, playerContext-&gt;buffer, playerContext-&gt;bufferSize);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        fclose(playerContext-&gt;pfile);</div><div class="line">        <span class="keyword">delete</span> playerContext-&gt;buffer;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// åˆ›å»ºéŸ³é¢‘æ’­æ”¾å™¨</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">createAudioPlayer</span><span class="params">(SLEngineItf engineEngine, SLObjectItf outputMixObject, SLObjectItf &amp;audioPlayerObject)</span></span>&#123;</div><div class="line">    SLDataLocator_AndroidSimpleBufferQueue dataSourceLocator = &#123;</div><div class="line">            SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE,</div><div class="line">            <span class="number">1</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// PCM æ•°æ®æºæ ¼å¼</span></div><div class="line">    SLDataFormat_PCM dataSourceFormat = &#123;</div><div class="line">            SL_DATAFORMAT_PCM,</div><div class="line">            <span class="number">2</span>,</div><div class="line">            SL_SAMPLINGRATE_44_1,</div><div class="line">            SL_PCMSAMPLEFORMAT_FIXED_16,</div><div class="line">            <span class="number">16</span>,</div><div class="line">            SL_SPEAKER_FRONT_LEFT| SL_SPEAKER_FRONT_RIGHT,</div><div class="line">            SL_BYTEORDER_LITTLEENDIAN</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataSource dataSource = &#123;</div><div class="line">            &amp;dataSourceLocator,</div><div class="line">            &amp;dataSourceFormat</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataLocator_OutputMix dataSinkLocator = &#123;</div><div class="line">            SL_DATALOCATOR_OUTPUTMIX, <span class="comment">// å®šä½å™¨ç±»å‹</span></div><div class="line">            outputMixObject <span class="comment">// è¾“å‡ºæ··åˆ</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataSink dataSink = &#123;</div><div class="line">            &amp;dataSinkLocator, <span class="comment">// å®šä½å™¨</span></div><div class="line">            <span class="number">0</span>,</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// éœ€è¦çš„æ¥å£</span></div><div class="line">    SLInterfaceID interfaceIDs[] = &#123;</div><div class="line">            SL_IID_BUFFERQUEUE</div><div class="line">    &#125;;</div><div class="line">    SLboolean requiredInterfaces[] = &#123;</div><div class="line">            SL_BOOLEAN_TRUE</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºéŸ³é¢‘æ’­æ”¾å¯¹è±¡</span></div><div class="line">    SLresult result = (*engineEngine)-&gt;CreateAudioPlayer(</div><div class="line">            engineEngine,</div><div class="line">            &amp;audioPlayerObject,</div><div class="line">            &amp;dataSource,</div><div class="line">            &amp;dataSink,</div><div class="line">            <span class="number">1</span>,</div><div class="line">            interfaceIDs,</div><div class="line">            requiredInterfaces</div><div class="line">    );</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"></div><div class="line"><span class="comment">// å¼€å§‹æ’­æ”¾éŸ³é¢‘</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_opensl_1es_AudioRecorder_startPlay</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="comment">// åˆ›å»ºå¼•æ“</span></div><div class="line">    <span class="keyword">if</span> (engineEngine == <span class="literal">NULL</span>) &#123;</div><div class="line">        createEngine();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºæ··éŸ³å™¨</span></div><div class="line">    SLresult result;</div><div class="line">    result = (*engineEngine)-&gt;CreateOutputMix(engineEngine, &amp;outputMixObjext, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    result = (*outputMixObjext)-&gt;Realize(outputMixObjext, SL_BOOLEAN_FALSE);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    FILE *p_file = fopen(AUDIO_SRC_PATH, <span class="string">"r"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºæ’­æ”¾å™¨</span></div><div class="line">    createAudioPlayer(engineEngine, outputMixObjext, playerObject);</div><div class="line"></div><div class="line">    result = (*playerObject)-&gt;Realize(playerObject, SL_BOOLEAN_FALSE);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    result = (*playerObject)-&gt;GetInterface(playerObject, SL_IID_BUFFERQUEUE,</div><div class="line">                                                &amp;playerBufferQueueItf);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    <span class="keyword">uint8_t</span> *buffer = <span class="keyword">new</span> <span class="keyword">uint8_t</span>[BUFFER_SIZE];</div><div class="line">    AudioContext *playerContext = <span class="keyword">new</span> AudioContext(p_file, buffer, BUFFER_SIZE);</div><div class="line">    result = (*playerBufferQueueItf)-&gt;RegisterCallback(playerBufferQueueItf, AudioPlayerCallback,</div><div class="line">                                                    playerContext);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    result = (*playerObject)-&gt;GetInterface(playerObject, SL_IID_PLAY, &amp;playerPlay);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    (<span class="keyword">void</span>) result;</div><div class="line"></div><div class="line">    result = (*playerPlay)-&gt;SetPlayState(playerPlay, SL_PLAYSTATE_PLAYING);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    AudioPlayerCallback(playerBufferQueueItf, playerContext);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// åœæ­¢æ’­æ”¾éŸ³é¢‘</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_opensl_1es_AudioRecorder_stopPlay</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="keyword">if</span> (playerPlay != <span class="literal">NULL</span>) &#123;</div><div class="line">        SLresult result;</div><div class="line">        result = (*playerPlay)-&gt;SetPlayState(playerPlay, SL_PLAYSTATE_STOPPED);</div><div class="line">        assert(SL_RESULT_SUCCESS == result);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// å¼€å§‹é‡‡é›†éŸ³é¢‘æ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_opensl_1es_AudioRecorder_startRecord</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (engineEngine == <span class="literal">NULL</span>) &#123;</div><div class="line">        createEngine();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (recorderObject != <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGI(<span class="string">"Audio recorder already has been created."</span>);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    FILE *p_file = fopen(AUDIO_SRC_PATH, <span class="string">"w"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (p_file == <span class="literal">NULL</span>) &#123;</div><div class="line">        LOGI(<span class="string">"Fail to open file."</span>);</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    SLresult result;</div><div class="line"></div><div class="line">    <span class="comment">/* setup the data source*/</span></div><div class="line">    SLDataLocator_IODevice ioDevice = &#123;</div><div class="line">            SL_DATALOCATOR_IODEVICE,</div><div class="line">            SL_IODEVICE_AUDIOINPUT,</div><div class="line">            SL_DEFAULTDEVICEID_AUDIOINPUT,</div><div class="line">            <span class="literal">NULL</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataSource recSource = &#123;&amp;ioDevice, <span class="literal">NULL</span>&#125;;</div><div class="line"></div><div class="line">    SLDataLocator_AndroidSimpleBufferQueue recBufferQueue = &#123;</div><div class="line">            SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE,</div><div class="line">            NUM_BUFFER_QUEUE</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataFormat_PCM pcm = &#123;</div><div class="line">            SL_DATAFORMAT_PCM, <span class="comment">// pcm æ ¼å¼çš„æ•°æ®</span></div><div class="line">            <span class="number">2</span>,  <span class="comment">// 2 ä¸ªå£°é“ï¼ˆç«‹ä½“å£°ï¼‰</span></div><div class="line">            SL_SAMPLINGRATE_44_1, <span class="comment">// 44100hz çš„é‡‡æ ·é¢‘ç‡</span></div><div class="line">            SL_PCMSAMPLEFORMAT_FIXED_16,</div><div class="line">            SL_PCMSAMPLEFORMAT_FIXED_16,</div><div class="line">            SL_SPEAKER_FRONT_LEFT| SL_SPEAKER_FRONT_RIGHT,</div><div class="line">            SL_BYTEORDER_LITTLEENDIAN</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    SLDataSink dataSink = &#123; &amp;recBufferQueue, &amp;pcm &#125;;</div><div class="line">    SLInterfaceID iids[NUM_RECORDER_EXPLICIT_INTERFACES] = &#123;SL_IID_ANDROIDSIMPLEBUFFERQUEUE, SL_IID_ANDROIDCONFIGURATION&#125;;</div><div class="line">    SLboolean required[NUM_RECORDER_EXPLICIT_INTERFACES] = &#123;SL_BOOLEAN_TRUE, SL_BOOLEAN_TRUE&#125;;</div><div class="line"></div><div class="line">    <span class="comment">/* Create the audio recorder */</span></div><div class="line">    result = (*engineEngine)-&gt;CreateAudioRecorder(engineEngine, &amp;recorderObject , &amp;recSource, &amp;dataSink,</div><div class="line">                                                  NUM_RECORDER_EXPLICIT_INTERFACES, iids, required);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* get the android configuration interface*/</span></div><div class="line">    result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_ANDROIDCONFIGURATION, &amp;configItf);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">/* Realize the recorder in synchronous mode. */</span></div><div class="line">    result = (*recorderObject)-&gt;Realize(recorderObject, SL_BOOLEAN_FALSE);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">/* Get the buffer queue interface which was explicitly requested */</span></div><div class="line">    result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_ANDROIDSIMPLEBUFFERQUEUE, (<span class="keyword">void</span>*) &amp;recorderBuffQueueItf);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* get the record interface */</span></div><div class="line">    result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_RECORD, &amp;recorderRecord);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="keyword">uint8_t</span> *buffer = <span class="keyword">new</span> <span class="keyword">uint8_t</span>[BUFFER_SIZE];</div><div class="line">    recorderContext = <span class="keyword">new</span> AudioContext(p_file, buffer, BUFFER_SIZE);</div><div class="line">    result = (*recorderBuffQueueItf)-&gt;RegisterCallback(recorderBuffQueueItf, AudioRecorderCallback, recorderContext);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">/* Enqueue buffers to map the region of memory allocated to store the recorded data */</span></div><div class="line">    result = (*recorderBuffQueueItf)-&gt;Enqueue(recorderBuffQueueItf, recorderContext-&gt;buffer, BUFFER_SIZE);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">    <span class="comment">/* Start recording */</span></div><div class="line">    <span class="comment">// å¼€å§‹å½•åˆ¶éŸ³é¢‘</span></div><div class="line">    result = (*recorderRecord)-&gt;SetRecordState(recorderRecord, SL_RECORDSTATE_RECORDING);</div><div class="line">    assert(SL_RESULT_SUCCESS == result);</div><div class="line">    LOGI(<span class="string">"Starting recording"</span>);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// åœæ­¢éŸ³é¢‘é‡‡é›†</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_opensl_1es_AudioRecorder_stopRecord</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="keyword">if</span> (recorderRecord != <span class="literal">NULL</span>) &#123;</div><div class="line">        SLresult result = (*recorderRecord)-&gt;SetRecordState(recorderRecord, SL_RECORDSTATE_STOPPED);</div><div class="line">        assert(SL_RESULT_SUCCESS == result);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (recorderContext != <span class="literal">NULL</span>) &#123;</div><div class="line">            fclose(recorderContext-&gt;pfile);</div><div class="line">            <span class="keyword">delete</span> recorderContext-&gt;buffer;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// é‡Šæ”¾èµ„æº</span></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_opensl_1es_AudioRecorder_release</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="keyword">if</span> (recorderObject != <span class="literal">NULL</span>) &#123;</div><div class="line">        (*recorderObject)-&gt;Destroy(recorderObject);</div><div class="line">        recorderObject = <span class="literal">NULL</span>;</div><div class="line">        recorderRecord = <span class="literal">NULL</span>;</div><div class="line">        recorderBuffQueueItf = <span class="literal">NULL</span>;</div><div class="line">        configItf = <span class="literal">NULL</span>;</div><div class="line">        recorderContext = <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (playerObject != <span class="literal">NULL</span>) &#123;</div><div class="line">        (*playerObject)-&gt;Destroy(playerObject);</div><div class="line">        playerObject = <span class="literal">NULL</span>;</div><div class="line">        playerPlay = <span class="literal">NULL</span>;</div><div class="line">        playerBufferQueueItf = <span class="literal">NULL</span>;</div><div class="line">        outputMixObjext = <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// destroy engine object, and invalidate all associated interfaces</span></div><div class="line">    <span class="keyword">if</span> (engineObject != <span class="literal">NULL</span>) &#123;</div><div class="line">        (*engineObject)-&gt;Destroy(engineObject);</div><div class="line">        engineObject = <span class="literal">NULL</span>;</div><div class="line">        engineEngine = <span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>CMake è„šæœ¬ CMakeLists.txt ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION <span class="number">3.4</span><span class="number">.1</span>)</div><div class="line"></div><div class="line">add_library( # Sets the name of the library.</div><div class="line">             audio-recorder</div><div class="line"></div><div class="line">             # Sets the library as a shared library.</div><div class="line">             SHARED</div><div class="line"></div><div class="line">             # Provides a relative path to your source file(s).</div><div class="line">             src/main/cpp/audio-recorder.cpp)</div><div class="line"></div><div class="line">target_link_libraries(audio-recorder</div><div class="line">                      android</div><div class="line">                      <span class="built_in">log</span></div><div class="line">                      OpenSLES)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171202.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;ä¸è¦
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="OpenSL ES" scheme="https://githubhaohao.github.io/tags/OpenSL-ES/"/>
    
  </entry>
  
  <entry>
    <title>NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹</title>
    <link href="https://githubhaohao.github.io/2018/01/09/NDK-posix-multi-thread/"/>
    <id>https://githubhaohao.github.io/2018/01/09/NDK-posix-multi-thread/</id>
    <published>2018-01-09T12:11:24.000Z</published>
    <updated>2018-01-11T02:16:00.932Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171125.jpg" alt="Markdown"></p><p></p>
<p><div align="center">äººä»·å€¼çš„é«˜ä½å–å†³äºç¨€ç¼ºæ€§ï¼Œå³ä¸å¯ä»£æ›¿æ€§ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹å¸¸ç”¨çš„ API ã€‚</p>
</blockquote>
<p>æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š</p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
<li><a href="http://haohaochang.cn/2018/01/06/NDK-native-call-java-method/" title="NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’" target="_blank" rel="external">NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</a></li>
</ul>
<h1 id="POSIX"><a href="#POSIX" class="headerlink" title="POSIX"></a>POSIX</h1><p>POSIX å…¨ç§°æ˜¯ Portable Operating System Interface of UNIX ï¼Œè¡¨ç¤ºå¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹æ ‡å‡†ã€‚å®ƒå®šä¹‰äº†æ“ä½œç³»ç»Ÿåº”è¯¥ä¸ºåº”ç”¨ç¨‹åºæä¾›çš„æ¥å£æ ‡å‡†ï¼Œæ˜¯ IEEE ä¸ºè¦åœ¨å„ç§ UNIX æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„è½¯ä»¶è€Œå®šä¹‰çš„ä¸€ç³»åˆ— API æ ‡å‡†çš„æ€»ç§°ã€‚</p>
<h1 id="Pthreads"><a href="#Pthreads" class="headerlink" title="Pthreads"></a>Pthreads</h1><p>POSIX çº¿ç¨‹æ˜¯ POSIX çš„çº¿ç¨‹æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Pthreads ï¼Œå®ƒå®šä¹‰äº†åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„ä¸€å¥— API ã€‚æœ¬æ–‡çš„ Pthreads æ˜¯å®ç° POSIX çº¿ç¨‹æ ‡å‡†çš„ c è¯­è¨€ç¼–ç¨‹åº“ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬å¤šçº¿ç¨‹çš„å®ç°ç”± POSIX å¤šçº¿ç¨‹ç¼–ç¨‹å®ç°ï¼Œè€Œ Android ç³»ç»ŸåŸºäº Linux ç³»ç»Ÿï¼ŒåŸç”Ÿä¾¿æ”¯æŒ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚</p>
<p>POSIX Linux ç¼–è¯‘å‘½ä»¤ï¼š<code>gcc hello.c -o hello -lpthread</code>ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š<code>./hello</code>ã€‚</p>
<p>ç”±äºæœ¬æ–‡è®²çš„æ˜¯ NDK å¼€å‘ï¼Œä»£ç ç¼–è¯‘åŸºäº Android å¹³å°å®ç°ã€‚</p>
<h1 id="POSIX-çº¿ç¨‹åˆ›å»º"><a href="#POSIX-çº¿ç¨‹åˆ›å»º" class="headerlink" title="POSIX çº¿ç¨‹åˆ›å»º"></a>POSIX çº¿ç¨‹åˆ›å»º</h1><p>çº¿ç¨‹åˆ›å»ºç›¸å…³ APIï¼š<br>pthread_t çº¿ç¨‹ id ã€‚<br>pthread_create è´Ÿè´£åˆ›å»ºçº¿ç¨‹ï¼Œä¼ å…¥ pthread_tï¼ˆçº¿ç¨‹ ID ï¼‰çš„æŒ‡é’ˆï¼Œçº¿ç¨‹çš„æ‰§è¡Œæ–¹æ³•å’Œä¼ å…¥çº¿ç¨‹çš„å‚æ•°ã€‚<br>pthread_join ä½¿å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…æŒ‡å®šçº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå¹¶è·å–çº¿ç¨‹è¿”å›å€¼ã€‚<br>pthread_exit é€€å‡ºå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å½“å‰çº¿ç¨‹çš„è¿”å›å€¼ã€‚<br>pthread_cancel ç»ˆæ­¢å½“å‰çº¿ç¨‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello-thread.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM_THREADS 5</span></div><div class="line"></div><div class="line"><span class="comment">// ç±»ä¼¼äº Java Runnable</span></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">run</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>&#123;</div><div class="line">    <span class="comment">// å–ä¼ å…¥å½“å‰çº¿ç¨‹çš„å‚æ•°</span></div><div class="line">    <span class="keyword">char</span> *thread_tag = (<span class="keyword">char</span>*)arg;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</div><div class="line">        LOGD(<span class="string">"%s thread %d"</span>, thread_tag, i);</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">4</span>) &#123;</div><div class="line">            <span class="comment">// ç»“æŸå½“å‰çº¿ç¨‹,å‚æ•°ä¸ºçº¿ç¨‹ç»“æŸåçš„è¿”å›å€¼</span></div><div class="line">            pthread_exit(thread_tag);</div><div class="line">            <span class="comment">//pthread_cancel(); send a cancellation request to a thread</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæˆåçš„è¿”å›å€¼</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">create_threads</span><span class="params">()</span></span>&#123;</div><div class="line">    LOGD(<span class="string">"Main thread"</span>);</div><div class="line">    <span class="keyword">char</span> tag_arr[][<span class="number">5</span>] = &#123;<span class="string">"No.1"</span>,<span class="string">"No.2"</span>,<span class="string">"No.3"</span>,<span class="string">"No.4"</span>,<span class="string">"No.5"</span>&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//çº¿ç¨‹ id ï¼Œç”¨äºåŒºåˆ†çº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ id</span></div><div class="line">    <span class="keyword">pthread_t</span> tids[NUM_THREADS];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM_THREADS; ++i) &#123;</div><div class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹ï¼ŒæŒ‡å®š run æ–¹æ³•ï¼Œä¼ å…¥å‚æ•° tags[i]</span></div><div class="line">        pthread_create(&amp;tids[i], <span class="literal">NULL</span>, run, (<span class="keyword">void</span> *) tag_arr[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">void</span> *return_val[NUM_THREADS];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM_THREADS; ++i) &#123;</div><div class="line">        <span class="comment">// é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…æŒ‡å®š tid çš„çº¿ç¨‹ç»“æŸï¼Œå¹¶è·å–çº¿ç¨‹è¿”å›å€¼</span></div><div class="line">        <span class="comment">// join with a terminated thread</span></div><div class="line">        pthread_join(tids[i], &amp;return_val[i]);</div><div class="line">        LOGD(<span class="string">"thread %s terminated."</span>, (<span class="keyword">char</span>*)return_val[i]);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">I/hello-thread: Main thread</div><div class="line">I/hello-thread: No<span class="number">.1</span> thread <span class="number">0</span></div><div class="line">I/hello-thread: No<span class="number">.1</span> thread <span class="number">1</span></div><div class="line">I/hello-thread: No<span class="number">.1</span> thread <span class="number">2</span></div><div class="line">I/hello-thread: No<span class="number">.1</span> thread <span class="number">3</span></div><div class="line">I/hello-thread: No<span class="number">.1</span> thread <span class="number">4</span></div><div class="line">I/hello-thread: No<span class="number">.2</span> thread <span class="number">0</span></div><div class="line">I/hello-thread: No<span class="number">.2</span> thread <span class="number">1</span></div><div class="line">I/hello-thread: No<span class="number">.2</span> thread <span class="number">2</span></div><div class="line">I/hello-thread: No<span class="number">.2</span> thread <span class="number">3</span></div><div class="line">I/hello-thread: No<span class="number">.2</span> thread <span class="number">4</span></div><div class="line">I/hello-thread: No<span class="number">.3</span> thread <span class="number">0</span></div><div class="line">I/hello-thread: No<span class="number">.3</span> thread <span class="number">1</span></div><div class="line">I/hello-thread: No<span class="number">.3</span> thread <span class="number">2</span></div><div class="line">I/hello-thread: No<span class="number">.3</span> thread <span class="number">3</span></div><div class="line">I/hello-thread: No<span class="number">.3</span> thread <span class="number">4</span></div><div class="line">I/hello-thread: No<span class="number">.4</span> thread <span class="number">0</span></div><div class="line">I/hello-thread: No<span class="number">.4</span> thread <span class="number">1</span></div><div class="line">I/hello-thread: No<span class="number">.4</span> thread <span class="number">2</span></div><div class="line">I/hello-thread: No<span class="number">.4</span> thread <span class="number">3</span></div><div class="line">I/hello-thread: No<span class="number">.4</span> thread <span class="number">4</span></div><div class="line">I/hello-thread: thread No<span class="number">.1</span> terminated.</div><div class="line">I/hello-thread: No<span class="number">.5</span> thread <span class="number">0</span></div><div class="line">I/hello-thread: No<span class="number">.5</span> thread <span class="number">1</span></div><div class="line">I/hello-thread: No<span class="number">.5</span> thread <span class="number">2</span></div><div class="line">I/hello-thread: No<span class="number">.5</span> thread <span class="number">3</span></div><div class="line">I/hello-thread: No<span class="number">.5</span> thread <span class="number">4</span></div><div class="line">I/hello-thread: thread No<span class="number">.2</span> terminated.</div><div class="line">I/hello-thread: thread No<span class="number">.3</span> terminated.</div><div class="line">I/hello-thread: thread No<span class="number">.4</span> terminated.</div><div class="line">I/hello-thread: thread No<span class="number">.5</span> terminated.</div></pre></td></tr></table></figure></p>
<h1 id="POSIX-çº¿ç¨‹åŒæ­¥"><a href="#POSIX-çº¿ç¨‹åŒæ­¥" class="headerlink" title="POSIX çº¿ç¨‹åŒæ­¥"></a>POSIX çº¿ç¨‹åŒæ­¥</h1><p>çº¿ç¨‹åŒæ­¥ç›¸å…³ API :<br>pthread_mutex_t äº’æ–¥é”ã€‚<br>pthread_mutex_init åˆå§‹åŒ–äº’æ–¥é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚<br>pthread_mutex_destroy é”€æ¯äº’æ–¥é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚<br>pthread_mutex_lock åŠ é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚<br>pthread_mutex_unlock è§£é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello-thread.h"</span></span></div><div class="line"><span class="keyword">int</span> g_count = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="comment">// äº’æ–¥é”</span></div><div class="line"><span class="keyword">pthread_mutex_t</span> mutex;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">asyn_run</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>&#123;</div><div class="line">    <span class="comment">// lock</span></div><div class="line">    pthread_mutex_lock(&amp;mutex);</div><div class="line"></div><div class="line">    <span class="comment">// å–ä¼ å…¥å½“å‰çº¿ç¨‹çš„å‚æ•°</span></div><div class="line">    <span class="keyword">char</span> *thread_tag = (<span class="keyword">char</span>*)arg;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</div><div class="line">        <span class="comment">// ä¼‘çœ  200 ms</span></div><div class="line">        usleep(<span class="number">200</span> * <span class="number">1000</span>);</div><div class="line">        g_count ++;</div><div class="line">        LOGD(<span class="string">"%s thread %d, g_count = %d"</span>, thread_tag, i, g_count);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// unlock</span></div><div class="line">    pthread_mutex_unlock(&amp;mutex);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> thread_tag; <span class="comment">// çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæˆåçš„è¿”å›å€¼</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">syn_thread</span><span class="params">()</span></span>&#123;</div><div class="line">    LOGD(<span class="string">"Main thread"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// åˆå§‹åŒ–äº’æ–¥é”</span></div><div class="line">    pthread_mutex_init(&amp;mutex, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    <span class="keyword">pthread_t</span> t1, t2;</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»º 2 ä¸ªçº¿ç¨‹</span></div><div class="line">    pthread_create(&amp;t1, <span class="literal">NULL</span>, asyn_run, <span class="string">"No.1"</span>);</div><div class="line">    pthread_create(&amp;t2, <span class="literal">NULL</span>, asyn_run, <span class="string">"No.2"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">void</span> *rtn_val[<span class="number">2</span>];</div><div class="line">    pthread_join(t1, &amp;rtn_val[<span class="number">0</span>]);</div><div class="line">    pthread_join(t2, &amp;rtn_val[<span class="number">1</span>]);</div><div class="line">    LOGD(<span class="string">"thread %s terminated."</span>, (<span class="keyword">char</span>*)rtn_val[<span class="number">0</span>]);</div><div class="line">    LOGD(<span class="string">"thread %s terminated."</span>, (<span class="keyword">char</span>*)rtn_val[<span class="number">1</span>]);</div><div class="line"></div><div class="line">    <span class="comment">// é”€æ¯äº’æ–¥é”</span></div><div class="line">    pthread_mutex_destroy(&amp;mutex);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">I/hello-thread: No.1 thread 0, g_count = 1</div><div class="line">I/hello-thread: No.1 thread 1, g_count = 2</div><div class="line">I/hello-thread: No.1 thread 2, g_count = 3</div><div class="line">I/hello-thread: No.1 thread 3, g_count = 4</div><div class="line">I/hello-thread: No.1 thread 4, g_count = 5</div><div class="line">I/hello-thread: No.1 thread 5, g_count = 6</div><div class="line">I/hello-thread: No.1 thread 6, g_count = 7</div><div class="line">I/hello-thread: No.1 thread 7, g_count = 8</div><div class="line">I/hello-thread: No.1 thread 8, g_count = 9</div><div class="line">I/hello-thread: No.1 thread 9, g_count = 10</div><div class="line">I/hello-thread: No.2 thread 0, g_count = 11</div><div class="line">I/hello-thread: No.2 thread 1, g_count = 12</div><div class="line">I/hello-thread: No.2 thread 2, g_count = 13</div><div class="line">I/hello-thread: No.2 thread 3, g_count = 14</div><div class="line">I/hello-thread: No.2 thread 4, g_count = 15</div><div class="line">I/hello-thread: No.2 thread 5, g_count = 16</div><div class="line">I/hello-thread: No.2 thread 6, g_count = 17</div><div class="line">I/hello-thread: No.2 thread 7, g_count = 18</div><div class="line">I/hello-thread: No.2 thread 8, g_count = 19</div><div class="line">I/hello-thread: No.2 thread 9, g_count = 20</div><div class="line">I/hello-thread: thread No.1 terminated.</div><div class="line">I/hello-thread: thread No.2 terminated.</div></pre></td></tr></table></figure></p>
<h1 id="POSIX-çº¿ç¨‹é—´é€šä¿¡"><a href="#POSIX-çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="POSIX çº¿ç¨‹é—´é€šä¿¡"></a>POSIX çº¿ç¨‹é—´é€šä¿¡</h1><p>çº¿ç¨‹é—´é€šä¿¡ç›¸å…³ API ï¼š<br>pthread_cond_t æ¡ä»¶å˜é‡ï¼Œæ¡ä»¶å˜é‡æ˜¯çº¿ç¨‹åŒæ­¥çš„ä¸€ç§æ‰‹æ®µï¼Œä½¿çº¿ç¨‹å¯ä»¥ä¼‘çœ ç­‰å¾…æŸç§æ¡ä»¶å‡ºç°ã€‚<br>pthread_cond_signal å‘é€ä¸€ä¸ªä¿¡å·ç»™å¦å¤–ä¸€ä¸ªæ­£åœ¨å¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼ŒåŸæœ¬è¿™ä¸¤ä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ª mutex lock ã€‚<br>pthread_cond_wait ä½¿å½“å‰çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶åˆ°å…¶ä»–çº¿ç¨‹å‘é€å¯¹åº”çš„ cond_signal ã€‚<br>pthread_cond_init åˆå§‹åŒ–æ¡ä»¶å˜é‡ã€‚<br>pthread_cond_destroy é”€æ¯æ¡ä»¶å˜é‡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello-thread.h"</span></span></div><div class="line"><span class="comment">// å…±äº«æ•°æ®</span></div><div class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> shared_count = <span class="number">0</span>;</div><div class="line"><span class="keyword">pthread_mutex_t</span> pthread_mutex;</div><div class="line"></div><div class="line"><span class="comment">// æ¡ä»¶å˜é‡</span></div><div class="line"><span class="keyword">pthread_cond_t</span> pthread_cond;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">producer</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>&#123;</div><div class="line">    <span class="keyword">char</span> *tag = (<span class="keyword">char</span>*)arg;</div><div class="line">    <span class="keyword">for</span> (;;) &#123;</div><div class="line">        pthread_mutex_lock(&amp;pthread_mutex);</div><div class="line"></div><div class="line">        <span class="comment">// ç”Ÿäº§è€…ç”Ÿäº§äº§å“</span></div><div class="line">        shared_count ++;</div><div class="line">        LOGD(<span class="string">"%s thread ç”Ÿäº§äº§å“, count = %d"</span>, tag, shared_count);</div><div class="line"></div><div class="line">        <span class="comment">// é€šçŸ¥æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹</span></div><div class="line">        pthread_cond_signal(&amp;pthread_cond);</div><div class="line"></div><div class="line">        pthread_mutex_unlock(&amp;pthread_mutex);</div><div class="line"></div><div class="line">        <span class="comment">// ä¼‘çœ  200 ms</span></div><div class="line">        usleep(<span class="number">200</span> * <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (<span class="keyword">void</span>*)<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> *<span class="title">consumer</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>&#123;</div><div class="line">    <span class="keyword">char</span>* tag = (<span class="keyword">char</span>*)arg;</div><div class="line">    <span class="keyword">for</span>(;;)&#123;</div><div class="line">        pthread_mutex_lock(&amp;pthread_mutex);</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (shared_count == <span class="number">0</span>)&#123;</div><div class="line">            <span class="comment">// å½“æ²¡æœ‰äº§å“å¯ä»¥æ¶ˆè´¹æ—¶ï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§ï¼ˆç­‰å¾…æ¡ä»¶å˜é‡è¢«å”¤é†’ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾äº’æ–¥é”ï¼‰</span></div><div class="line">            <span class="comment">// å½“è¢«å…¶ä»–çº¿ç¨‹å”¤é†’æ—¶ï¼Œè§£é™¤é˜»å¡çŠ¶æ€ï¼Œé‡æ–°ç”³è¯·è·å¾—äº’æ–¥é”</span></div><div class="line">            pthread_cond_wait(&amp;pthread_cond, &amp;pthread_mutex);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        shared_count --;</div><div class="line">        LOGD(<span class="string">"%s thread æ¶ˆè´¹äº§å“, count = %d"</span>, tag, shared_count);</div><div class="line"></div><div class="line">        pthread_mutex_unlock(&amp;pthread_mutex);</div><div class="line"></div><div class="line">        <span class="comment">// ä¼‘çœ  500 ms</span></div><div class="line">        usleep(<span class="number">500</span> * <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (<span class="keyword">void</span>*)<span class="number">0</span>;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// çº¿ç¨‹é—´é€šä¿¡</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">communicate_thread</span><span class="params">()</span></span>&#123;</div><div class="line">    pthread_mutex_init(&amp;pthread_mutex, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    <span class="comment">// åˆå§‹åŒ–æ¡ä»¶å˜é‡</span></div><div class="line">    pthread_cond_init(&amp;pthread_cond, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    <span class="comment">// çº¿ç¨‹ id</span></div><div class="line">    <span class="keyword">pthread_t</span> producer_tid, consumer_tid;</div><div class="line"></div><div class="line">    <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹</span></div><div class="line">    pthread_create(&amp;producer_tid, <span class="literal">NULL</span>, producer, <span class="string">"producer"</span>);</div><div class="line">    <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹</span></div><div class="line">    pthread_create(&amp;consumer_tid, <span class="literal">NULL</span>, consumer, <span class="string">"consumer"</span>);</div><div class="line"></div><div class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></div><div class="line">    pthread_join(producer_tid, <span class="literal">NULL</span>);</div><div class="line">    pthread_join(consumer_tid, <span class="literal">NULL</span>);</div><div class="line"></div><div class="line">    <span class="comment">// é”€æ¯äº’æ–¥é”</span></div><div class="line">    pthread_mutex_destroy(&amp;pthread_mutex);</div><div class="line">    <span class="comment">// é”€æ¯æ¡ä»¶å˜é‡</span></div><div class="line">    pthread_cond_destroy(&amp;pthread_cond);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 1</div><div class="line">I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 0</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 1</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 2</div><div class="line">I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 1</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 2</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 3</div><div class="line">I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 2</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 3</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 4</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 5</div><div class="line">I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 4</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 5</div><div class="line">I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 6</div><div class="line">I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 5</div><div class="line">......</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171125.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;äººä»·
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="POSIX å¤šçº¿ç¨‹" scheme="https://githubhaohao.github.io/tags/POSIX-%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>NDK å¼€å‘ä¸­ Native ä¸ Java äº¤äº’</title>
    <link href="https://githubhaohao.github.io/2018/01/06/NDK-native-call-java-method/"/>
    <id>https://githubhaohao.github.io/2018/01/06/NDK-native-call-java-method/</id>
    <published>2018-01-06T06:00:52.000Z</published>
    <updated>2018-01-10T11:03:55.432Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171118.jpg" alt="Markdown"></p><p></p>
<p><div align="center">äººç”Ÿè¿œæ¯”æˆ‘ä»¬æƒ³è±¡å¾—æ¼«é•¿ï¼Œæ‰€ä»¥ä¸äº‰ä¸€åŸä¸€æ± çš„å¾—å¤±ï¼Œè¦æŠŠä¸€åˆ‡æœºä¼šå’ŒæŒ«æŠ˜éƒ½æ”¾åˆ°å°½å¯èƒ½é•¿çš„å‘¨æœŸé‡Œæ¥æ€è€ƒã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Native å±‚ä¸ Java äº¤äº’æ–¹å¼</p>
</blockquote>
<p>å‰é¢æ–‡ç« åˆ†åˆ«ä»‹ç»çš„ NDK ç¼–è¯‘æ–¹å¼å’Œç¬¬ä¸‰æ–¹åº“çš„å¼•å…¥æ–¹å¼ï¼š</p>
<ul>
<li><a href="http://haohaochang.cn/2017/11/04/NDK-compiled-three-ways/" title="NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼" target="_blank" rel="external">NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</a></li>
<li><a href="http://haohaochang.cn/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/" title="åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“" target="_blank" rel="external">åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</a></li>
</ul>
<h1 id="Java-ä¸-JNI-æ•°æ®ç±»å‹å¯¹åº”å…³ç³»"><a href="#Java-ä¸-JNI-æ•°æ®ç±»å‹å¯¹åº”å…³ç³»" class="headerlink" title="Java ä¸ JNI æ•°æ®ç±»å‹å¯¹åº”å…³ç³»"></a>Java ä¸ JNI æ•°æ®ç±»å‹å¯¹åº”å…³ç³»</h1><table>
<thead>
<tr>
<th>Java æ•°æ®ç±»å‹</th>
<th style="text-align:center">JNI æ•°æ®ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td style="text-align:center">jboolean</td>
</tr>
<tr>
<td>byte</td>
<td style="text-align:center">jbyte</td>
</tr>
<tr>
<td>char</td>
<td style="text-align:center">jchar</td>
</tr>
<tr>
<td>short</td>
<td style="text-align:center">jshort</td>
</tr>
<tr>
<td>int</td>
<td style="text-align:center">jint</td>
</tr>
<tr>
<td>long</td>
<td style="text-align:center">jlong</td>
</tr>
<tr>
<td>float</td>
<td style="text-align:center">jfloat</td>
</tr>
<tr>
<td>double</td>
<td style="text-align:center">jdouble</td>
</tr>
<tr>
<td>String</td>
<td style="text-align:center">jstring</td>
</tr>
<tr>
<td>Object</td>
<td style="text-align:center">jobject</td>
</tr>
<tr>
<td>byte[]</td>
<td style="text-align:center">jbyteArray</td>
</tr>
<tr>
<td>Object[]</td>
<td style="text-align:center">jobjectArray</td>
</tr>
</tbody>
</table>
<h1 id="Native-ä¸­çš„ç­¾å"><a href="#Native-ä¸­çš„ç­¾å" class="headerlink" title="Native ä¸­çš„ç­¾å"></a>Native ä¸­çš„ç­¾å</h1><p>NDK å¼€å‘ä¸­ä¼šç”¨åˆ° Java å¯¹è±¡çš„å±æ€§ç­¾åå’Œæ–¹æ³•ç­¾åï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<h2 id="å±æ€§ç­¾å"><a href="#å±æ€§ç­¾å" class="headerlink" title="å±æ€§ç­¾å"></a>å±æ€§ç­¾å</h2><p>å±æ€§çš„ç­¾åå°±æ˜¯å±æ€§ç±»å‹çš„ç®€ç§°ã€‚<br>å±æ€§ç±»å‹ä¸å…¶ç­¾åçš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§ç±»å‹</th>
<th style="text-align:left">ç±»å‹ç­¾å</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td style="text-align:left">Z</td>
</tr>
<tr>
<td>byte</td>
<td style="text-align:left">B</td>
</tr>
<tr>
<td>char</td>
<td style="text-align:left">C</td>
</tr>
<tr>
<td>short</td>
<td style="text-align:left">S</td>
</tr>
<tr>
<td>int</td>
<td style="text-align:left">I</td>
</tr>
<tr>
<td>long</td>
<td style="text-align:left">L</td>
</tr>
<tr>
<td>float</td>
<td style="text-align:left">F</td>
</tr>
<tr>
<td>double</td>
<td style="text-align:left">D</td>
</tr>
<tr>
<td>void</td>
<td style="text-align:left">V</td>
</tr>
<tr>
<td>String</td>
<td style="text-align:left">Ljava/lang/String;</td>
</tr>
<tr>
<td>Object</td>
<td style="text-align:left">ä»¥ L å¼€å¤´ï¼ŒååŠ å®Œæ•´çš„åŒ…åï¼Œå¹¶ä»¥åˆ†å·ç»“æŸ</td>
</tr>
<tr>
<td>byte[]</td>
<td style="text-align:left">[B</td>
</tr>
<tr>
<td>Object[]</td>
<td style="text-align:left">ä»¥ [ å¼€å¤´ï¼ŒååŠ å¯¹è±¡ç±»å‹ç­¾åï¼Œä¾‹å¦‚ String[] å¯¹åº” [Ljava/lang/String;</td>
</tr>
</tbody>
</table>
<h2 id="æ–¹æ³•ç­¾å"><a href="#æ–¹æ³•ç­¾å" class="headerlink" title="æ–¹æ³•ç­¾å"></a>æ–¹æ³•ç­¾å</h2><p>æ–¹æ³•ç­¾åæ ¼å¼ï¼š<br><code>(å‚æ•°ç±»å‹ç­¾å)è¿”å›å€¼ç±»å‹ç­¾å</code></p>
<p>é‚£ä¹ˆå¦‚ä½•è·å–æ–¹æ³•ç­¾åï¼Ÿ<br>æ‰§è¡Œå‘½ä»¤ <code>javah &lt;class æ–‡ä»¶çš„å…¨å&gt;</code><br>å¦‚ <code>javah com.haohao.hellojni.NativeTest.class</code> ç”Ÿæˆ com_haohao_hellojni_NativeTest.h æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä¾¿æ ‡å‡ºäº†æ–¹æ³•çš„ Signature ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="comment">/* Header for class com_haohao_hellojni_NativeTest */</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_com_haohao_hellojni_NativeTest</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_com_haohao_hellojni_NativeTest</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    getString</div><div class="line"> * Signature: ()Ljava/lang/String;</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_getString__</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    getString</div><div class="line"> * Signature: (Ljava/lang/String;)Ljava/lang/String;</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jstring JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_getString__Ljava_lang_String_2</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject, jstring)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    getInt</div><div class="line"> * Signature: ()I</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_getInt__</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    getInt</div><div class="line"> * Signature: (I)I</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_getInt__I</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject, jint)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    input</div><div class="line"> * Signature: (Ljava/lang/String;I)V</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_input__Ljava_lang_String_2I</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject, jstring, jint)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    input</div><div class="line"> * Signature: ([Ljava/lang/String;I)V</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_input___3Ljava_lang_String_2I</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject, jobjectArray, jint)</span>;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * Class:     com_haohao_hellojni_NativeTest</div><div class="line"> * Method:    getBytes</div><div class="line"> * Signature: ([Ljava/lang/String;Ljava/lang/String;)[B</div><div class="line"> */</div><div class="line"><span class="function">JNIEXPORT jbyteArray JNICALL <span class="title">Java_com_haohao_hellojni_NativeTest_getBytes</span></span></div><div class="line">  <span class="params">(JNIEnv *, jobject, jobjectArray, jstring)</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h1 id="Native-ä¸-Java-äº¤äº’"><a href="#Native-ä¸-Java-äº¤äº’" class="headerlink" title="Native ä¸ Java äº¤äº’"></a>Native ä¸ Java äº¤äº’</h1><p>è®¾ç½®ä¸€ä¸ªç®€å•çš„ç±» NativeUtils.java ç”¨äºæµ‹è¯•ï¼ŒNative ä¸ Java äº¤äº’çš„å®ç°ç±»ä¼¼äº Java çš„åå°„æœºåˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.haohao.hellojni;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * author: haohao</div><div class="line"> * time: 2018/1/1</div><div class="line"> * mail: haohaochang86@gmail.com</div><div class="line"> * desc: description</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NativeUtils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"native-utils"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"NativeUtils"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> staticProp = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> prop = -<span class="number">1</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStringFromJava</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"getStringFromJava: "</span>+ str);</div><div class="line">        <span class="keyword">return</span> <span class="string">"Hello C , I am from Java."</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getStringFromJavaStatic</span><span class="params">(String str)</span></span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"getStringFromJavaStatic: "</span> + str);</div><div class="line">        <span class="keyword">return</span> <span class="string">"Hello C , I am from Java static."</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">accessJavaClassProp</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callJavaClassMethod</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">accessStaticJavaProp</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callStaticJavaMethod</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="è®¿é—®-Java-å¯¹è±¡çš„éé™æ€å±æ€§"><a href="#è®¿é—®-Java-å¯¹è±¡çš„éé™æ€å±æ€§" class="headerlink" title="è®¿é—® Java å¯¹è±¡çš„éé™æ€å±æ€§"></a>è®¿é—® Java å¯¹è±¡çš„éé™æ€å±æ€§</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_accessJavaClassProp</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="comment">//è®¿é—® Java å¯¹è±¡çš„éé™æ€å±æ€§</span></div><div class="line"></div><div class="line">    <span class="comment">//é€šè¿‡ JNIEnv å’Œå¯¹è±¡ instance å®ä¾‹æ‹¿åˆ° class ã€‚</span></div><div class="line">    jclass cls = (*env)-&gt;GetObjectClass(env, instance);</div><div class="line">    <span class="comment">//è·å–å±æ€§çš„ field id</span></div><div class="line">    jfieldID fid = (*env)-&gt;GetFieldID(env, cls, <span class="string">"prop"</span>, <span class="string">"I"</span>);</div><div class="line">    <span class="comment">//é€šè¿‡ field id è·å–å±æ€§çš„å€¼</span></div><div class="line">    jint prop = (*env)-&gt;GetIntField(env, instance, fid);</div><div class="line">    <span class="comment">//åœ¨ Native å±‚ä¿®æ”¹å±æ€§</span></div><div class="line">    prop += <span class="number">101</span>;</div><div class="line">    (*env)-&gt;SetIntField(env, instance, fid, prop);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="è°ƒç”¨-Java-å¯¹è±¡çš„éé™æ€æ–¹æ³•"><a href="#è°ƒç”¨-Java-å¯¹è±¡çš„éé™æ€æ–¹æ³•" class="headerlink" title="è°ƒç”¨ Java å¯¹è±¡çš„éé™æ€æ–¹æ³•"></a>è°ƒç”¨ Java å¯¹è±¡çš„éé™æ€æ–¹æ³•</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_callJavaClassMethod</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„éé™æ€æ–¹æ³•</span></div><div class="line"></div><div class="line">    jclass myClass = (*env)-&gt;GetObjectClass(env, instance);</div><div class="line">    <span class="comment">//è·å–å‘æ–¹æ³•çš„ method id</span></div><div class="line">    jmethodID mid = (*env)-&gt;GetMethodID(env, myClass, <span class="string">"getStringFromJava"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„æ–¹æ³•</span></div><div class="line">    jstring  jstr = (*env)-&gt;CallObjectMethod(env, instance, mid, (*env)-&gt;NewStringUTF(env, <span class="string">"Hello Java, I am From C."</span>));</div><div class="line">    <span class="comment">//jstring è½¬æ¢ä¸º c çš„å­—ç¬¦ä¸²</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>);</div><div class="line">    LOGD(<span class="string">"%s"</span>, cstr);</div><div class="line">    <span class="comment">//æ³¨æ„åŒºåˆ«å¯¹å¾… Java å­—ç¬¦ä¸²å’Œ C çš„å­—ç¬¦ä¸²ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢</span></div><div class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="è®¿é—®-Java-å¯¹è±¡çš„é™æ€å±æ€§"><a href="#è®¿é—®-Java-å¯¹è±¡çš„é™æ€å±æ€§" class="headerlink" title="è®¿é—® Java å¯¹è±¡çš„é™æ€å±æ€§"></a>è®¿é—® Java å¯¹è±¡çš„é™æ€å±æ€§</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_accessStaticJavaProp</span><span class="params">(JNIEnv *env, jclass type)</span> &#123;</div><div class="line">    <span class="comment">//è®¿é—® Java å¯¹è±¡çš„é™æ€å±æ€§,</span></div><div class="line"></div><div class="line">    jfieldID fid = (*env)-&gt;GetStaticFieldID(env, type, <span class="string">"staticProp"</span>, <span class="string">"I"</span>);</div><div class="line">    jint staticProp = (*env)-&gt;GetStaticIntField(env, type, fid);</div><div class="line">    staticProp += <span class="number">101</span>;</div><div class="line">    (*env)-&gt;SetStaticIntField(env, type, fid, staticProp);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="è°ƒç”¨-Java-å¯¹è±¡çš„é™æ€æ–¹æ³•"><a href="#è°ƒç”¨-Java-å¯¹è±¡çš„é™æ€æ–¹æ³•" class="headerlink" title="è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³•"></a>è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³•</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_callStaticJavaMethod</span><span class="params">(JNIEnv *env, jclass type)</span> &#123;</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³•</span></div><div class="line"></div><div class="line">    jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, <span class="string">"getStringFromJavaStatic"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</div><div class="line">    jstring jstr = (*env)-&gt;CallStaticObjectMethod(env, type, mid, (*env)-&gt;NewStringUTF(env, <span class="string">"Hello Java, I am From C."</span>));</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>);</div><div class="line">    LOGD(<span class="string">"%s"</span>, cstr);</div><div class="line"></div><div class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">nativeUtils = <span class="keyword">new</span> NativeUtils();</div><div class="line">Log.i(TAG, <span class="string">"old prop : "</span> + nativeUtils.prop);</div><div class="line">nativeUtils.accessJavaClassProp();</div><div class="line">Log.i(TAG, <span class="string">"new prop : "</span> + nativeUtils.prop);</div><div class="line">Log.i(TAG, <span class="string">"old static prop : "</span> + NativeUtils.staticProp);</div><div class="line">NativeUtils.accessStaticJavaProp();</div><div class="line">Log.i(TAG, <span class="string">"new static prop : "</span> + NativeUtils.staticProp);</div><div class="line">nativeUtils.callJavaClassMethod();</div><div class="line">NativeUtils.callStaticJavaMethod();</div></pre></td></tr></table></figure>
<p>native-utils.c å®Œæ•´ä»£ç </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Created by haohao on 2018/1/1.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> TAG <span class="meta-string">"native-utils"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LOGD(...) __android_log_print(ANDROID_LOG_INFO,TAG ,__VA_ARGS__) <span class="comment">// å®šä¹‰LOGDç±»å‹</span></span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_accessJavaClassProp</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="comment">//è®¿é—® Java å¯¹è±¡çš„éé™æ€å±æ€§</span></div><div class="line"></div><div class="line">    <span class="comment">//é€šè¿‡ JNIEnv å’Œå¯¹è±¡ instance å®ä¾‹æ‹¿åˆ° class ã€‚</span></div><div class="line">    jclass cls = (*env)-&gt;GetObjectClass(env, instance);</div><div class="line">    <span class="comment">//è·å–å±æ€§çš„ field id</span></div><div class="line">    jfieldID fid = (*env)-&gt;GetFieldID(env, cls, <span class="string">"prop"</span>, <span class="string">"I"</span>);</div><div class="line">    <span class="comment">//é€šè¿‡ field id è·å–å±æ€§çš„å€¼</span></div><div class="line">    jint prop = (*env)-&gt;GetIntField(env, instance, fid);</div><div class="line">    <span class="comment">//åœ¨ Native å±‚ä¿®æ”¹å±æ€§</span></div><div class="line">    prop += <span class="number">101</span>;</div><div class="line">    (*env)-&gt;SetIntField(env, instance, fid, prop);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_callJavaClassMethod</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„éé™æ€æ–¹æ³•</span></div><div class="line"></div><div class="line">    jclass myClass = (*env)-&gt;GetObjectClass(env, instance);</div><div class="line">    <span class="comment">//è·å–å‘æ–¹æ³•çš„ method id</span></div><div class="line">    jmethodID mid = (*env)-&gt;GetMethodID(env, myClass, <span class="string">"getStringFromJava"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„æ–¹æ³•</span></div><div class="line">    jstring  jstr = (*env)-&gt;CallObjectMethod(env, instance, mid, (*env)-&gt;NewStringUTF(env, <span class="string">"Hello Java, I am From C."</span>));</div><div class="line">    <span class="comment">//jstring è½¬æ¢ä¸º c çš„å­—ç¬¦ä¸²</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>);</div><div class="line">    LOGD(<span class="string">"%s"</span>, cstr);</div><div class="line">    <span class="comment">//æ³¨æ„åŒºåˆ«å¯¹å¾… Java å­—ç¬¦ä¸²å’Œ C çš„å­—ç¬¦ä¸²ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢</span></div><div class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_accessStaticJavaProp</span><span class="params">(JNIEnv *env, jclass type)</span> &#123;</div><div class="line">    <span class="comment">//è®¿é—® Java å¯¹è±¡çš„é™æ€å±æ€§,</span></div><div class="line"></div><div class="line">    jfieldID fid = (*env)-&gt;GetStaticFieldID(env, type, <span class="string">"staticProp"</span>, <span class="string">"I"</span>);</div><div class="line">    jint staticProp = (*env)-&gt;GetStaticIntField(env, type, fid);</div><div class="line">    staticProp += <span class="number">101</span>;</div><div class="line">    (*env)-&gt;SetStaticIntField(env, type, fid, staticProp);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_hellojni_NativeUtils_callStaticJavaMethod</span><span class="params">(JNIEnv *env, jclass type)</span> &#123;</div><div class="line">    <span class="comment">//è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³•</span></div><div class="line"></div><div class="line">    jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, <span class="string">"getStringFromJavaStatic"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</div><div class="line">    jstring jstr = (*env)-&gt;CallStaticObjectMethod(env, type, mid, (*env)-&gt;NewStringUTF(env, <span class="string">"Hello Java, I am From C."</span>));</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, <span class="literal">NULL</span>);</div><div class="line">    LOGD(<span class="string">"%s"</span>, cstr);</div><div class="line"></div><div class="line">    <span class="comment">//é‡Šæ”¾èµ„æº</span></div><div class="line">    (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">I/MainActivity: old prop : -<span class="number">1</span></div><div class="line">I/MainActivity: <span class="keyword">new</span> prop : <span class="number">100</span></div><div class="line">I/MainActivity: old <span class="keyword">static</span> prop : -<span class="number">1</span></div><div class="line">I/MainActivity: <span class="keyword">new</span> <span class="keyword">static</span> prop : <span class="number">100</span></div><div class="line">I/NativeUtils: getStringFromJava: Hello Java, I am From C.</div><div class="line">I/<span class="keyword">native</span>-utils: Hello C , I am from Java.</div><div class="line">I/NativeUtils: getStringFromJavaStatic: Hello Java, I am From C.</div><div class="line">I/<span class="keyword">native</span>-utils: Hello C , I am from Java <span class="keyword">static</span>.</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171118.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;äººç”Ÿ
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="Native ä¸ Java äº¤äº’" scheme="https://githubhaohao.github.io/tags/Native-%E4%B8%8E-Java-%E4%BA%A4%E4%BA%92/"/>
    
  </entry>
  
  <entry>
    <title>ä½ å¥½ 2018</title>
    <link href="https://githubhaohao.github.io/2018/01/01/hello-2018/"/>
    <id>https://githubhaohao.github.io/2018/01/01/hello-2018/</id>
    <published>2018-01-01T12:42:13.000Z</published>
    <updated>2018-01-04T06:39:15.303Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20180101.jpg" alt="Markdown"></p><p></p>
<p><div align="center">ä¸º 2018 ç«‹å‡ ä¸ª FLAG </div><br></p>
<h1 id="å›çœ‹-2017"><a href="#å›çœ‹-2017" class="headerlink" title="å›çœ‹ 2017"></a>å›çœ‹ 2017</h1><p>2017 æ˜¯æå…¶å¹³æ·¡çš„ä¸€å¹´ï¼Œä¹Ÿæ˜¯å­•è‚²å¸Œæœ›çš„ä¸€å¹´ã€‚2017 æˆ‘è¿˜åœ¨è¯»ç ”ï¼Œ2017 æˆ‘è¿˜åœ¨ç§Ÿæˆ¿ã€‚å¦‚æœéè¦ç”¨å‡ ä¸ªå­—æ¥å½¢å®¹ 2017 å¹´ï¼Œé‚£å°±æ˜¯â€œå­¦ä¹ â€ã€â€œç¾é£Ÿâ€ã€â€œç”µå½±â€ã€‚</p>
<p>æ•´ä¸ª 2017 å¹´ï¼Œæˆ‘å’Œåª³å¦‡å„¿ï¼Œçœ‹äº†å¾ˆå¤šåœºç”µå½±ï¼Œåƒäº†å¾ˆå¤šé¡¿å¤§é¤ï¼ˆç›´æ¥çš„åæœå°±æ˜¯å¯¼è‡´æˆ‘çš„ä½“é‡å¢åŠ  10 æ–¤ï¼‰ï¼Œè¿™ä¹Ÿè®¸æ˜¯æˆ‘ä»¬æœ€å¤§çš„å…±åŒçˆ±å¥½ã€‚2017 å¹´ä¸»è¦é åª³å¦‡å„¿çš„å·¥ä½œæ”¶å…¥å’Œæˆ‘ç ”ç©¶ç”Ÿçš„å¾®è–„è¡¥è¶³ï¼Œæ”¯æ’‘ç€æˆ‘ä»¬çš„â€œç”µå½±â€ã€â€œç¾é£Ÿâ€å’Œæˆ¿ç§Ÿï¼Œå¦å¤–æˆ‘ä»¬è¿˜å–œæ¬¢åˆ°å¤„èµ°èµ°ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸»è¦æ€»ç»“ä¸€ä¸‹ï¼Œ2017 å¹´åœ¨æŠ€æœ¯æ–¹é¢çš„ä¸€äº›æ”¶è·ã€‚é™¤äº†æé¡¹ç›®ä¹‹å¤–ï¼Œä¸ŠåŠå¹´ä¸»è¦æŒæ¡äº† Facebook çš„å…¨å®¶æ¡¶ï¼ŒåŒ…æ‹¬ RN å’Œ React å‰ç«¯å¼€å‘æŠ€æœ¯ï¼Œä¸‹åŠå¹´ä»¥å®Œæˆè®ºæ–‡ä¸ºç›®çš„å­¦ä¹ äº† Python å’Œ TensorFlow å¼€å‘ï¼Œå†åˆ°åæ¥ï¼Œç³»ç»Ÿåœ°å­¦ä¹ äº† Kotlin Android å¼€å‘ã€‚ä»¥ä¸ŠæŠ€æœ¯å­¦ä¹ éƒ½æ˜¯åŸºäºä¸ªäººå…´è¶£ï¼Œè‡ªå·±åšäº†å‡ ä¸ªå°é¡¹ç›®ï¼Œå¹¶æ²¡æœ‰è¿ç”¨çš„ç”Ÿäº§ç¯å¢ƒä¸­ã€‚æ€»ä½“æ¥è¯´ï¼Œå¯¹å¸¸è§„å¼€å‘ä¸­çš„æŠ€æœ¯æ ˆæœ‰äº†ä¸€å®šçš„æŒæ¡ï¼Œä½†å¹¶æ²¡æœ‰æ·±å…¥ï¼Œè¿™ä¹Ÿæ˜¯å…´è¶£å¤ªå¹¿æ³›çš„ç¼ºç‚¹ã€‚</p>
<p>å›æœ› 2017 ï¼Œéå¸¸æ„Ÿè°¢å¯¼å¸ˆå’ŒåŒå­¦åœ¨ç”Ÿæ´»å’Œå­¦ä¹ ä¸Šç»™äºˆæˆ‘çš„å¸®åŠ©ï¼Œæ„Ÿè°¢æˆ‘çš„å®¶äººç»™äºˆæˆ‘çš„é™ªä¼´å’Œæ”¯æŒã€‚</p>
<h1 id="å±•æœ›-2018"><a href="#å±•æœ›-2018" class="headerlink" title="å±•æœ› 2018"></a>å±•æœ› 2018</h1><p>ä¸å¾—ä¸è¯´ï¼Œæ—¶é—´è¿‡å¾—çœŸçš„æ˜¯å¤ªå¿«äº†ï¼Œå¤§ä¸€çš„ç”Ÿæ´»è¿˜å†å†åœ¨ç›®ï¼Œå¯æ˜¯é‚£å·²ç»æ˜¯ 7 å¹´å‰çš„äº‹äº†ã€‚æ­£å¦‚ï¼Œä¸Šå¸æ‚„æ‚„å·èµ°äº†æˆ‘ä»¬çš„çº¯çœŸï¼Œå´ç¥åœ£åœ°è¯´æ˜¯æˆé•¿çš„ä»£ä»·ã€‚</p>
<p>é©¬ä¸Šå°±è¦æ¯•ä¸šäº†ï¼Œæ¥ä¸‹æ¥å¿…é¡»è¦ç‹¬å½“ä¸€é¢ï¼Œç»™æˆ‘çš„ 2018 ç«‹å‡ ä¸ª FLAG ï¼ˆå¸Œæœ›æ˜å¹´å†çœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ä¸ä¼šè„¸ç–¼ï¼‰ã€‚</p>
<h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>ç»§ç»­åŸ¹å…»æˆ‘å’Œåª³å¦‡å„¿å…±åŒçˆ±å¥½ï¼Œâ€œç”µå½±â€ã€â€œç¾é£Ÿâ€ï¼Œåœ¨è¿½åŠ ä¸€ä¸ªâ€œåˆ°å¤„èµ°èµ°â€ã€‚<br>ç»§ç»­åŸ¹å…»æˆ‘çš„æ–°æŠ€èƒ½â€“çƒ¹é¥ªï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯ç²¾é€šåª³å¦‡å„¿æœ€å–œæ¬¢åƒçš„é‚£å‡ é“èœçš„åšæ³•ã€‚ç­‰æœªæ¥ä»€ä¹ˆæ—¶å€™äººå·¥æ™ºèƒ½ä¹Ÿæ·˜æ±°äº†ï¼Œé‚£æˆ‘å°±å½“å¨å¸ˆå’¯ï¼Œäººç±»æ€»è¦åƒé¥­çš„ï¼Œå“ˆå“ˆã€‚</p>
<h2 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h2><p>ç†Ÿç»ƒæŒæ¡éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯ï¼Œè‡³å°‘æä¸€ä¸ªå¼€æºé¡¹ç›®ï¼›<br>æŒæ¡åŸºäºç§»åŠ¨ç«¯çš„ TensorFlow å¼€å‘ã€‚</p>
<h2 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h2><p>ç»§ç»­æ‰“ç†è‡ªå·±çš„å…¬ä¼—å·ã€åšå®¢ï¼Œä¿è¯å‘¨æœŸæ€§æ›´æ–°ã€‚</p>
<h2 id="å¥èº«"><a href="#å¥èº«" class="headerlink" title="å¥èº«"></a>å¥èº«</h2><p>æ¯«æ— ç–‘é—®ï¼Œèº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ï¼Œæ˜¯ä¸€åˆ‡ç¾å¥½çš„åŸºçŸ³ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ç»å¸¸è°ƒä¾ƒè‡ªå·±æ˜¯åƒé’æ˜¥é¥­çš„ç¨‹åºå‘˜æ¥è¯´ã€‚</p>
<p>2017 å¹´ç”±äºå®éªŒå®¤åˆ¶åº¦ç­‰å„ç§åŸå› ï¼ˆå…¶å®ä¸»è¦æ˜¯è‡ªå·±å¤ªæ‡’ï¼‰ï¼Œå‘¨æœŸè¿åŠ¨éƒ½æ²¡åšæŒä¸‹æ¥ã€‚</p>
<p>2018 å¹´é‡åŒ–ç›®æ ‡ï¼Œç¡®ä¿ä½“é‡æ¯”ç°åœ¨ä¸‹é™ 10 æ–¤ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20180101.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;ä¸º 
    
    </summary>
    
      <category term="ç”Ÿæ´»" scheme="https://githubhaohao.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="è§„åˆ’" scheme="https://githubhaohao.github.io/tags/%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>æ¨è 2 æ¬¾ Google è®¿é—®å·¥å…·</title>
    <link href="https://githubhaohao.github.io/2017/12/31/recommended-2-Google-access-tools/"/>
    <id>https://githubhaohao.github.io/2017/12/31/recommended-2-Google-access-tools/</id>
    <published>2017-12-31T07:33:25.000Z</published>
    <updated>2018-01-02T01:43:53.334Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://mmbiz.qpic.cn/mmbiz_png/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBiaGoOWLJdUBUWqLyqeLQ8v1iaUdicQZvUiaOibfKYKkUshSIve4IcY5WcfeA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="Markdown"></p><p></p>
<div align="center">å½±å“äººç”Ÿå‘½è¿çš„é€‰æ‹©ï¼Œä¸åœ¨äºæŸä¸ªé‡è¦å…³å¤´çš„é‡å¤§äº‹ä»¶ï¼Œè€Œåœ¨äºä¸€äº›å¾ˆæ— æ‰€è°“çš„äº‹æƒ…ã€‚</div><br><br><br>&gt; 2017 å¹´æœ€åä¸€ç¯‡æ–‡ç« ï¼Œåªæœ‰ç¦åˆ©ï¼Œæ²¡æœ‰å¹²è´§ã€‚<br><br><br># iShadow #<br>iShadow æ˜¯ä¸€ä¸ªæä¾›ç§‘å­¦ä¸Šç½‘æœåŠ¡çš„ç½‘ç«™ã€‚å½“ç„¶ç§‘å­¦ä¸Šç½‘å·¥å…·ä¸åªæœ‰æŸé£ã€æŸç¯ã€**-Net ç­‰ï¼ŒiShadow ç½‘ç«™æ•´ä½“é£æ ¼ç‹¬æ ‘ä¸€å¸œï¼Œè¿›å…¥è¯¥ç½‘ç«™åï¼Œä½ é¦–å…ˆä¼šå› çœ‹åˆ°ä¸€å¤§å †ç¾é£Ÿè€Œå£æ°´ç›´æµã€‚<br><br><img src="http://mmbiz.qpic.cn/mmbiz_jpg/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBiaKquZFvw2hLYjSt4F44d0I80PRCicIOGmalK5hFkV5HqDmpIkZwEO3rg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="iShadow ç½‘ç«™ä¸»ç•Œé¢"><br><br><div align="center">iShadow ç½‘ç«™ä¸»ç•Œé¢</div>

<p>è¿™ä¸ªç½‘ç«™ç»™äººçš„ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯ï¼Œå®ƒæ˜¯æç¾é£Ÿçƒ¹é¥ªçš„ï¼Œä½†ç»†æƒ³ä¸€ä¸‹ä¹Ÿæ²¡é”™ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½æ˜¯åƒè´§ã€‚è¯¥ç½‘ç«™æä¾›å…è´¹å’Œä»˜è´¹çš„ SS è´¦å·ï¼Œå…è´¹è´¦å·çš„å¯†ç æ¯ 6 ä¸ªå°æ—¶æ›´æ¢ä¸€æ¬¡ï¼Œé€Ÿåº¦è‰¯å¥½ï¼Œå¯¹äºä¸€èˆ¬éœ€æ±‚çš„å¼€å‘è€…è¶³å¤Ÿäº†ã€‚</p>
<p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBiapblxh2FcgtD61NgtTYsjPL5vHrHmFnibf09XVeGeycaFwG3q2nV0UUQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
<p>ä½¿ç”¨æ•™ç¨‹æ”¯æŒå››ç§å¹³å°ï¼Œé…ç½®éå¸¸æ–¹ä¾¿ã€‚ç‚¹å‡»ä¸€é“ç¾é£Ÿåï¼Œä¸Šæ–¹ä¼šå‡ºç°ä¸€ä¸ªäºŒç»´ç ï¼Œç”¨ä½ çš„å®¢æˆ·ç«¯æ‰«æä¸€ä¸‹å°±å®Œæˆé…ç½®ã€‚</p>
<p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBia2knS8Ol2AJdkuCq7V4oX5APsvEjbkRhzx9IyxPdiaUcg5PObkrqFqyw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
<p>iShadow ç½‘ç«™åœ°å€ï¼š</p>
<p><a href="https://global.ishadowx.net/" title="https://global.ishadowx.net/ " target="_blank" rel="external">https://global.ishadowx.net/ </a></p>
<p>ç”±äºä¸å¯æŠ—åŠ›ï¼Œç½‘å€ä¼šä¸æ–­å˜æ›´ï¼Œä½†åªéœ€è¦è®°ä½å’Œæœç´¢ iShadow å…³é”®è¯ã€‚</p>
<h1 id="Google-è®¿é—®åŠ©æ‰‹"><a href="#Google-è®¿é—®åŠ©æ‰‹" class="headerlink" title="Google è®¿é—®åŠ©æ‰‹"></a>Google è®¿é—®åŠ©æ‰‹</h1><p><img src="http://mmbiz.qpic.cn/mmbiz_png/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBia0375y7Iun4yYmgFGvXkGWicFxqzdT3q22JoATzVFzldCDjXrneVcibeQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
<p>Google è®¿é—®åŠ©æ‰‹æ˜¯ä¸€æ¬¾æµè§ˆå™¨æ’ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥åŠ©ä½ ä½¿ç”¨ Google æ‰€æä¾›çš„æœåŠ¡ï¼Œå¦‚æœç´¢å¼•æ“ã€Gmail ç­‰ï¼Œä½¿ç”¨éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å±è”½æ‰äº†å¤§éƒ¨åˆ†å›½å¤–ç½‘ç«™ï¼ŒåŒ…æ‹¬ Android å®˜ç½‘ç­‰ã€‚é‚£ä¹ˆï¼Œæ€æ ·æ‰èƒ½è·å¾—æ’ä»¶å‘¢ï¼Ÿå…³æ³¨ã€ <strong>AndroidGeeks</strong> ã€å…¬ä¼—å· ï¼Œå¹¶åœ¨å…¬ä¼—å·åå°å›å¤å…³é”®å­—ã€ <strong>Google</strong> ã€ï¼Œå³å¯è·å¾—è¯¥æ’ä»¶ã€‚</p>
<p>è·å¾—è¯¥æ’ä»¶åï¼Œæ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œç„¶åè¿›å…¥chrome://extensions/ æ‰©å±•ç¨‹åºé¡µé¢ï¼Œå°† .crx æ–‡ä»¶ç›´æ¥æ‹–è¿›å»ï¼Œå³å®Œæˆæ’ä»¶å®‰è£…ã€‚</p>
<p><img src="http://mmbiz.qpic.cn/mmbiz_png/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBiazMmBA9QbmRrYoYyyYyonIqqeCwcqSsSmX5MrldHrzvs3zd3aDM98Og/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p>
<p>å®‰è£…å®Œæˆåï¼Œè¿›å…¥ Chrome æµè§ˆå™¨çš„è®¾ç½®é¡µé¢ï¼Œå³ chrome://settings/ ï¼Œå°†å¯åŠ¨é¡µè®¾ç½®ä¸º hao123 ä¸»é¡µï¼ˆå¿å¿å§ï¼‰ï¼Œé‡å¯æµè§ˆå™¨ï¼Œå³å¯ä»¥ä½¿ç”¨ Google æœåŠ¡ã€‚</p>
<p><a href="https://mp.weixin.qq.com/s/Zh5aZQH7er6CAzZNUifwLA" title="https://mp.weixin.qq.com/s/Zh5aZQH7er6CAzZNUifwLA" target="_blank" rel="external">å…¬ä¼—å·æ–‡ç« é“¾æ¥ https://mp.weixin.qq.com/s/Zh5aZQH7er6CAzZNUifwLA </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://mmbiz.qpic.cn/mmbiz_png/Y4w7CnSkUZLM1wRaSEg5ibFl92pJ3ZsBiaGoOWLJdUBUWqLyqeLQ8v1iaUdicQZvUiaOibfKYK
    
    </summary>
    
      <category term="å·¥å…·" scheme="https://githubhaohao.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="ç§‘å­¦ä¸Šç½‘" scheme="https://githubhaohao.github.io/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“</title>
    <link href="https://githubhaohao.github.io/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/"/>
    <id>https://githubhaohao.github.io/2017/11/11/NDK-packaging-third-party-static-and-dynamic-lib/</id>
    <published>2017-11-11T04:33:25.000Z</published>
    <updated>2018-01-02T01:37:03.017Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171111.jpg" alt="Markdown"></p><p></p>
<p><div align="center">è‡ªå¾‹çš„å‰æœŸæ˜¯å…´å¥‹çš„ï¼Œä¸­æœŸæ˜¯ç—›è‹¦çš„ï¼ŒåæœŸæ˜¯äº«å—çš„ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»‹ç»åœ¨ NDK å¼€å‘ä¸­é€šè¿‡ CMake å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ã€‚</p>
</blockquote>
<h1 id="é™æ€åº“å’ŒåŠ¨æ€åº“"><a href="#é™æ€åº“å’ŒåŠ¨æ€åº“" class="headerlink" title="é™æ€åº“å’ŒåŠ¨æ€åº“"></a>é™æ€åº“å’ŒåŠ¨æ€åº“</h1><h2 id="é™æ€åº“"><a href="#é™æ€åº“" class="headerlink" title="é™æ€åº“"></a>é™æ€åº“</h2><p>é™æ€åº“æ–‡ä»¶åç¼€ä¸€èˆ¬ä¸º .a ï¼Œåˆ©ç”¨é™æ€åº“ç¼–è¯‘æˆçš„å¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸æ¯”è¾ƒå¤§ï¼Œç¼–è¯‘åçš„æ‰§è¡Œç¨‹åºä¸éœ€è¦å¤–éƒ¨å‡½æ•°åº“çš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºä¾èµ–çš„é™æ€åº“å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç¨‹åºå°±éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p>
<h2 id="åŠ¨æ€åº“"><a href="#åŠ¨æ€åº“" class="headerlink" title="åŠ¨æ€åº“"></a>åŠ¨æ€åº“</h2><p>åŠ¨æ€åº“ä¹Ÿç§°ä¸ºå…±äº«åº“ï¼ŒåŠ¨æ€åº“æ–‡ä»¶åç¼€ä¸€èˆ¬ä¸º .so (Linux) æˆ– .dll (Windows) ï¼Œç›¸å¯¹äºé™æ€åº“ï¼ŒåŠ¨æ€åº“åœ¨ç¼–è¯‘æ—¶, å¹¶æ²¡æœ‰è¢«ç¼–è¯‘è¿›ç›®æ ‡ä»£ç ä¸­ï¼Œç¨‹åºæ‰§è¡Œåˆ°ç›¸å…³å‡½æ•°æ—¶æ‰è°ƒç”¨åŠ¨æ€åº“é‡Œçš„ç›¸å…³å‡½æ•°ï¼ŒåŠ¨æ€åº“ç¼–è¯‘åæ‰€äº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸è¾ƒå°ã€‚ç”±äºåŠ¨æ€åº“æ²¡æœ‰è¢«æ•´åˆè¿›ç¨‹åºï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°ç”³è¯·å¹¶è°ƒç”¨ï¼Œå› æ­¤ç¨‹åºçš„è¿è¡Œç¯å¢ƒä¸­å¿…é¡»æä¾›ç›¸åº”çš„åº“ã€‚åŠ¨æ€åº“çš„æ”¹å˜å¹¶ä¸å½±å“ç¨‹åºï¼Œä¾¿äºå‡çº§ã€‚</p>
<h2 id="ä¸¤ç§å‡½æ•°åº“ç‰¹ç‚¹"><a href="#ä¸¤ç§å‡½æ•°åº“ç‰¹ç‚¹" class="headerlink" title="ä¸¤ç§å‡½æ•°åº“ç‰¹ç‚¹"></a>ä¸¤ç§å‡½æ•°åº“ç‰¹ç‚¹</h2><p>é™æ€åº“ï¼šç¼–è¯‘åçš„æ‰§è¡Œç¨‹åºä¸éœ€è¦å¤–éƒ¨çš„å‡½æ•°åº“æ”¯æŒï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­å·²ç»è¢«è½½å…¥å¯æ‰§è¡Œç¨‹åº,ç¨‹åºè¿è¡Œæ—¶å°†ä¸å†éœ€è¦è¯¥é™æ€åº“ï¼›<br>åŠ¨æ€åº“ï¼šåŠ¨æ€åº“çš„ä»£ç åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰è½½å…¥å†…å­˜ï¼Œè€Œç¼–è¯‘è¿‡ç¨‹ä¸­ä»…ç®€å•çš„å¼•ç”¨ï¼Œä»£ç ä½“ç§¯è¾ƒå°ï¼Œå¹¶ä¸”åŠ¨æ€åº“ä¸ç¨‹åºä»£ç ç‹¬ç«‹ï¼Œå¯å¤ç”¨ï¼Œè€¦åˆåº¦ä½ï¼›</p>
<h1 id="ç”Ÿæˆç¬¬ä¸‰æ–¹åŠ¨æ€åº“å’Œé™æ€åº“"><a href="#ç”Ÿæˆç¬¬ä¸‰æ–¹åŠ¨æ€åº“å’Œé™æ€åº“" class="headerlink" title="ç”Ÿæˆç¬¬ä¸‰æ–¹åŠ¨æ€åº“å’Œé™æ€åº“"></a>ç”Ÿæˆç¬¬ä¸‰æ–¹åŠ¨æ€åº“å’Œé™æ€åº“</h1><p>æœ¬æ–‡ä¸»è¦é€šè¿‡ CMake å·¥å…·æ„å»ºï¼Œè¯·ç¡®ä¿ AS ç‰ˆæœ¬åœ¨ 2.2 ä»¥ä¸Šã€‚æœ¬èŠ‚ç®€å•ç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“å’Œé™æ€åº“ï¼Œæ¨¡ä»¿æˆ‘ä»¬è¦å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ã€‚<br>æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œé€‰æ‹© Support C++ ï¼Œæ–‡ä»¶ç»“æ„ï¼š</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndklib/%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84.png" alt=""></p>
<p>æ–‡ä»¶ haohao/haohao.h ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“å’Œä¸€ä¸ªç®€å•çš„ç±»ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Created by haohao on 2017/12/14.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> NDKLIB_HAOHAO_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NDKLIB_HAOHAO_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>  LOG_E(...)  __android_log_print(ANDROID_LOG_ERROR,<span class="meta-string">"HaoHao"</span>,__VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> (*getResponse)();</div><div class="line">&#125; HaoHao_FUN;</div><div class="line"></div><div class="line"><span class="keyword">class</span> HaoHao&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    HaoHao(<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="keyword">int</span>);</div><div class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">getHaoHaoWord</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> name;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> __attribute__ ((visibility (<span class="string">"default"</span>))) HaoHao_FUN haohao_fun;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//NDKLIB_HAOHAO_H</span></span></div></pre></td></tr></table></figure>
<p>haohao/haohao.cpp ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªç»“æ„ä½“ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"haohao.h"</span></span></div><div class="line"></div><div class="line">HaoHao::HaoHao(<span class="built_in">std</span>::<span class="built_in">string</span> name, <span class="keyword">int</span> age) &#123;</div><div class="line">    <span class="keyword">this</span>-&gt;name = name;</div><div class="line">    <span class="keyword">this</span>-&gt;age = age;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">string</span> HaoHao::getHaoHaoWord() &#123;</div><div class="line">    <span class="keyword">char</span> tem[<span class="number">3</span>];</div><div class="line">    <span class="built_in">sprintf</span>(tem, <span class="string">"%d"</span>, age);</div><div class="line">    <span class="keyword">return</span> <span class="string">"Hello, My name is "</span> + name + <span class="string">" I am "</span> + tem + <span class="string">" years old"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">get_response</span><span class="params">()</span></span>&#123;</div><div class="line">    HaoHao hao = HaoHao(<span class="string">"chary"</span>, <span class="number">23</span>);</div><div class="line">    <span class="keyword">return</span> hao.getHaoHaoWord();</div><div class="line">&#125;</div><div class="line"></div><div class="line">__attribute__ ((visibility (<span class="string">"default"</span>))) HaoHao_FUN haohao_fun = &#123;</div><div class="line">     get_response</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>haohao/CMakeLists.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line">add_library(haohao STATIC haohao.cpp ) // æ·»åŠ ä¸ºé™æ€åº“</div><div class="line"></div><div class="line">find_library(log-lib  log )</div><div class="line"></div><div class="line">target_link_libraries(haohao $&#123;log-lib&#125; )</div></pre></td></tr></table></figure>
<p>nannan/nannan.h ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“ï¼Œæä¾›ç»™å…¶ä»–ç¨‹åºä½¿ç”¨ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> NDKLIB_NANNAN_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NDKLIB_NANNAN_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;android/log.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span>  LOG_E(...)  __android_log_print(ANDROID_LOG_ERROR,<span class="meta-string">"NanNan"</span>,__VA_ARGS__)</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> (*getResponse)();</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="keyword">int32_t</span> (*getNanNanKey)();</div><div class="line">&#125; NANNAN_FUN;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> __attribute__ ((visibility (<span class="string">"default"</span>))) NANNAN_FUN nannan_fun;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//NDKLIB_NANNAN_H</span></span></div></pre></td></tr></table></figure>
<p>nannan/nannan.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"nannan.h"</span></span></div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">get_nannan_response</span><span class="params">()</span></span>&#123;</div><div class="line">    LOG_E(<span class="string">"Nannan get response"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="string">"Hello, My name is Nannan!"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="keyword">int32_t</span> get_nannan_age()&#123;</div><div class="line">    LOG_E(<span class="string">"Nannan get age"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">23</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">__attribute__ ((visibility (<span class="string">"default"</span>))) NANNAN_FUN nannan_fun = &#123;</div><div class="line">        get_nannan_response,</div><div class="line">        get_nannan_age</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>nannan/CmakeLists.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line"></div><div class="line">add_library(nannan SHARED nannan.cpp ) // æ·»åŠ ä¸ºåŠ¨æ€åº“</div><div class="line"></div><div class="line">find_library(log-lib  log )</div><div class="line"></div><div class="line">target_link_libraries(nannan $&#123;log-lib&#125; )</div></pre></td></tr></table></figure>
<p>æ ¹ç›®å½•ä¸‹çš„ CMakeLists.txt </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line">include_directories($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp)</div><div class="line">set(jnilibs &quot;$&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs&quot;)</div><div class="line">set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;)</div><div class="line"></div><div class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125;  -std=c++14 -pthread -DMGULK_LOG_STDERR=1 -Wall -Wextra -Wnon-virtual-dtor -g&quot;)</div><div class="line"></div><div class="line">ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/haohao)</div><div class="line">ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/nannan)</div></pre></td></tr></table></figure>
<p>app/build.gradle</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndklib/genlib-gradle.png" alt=""></p>
<p>make å·¥ç¨‹ï¼Œåœ¨ app/src/main/jniLibs ç›®å½•ä¸‹ç”Ÿæˆäº†æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndklib/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93.png" alt=""></p>
<h1 id="å¼•å…¥ç¬¬ä¸‰æ–¹åº“"><a href="#å¼•å…¥ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="å¼•å…¥ç¬¬ä¸‰æ–¹åº“"></a>å¼•å…¥ç¬¬ä¸‰æ–¹åº“</h1><p>æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå°†ä¸ŠèŠ‚ç”Ÿæˆçš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶æ‹·è´åˆ° app/src/main/jniLibs ç›®å½•ä¸‹ï¼Œåœ¨ cpp ç›®å½•ä¸‹æ–°å»º include ç›®å½•ï¼Œæ‹·è´ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶åœ¨ include ç›®å½•ä¸‹ã€‚<br>å·¥ç¨‹ç›®å½•</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndklib/%E4%B8%BB%E5%B7%A5%E7%A8%8B.png" alt=""></p>
<p>MainActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.haohao.ndklib;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Used to load the 'native-lib' library on application startup.</span></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        System.loadLibrary(<span class="string">"native"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="comment">// Example of a call to a native method</span></div><div class="line">        TextView tv = (TextView) findViewById(R.id.sample_text);</div><div class="line">        tv.setText(stringFromJNI());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * A native method that is implemented by the 'native-lib' native library,</div><div class="line">     * which is packaged with this application.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">stringFromJNI</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>native/native.cpp ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹åº“æä¾›çš„ API ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;nannan.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;haohao.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span></div><div class="line">&#123;</div><div class="line"><span class="function">JNIEXPORT jstring JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ndklib_MainActivity_stringFromJNI</span><span class="params">(JNIEnv</span></div><div class="line">                                                  *env, jobject instance) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">char</span> age[<span class="number">3</span>];</div><div class="line">    <span class="built_in">sprintf</span>(age, <span class="string">"%d"</span>, nannan_fun.getNanNanKey());</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> value = nannan_fun.getResponse() + <span class="string">" I am "</span> + age + <span class="string">" years old.\n"</span>;</div><div class="line">    value += haohao_fun.getResponse();</div><div class="line">    <span class="comment">//std::string value = "Hello";</span></div><div class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(value.c_str());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>native/CMakeLists.txt æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">add_library(native SHARED native.cpp)</div><div class="line"></div><div class="line"># å¼•å…¥ .so æ–‡ä»¶</div><div class="line">add_library(nannan SHARED IMPORTED )</div><div class="line">set_target_properties(nannan PROPERTIES IMPORTED_LOCATION &quot;$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libnannan.so&quot;)</div><div class="line"></div><div class="line"># å¼•å…¥ .a æ–‡ä»¶</div><div class="line">add_library(haohao STATIC IMPORTED )</div><div class="line">set_target_properties(haohao PROPERTIES IMPORTED_LOCATION &quot;$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libhaohao.a&quot;)</div><div class="line"></div><div class="line">find_library( log-lib log )</div><div class="line"></div><div class="line">target_link_libraries(native nannan haohao $&#123;log-lib&#125;)</div></pre></td></tr></table></figure>
<p>æ ¹ç›®å½•ä¸‹çš„ CMakeLists.txt æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line"></div><div class="line">include_directories($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/include)</div><div class="line">set(jnilibs &quot;$&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs&quot;)</div><div class="line">set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;)</div><div class="line"></div><div class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125;  -std=c++14 -pthread -DMGULK_LOG_STDERR=1 -Wall -Wextra -Wnon-virtual-dtor -g&quot;)</div><div class="line"></div><div class="line">ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/native)</div></pre></td></tr></table></figure>
<p>app/build.gradle æ–‡ä»¶é…ç½®ã€‚</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">25</span></div><div class="line">    buildToolsVersion <span class="string">"25.0.3"</span></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="string">"com.haohao.ndklib"</span></div><div class="line">        minSdkVersion <span class="number">15</span></div><div class="line">        targetSdkVersion <span class="number">25</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></div><div class="line">        externalNativeBuild &#123;</div><div class="line">            cmake &#123;</div><div class="line">                arguments <span class="string">'-DANDROID_PLATFORM=android-15'</span>,</div><div class="line">                        <span class="string">'-DANDROID_TOOLCHAIN=clang'</span>, <span class="string">'-DANDROID_STL=gnustl_static'</span></div><div class="line"><span class="comment">//                cppFlags "-DANDROID_STL=c++_static"</span></div><div class="line">                abiFilters <span class="string">'armeabi-v7a'</span>,<span class="string">'x86_64'</span>, <span class="string">'arm64-v8a'</span>,<span class="string">'x86'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    externalNativeBuild &#123;</div><div class="line">        cmake &#123;</div><div class="line">            path <span class="string">"CMakeLists.txt"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    androidTestCompile(<span class="string">'com.android.support.test.espresso:espresso-core:2.2.2'</span>, &#123;</div><div class="line">        <span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'com.android.support'</span>, module: <span class="string">'support-annotations'</span></div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:25.3.1'</span></div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support.constraint:constraint-layout:1.0.2'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>build å·¥ç¨‹åï¼Œç”Ÿæˆ libnative.so ï¼Œç›´æ¥è¿è¡Œé¡¹ç›®ï¼Œå®‰è£… apk ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndklib/%E4%B8%BB%E5%B7%A5%E7%A8%8B%E7%94%9F%E6%88%90%E5%BA%93.png" alt=""></p>
<p><a href="https://github.com/githubhaohao/NDKLib" target="_blank" rel="external">æœ¬æ–‡ç¤ºä¾‹ä»£ç  https://github.com/githubhaohao/NDKLib</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171111.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;è‡ªå¾‹
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="NDK ç¬¬ä¸‰æ–¹åº“" scheme="https://githubhaohao.github.io/tags/NDK-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼</title>
    <link href="https://githubhaohao.github.io/2017/11/04/NDK-compiled-three-ways/"/>
    <id>https://githubhaohao.github.io/2017/11/04/NDK-compiled-three-ways/</id>
    <published>2017-11-04T05:53:25.000Z</published>
    <updated>2018-01-12T12:00:39.143Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171104.jpg" alt="Markdown"></p><p></p>
<p><div align="center">åšä»»ä½•äº‹éƒ½ä¸å¯èƒ½æœ‰ 100% çš„å‡†å¤‡ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸€è¾¹å‡†å¤‡ä¸€è¾¹é¢å¯¹æœªçŸ¥ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ä»¥å›¾æ–‡çš„æ–¹å¼ä»‹ç»ä¸€ä¸‹ Android NDK ç¼–è¯‘çš„å‡ ç§æ–¹å¼</p>
</blockquote>
<h1 id="é€šè¿‡-Android-Studio-é»˜è®¤çš„æ–¹å¼"><a href="#é€šè¿‡-Android-Studio-é»˜è®¤çš„æ–¹å¼" class="headerlink" title="é€šè¿‡ Android Studio é»˜è®¤çš„æ–¹å¼"></a>é€šè¿‡ Android Studio é»˜è®¤çš„æ–¹å¼</h1><p>åˆ›å»ºå¸¦æœ‰ native æ–¹æ³•çš„ç±»ï¼Œbuild é¡¹ç›®ã€‚<br><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-0.png" alt="img"></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-1.png" alt="img"></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-2.png" alt="img"></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-3.png" alt="img"></p>
<p>ç”Ÿæˆä¸ç±»åç›¸å…³çš„ .h æ–‡ä»¶ã€‚<br>è¿›å…¥ app -&gt; build -&gt; intermediates -&gt; classes -&gt; debug ç›®å½•ä¸‹<br>æ‰§è¡Œï¼š <code>javah com.haohao.hellojni.MyJNI</code> ï¼ˆå…ˆé…ç½®å¥½ JDK çš„ç¯å¢ƒå˜é‡ï¼‰,ç”Ÿæˆ com_haohao_hellojni_MyJNI.h æ–‡ä»¶</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-4.png" alt="img"></p>
<p>åˆ›å»º cpp æ–‡ä»¶ã€‚<br>åœ¨ main æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º jni ç›®å½•ï¼Œå‰ªåˆ‡ .h æ–‡ä»¶åˆ° jni ç›®å½•ä¸‹ï¼Œåˆ›å»º hello.cpp æ–‡ä»¶</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-5.png" alt="img"></p>
<p>hello.cpp</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-6.png" alt=""></p>
<p>é…ç½® build.gradle æ–‡ä»¶ã€‚<br>ä¿®æ”¹ app/build.gradle æ–‡ä»¶ï¼Œ muduleName ä¸ºå¼•å…¥çš„ .so name , ç›´æ¥è¿è¡Œé¡¹ç›®ï¼Œå®‰è£… apk ï¼Œè¿è¡Œå°± OK äº†</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-7.png" alt=""></p>
<p>ç”Ÿæˆçš„ .so æ–‡ä»¶ä½ç½®ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-8.png" alt=""></p>
<p>PSï¼š æœªæŒ‡å®š CPU æ¡†æ¶æ—¶ï¼ŒAS ä¼šç”Ÿæˆæ”¯æŒæ‰€æœ‰ CPU æ¡†æ¶çš„ .so æ–‡ä»¶ã€‚</p>
<h1 id="é€šè¿‡-ndk-build"><a href="#é€šè¿‡-ndk-build" class="headerlink" title="é€šè¿‡ ndk-build"></a>é€šè¿‡ ndk-build</h1><p>åˆ›å»º Android.mk å’Œ Application.mk æ–‡ä»¶ã€‚<br>æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨ app ç›®å½•ä¸‹ï¼ˆä»»ç›®å½•ä¸‹éƒ½å¯ä»¥ï¼‰æ–°å»º jni æ–‡ä»¶ï¼Œæ·»åŠ  Android.mk å’Œ Application.mk æ–‡ä»¶ï¼Œä»¥åŠ com_haohao_hellojni_MyJNI.h æ–‡ä»¶ï¼ˆè¿ç”¨ä¸Šä¸€å°èŠ‚çš„æ–¹æ³•ç”Ÿæˆï¼‰ã€‚<br>Android.mk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line"># è¦ç”Ÿæˆçš„.soåº“åç§°ã€‚javaä»£ç System.loadLibrary(&quot;hello&quot;);åŠ è½½çš„å°±æ˜¯å®ƒ</div><div class="line">LOCAL_MODULE := hello</div><div class="line"></div><div class="line"># C++æ–‡ä»¶</div><div class="line">LOCAL_SRC_FILES := hello.cpp</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure></p>
<p>Application.mk<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># ä¸å†™ APP_ABI ä¼šç”Ÿæˆå…¨éƒ¨æ”¯æŒçš„å¹³å°,ç›®å‰æ”¯æŒï¼šarmeabi arm64-v8a armeabi-v7a</div><div class="line"># APP_ABI := armeabi arm64-v8a armeabi-v7a mips mips64 x86 x86_64</div><div class="line">APP_ABI := armeabi arm64-v8a armeabi-v7a</div></pre></td></tr></table></figure></p>
<p>ç”Ÿæˆ .so æ–‡ä»¶ã€‚<br>åœ¨ jni ç›®å½•ä¸‹ï¼ˆé…ç½®å¥½NDKç¯å¢ƒå˜é‡ï¼‰ç›´æ¥æ‰§è¡Œ ndk-build ï¼Œ ç”Ÿæˆ .so æ–‡ä»¶ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-9.png" alt=""></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-10.png" alt=""></p>
<p>é…ç½®é¡¹ç›®å·¥ç¨‹ã€‚<br>åœ¨ main ç›®å½•ä¸‹æ–°å»º jniLibs ç›®å½•ï¼Œå¹¶æ‹·è´ armeabi arm64-v8a armeabi-v7a æ–‡ä»¶å¤¹ï¼Œè¿è¡Œ proj ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-11.png" alt=""></p>
<h1 id="é€šè¿‡-CMake-å·¥å…·ã€‚"><a href="#é€šè¿‡-CMake-å·¥å…·ã€‚" class="headerlink" title="é€šè¿‡ CMake å·¥å…·ã€‚"></a>é€šè¿‡ CMake å·¥å…·ã€‚</h1><p>ä» Android Studio 2.2 å¼€å§‹ï¼Œå°±é»˜è®¤ä½¿ç”¨ CMake å·¥å…·æ„å»º NDK é¡¹ç›®ï¼Œè¯·ç¡®ä¿ä½ çš„ AS ç‰ˆæœ¬å¤§äº 2.2 ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-11-1.png" alt=""></p>
<h2 id="é€šè¿‡-IDE-è‡ªåŠ¨æ„å»º"><a href="#é€šè¿‡-IDE-è‡ªåŠ¨æ„å»º" class="headerlink" title="é€šè¿‡ IDE è‡ªåŠ¨æ„å»º"></a>é€šè¿‡ IDE è‡ªåŠ¨æ„å»º</h2><p>åˆ›å»ºé¡¹ç›®æ—¶ï¼Œå‹¾é€‰ <code>Include C++ support</code> </p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-12.png" alt=""></p>
<p>é€‰æ‹©é»˜è®¤çš„ <code>Toolchain Default</code></p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-13.png" alt=""></p>
<p>AS è‡ªåŠ¨ç”Ÿæˆ CMakeLists.txt æ–‡ä»¶ï¼ˆCMake æ„å»ºè„šæœ¬ï¼‰</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-14.png" alt=""></p>
<p>CMakeLists.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"># For more information about using CMake with Android Studio, read the</div><div class="line"># documentation: https://d.android.com/studio/projects/add-native-code.html</div><div class="line"></div><div class="line"># Sets the minimum version of CMake required to build the native library. </div><div class="line"># æŒ‡å®šCMakeçš„æœ€å°ç‰ˆæœ¬</div><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line"></div><div class="line"># Creates and names a library, sets it as either STATIC</div><div class="line"># or SHARED, and provides the relative paths to its source code.</div><div class="line"># You can define multiple libraries, and CMake builds them for you.</div><div class="line"># Gradle automatically packages shared libraries with your APK.</div><div class="line"># è®¾ç½®æ¨¡å—åä¸º native-libï¼ŒSHARED å¯åˆ†äº«çš„ï¼Œä»¥åŠé…ç½®æºæ–‡ä»¶çš„è·¯å¾„</div><div class="line">add_library( # Sets the name of the library. è®¾ç½®æ¨¡å—å</div><div class="line">             native-lib</div><div class="line"></div><div class="line">             # Sets the library as a shared library. </div><div class="line">             SHARED </div><div class="line"></div><div class="line">             # Provides a relative path to your source file(s). æ–‡ä»¶è·¯å¾„</div><div class="line">             src/main/cpp/native-lib.cpp )</div><div class="line"></div><div class="line"># Searches for a specified prebuilt library and stores the path as a</div><div class="line"># variable. Because CMake includes system libraries in the search path by</div><div class="line"># default, you only need to specify the name of the public NDK library</div><div class="line"># you want to add. CMake verifies that the library exists before</div><div class="line"># completing its build.</div><div class="line"># æ‰¾åˆ° log æœ¬åœ°æ¨¡å—</div><div class="line">find_library( # Sets the name of the path variable. </div><div class="line">              log-lib</div><div class="line"></div><div class="line">              # Specifies the name of the NDK library that</div><div class="line">              # you want CMake to locate.</div><div class="line">              log )</div><div class="line"></div><div class="line"># Specifies libraries CMake should link to your target library. You</div><div class="line"># can link multiple libraries, such as libraries you define in this</div><div class="line"># build script, prebuilt third-party libraries, or system libraries.</div><div class="line"># å…³è” native-lib æ¨¡å—å’Œ log æ¨¡å—</div><div class="line">target_link_libraries( # Specifies the target library.</div><div class="line">                       native-lib</div><div class="line"></div><div class="line">                       # Links the target library to the log library</div><div class="line">                       # included in the NDK.</div><div class="line">                       $&#123;log-lib&#125; )</div></pre></td></tr></table></figure></p>
<p>åœ¨é…ç½® app/build.gradle ï¼Œé’ˆå¯¹ç‰¹æ®Šå¹³å° abiFilters ã€‚é…ç½®å®Œæˆä¹‹åï¼ŒåŒæ­¥ï¼Œè¿è¡Œã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-15.png" alt=""></p>
<h2 id="æ‰‹åŠ¨æ„å»º"><a href="#æ‰‹åŠ¨æ„å»º" class="headerlink" title="æ‰‹åŠ¨æ„å»º"></a>æ‰‹åŠ¨æ„å»º</h2><p>æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œåˆ›å»º native ç±»ï¼Œå¿«æ·é”® Alt + Enter ,è‡ªåŠ¨åˆ›å»º jni ç›®å½•å’Œç›¸åº”çš„ .cpp æ–‡ä»¶ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-16.png" alt=""></p>
<p>native-lib.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span></div><div class="line"></div><div class="line"><span class="function">JNIEXPORT jstring JNICALL</span></div><div class="line"><span class="title">Java_com_haohao_ndk_1cpp_MyJNI_stringFromJNI</span><span class="params">(JNIEnv *env, jobject instance)</span> &#123;</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> hello = <span class="string">"Hello from C++"</span>;</div><div class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»º CMakeLists.txt æ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># æŒ‡å®šCMakeçš„æœ€å°ç‰ˆæœ¬</div><div class="line">cmake_minimum_required(VERSION 3.4.1)</div><div class="line"></div><div class="line">add_library( # Sets the name of the library. è®¾ç½®æ¨¡å—å</div><div class="line">             native-lib</div><div class="line"></div><div class="line">             # Sets the library as a shared library. </div><div class="line">             SHARED </div><div class="line"></div><div class="line">             # Provides a relative path to your source file(s). æ–‡ä»¶è·¯å¾„</div><div class="line">             src/main/cpp/native-lib.cpp )</div></pre></td></tr></table></figure></p>
<p>é€‰æ‹© <code>app</code> modulde ï¼Œå³å‡»é€‰æ‹©<code>Link C++ Project with Gradle</code>ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-17.png" alt=""></p>
<p>é€‰æ‹©è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-18.png" alt=""></p>
<p>app/build.gradle ä¼šè‡ªåŠ¨åŒæ­¥ã€‚åŒæ­¥å®Œæˆåï¼Œè¿è¡Œé¡¹ç›®ã€‚</p>
<p><img src="http://ovv1lq7pk.bkt.clouddn.com/ndk-compiledndk-19.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171104.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;åšä»»
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="NDK" scheme="https://githubhaohao.github.io/categories/Android/NDK/"/>
    
    
      <category term="NDK ç¼–è¯‘" scheme="https://githubhaohao.github.io/tags/NDK-%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡</title>
    <link href="https://githubhaohao.github.io/2017/10/27/custom-android-system-service/"/>
    <id>https://githubhaohao.github.io/2017/10/27/custom-android-system-service/</id>
    <published>2017-10-27T05:52:04.000Z</published>
    <updated>2017-12-16T06:09:15.631Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171027.jpg" alt="Markdown"></p><p></p>
<p><div align="center">ä¸€ä»¶äº‹å¦‚æœçŠ¹è±«åšè¿˜æ˜¯ä¸åšï¼Œé€‰â€œåšâ€ã€‚ åšäº†ä¹Ÿå¯èƒ½ä¼šåæ‚”ï¼Œä½†æ˜¯è¿™ç§åæ‚”å’Œâ€œæ²¡åšâ€è€Œäº§ç”Ÿçš„ä¸€è¾ˆå­çš„å¦„å¿µç›¸æ¯”ï¼Œåå¤„å°å¤šäº†ã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡çš„è¿‡ç¨‹ã€‚</p>
</blockquote>
<h1 id="åœ¨-Android-ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼ˆCustom-System-Service-in-AOSPï¼‰"><a href="#åœ¨-Android-ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼ˆCustom-System-Service-in-AOSPï¼‰" class="headerlink" title="åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼ˆCustom System Service in AOSPï¼‰"></a>åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼ˆCustom System Service in AOSPï¼‰</h1><h2 id="é…ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆInitial-AOSP-build-environment-ï¼‰"><a href="#é…ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆInitial-AOSP-build-environment-ï¼‰" class="headerlink" title="é…ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆInitial AOSP build environment.ï¼‰"></a>é…ç½®ç¼–è¯‘ç¯å¢ƒï¼ˆInitial AOSP build environment.ï¼‰</h2><p><code>cd AOSP root dir</code><br><code>source build/envsetup.sh</code><br><code>lunch</code><br><code>2</code></p>
<h2 id="å®šä¹‰-Service-çš„-AIDL-æ–‡ä»¶ï¼ˆDefine-service-AIDL-fileï¼‰"><a href="#å®šä¹‰-Service-çš„-AIDL-æ–‡ä»¶ï¼ˆDefine-service-AIDL-fileï¼‰" class="headerlink" title="å®šä¹‰ Service çš„ AIDL æ–‡ä»¶ï¼ˆDefine service AIDL fileï¼‰"></a>å®šä¹‰ Service çš„ AIDL æ–‡ä»¶ï¼ˆDefine service AIDL fileï¼‰</h2><p>path: frameworks/base/core/java/android/os/<br>Create <code>IHaoHaoService.aidl</code> file</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> android.os;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IHaoHaoService</span> </span>&#123;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">setVal</span><span class="params">(String key,String value)</span></span>;</div><div class="line"></div><div class="line">   <span class="function">String <span class="title">getVal</span><span class="params">(String key)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ä¿®æ”¹-Android-æ¨¡å—æ–‡ä»¶ï¼ˆModify-Android-mk-fileï¼‰"><a href="#ä¿®æ”¹-Android-æ¨¡å—æ–‡ä»¶ï¼ˆModify-Android-mk-fileï¼‰" class="headerlink" title="ä¿®æ”¹ Android æ¨¡å—æ–‡ä»¶ï¼ˆModify Android.mk fileï¼‰"></a>ä¿®æ”¹ Android æ¨¡å—æ–‡ä»¶ï¼ˆModify Android.mk fileï¼‰</h2><p>path: frameworks/base/Android.mk</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">......</div><div class="line"></div><div class="line">## READ ME: ########################################################</div><div class="line">##</div><div class="line">## When updating this list of aidl files, consider if that aidl is</div><div class="line">## part of the SDK API.  If it is, also add it to the list below that</div><div class="line">## is preprocessed and distributed with the SDK.  This list should</div><div class="line">## not contain any aidl files for parcelables, but the one below should</div><div class="line">## if you intend for 3rd parties to be able to send those objects</div><div class="line">## across process boundaries.</div><div class="line">##</div><div class="line">## READ ME: ########################################################</div><div class="line">LOCAL_SRC_FILES += \</div><div class="line"></div><div class="line">    ......</div><div class="line"></div><div class="line">	core/java/android/os/IPowerManager.aidl \</div><div class="line">	core/java/android/os/IRemoteCallback.aidl \</div><div class="line">	core/java/android/os/ISchedulingPolicyService.aidl \</div><div class="line">	core/java/android/os/IUpdateLock.aidl \</div><div class="line">	core/java/android/os/IUserManager.aidl \</div><div class="line">	core/java/android/os/IVibratorService.aidl \</div><div class="line">	core/java/android/os/IHaoHaoService.aidl \</div><div class="line"></div><div class="line">	......</div></pre></td></tr></table></figure>
<p>è¿›è¡Œæ¨¡å—ç¼–è¯‘ï¼š</p>
<p><code>~/aosp/android-6.0.1_r1$ mmm frameworks/base</code></p>
<p>generate <code>IHaoHaoService.java</code> file.</p>
<h2 id="åˆ›å»º-HaoHaoService-æ–‡ä»¶ï¼ˆCreate-HaoHaoService-fileï¼‰"><a href="#åˆ›å»º-HaoHaoService-æ–‡ä»¶ï¼ˆCreate-HaoHaoService-fileï¼‰" class="headerlink" title="åˆ›å»º HaoHaoService æ–‡ä»¶ï¼ˆCreate HaoHaoService fileï¼‰"></a>åˆ›å»º HaoHaoService æ–‡ä»¶ï¼ˆCreate HaoHaoService fileï¼‰</h2><p>path: frameworks/base/services/core/java/com/android/server/<br>Create HaoHaoService.java file.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.android.server;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.util.Slog; </div><div class="line"><span class="keyword">import</span> android.os.RemoteException;</div><div class="line"><span class="keyword">import</span> android.os.IHaoHaoService;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HaoHaoService</span> <span class="keyword">extends</span> <span class="title">IHaoHaoService</span>.<span class="title">Stub</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String,String&gt; mCache = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG=<span class="string">"HaoHaoService"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HaoHaoService</span><span class="params">()</span> </span>&#123;</div><div class="line">    	 mCache = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    	 Slog.d(TAG, <span class="string">"HaoHaoService starting."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVal</span><span class="params">(String key, String value)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">        mCache.put(key, value);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getVal</span><span class="params">(String key)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">        <span class="keyword">return</span> mCache.get(key);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æ³¨å†ŒæœåŠ¡ï¼ˆRegister-serviceï¼‰"><a href="#æ³¨å†ŒæœåŠ¡ï¼ˆRegister-serviceï¼‰" class="headerlink" title="æ³¨å†ŒæœåŠ¡ï¼ˆRegister serviceï¼‰"></a>æ³¨å†ŒæœåŠ¡ï¼ˆRegister serviceï¼‰</h2><p>Modify  <code>frameworks/base/core/java/android/content/Context.java</code><br>Add:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/**</span></div><div class="line"> * Use with &#123;<span class="doctag">@link</span> #getSystemService&#125; to retrieve a</div><div class="line"> * &#123;<span class="doctag">@link</span> android.os.IHaoHaoService&#125; for accessing the HaoHao service.</div><div class="line"> *</div><div class="line"> * <span class="doctag">@see</span> #getSystemService</div><div class="line"> * <span class="doctag">@hide</span></div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String HAOHAO_SERVICE = <span class="string">"haohao"</span>;</div></pre></td></tr></table></figure>
<p>Modify <code>frameworks/base/services/java/com/android/server/SystemServer.java</code><br>Find function <code>startOtherServices()</code><br>Add:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    Slog.i(TAG, <span class="string">"***HaoHao Service***"</span>);</div><div class="line">    ServiceManager.addService(Context.HAOHAO_SERVICE, <span class="keyword">new</span> HaoHaoService());</div><div class="line">&#125; <span class="keyword">catch</span> (Throwable e) &#123;</div><div class="line">    Slog.e(TAG, <span class="string">"Failure starting HaoHao Service"</span>, e);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Create-HaoHaoServiceManager-java-file"><a href="#Create-HaoHaoServiceManager-java-file" class="headerlink" title="Create HaoHaoServiceManager.java file"></a>Create HaoHaoServiceManager.java file</h2><p>path: frameworks/base/core/java/android/app/ </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> android.app;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by haohao on 17/10/2.</div><div class="line"> */</div><div class="line"><span class="keyword">import</span> android.annotation.SdkConstant;</div><div class="line"><span class="keyword">import</span> android.annotation.SystemApi;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.os.Build;</div><div class="line"><span class="keyword">import</span> android.os.Parcel;</div><div class="line"><span class="keyword">import</span> android.os.Parcelable;</div><div class="line"><span class="keyword">import</span> android.os.RemoteException;</div><div class="line"><span class="keyword">import</span> android.os.IHaoHaoService;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HaoHaoServiceManager</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"HaoHaoServiceManager"</span>;</div><div class="line">    <span class="keyword">private</span> IHaoHaoService mService;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HaoHaoServiceManager</span><span class="params">(Context context, IHaoHaoService service)</span></span>&#123;</div><div class="line">        mService = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVal</span><span class="params">(String key,String value)</span></span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">            mService.setVal(key,value);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span>(Exception e)&#123;</div><div class="line"></div><div class="line">            Log.e(TAG, e.toString());</div><div class="line"></div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getVal</span><span class="params">(String key)</span></span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> mService.getVal(key);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">            </div><div class="line">            Log.e(TAG, e.toString());</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Register-service-in-SystemServiceRegistry-java-file"><a href="#Register-service-in-SystemServiceRegistry-java-file" class="headerlink" title="Register service in SystemServiceRegistry.java file"></a>Register service in SystemServiceRegistry.java file</h2><p>path: frameworks/base/core/java/android/app/SystemServiceRegistry.java<br>Add:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.os.IHaoHaoService;</div><div class="line">      </div><div class="line">        ......</div><div class="line"></div><div class="line">         registerService(Context.HAOHAO_SERVICE, HaoHaoServiceManager.class,</div><div class="line">                <span class="keyword">new</span> CachedServiceFetcher&lt;HaoHaoServiceManager&gt;() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> HaoHaoServiceManager <span class="title">createService</span><span class="params">(ContextImpl ctx)</span> </span>&#123;</div><div class="line">                        IBinder binder = ServiceManager.getService(Context.HAOHAO_SERVICE);</div><div class="line">                        IHaoHaoService service = IHaoHaoService.Stub.asInterface(binder);</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">new</span> HaoHaoServiceManager(ctx, service);</div><div class="line">            &#125;&#125;);</div><div class="line"></div><div class="line">        ......</div></pre></td></tr></table></figure>
<h2 id="Modify-SePolicy-Build-Check"><a href="#Modify-SePolicy-Build-Check" class="headerlink" title="Modify SePolicy Build Check"></a>Modify SePolicy Build Check</h2><p>path: external/sepolicy/service.te</p>
<p>Add:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">type haohao_service, system_api_service, system_server_service, service_manager_type;</div></pre></td></tr></table></figure>
<p>path: external/sepolicy/service_contexts</p>
<p>Add:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">haohao u:object_r:haohao_service:s0</div></pre></td></tr></table></figure>
<p>service_contexts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">accessibility                             u:object_r:accessibility_service:s0</div><div class="line">account                                   u:object_r:account_service:s0</div><div class="line">activity                                  u:object_r:activity_service:s0</div><div class="line">alarm                                     u:object_r:alarm_service:s0</div><div class="line">haohao                                    u:object_r:haohao_service:s0</div><div class="line">android.security.keystore                 u:object_r:keystore_service:s0</div><div class="line">android.service.gatekeeper.IGateKeeperService    u:object_r:gatekeeper_service:s0</div></pre></td></tr></table></figure>
<h2 id="Update-api-and-build"><a href="#Update-api-and-build" class="headerlink" title="Update api and build"></a>Update api and build</h2><p><code>~/aosp/android-6.0.1_r1$ make update-api -j8</code></p>
<p><code>~/aosp/android-6.0.1_r1$ make -j8</code></p>
<h2 id="Test-service-in-your-Activity"><a href="#Test-service-in-your-Activity" class="headerlink" title="Test service in your Activity"></a>Test service in your Activity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate();</div><div class="line"></div><div class="line">    mHaoHaoServiceManager = (HaoHaoServiceManager)getSystemService(Context.HAOHAO_SERVICE);</div><div class="line">    mHaoHaoServiceManager.setVal(<span class="string">"haohao"</span>, <span class="string">"Android Developer"</span>);</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171027.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;ä¸€ä»¶
    
    </summary>
    
      <category term="Android" scheme="https://githubhaohao.github.io/categories/Android/"/>
    
      <category term="Android ç³»ç»Ÿ" scheme="https://githubhaohao.github.io/categories/Android/Android-%E7%B3%BB%E7%BB%9F/"/>
    
    
      <category term="è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡" scheme="https://githubhaohao.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆJava å®ç°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆä¸‰ï¼‰</title>
    <link href="https://githubhaohao.github.io/2017/10/20/Java-data-structure-stack-and-queue/"/>
    <id>https://githubhaohao.github.io/2017/10/20/Java-data-structure-stack-and-queue/</id>
    <published>2017-10-20T00:20:42.000Z</published>
    <updated>2017-10-20T10:16:58.785Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20171020.jpg" alt="Markdown"></p><p></p>
<p><div align="center">ç”Ÿæ´»è‹Ÿä¸”çš„äººï¼Œå‚»äº†å§å”§çš„å»äº†è¯—å’Œè¿œæ–¹ï¼›è€Œé¼“å¹è¯—å’Œè¿œæ–¹çš„äººï¼Œå·¥ä½œæ¯”è°éƒ½ç§¯æã€‚</div><br></p>
<blockquote>
<p>æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹æ ˆå’Œé˜Ÿåˆ—çš„å®ç°ï¼Œå®ƒä»¬æ˜¯æ•°æ®ç»“æ„ä¸ç®—æ³•ä¸­éå¸¸é‡è¦çš„åŸºç¡€ã€‚</p>
</blockquote>
<h1 id="æ ˆï¼ˆStackï¼‰"><a href="#æ ˆï¼ˆStackï¼‰" class="headerlink" title="æ ˆï¼ˆStackï¼‰"></a>æ ˆï¼ˆStackï¼‰</h1><p><img src="http://ovv1lq7pk.bkt.clouddn.com/stack.PNG" alt="stack"></p>
<p><strong>æ ˆ</strong>æ˜¯é™å®šåœ¨è¡¨å°¾è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„çº¿æ€§è¡¨ã€‚å…è®¸æ’å…¥çš„ç«¯ç§°ä¸ºæ ˆé¡¶ï¼Œå¦ä¸€ç«¯ç§°ä¸ºæ ˆåº•ã€‚</p>
<h2 id="æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹"><a href="#æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹"></a>æ ˆçš„æŠ½è±¡æ•°æ®ç±»å‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Stack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function">T <span class="title">pop</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="æ ˆçš„å®ç°-é“¾æ ˆ"><a href="#æ ˆçš„å®ç°-é“¾æ ˆ" class="headerlink" title="æ ˆçš„å®ç°(é“¾æ ˆ)"></a>æ ˆçš„å®ç°(é“¾æ ˆ)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span>&lt;<span class="title">T</span>&gt;  <span class="keyword">implements</span> <span class="title">Stack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> Node head;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedStack</span><span class="params">()</span> </span>&#123;</div><div class="line">        head = <span class="keyword">null</span>;</div><div class="line">        count = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"the stack is null."</span>);</div><div class="line">        &#125;</div><div class="line">        Node node = head;</div><div class="line">        head = head.getNext();</div><div class="line">        node.setNext(<span class="keyword">null</span>);</div><div class="line">        <span class="keyword">return</span> (T) node.getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T item)</span> </span>&#123;</div><div class="line">        Node node = <span class="keyword">new</span> Node(item);</div><div class="line">        node.setNext(head);</div><div class="line">        head = node;</div><div class="line">        count ++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> count;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> count == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Node p = head;</div><div class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">            <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</div><div class="line">                stringBuilder.append(p.getElement()).append(<span class="string">"\n"</span>);</div><div class="line">                p = p.getNext();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> stringBuilder.toString();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        LinkedStack&lt;String&gt; linkedStack = <span class="keyword">new</span> LinkedStack&lt;String&gt;();</div><div class="line">        linkedStack.push(<span class="string">"Android"</span>);</div><div class="line">        linkedStack.push(<span class="string">"iOS"</span>);</div><div class="line">        linkedStack.push(<span class="string">"Kotlin"</span>);</div><div class="line"></div><div class="line">        System.out.println(linkedStack.toString());</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"pop -&gt; "</span> + linkedStack.pop());</div><div class="line">        System.out.println(<span class="string">"pop -&gt; "</span> + linkedStack.pop());</div><div class="line"></div><div class="line">        System.out.println(linkedStack.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Kotlin</div><div class="line">iOS</div><div class="line">Android</div><div class="line"></div><div class="line">pop -&gt; Kotlin</div><div class="line">pop -&gt; iOS</div><div class="line">Android</div></pre></td></tr></table></figure>
<h1 id="é˜Ÿåˆ—ï¼ˆQueueï¼‰"><a href="#é˜Ÿåˆ—ï¼ˆQueueï¼‰" class="headerlink" title="é˜Ÿåˆ—ï¼ˆQueueï¼‰"></a>é˜Ÿåˆ—ï¼ˆQueueï¼‰</h1><p><img src="http://ovv1lq7pk.bkt.clouddn.com/queue.PNG" alt="queue"></p>
<p><strong>é˜Ÿåˆ—</strong>æ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„çº¿æ€§è¡¨ï¼ˆFIFOï¼‰ã€‚å…è®¸æ’å…¥çš„ä¸€æ®µç§°ä¸ºé˜Ÿå°¾ï¼Œå…è®¸åˆ é™¤çš„ä¸€ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚</p>
<h2 id="é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹"><a href="#é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹" class="headerlink" title="é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹"></a>é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»å‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Queue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(T item)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">T <span class="title">deQueue</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function">T <span class="title">peek</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="é˜Ÿåˆ—å®ç°ï¼ˆé“¾é˜Ÿåˆ—ï¼‰"><a href="#é˜Ÿåˆ—å®ç°ï¼ˆé“¾é˜Ÿåˆ—ï¼‰" class="headerlink" title="é˜Ÿåˆ—å®ç°ï¼ˆé“¾é˜Ÿåˆ—ï¼‰"></a>é˜Ÿåˆ—å®ç°ï¼ˆé“¾é˜Ÿåˆ—ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedQueue</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</div><div class="line">    <span class="keyword">private</span> Node head;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">        head = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(T item)</span> </span>&#123;</div><div class="line">        Node node = <span class="keyword">new</span> Node(item);</div><div class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</div><div class="line">            head = node;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Node p = head;</div><div class="line">            Node prev = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</div><div class="line">                prev = p;</div><div class="line">                p = p.getNext();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            prev.setNext(node);</div><div class="line">        &#125;</div><div class="line">        size++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">deQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"the queue is empty."</span>);</div><div class="line">        &#125;</div><div class="line">        Node node = head;</div><div class="line">        head = head.getNext();</div><div class="line">        node.setNext(<span class="keyword">null</span>);</div><div class="line">        size --;</div><div class="line">        <span class="keyword">return</span> (T) node.getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (T) head.getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">            Node p = head;</div><div class="line">            <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</div><div class="line">                stringBuilder.append(p.getElement()).append(<span class="string">"\n"</span>);</div><div class="line">                p = p.getNext();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> stringBuilder.toString();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        LinkedQueue&lt;String&gt; linkedQueue = <span class="keyword">new</span> LinkedQueue&lt;String&gt;();</div><div class="line">        linkedQueue.enQueue(<span class="string">"Android"</span>);</div><div class="line">        linkedQueue.enQueue(<span class="string">"iOS"</span>);</div><div class="line">        linkedQueue.enQueue(<span class="string">"Kotlin"</span>);</div><div class="line">        linkedQueue.enQueue(<span class="string">"Java"</span>);</div><div class="line"></div><div class="line">        System.out.println(linkedQueue.toString());</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"LinkedQueue dequeue -&gt; "</span> + linkedQueue.deQueue());</div><div class="line">        System.out.println(<span class="string">"LinkedQueue dequeue -&gt; "</span> + linkedQueue.deQueue());</div><div class="line"></div><div class="line">        System.out.println(linkedQueue.toString());</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Android</div><div class="line">iOS</div><div class="line">Kotlin</div><div class="line">Java</div><div class="line"></div><div class="line">LinkedQueue dequeue -&gt; Android</div><div class="line">LinkedQueue dequeue -&gt; iOS</div><div class="line">Kotlin</div><div class="line">Java</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20171020.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;ç”Ÿæ´»
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="https://githubhaohao.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="æ ˆ" scheme="https://githubhaohao.github.io/tags/%E6%A0%88/"/>
    
      <category term="é˜Ÿåˆ—" scheme="https://githubhaohao.github.io/tags/%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>Socket Socket.io Websocket ä¸ HTTP ä¹‹é—´çš„åŒºåˆ«</title>
    <link href="https://githubhaohao.github.io/2017/09/30/diff-between-socket-websocket-socket-io-and-http/"/>
    <id>https://githubhaohao.github.io/2017/09/30/diff-between-socket-websocket-socket-io-and-http/</id>
    <published>2017-09-30T07:33:45.000Z</published>
    <updated>2017-10-03T05:32:06.000Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20170930.jpg" alt="Markdown"></p><p></p>
<p><div align="center">æ•™è‚²çš„ç›®çš„ä»æ¥éƒ½æ˜¯ç²¾ç¥çš„ç‹¬ç«‹è€Œä¸æ˜¯ç»™äºˆè‹¦å¤´ï¼Œé™¤éæœ‰äººä¸å¸Œæœ›çœ‹åˆ°ä½ å¤ªâ€œè‡ªåœ¨â€ï¼Œéœ€è¦é€šè¿‡åˆ¶åº¦å±•ç¤ºæƒåŠ›çš„å¨ä¸¥</div><br></p>
<hr>
<blockquote>
<p>æœ¬ç¯‡ä»ç‰¹å¾è§’åº¦ä»‹ç»ä¸€ä¸‹ï¼ŒSocketã€ Socket.ioã€ Websocketã€ HTTP ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
</blockquote>
<h1 id="Socket-ã€-Socket-io-ã€-Websocket-ã€-HTTP-ä¹‹é—´çš„åŒºåˆ«"><a href="#Socket-ã€-Socket-io-ã€-Websocket-ã€-HTTP-ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="Socket ã€ Socket.io ã€ Websocket ã€ HTTP ä¹‹é—´çš„åŒºåˆ«"></a>Socket ã€ Socket.io ã€ Websocket ã€ HTTP ä¹‹é—´çš„åŒºåˆ«</h1><p><img src="http://ox31eiczv.bkt.clouddn.com/socket.jpg" alt="socket"><br><br></p>
<p>Socket æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„<strong>å¯¹äºä¼ è¾“å±‚ï¼ˆTCP / UDPï¼‰æŠ½è±¡çš„æ¥å£</strong>ï¼Œæ˜¯ä¸€ä¸ª<strong>ç¼–ç¨‹æ¦‚å¿µ</strong>ï¼Œè€Œ Websocket ã€Socket.io ä¸ HTTP ä¸€æ ·æ˜¯ä¸€ä¸ª<strong>æˆæ–‡çš„äº’è”ç½‘åè®®</strong>ã€‚å¦å¤–ï¼ŒWebsocket å’Œ HTTP éƒ½æ˜¯åŸºäº TCP ä¼ è¾“æ•°æ®ï¼ŒSocket.io å¯ä»¥çœ‹ä½œæ˜¯å¯¹ Websocket å’Œ HTTP çš„åˆä¸€æ¬¡å°è£…ã€‚</p>
<p><img src="http://ox31eiczv.bkt.clouddn.com/http.png" alt="http"><br><br></p>
<p>HTTP æ˜¯åŸºäºè¯·æ±‚å“åº”å¼çš„ï¼Œå³é€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡ç«¯åšå‡ºå“åº”ï¼Œæ— çŠ¶æ€ï¼Œæ— è¿æ¥ã€‚<br><strong>æ— çŠ¶æ€</strong>ï¼šæ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ç»“æŸåæ–­å¼€è¿æ¥ã€‚<br><strong>æ— è¿æ¥</strong>ï¼šå¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚</p>
<p>ä»¥å¾€å®ç°å³æ—¶é€šè®¯çš„æ‰‹æ®µï¼š<br>è½®è¯¢ï¼šå®¢æˆ·ç«¯å®šæ—¶å‘æœåŠ¡å™¨å‘é€ Ajax è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥åˆ°è¯·æ±‚åé©¬ä¸Šè¿”å›å“åº”ä¿¡æ¯å¹¶å…³é—­è¿æ¥ã€‚<br>é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ Ajax è¯·æ±‚ï¼Œ<strong>æœåŠ¡å™¨æ¥åˆ°è¯·æ±‚å hold ä½è¿æ¥</strong>ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯æ‰è¿”å›å“åº”ä¿¡æ¯å¹¶å…³é—­è¿æ¥ï¼Œå®¢æˆ·ç«¯å¤„ç†å®Œå“åº”ä¿¡æ¯åå†å‘æœåŠ¡å™¨å‘é€æ–°çš„è¯·æ±‚ã€‚<br>é•¿è¿æ¥ï¼šåœ¨é¡µé¢é‡ŒåµŒå…¥ä¸€ä¸ªéšè”µ iframeï¼Œå°†è¿™ä¸ªéšè”µ iframe çš„ src å±æ€§è®¾ä¸ºå¯¹ä¸€ä¸ªé•¿è¿æ¥çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å°±èƒ½æºæºä¸æ–­åœ°å¾€å®¢æˆ·ç«¯è¾“å…¥æ•°æ®ã€‚<br>Flash Socketï¼šåœ¨é¡µé¢ä¸­å†…åµŒå…¥ä¸€ä¸ªä½¿ç”¨äº† Socket ç±»çš„ Flash ç¨‹åº JavaScript é€šè¿‡è°ƒç”¨æ­¤ Flash ç¨‹åºæä¾›çš„ Socket æ¥å£ä¸æœåŠ¡å™¨ç«¯çš„ Socket æ¥å£è¿›è¡Œé€šä¿¡ï¼ŒJavaScript åœ¨æ”¶åˆ°æœåŠ¡å™¨ç«¯ä¼ é€çš„ä¿¡æ¯åæ§åˆ¶é¡µé¢çš„æ˜¾ç¤ºã€‚</p>
<p><img src="http://ox31eiczv.bkt.clouddn.com/websocket-lifecycle.png" alt="websocket"><br><br></p>
<p>Websocket çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³ HTTP åœ¨å³æ—¶é€šä¿¡ä¸­å­˜åœ¨çš„ä¸è¶³ï¼ŒHTTP æ˜¯é€šè¿‡ Polling å®ç°å³æ—¶é€šä¿¡å­˜åœ¨å¾ˆå¤§çš„èµ„æºå¼€é”€ã€‚</p>
<p>Webscoket æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œè¿æ¥å»ºç«‹ä¹‹åä¾¿ä¸ HTTP åè®®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒWebsocket è¿æ¥å»ºç«‹ä¹‹åï¼Œclient ä¸ server å¯ä»¥åŒæ—¶æ”¶å‘æ•°æ®ï¼Œå…¨åŒå·¥é€šè®¯ã€‚</p>
<p><img src="http://ox31eiczv.bkt.clouddn.com/socket_io.png" alt="socketio"></p>
<p>Socket.io æ”¯æŒ Websocket åè®®ï¼Œæ”¯æŒå¤šç§è½®è¯¢æœºåˆ¶ï¼Œå®ƒå®ç°äº†å®æ—¶ã€åŒå‘ã€åŸºäºäº‹ä»¶çš„é€šè®¯æœºåˆ¶ï¼Œå¤©ç”Ÿç”¨æ¥è§£å†³å®æ—¶é€šè®¯é—®é¢˜ã€‚å¦å¤–ï¼ŒSocket.io èƒ½å¤Ÿæ ¹æ®æµè§ˆå™¨å¯¹é€šè®¯æœºåˆ¶çš„æ”¯æŒæƒ…å†µè‡ªåŠ¨åœ°é€‰æ‹©æœ€ä½³çš„æ–¹å¼æ¥å®ç°ç½‘ç»œå®æ—¶åº”ç”¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20170930.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;æ•™è‚²
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œåŸºç¡€" scheme="https://githubhaohao.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="ç½‘ç»œåè®®" scheme="https://githubhaohao.github.io/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆJava å®ç°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆäºŒï¼‰</title>
    <link href="https://githubhaohao.github.io/2017/09/26/Java-data-structure-linkedlist/"/>
    <id>https://githubhaohao.github.io/2017/09/26/Java-data-structure-linkedlist/</id>
    <published>2017-09-26T13:43:22.000Z</published>
    <updated>2017-10-03T06:57:48.000Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20170927.jpg" alt="Markdown"></p><p></p>
<p><div align="center">å› ä¸ºæˆ‘ä»¬çš„è¨€è¯­è¡¨è¾¾äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè€Œæˆ‘ä»¬çš„æƒ³æ³•åˆ›é€ äº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚</div><br></p>
<hr>
<blockquote>
<p>æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹å•é“¾è¡¨ï¼Œå•å¾ªç¯é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨ã€‚é“¾è¡¨æ˜¯çº¿æ€§è¡¨çš„æ ¸å¿ƒå†…å®¹ï¼Œå•é“¾è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ„æˆæ ˆå’Œé˜Ÿåˆ—ã€‚</p>
</blockquote>
<h2 id="å•é“¾è¡¨èŠ‚ç‚¹"><a href="#å•é“¾è¡¨èŠ‚ç‚¹" class="headerlink" title="å•é“¾è¡¨èŠ‚ç‚¹"></a>å•é“¾è¡¨èŠ‚ç‚¹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    Object data; <span class="comment">// æ•°æ®å…ƒç´ </span></div><div class="line">    Node next;   <span class="comment">// ä¸‹ä¸€èŠ‚ç‚¹çš„å¯¹è±¡å¼•ç”¨</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Node nextval)</span> </span>&#123; <span class="comment">// ç”¨äºå¤´ç»“ç‚¹çš„æ„é€ å‡½æ•°</span></div><div class="line">        next = nextval;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Object obj, Node nextval)</span> </span>&#123; <span class="comment">// ç”¨äºä¸‹ä¸€èŠ‚ç‚¹çš„æ„é€ å‡½æ•°</span></div><div class="line">        data = obj;</div><div class="line">        next = nextval;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getElement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setElement</span><span class="params">(Object data)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data = data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="å•é“¾è¡¨"><a href="#å•é“¾è¡¨" class="headerlink" title="å•é“¾è¡¨"></a>å•é“¾è¡¨</h2><p><img src="http://ovv1lq7pk.bkt.clouddn.com/single_linklist.PNG" alt="å•é“¾è¡¨"></p>
<p>æœ¬ç¯‡çš„å•é“¾è¡¨æ˜¯å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/9.</div><div class="line"> * å•é“¾è¡¨</div><div class="line"> * |  a0  | next | --&gt; |  a1  | next | --&gt; |  a2  | next | --&gt; ... --&gt; |  an  | null |</div><div class="line"> * æ—¶é—´å¤æ‚åº¦O(n)</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> <span class="keyword">implements</span> <span class="title">List</span> </span>&#123;</div><div class="line">    Node head; <span class="comment">// å¤´æŒ‡é’ˆ</span></div><div class="line">    Node current; <span class="comment">// å½“å‰èŠ‚ç‚¹ä½ç½®</span></div><div class="line">    <span class="keyword">int</span> size; <span class="comment">// æ•°æ®å…ƒç´ ä¸ªæ•°</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SingleLinkedList</span><span class="params">()</span> </span>&#123;</div><div class="line">        head = current = <span class="keyword">new</span> Node(<span class="keyword">null</span>);</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        locate(index - <span class="number">1</span>);</div><div class="line">        current.setNext(<span class="keyword">new</span> Node(o, current.next));</div><div class="line">        size ++;</div><div class="line">        System.out.println(<span class="string">"insert node : "</span> + o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"é“¾è¡¨å·²ç©ºï¼Œæ²¡æœ‰å…ƒç´ å¯ä»¥åˆ é™¤"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        locate(index - <span class="number">1</span>);</div><div class="line">        Object o = current.next.getElement();</div><div class="line">        current.setNext(current.next.next);</div><div class="line">        size --;</div><div class="line">        System.out.println(<span class="string">"delete node : "</span> + o);</div><div class="line">        <span class="keyword">return</span> o;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        locate(index);</div><div class="line">        <span class="keyword">return</span> current.getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">locate</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123; <span class="comment">// å®šä½</span></div><div class="line">        <span class="keyword">if</span> (index &lt; -<span class="number">1</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</div><div class="line">            current = head;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        current = head.next;</div><div class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (current != <span class="keyword">null</span> &amp;&amp; j &lt; index) &#123;</div><div class="line">            current = current.next;</div><div class="line">            j++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SingleLinkedList singleLinkedList = <span class="keyword">new</span> SingleLinkedList();</div><div class="line">        singleLinkedList.insert(<span class="number">0</span>, <span class="string">"Android"</span>);</div><div class="line">        singleLinkedList.insert(<span class="number">1</span>, <span class="string">"iOS"</span>);</div><div class="line">        singleLinkedList.insert(<span class="number">2</span>, <span class="string">"React Native"</span>);</div><div class="line">        singleLinkedList.insert(<span class="number">3</span>, <span class="string">"Kotlin"</span>);</div><div class="line"></div><div class="line">        singleLinkedList.delete(<span class="number">0</span>);</div><div class="line"></div><div class="line">        System.out.println(singleLinkedList.size());</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œè¾“å‡ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">insert node : Android</div><div class="line">insert node : iOS</div><div class="line">insert node : React Native</div><div class="line">insert node : Kotlin</div><div class="line">delete node : Android</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure></p>
<h2 id="å•å¾ªç¯é“¾è¡¨"><a href="#å•å¾ªç¯é“¾è¡¨" class="headerlink" title="å•å¾ªç¯é“¾è¡¨"></a>å•å¾ªç¯é“¾è¡¨</h2><p><img src="http://ovv1lq7pk.bkt.clouddn.com/single_cir_linkedlist.PNG" alt="å•å¾ªç¯é“¾è¡¨"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/22.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleCirLinkedList</span> <span class="keyword">implements</span> <span class="title">List</span></span>&#123;</div><div class="line"></div><div class="line">    Node head;</div><div class="line">    Node current;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SingleCirLinkedList</span><span class="params">()</span> </span>&#123;</div><div class="line">        head = current = <span class="keyword">new</span> Node(<span class="keyword">null</span>);</div><div class="line">        head.setNext(head);</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        locate(index - <span class="number">1</span>);</div><div class="line">        current.setNext(<span class="keyword">new</span> Node(o, current.getNext()));</div><div class="line">        size ++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        locate(index - <span class="number">1</span>);</div><div class="line">        Object o = current.getNext().getElement();</div><div class="line">        System.out.println(<span class="string">"delete : "</span> + o);</div><div class="line">        current.setNext(current.getNext().getNext());</div><div class="line">        size --;</div><div class="line">        <span class="keyword">return</span> o;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException</span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        locate(index - <span class="number">1</span>);</div><div class="line">        <span class="keyword">return</span> current.getNext().getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"null"</span>;</div><div class="line">        &#125;</div><div class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        Node p = head.getNext();</div><div class="line">        <span class="keyword">while</span> (p != head) &#123;</div><div class="line">            stringBuilder.append(p.getElement()).append(<span class="string">"\n"</span>);</div><div class="line">            p = p.getNext();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> stringBuilder.toString();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * index å–å€¼èŒƒå›´ -1 è‡³ size - 2 éœ€è¦è€ƒè™‘ 0 -1 è¿™ä¸¤ç§ç‰¹æ®Šæƒ…å†µ</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">locate</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (index &lt; -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</div><div class="line">            current = head;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</div><div class="line">        current = head.getNext();</div><div class="line">        <span class="keyword">while</span> (current != head &amp;&amp; j &lt; index) &#123;</div><div class="line">            current = current.getNext();</div><div class="line">            j++;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SingleCirLinkedList cirLinkedList = <span class="keyword">new</span> SingleCirLinkedList();</div><div class="line">        cirLinkedList.insert(<span class="number">0</span>, <span class="string">"Android"</span>);</div><div class="line">        cirLinkedList.insert(<span class="number">1</span>, <span class="string">"iOS"</span>);</div><div class="line">        cirLinkedList.insert(<span class="number">2</span>, <span class="string">"Kotlin"</span>);</div><div class="line"></div><div class="line">        System.out.println(cirLinkedList.getData(<span class="number">0</span>));</div><div class="line">        System.out.println(cirLinkedList.getData(<span class="number">1</span>));</div><div class="line">        System.out.println(cirLinkedList.getData(<span class="number">2</span>));</div><div class="line"></div><div class="line">        cirLinkedList.delete(<span class="number">1</span>);</div><div class="line"></div><div class="line">        System.out.println(cirLinkedList.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿è¡Œè¾“å‡ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Android</div><div class="line">iOS</div><div class="line">Kotlin</div><div class="line">delete : iOS</div><div class="line">Android</div><div class="line">Kotlin</div></pre></td></tr></table></figure></p>
<h1 id="åŒå‘å¾ªç¯é“¾è¡¨"><a href="#åŒå‘å¾ªç¯é“¾è¡¨" class="headerlink" title="åŒå‘å¾ªç¯é“¾è¡¨"></a>åŒå‘å¾ªç¯é“¾è¡¨</h1><p>åŒå‘å¾ªç¯é“¾è¡¨èŠ‚ç‚¹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/25.</div><div class="line"> * åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DulNode</span> </span>&#123;</div><div class="line">    Object element;</div><div class="line">    DulNode prior; <span class="comment">// ç›´æ¥å‰é©±æŒ‡é’ˆ</span></div><div class="line">    DulNode next;  <span class="comment">// ç›´æ¥åç»§æŒ‡é’ˆ</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DulNode</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DulNode</span><span class="params">(Object element, DulNode prior, DulNode next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.element = element;</div><div class="line">        <span class="keyword">this</span>.prior = prior;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getElement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> element;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> DulNode <span class="title">getPrior</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> prior;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> DulNode <span class="title">getNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setElement</span><span class="params">(Object element)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.element = element;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrior</span><span class="params">(DulNode prior)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.prior = prior;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(DulNode next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åŒå‘å¾ªç¯é“¾è¡¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/25.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CirDulLinkedList</span> <span class="keyword">implements</span> <span class="title">List</span> </span>&#123;</div><div class="line"></div><div class="line">    DulNode head; <span class="comment">// å¤´ç»“ç‚¹</span></div><div class="line">    <span class="keyword">int</span> size;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CirDulLinkedList</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// åˆå§‹åŒ–å¤´ç»“ç‚¹</span></div><div class="line">        head = <span class="keyword">new</span> DulNode();</div><div class="line">        head.setPrior(head);</div><div class="line">        head.setNext(head);</div><div class="line">        head.setElement(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index == size) &#123;  <span class="comment">// ç‰¹æ®Šæƒ…å†µï¼Œåœ¨å°¾éƒ¨ç›´æ¥æ·»åŠ èŠ‚ç‚¹</span></div><div class="line">            add(o);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            DulNode p = search(index);</div><div class="line">            DulNode s = p.getPrior();</div><div class="line">            DulNode newNode = <span class="keyword">new</span> DulNode(o, s, p);</div><div class="line">            s.setNext(newNode);</div><div class="line">            p.setPrior(newNode);</div><div class="line">            size++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        DulNode p = search(index);</div><div class="line">        Object o = p.getElement();</div><div class="line">        DulNode s = p.getPrior();</div><div class="line">        s.setNext(p.getNext());</div><div class="line">        p.getNext().setPrior(s);</div><div class="line">        size--;</div><div class="line">        System.out.println(<span class="string">"CirDulLinkedList.delete : "</span> + o);</div><div class="line">        <span class="keyword">return</span> o;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> search(index).getElement();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"é“¾è¡¨ä¸ºç©º"</span>);</div><div class="line">        &#125;</div><div class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        DulNode p = head.getNext();</div><div class="line">        <span class="keyword">while</span> (p != head) &#123;</div><div class="line">            stringBuilder.append(p.getElement()).append(<span class="string">"\n"</span>);</div><div class="line">            p = p.getNext();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> stringBuilder.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ç›´æ¥åœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        DulNode rear = head.getPrior();</div><div class="line">        DulNode newNode = <span class="keyword">new</span> DulNode(o, rear, head);</div><div class="line">        rear.setNext(newNode);</div><div class="line">        head.setPrior(newNode);</div><div class="line">        size++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// æŒ‰ç…§ä½ç½®æŸ¥æ‰¾èŠ‚ç‚¹</span></div><div class="line">    <span class="function"><span class="keyword">private</span> DulNode <span class="title">search</span><span class="params">(<span class="keyword">int</span> index)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        DulNode p = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (index &gt; size / <span class="number">2</span>) &#123;</div><div class="line">            <span class="comment">// ä½äºé“¾è¡¨çš„ååŠéƒ¨åˆ†ï¼Œåå‘æŸ¥è¯¢</span></div><div class="line">            p = head.getPrior();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--) &#123;</div><div class="line">                p = p.getPrior();</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// ä½äºé“¾è¡¨çš„å‰åŠéƒ¨åˆ†ï¼Œæ­£å‘æŸ¥è¯¢</span></div><div class="line">            p = head.getNext();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</div><div class="line">                p = p.getNext();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        CirDulLinkedList cirDulLinkedList = <span class="keyword">new</span> CirDulLinkedList();</div><div class="line">        cirDulLinkedList.insert(<span class="number">0</span>, <span class="string">"Android"</span>);</div><div class="line">        cirDulLinkedList.insert(<span class="number">1</span>, <span class="string">"iOS"</span>);</div><div class="line">        cirDulLinkedList.insert(<span class="number">2</span>, <span class="string">"Kotlin"</span>);</div><div class="line">        cirDulLinkedList.add(<span class="string">"ReactNative"</span>);</div><div class="line"></div><div class="line">        System.out.println(cirDulLinkedList.toString());</div><div class="line"></div><div class="line">        cirDulLinkedList.delete(<span class="number">2</span>);</div><div class="line"></div><div class="line">        System.out.println(cirDulLinkedList.toString());</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20170927.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;å› ä¸º
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="https://githubhaohao.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="çº¿æ€§è¡¨" scheme="https://githubhaohao.github.io/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/"/>
    
      <category term="é“¾è¡¨" scheme="https://githubhaohao.github.io/tags/%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆJava å®ç°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆä¸€ï¼‰</title>
    <link href="https://githubhaohao.github.io/2017/09/26/Java-data-structure-lineartable/"/>
    <id>https://githubhaohao.github.io/2017/09/26/Java-data-structure-lineartable/</id>
    <published>2017-09-26T12:51:58.000Z</published>
    <updated>2017-09-26T13:45:40.000Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20170926.jpg" alt="Markdown"></p><p></p>
<p><div align="center">æˆå¹´äººå­¦ä¹ çš„ç›®çš„ï¼Œåº”è¯¥æ˜¯è¿½æ±‚æ›´å¥½çš„æ€ç»´æ¨¡å‹ï¼Œè€Œä¸æ˜¯æ›´å¤šçš„çŸ¥è¯†ã€‚</div><br></p>
<hr>
<h1 id="çº¿æ€§è¡¨"><a href="#çº¿æ€§è¡¨" class="headerlink" title="çº¿æ€§è¡¨"></a>çº¿æ€§è¡¨</h1><p><img src="http://img.mukewang.com/55adb5490001776c11520129.jpg" alt="linearlist"></p>
<blockquote>
<p>çº¿æ€§è¡¨ï¼ˆLinear Listï¼‰æ˜¯ç”± nï¼ˆnâ‰¥0ï¼‰ä¸ªæ•°æ®å…ƒç´ ï¼ˆç»“ç‚¹ï¼‰a[0]ï¼Œa[1]ï¼Œa[2]â€¦ï¼Œa[n-1] ç»„æˆçš„æœ‰é™åºåˆ—ã€‚</p>
</blockquote>
<p><img src="http://img.mukewang.com/55adb597000177c611520310.jpg" alt=""><br>çº¿æ€§è¡¨æŒ‰ç…§å­˜å‚¨ç»“æ„åˆ†ä¸ºï¼šé¡ºåºè¡¨å’Œé“¾è¡¨<br>é¡ºåºè¡¨ï¼š<strong>ç”¨ä¸€å—åœ°å€è¿ç»­çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨ä¸­çš„æ•°æ®å…ƒç´ </strong>ï¼›<br>é“¾è¡¨ï¼šé“¾å¼å­˜å‚¨ç»“æ„çš„çº¿æ€§è¡¨ï¼Œ<strong>é€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ åœ¨ç‰©ç†ä¸Šå¯ä»¥ä¸ç›¸é‚»</strong>ï¼Œå…ƒç´ é—´çš„é€»è¾‘å…³ç³»è¡¨ç°åœ¨èŠ‚ç‚¹çš„è¿æ¥ä¸Šã€‚</p>
<h2 id="æŠ½è±¡çº¿æ€§è¡¨"><a href="#æŠ½è±¡çº¿æ€§è¡¨" class="headerlink" title="æŠ½è±¡çº¿æ€§è¡¨"></a>æŠ½è±¡çº¿æ€§è¡¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/8.</div><div class="line"> * æŠ½è±¡çº¿æ€§è¡¨æ“ä½œ</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</div><div class="line"></div><div class="line">    <span class="function">Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="é¡ºåºè¡¨"><a href="#é¡ºåºè¡¨" class="headerlink" title="é¡ºåºè¡¨"></a>é¡ºåºè¡¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/8.</div><div class="line"> * é¡ºåºè¡¨</div><div class="line"> * æ•°æ®å…ƒç´ å­˜å‚¨åœ¨è¿ç»­åœ°å€ç©ºé—´çš„å†…å­˜å•å…ƒ</div><div class="line"> * æ’å…¥/åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦O(n)</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeqList</span> <span class="keyword">implements</span> <span class="title">List</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SeqList"</span>;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> defultSize = <span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> maxSize;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    Object[] array;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SeqList</span><span class="params">()</span> </span>&#123;</div><div class="line">        initiate(defultSize);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SeqList</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">        initiate(size);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initiate</span><span class="params">(<span class="keyword">int</span> sz)</span> </span>&#123;</div><div class="line">        maxSize = sz;</div><div class="line">        size = <span class="number">0</span>;</div><div class="line">        array = <span class="keyword">new</span> Object[sz];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (maxSize == index) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Seq list is full."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"argument error."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i &gt; index; i--) &#123;</div><div class="line">            array[i] = array[i-<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        array[index] = o;</div><div class="line">        size ++;</div><div class="line">        System.out.println(<span class="string">"insert item : "</span> + o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">        <span class="keyword">if</span> (maxSize == size) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Seq list is full."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        array[size] = o;</div><div class="line">        size ++;</div><div class="line"></div><div class="line">        System.out.println(<span class="string">"add item : "</span> + o);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Seq list is empty."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"argument error."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        Object o = array[index];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size - <span class="number">1</span>; i++) &#123;</div><div class="line">            array[i] = array[i + <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        size --;</div><div class="line">        System.out.println(<span class="string">"delete item : "</span> + o + <span class="string">",index : "</span> + index);</div><div class="line">        <span class="keyword">return</span> o;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Seq list is empty."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"argument error."</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array[index];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"null"</span>;</div><div class="line">        &#125;</div><div class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">            stringBuilder.append(<span class="string">"index : "</span>).append(i).append(<span class="string">", value : "</span>).append(array[i]).append(<span class="string">"\n"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> stringBuilder.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        SeqList seqList = <span class="keyword">new</span> SeqList();</div><div class="line">        seqList.insert(<span class="number">0</span>, <span class="string">"Kotlin"</span>);</div><div class="line">        seqList.add(<span class="string">"Android"</span>);</div><div class="line">        seqList.insert(<span class="number">2</span>, <span class="string">"NodeJS"</span>);</div><div class="line"></div><div class="line">        System.out.println(seqList);</div><div class="line"></div><div class="line">        seqList.delete(<span class="number">0</span>);</div><div class="line">        seqList.delete(<span class="number">0</span>);</div><div class="line"></div><div class="line">        System.out.println(seqList);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»£ç è¿è¡Œç»“æœï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">insert item : Kotlin</div><div class="line">add item : Android</div><div class="line">insert item : NodeJS</div><div class="line">index : <span class="number">0</span>, value : Kotlin</div><div class="line">index : <span class="number">1</span>, value : Android</div><div class="line">index : <span class="number">2</span>, value : NodeJS</div><div class="line"></div><div class="line">delete item : Kotlin,index : <span class="number">0</span></div><div class="line">delete item : Android,index : <span class="number">0</span></div><div class="line">index : <span class="number">0</span>, value : NodeJS</div></pre></td></tr></table></figure></p>
<p>å¯å˜å®¹é‡çš„é¡ºåºè¡¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by HaohaoChang on 2017/9/13.</div><div class="line"> * å¯å˜å®¹é‡é¡ºåºè¡¨</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VarSeqList</span> <span class="keyword">implements</span> <span class="title">List</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> defaultSize = <span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> size;</div><div class="line">    <span class="keyword">int</span> length;</div><div class="line">    Object[] array;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VarSeqList</span><span class="params">()</span> </span>&#123;</div><div class="line">        array = <span class="keyword">new</span> Object[defaultSize];</div><div class="line">        size = defaultSize;</div><div class="line">        length = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> index, Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; length) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (length == size) &#123;</div><div class="line">            extend();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = length; i &gt; index; i--) &#123;</div><div class="line">            array[i] = array[i -<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        array[index] = o;</div><div class="line">        length ++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">delete</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        System.out.println(index + <span class="string">" ,"</span> + length);</div><div class="line">        <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"åˆ—è¡¨ä¸ºç©º"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; length - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        Object o = array[index];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; length - <span class="number">1</span>; i++) &#123;</div><div class="line">            array[i] = array[i + <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        length --;</div><div class="line">        <span class="keyword">return</span> o;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"åˆ—è¡¨ä¸ºç©º"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; length - <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"å‚æ•°é”™è¯¯"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> array[index];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> length == <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"åˆ—è¡¨ä¸ºç©º"</span>);</div><div class="line">        &#125;</div><div class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">            stringBuilder.append(getData(i)).append(<span class="string">"\n"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> stringBuilder.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (length == size) &#123;</div><div class="line">            extend();</div><div class="line">        &#125;</div><div class="line">        array[length] = o;</div><div class="line">        length ++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">extend</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// å°å¿ƒè¶Šç•Œ</span></div><div class="line">        size *= <span class="number">2</span>;</div><div class="line">        Object[] newArray = <span class="keyword">new</span> Object[size];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">            newArray[i] = array[i];</div><div class="line">        &#125;</div><div class="line">        array = newArray;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</div><div class="line">        length = <span class="number">0</span>;</div><div class="line">        size = defaultSize;</div><div class="line">        array = <span class="keyword">new</span> Object[size];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        VarSeqList varSeqList = <span class="keyword">new</span> VarSeqList();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</div><div class="line">            varSeqList.add(i);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">995</span>; i++) &#123;</div><div class="line">            varSeqList.delete(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        System.out.println(varSeqList.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20170926.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;&lt;div align=&quot;center&quot;&gt;æˆå¹´
    
    </summary>
    
      <category term="æ•°æ®ç»“æ„ä¸ç®—æ³•" scheme="https://githubhaohao.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="çº¿æ€§è¡¨" scheme="https://githubhaohao.github.io/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/"/>
    
      <category term="é¡ºåºè¡¨" scheme="https://githubhaohao.github.io/tags/%E9%A1%BA%E5%BA%8F%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨ä»è¾“å…¥ Url åˆ°å±•ç¤ºå‡ºé¡µé¢éƒ½ç»å†äº†å“ªäº›è¿‡ç¨‹</title>
    <link href="https://githubhaohao.github.io/2017/09/23/from-url-to-page-displaying/"/>
    <id>https://githubhaohao.github.io/2017/09/23/from-url-to-page-displaying/</id>
    <published>2017-09-23T08:09:25.000Z</published>
    <updated>2017-09-23T08:33:04.000Z</updated>
    
    <content type="html"><![CDATA[<p></p><p align="center"><img src="http://ow23qx875.bkt.clouddn.com/cover_20170923.jpg" alt="Markdown"></p><p></p>
<div align="center">å½“ä½ æƒ³å®Œå…¨å‡†å¤‡å¥½å†åšä¸€ä»¶äº‹çš„æ—¶å€™ï¼Œä¸å¦‚å…ˆåšèµ·æ¥ï¼Œè¾¹åšè¾¹å‡†å¤‡</div>

<hr>
<blockquote>
<p>æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæµè§ˆå™¨ä»è¾“å…¥ Url åˆ°å±•ç¤ºå‡ºé¡µé¢éƒ½ç»å†äº†å“ªäº›è¿‡ç¨‹ã€‚</p>
</blockquote>
<h2 id="è¾“å…¥åŸŸå"><a href="#è¾“å…¥åŸŸå" class="headerlink" title="è¾“å…¥åŸŸå"></a>è¾“å…¥åŸŸå</h2><p>åœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å†å²è®°å½•ã€ä¹¦ç­¾æ™ºèƒ½åŒ¹é…è¡¥å…¨åŸŸåæˆ–è€… url ã€‚<br>ä¾‹å¦‚ chrome æµè§ˆå™¨ï¼Œç”šè‡³ä¼šæ ¹æ®åŒ¹é…ç»“æœç›´æ¥æŠŠç½‘é¡µåŠ è½½å‡ºæ¥ã€‚</p>
<h2 id="è§£æåŸŸå"><a href="#è§£æåŸŸå" class="headerlink" title="è§£æåŸŸå"></a>è§£æåŸŸå</h2><p>è¯·æ±‚å‘èµ·æ—¶ï¼Œæµè§ˆå™¨é¦–å…ˆè§£æåŸŸåï¼Œä¸€èˆ¬ä¼šé¦–å…ˆæŸ¥çœ‹æœ¬åœ°çš„ hosts æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ç›¸å…³åŸŸåä¸ ip åœ°å€çš„å¯¹åº”è§„åˆ™ï¼Œè‹¥æŸ¥æ‰¾åˆ°çš„è¯ï¼Œå°±ç›´æ¥ä½¿ç”¨ hosts æ–‡ä»¶é‡Œé¢çš„ ip åœ°å€ã€‚</p>
<p>è‹¥åœ¨æœ¬åœ° hosts æ–‡ä»¶ä¸­ï¼Œæœªæ‰¾åˆ°ç›®æ ‡åŸŸåä¸ ip åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæµè§ˆå™¨ä¾¿ä¼šå‘æœ¬åœ° DNS æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª DNS è¯·æ±‚ï¼Œæœ¬åœ° DNS æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¾¿ä¼šæŸ¥è¯¢å…¶ç¼“å­˜è®°å½•ï¼Œè‹¥æŸ¥è¯¢åˆ°æ­¤è®°å½•ä¾¿ç›´æ¥è¿”å›ç»“æœã€‚</p>
<p>è‹¥æœ¬åœ° DNS æœåŠ¡å™¨ç¼“å­˜ä¸­æœªæŸ¥è¯¢åˆ°ç›¸å…³è®°å½•ï¼Œä¾¿å‘ DNS æ ¹æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œæ ¹ DNS æœåŠ¡å™¨æ²¡æœ‰è®°å½•å…·ä½“çš„åŸŸåä¸ ip åœ°å€çš„æ˜ å°„å…³ç³»ï¼Œè€Œæ˜¯è¿”å›åŸŸæœåŠ¡å™¨çš„åœ°å€ã€‚</p>
<p>æœ¬åœ° DNS ç»§ç»­å‘åŸŸæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒåŸŸæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œè¿”å›åŸŸåè§£ææœåŠ¡å™¨çš„åœ°å€ã€‚æœ€åæœ¬åœ° DNS æœåŠ¡å™¨å‘åŸŸåè§£ææœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒåŸŸåè§£ææœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œè¿”å›åŸŸåä¸ ip æ˜ å°„å…³ç³»ä¿¡æ¯ï¼Œç„¶åæœ¬åœ° DNS æœåŠ¡å™¨å°†æ˜ å°„ä¿¡æ¯ä¿å­˜åˆ°å…¶ç¼“å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå°† ip åœ°å€è¿”å›ç»™ç”¨æˆ·ç”µè„‘ã€‚</p>
<p><img src="http://ow23qx875.bkt.clouddn.com/dns.jpg" alt="dns"></p>
<div align="center">å›¾ç‰‡æ¥è‡ªç½‘ç»œ</div>

<h2 id="æµè§ˆå™¨å‘èµ·-http-è¯·æ±‚"><a href="#æµè§ˆå™¨å‘èµ·-http-è¯·æ±‚" class="headerlink" title="æµè§ˆå™¨å‘èµ· http è¯·æ±‚"></a>æµè§ˆå™¨å‘èµ· http è¯·æ±‚</h2><p>æµè§ˆå™¨è·å–åˆ°åŸŸåå¯¹åº”çš„ ip åœ°å€ä¹‹åï¼Œä¾¿ä¼šä»¥ä¸€ä¸ªéšæœºç«¯å£ï¼ˆ1024&lt; port &lt; 65535ï¼‰å‘æœåŠ¡ç«¯ web ç¨‹åº 80 ç«¯å£å‘èµ· TCP è¿æ¥è¯·æ±‚ã€‚</p>
<p>æµè§ˆå™¨ä¸æœåŠ¡ç«¯ç»è¿‡ 3 æ¬¡ TCP æ¡æ‰‹ä¹‹åï¼Œå»ºç«‹ TCP è¿æ¥ï¼Œç„¶åæµè§ˆå™¨å‘èµ·ä¸€ä¸ª http è¯·æ±‚ã€‚ä¸€èˆ¬çš„æµè§ˆå™¨åªèƒ½å‘èµ· GET æˆ–è€… POST è¯·æ±‚ã€‚</p>
<p>è¯·æ±‚ä¿¡æ ¼å¼åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>è¯·æ±‚è¡Œï¼ˆè¯·æ±‚æ–¹æ³• URI åè®®/ç‰ˆæœ¬ï¼‰</strong></li>
<li><strong>è¯·æ±‚å¤´(ç¼“å­˜ã€å®¢æˆ·ç«¯èº«ä»½ä¿¡æ¯ç­‰)</strong></li>
<li><strong>ç©ºè¡Œ</strong></li>
<li><strong>æ¶ˆæ¯ä½“</strong></li>
</ol>
<p>http è¯·æ±‚æ ¼å¼ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">GET /index.html HTTP/1.1</div><div class="line">Cache-Control:max-age=0</div><div class="line">Cookie:gsScrollPos=; _ga=GA1.2.329038035.1465891024; _gat=1</div><div class="line">If-Modified-Since:Sun, 01 May 2016 23:59:59 GMT</div><div class="line">User-Agent:Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36</div><div class="line"></div><div class="line">//æ¶ˆæ¯ä½“</div></pre></td></tr></table></figure></p>
<p>PSï¼š<br>å¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•æœ‰ GET/POST/DELETE/PUT/HEAD ã€‚</p>
<p><img src="http://ow23qx875.bkt.clouddn.com/tcp.jpg" alt="tcp"></p>
<div align="center">ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾</div>

<p>TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ï¼š<strong>ä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å› è€Œäº§ç”Ÿä¸å¿…è¦çš„å“åº”å¼€é”€</strong>ã€‚</p>
<blockquote>
<p>åœ¨è°¢å¸Œä»è‘—ã€Šè®¡ç®—æœºç½‘ç»œã€‹ç¬¬å››ç‰ˆä¸­è®²â€œä¸‰æ¬¡æ¡æ‰‹â€çš„ç›®çš„æ˜¯â€œä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯â€ã€‚åœ¨å¦ä¸€éƒ¨ç»å…¸çš„ã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸€ä¹¦ä¸­è®²â€œä¸‰æ¬¡æ¡æ‰‹â€çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³â€œç½‘ç»œä¸­å­˜åœ¨å»¶è¿Ÿçš„é‡å¤åˆ†ç»„â€çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>TCP å››æ¬¡æŒ¥æ‰‹çš„ç›®çš„æ˜¯ï¼šä¸ºç¡®ä¿æ”¶å‘åŒæ–¹æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§ã€‚</p>
<blockquote>
<p>é‚£å››æ¬¡åˆ†æ‰‹åˆæ˜¯ä¸ºä½•å‘¢ï¼ŸTCPåè®®æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„è¿è¾“å±‚é€šä¿¡åè®®ã€‚TCPæ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå½“ä¸»æœº1å‘å‡ºFINæŠ¥æ–‡æ®µæ—¶ï¼Œåªæ˜¯è¡¨ç¤ºä¸»æœº1å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¸»æœº1å‘Šè¯‰ä¸»æœº2ï¼Œå®ƒçš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†ï¼›ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸»æœº1è¿˜æ˜¯å¯ä»¥æ¥å—æ¥è‡ªä¸»æœº2çš„æ•°æ®ï¼›å½“ä¸»æœº2è¿”å›ACKæŠ¥æ–‡æ®µæ—¶ï¼Œè¡¨ç¤ºå®ƒå·²ç»çŸ¥é“ä¸»æœº1æ²¡æœ‰æ•°æ®å‘é€äº†ï¼Œä½†æ˜¯ä¸»æœº2è¿˜æ˜¯å¯ä»¥å‘é€æ•°æ®åˆ°ä¸»æœº1çš„ï¼›å½“ä¸»æœº2ä¹Ÿå‘é€äº†FINæŠ¥æ–‡æ®µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¡¨ç¤ºä¸»æœº2ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå°±ä¼šå‘Šè¯‰ä¸»æœº1ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¹‹åå½¼æ­¤å°±ä¼šæ„‰å¿«çš„ä¸­æ–­è¿™æ¬¡TCPè¿æ¥ã€‚å¦‚æœè¦æ­£ç¡®çš„ç†è§£å››æ¬¡åˆ†æ‰‹çš„åŸç†ï¼Œå°±éœ€è¦äº†è§£å››æ¬¡åˆ†æ‰‹è¿‡ç¨‹ä¸­çš„çŠ¶æ€å˜åŒ–ã€‚</p>
</blockquote>
<h2 id="æœåŠ¡å™¨è¿”å›-http-å“åº”"><a href="#æœåŠ¡å™¨è¿”å›-http-å“åº”" class="headerlink" title="æœåŠ¡å™¨è¿”å› http å“åº”"></a>æœåŠ¡å™¨è¿”å› http å“åº”</h2><p>æœåŠ¡ç«¯è¿”å› http å“åº”çš„æ ¼å¼åŒ…å«å››ä¸ªéƒ¨åˆ†:</p>
<ol>
<li>å“åº”è¡Œï¼ˆçŠ¶æ€è¡Œï¼‰ï¼ˆåè®®/ç‰ˆæœ¬å· çŠ¶æ€ç  çŠ¶æ€è¯´æ˜ï¼‰</li>
<li>å“åº”å¤´ï¼ˆå“åº”å¤´æ˜¯æœåŠ¡å™¨ä¼ é€’ç»™å®¢æˆ·ç«¯ç”¨äºè¯´æ˜æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠå°†æ¥ç»§ç»­è®¿é—®è¯¥èµ„æºæ—¶çš„ç­–ç•¥ã€‚ï¼‰</li>
<li>ç©ºè¡Œ</li>
<li>æ¶ˆæ¯ä½“ï¼ˆå“åº”ä½“æ˜¯æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯çš„ HTML æ–‡æœ¬å†…å®¹ï¼Œæˆ–è€…å…¶ä»–æ ¼å¼çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šè§†é¢‘æµã€å›¾ç‰‡æˆ–è€…éŸ³é¢‘æ•°æ®ã€‚ï¼‰</li>
</ol>
<p>http å“åº”æ ¼å¼ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Sat, 31 Dec 2016 23:59:59 GMT</div><div class="line">Content-Type: text/html;charset=ISO-8859-1</div><div class="line">Content-Length: 113</div><div class="line"></div><div class="line">ï¼œhtmlï¼</div><div class="line">ï¼œheadï¼</div><div class="line">ï¼œtitleï¼Haohaoï¼œ/titleï¼</div><div class="line">ï¼œ/headï¼</div><div class="line">ï¼œbodyï¼</div><div class="line">Hello Worldï¼</div><div class="line">ï¼œ/bodyï¼</div><div class="line">ï¼œ/htmlï¼</div></pre></td></tr></table></figure></p>
<p>PSï¼š<br>æœåŠ¡å™¨åœ¨è¿”å›å“åº”ä¹‹å‰å¯èƒ½ä¼šç»è¿‡é‡å®šå‘ã€åå‘ä»£ç†æœåŠ¡å™¨è¯·æ±‚ç­‰è¿‡ç¨‹ã€‚</p>
<h2 id="æµè§ˆå™¨å¤„ç†å“åº”"><a href="#æµè§ˆå™¨å¤„ç†å“åº”" class="headerlink" title="æµè§ˆå™¨å¤„ç†å“åº”"></a>æµè§ˆå™¨å¤„ç†å“åº”</h2><p>ä»¥æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ä½“ä¸º HTML æ–‡æœ¬ä¸ºä¾‹ï¼Œæµè§ˆå™¨è§£æ HTML æ–‡æœ¬æ—¶ï¼Œä¼šâ€è‡ªä¸Šè€Œä¸‹â€œåŠ è½½ï¼Œå¹¶åœ¨åŠ è½½è¿‡ç¨‹ä¸­è¿›è¡Œè§£ææ¸²æŸ“å±•ç°ç»™ç”¨æˆ·ã€‚åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°è¯·æ±‚å¤–éƒ¨èµ„æºæ—¶ï¼Œå¦‚å›¾ç‰‡ã€å¤–é“¾çš„ CSS ã€ js ç­‰ï¼Œè¯·æ±‚è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸ä¼šå½±å“æ•´ä¸ª HTML æ–‡æ¡£çš„åŠ è½½ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://foofish.net/http-request-process.html" title="ä¸€æ¬¡å®Œæ•´çš„HTTPè¯·æ±‚è¿‡ç¨‹" target="_blank" rel="external">https://foofish.net/http-request-process.html</a></p>
<p><a href="https://github.com/jawil/blog/issues/14" title="é€šä¿—å¤§ç™½è¯æ¥ç†è§£TCPåè®®çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡åˆ†æ‰‹" target="_blank" rel="external">https://github.com/jawil/blog/issues/14</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/p&gt;&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;http://ow23qx875.bkt.clouddn.com/cover_20170923.jpg&quot; alt=&quot;Markdown&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;å½“ä½ æƒ³å®Œå…¨
    
    </summary>
    
      <category term="è®¡ç®—æœºç½‘ç»œåŸºç¡€" scheme="https://githubhaohao.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="ç½‘ç»œè¯·æ±‚" scheme="https://githubhaohao.github.io/tags/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/"/>
    
  </entry>
  
</feed>

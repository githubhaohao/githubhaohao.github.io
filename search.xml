<?xml version="1.0" encoding="utf-8"?>
<search>
  
    
    <entry>
      <title><![CDATA[åœ¨ä»¥å¤ªåŠç§æœ‰é“¾ä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦]]></title>
      <url>%2F2018%2F10%2F07%2FDeploy-smart-contracts-on-the-Ethereum-private-chain%2F</url>
      <content type="text"><![CDATA[åœ¨è‡ªå·±çš„ç§æœ‰é“¾ä¸Šéƒ¨ç½²æ™ºèƒ½åˆçº¦ ä¸ŠèŠ‚ç®€å•ä»‹ç»äº†åŸºäºŽä»¥å¤ªåŠæ­å»ºç§æœ‰é“¾ä»¥åŠæŒ–çŸ¿å’Œäº¤æ˜“ï¼Œåœ¨éƒ¨ç½²æ™ºèƒ½åˆçº¦ä¹‹å‰è¯·ç¡®ä¿ç§æœ‰é“¾ä¸Šçš„è´¦æˆ·æœ‰ä½™é¢ï¼Œå› ä¸ºéƒ¨ç½²æ™ºèƒ½åˆçº¦éœ€è¦æ¶ˆè€— Gas ï¼Œè€Œ Gas éœ€è¦ ether å¸æ¥å…‘æ¢ã€‚ æ™ºèƒ½åˆçº¦ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼ˆSmart Contractï¼‰ï¼Ÿæ™ºèƒ½åˆçº¦æ˜¯å­˜å‚¨åœ¨ä»¥å¤ªåŠç½‘ç»œç‰¹å®šåœ°å€çš„ä¸€ç»„ä»£ç å’Œæ•°æ®é›†ã€‚åœ¨ä»¥å¤ªåŠç½‘ç»œä¸­æ™ºèƒ½åˆçº¦ä»¥ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰å­—èŠ‚ç çš„å½¢å¼å­˜åœ¨ï¼Œç”±ä»¥å¤ªåŠè™šæ‹Ÿæœºè§£é‡Šæ‰§è¡Œã€‚ç”¨äºŽç¼–å†™æ™ºèƒ½åˆçº¦å¸¸ç”¨çš„è¯­è¨€æœ‰ Solidity ã€Serpent ä»¥åŠ LLL ï¼Œå…¶ä¸­æœ€è‘—åçš„å°±æ˜¯ Solidity ã€‚æ™ºèƒ½åˆçº¦çš„éƒ¨ç½²å’Œæ‰§è¡Œéƒ½éœ€è¦è´¹ç”¨ï¼ˆGasï¼‰,ä¸€æ—¦éƒ¨ç½²ä¾¿ä¸èƒ½ä¿®æ”¹ã€‚ éƒ¨ç½²æ™ºèƒ½åˆçº¦éƒ¨ç½²æ™ºèƒ½åˆçº¦å¯ä»¥ä½¿ç”¨ä»¥å¤ªåŠå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼ˆGeth Consoleï¼‰å’Œ Mist ã€‚ é€‰ç”¨ Solidity å®˜ç½‘çš„ä¾‹å­ Coin ã€‚ 123456789101112131415161718192021222324252627282930pragma solidity ^0.4.0;contract Coin &#123; // The keyword "public" makes those variables // easily readable from outside. address public minter; mapping (address =&gt; uint) public balances; // Events allow light clients to react to // changes efficiently. event Sent(address from, address to, uint amount); // This is the constructor whose code is // run only when the contract is created. constructor() public &#123; minter = msg.sender; &#125; function mint(address receiver, uint amount) public &#123; require(msg.sender == minter); require(amount &lt; 1e60); balances[receiver] += amount; &#125; function send(address receiver, uint amount) public &#123; require(amount &lt;= balances[msg.sender], "Insufficient balance."); balances[msg.sender] -= amount; balances[receiver] += amount; emit Sent(msg.sender, receiver, amount); &#125;&#125; ä»¥å¤ªåŠå‘½ä»¤è¡Œå®¢æˆ·ç«¯éƒ¨ç½²æ‰“å¼€ç½‘ç«™https://remix.ethereum.orgï¼Œå°†ä¸Šé¢çš„æ™ºèƒ½åˆçº¦ä»£ç æ›¿æ¢ä¸º Coin çš„ä¾‹å­ã€‚ ç„¶åŽé€‰æ‹© Compile ï¼Œç‚¹å‡» Start to compile ç”Ÿæˆ EVM çš„å­—èŠ‚ç ï¼Œå¤åˆ¶ç”Ÿæˆçš„ ABI å’Œ ByteCode ã€‚ ABI: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899[ &#123; "constant": false, "inputs": [ &#123; "name": "receiver", "type": "address" &#125;, &#123; "name": "amount", "type": "uint256" &#125; ], "name": "mint", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "constant": false, "inputs": [ &#123; "name": "receiver", "type": "address" &#125;, &#123; "name": "amount", "type": "uint256" &#125; ], "name": "send", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "anonymous": false, "inputs": [ &#123; "indexed": false, "name": "from", "type": "address" &#125;, &#123; "indexed": false, "name": "to", "type": "address" &#125;, &#123; "indexed": false, "name": "amount", "type": "uint256" &#125; ], "name": "Sent", "type": "event" &#125;, &#123; "inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor" &#125;, &#123; "constant": true, "inputs": [ &#123; "name": "", "type": "address" &#125; ], "name": "balances", "outputs": [ &#123; "name": "", "type": "uint256" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": true, "inputs": [], "name": "minter", "outputs": [ &#123; "name": "", "type": "address" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;] ByteCodeï¼Œ å…¶ä¸­ object å­—æ®µå¯¹åº”çš„å°±æ˜¯å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ EVM å­—èŠ‚ç ï¼ˆä¸‹é¢åªè´´å‡ºæ¥éƒ¨åˆ†ä»£ç ï¼‰: 1234567&#123; "linkReferences": &#123;&#125;, "object": "608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506104df806100606000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806307546172146...", "opcodes": "PUSH1 0x80 PUSH1 0x40 MSTORE CALLVALUE DUP1 ISZERO PUSH2 0x10 JUMPI PUSH1 0x0 DUP1 REVERT JUMPDEST POP CALLER PUSH1 0x0 DUP1 PUSH2 0x100 EXP DUP2 SLOAD DUP2 PUSH20 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF MUL NOT AND SWAP1 DUP4 PUSH20 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF AND MUL OR SWAP1 SSTORE POP PUSH2 0x4DF DUP1 PUSH2 0x60 PUSH1 0x0 CODECOPY PUSH1 0x0 RETURN STOP PUSH1 0x80 PUSH1 0x40 MSTORE PUSH1 0x4 CALLDATASIZE LT PUSH2 0x62 JUMPI ...", "sourceMap": "24:902:0:-;;;427:57;8:9:-1;5:2;;;30:1;27;20:12;5:2;427:57:0;467:10;458:6;;:19;;;;;;;;;;;;;;;;;;24:902;;;;;;"&#125; å¦å¤– ABI éœ€è¦è½¬ä¹‰æˆå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ç½‘ç«™http://www.bejson.comï¼Œ é€‰æ‹©ã€åˆ é™¤ç©ºæ ¼å¹¶è½¬ä¹‰ã€‘ã€‚è½¬ä¹‰æˆå­—ç¬¦ä¸²çš„ ABI ï¼š 1[&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;receiver\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;name\&quot;:\&quot;mint\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;receiver\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;name\&quot;:\&quot;send\&quot;,\&quot;outputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;anonymous\&quot;:false,\&quot;inputs\&quot;:[&#123;\&quot;indexed\&quot;:false,\&quot;name\&quot;:\&quot;from\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;indexed\&quot;:false,\&quot;name\&quot;:\&quot;to\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;,&#123;\&quot;indexed\&quot;:false,\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;name\&quot;:\&quot;Sent\&quot;,\&quot;type\&quot;:\&quot;event\&quot;&#125;,&#123;\&quot;inputs\&quot;:[],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;,\&quot;type\&quot;:\&quot;constructor\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;name\&quot;:\&quot;balances\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;,&#123;\&quot;constant\&quot;:true,\&quot;inputs\&quot;:[],\&quot;name\&quot;:\&quot;minter\&quot;,\&quot;outputs\&quot;:[&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address\&quot;&#125;],\&quot;payable\&quot;:false,\&quot;stateMutability\&quot;:\&quot;view\&quot;,\&quot;type\&quot;:\&quot;function\&quot;&#125;] é€šè¿‡ Geth Console åˆ›å»ºåˆçº¦å¯¹è±¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133// å£°æ˜Žåˆçº¦ coin&gt; var abi = JSON.parse('[&#123;\"constant\":false,\"inputs\":[&#123;\"name\":\"receiver\",\"type\":\"address\"&#125;,&#123;\"name\":\"amount\",\"type\":\"uint256\"&#125;],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"&#125;,&#123;\"constant\":false,\"inputs\":[&#123;\"name\":\"receiver\",\"type\":\"address\"&#125;,&#123;\"name\":\"amount\",\"type\":\"uint256\"&#125;],\"name\":\"send\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"&#125;,&#123;\"anonymous\":false,\"inputs\":[&#123;\"indexed\":false,\"name\":\"from\",\"type\":\"address\"&#125;,&#123;\"indexed\":false,\"name\":\"to\",\"type\":\"address\"&#125;,&#123;\"indexed\":false,\"name\":\"amount\",\"type\":\"uint256\"&#125;],\"name\":\"Sent\",\"type\":\"event\"&#125;,&#123;\"inputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"&#125;,&#123;\"constant\":true,\"inputs\":[&#123;\"name\":\"\",\"type\":\"address\"&#125;],\"name\":\"balances\",\"outputs\":[&#123;\"name\":\"\",\"type\":\"uint256\"&#125;],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"&#125;,&#123;\"constant\":true,\"inputs\":[],\"name\":\"minter\",\"outputs\":[&#123;\"name\":\"\",\"type\":\"address\"&#125;],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"&#125;]')&gt; coin = web3.eth.contract(abi)// éœ€è¦ä¸ºå­—èŠ‚ç æ·»åŠ ï¼Œ'0x' å‰ç¼€ã€‚&gt; byteCode = "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506104df806100606000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063075461721461006757806327e235e3146100be57806340c10f1914610115578063d0679d34146101...""0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506104df806100606000396000f300608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063075461721461006757806327e235e3146100be57806340c10f19146101..."// å°±æ˜¯éƒ¨ç½²æ™ºèƒ½åˆçº¦éœ€è¦çš„ç‡ƒæ–™ï¼ˆGasï¼‰å€¼ã€‚&gt; eth.estimateGas(&#123;data: byteCode&#125;)406661// æˆ‘ä»¬è¾“å…¥çš„ç‡ƒæ–™å€¼éœ€è¦å¤§äºŽ 406661 &gt;// è§£é” coinbase è´¦æˆ·&gt; personal.unlockAccount(eth.coinbase)Unlock account 0x33213084015dab454fee16eb369fa2a8e6e65eeePassphrase:true// åˆ›å»º coin åˆçº¦å¯¹è±¡ï¼Œéƒ¨ç½²åˆçº¦&gt; coinContractIns = coin.new(&#123;data: byteCode gas: 410000, from: eth.coinbase&#125;, function(e, contract)&#123; if(!e)&#123; if(!contract.address)&#123; console.log("Contract transaction send: Transaction Hash: "+contract.transactionHash+" waiting to be mined..."); &#125;else&#123; console.log("Contract mined! Address: " + contract.address); console.log(contract); &#125; &#125;else&#123; console.log(e) &#125;&#125;)INFO [10-07|12:19:00.077] Submitted contract creation fullhash=0x114e241d2a62064b0d41ec143c595768f648306595a931563a3add4cee3c2d77 contract=0x7227255a42b167061B4260A0b1827e3E6F737905Contract transaction send: Transaction Hash: 0x114e241d2a62064b0d41ec143c595768f648306595a931563a3add4cee3c2d77 waiting to be mined...&#123; abi: [&#123; constant: false, inputs: [&#123;...&#125;, &#123;...&#125;], name: "mint", outputs: [], payable: false, stateMutability: "nonpayable", type: "function" &#125;, &#123; constant: false, inputs: [&#123;...&#125;, &#123;...&#125;], name: "send", outputs: [], payable: false, stateMutability: "nonpayable", type: "function" &#125;, &#123; anonymous: false, inputs: [&#123;...&#125;, &#123;...&#125;, &#123;...&#125;], name: "Sent", type: "event" &#125;, &#123; inputs: [], payable: false, stateMutability: "nonpayable", type: "constructor" &#125;, &#123; constant: true, inputs: [&#123;...&#125;], name: "balances",// coin åˆçº¦å¹¶æ²¡æœ‰éƒ¨ç½²æˆåŠŸï¼Œéœ€è¦å¯åŠ¨æŒ–çŸ¿&gt; miner.start();&gt; // ç­‰å¾…çº¦ 12 ä»¥ä¸ŠåŒºå—ç”Ÿæˆï¼Œåœæ­¢æŒ–çŸ¿&gt; miner.stop();// æŸ¥çœ‹åˆçº¦æ˜¯å¦éƒ¨ç½²æˆåŠŸ&gt; eth.getCode(coinContractIns.address)"0x608060405260043610610062576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063075461721461006757806327e235e31461b600080fd5b34801561007357600080fd5b5061007c6101af565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff00080fd5b506100ff600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506101d4565b6040518082815260200191505060405180..."// åˆçº¦éƒ¨ç½²æˆåŠŸ//è§£é”è´¦æˆ·&gt; eth.defaultAccount=eth.coinbase"0x33213084015dab454fee16eb369fa2a8e6e65eee" // coinbase è´¦æˆ·&gt; personal.unlockAccount(eth.coinbase)Unlock account 0x33213084015dab454fee16eb369fa2a8e6e65eeePassphrase:true// æŸ¥çœ‹è´¦æˆ·åœ¨åˆçº¦ä¸­çš„ä½™é¢&gt; coinContractIns.balances("0x33213084015DAB454fEe16eb369FA2a8E6E65eEE") //æ›¿æ¢æˆè‡ªå·±çš„ coinbase è´¦æˆ·0// ç”±äºŽåˆçº¦æ²¡æœ‰è¢«æ‰§è¡Œï¼Œåˆçº¦ä¸­çš„ä½™é¢ä¸º 0// é€šè¿‡åˆçº¦ä¸­çš„ mint æŽ¥å£è®¾ç½® coinbase è´¦æˆ·åœ¨åˆçº¦ä¸­çš„ coin æ•°ç›®ä¸º 30000 ã€‚&gt; coinContractIns.mint("0x33213084015DAB454fEe16eb369FA2a8E6E65eEE", 30000);INFO [10-07|12:37:31.191] Submitted transaction fullhash=0x788857480e7c33d59f5893e7287c697d33e5ad29a52817e19930ec26178e62b3 recipient=0x7227255a42b1"0x788857480e7c33d59f5893e7287c697d33e5ad29a52817e19930ec26178e62b3"// ä¸Šè¿°æ“ä½œå¹¶æœªæ‰§è¡Œï¼Œéœ€è¦å¯åŠ¨æŒ–çŸ¿&gt; miner.start();&gt; // ç­‰å¾…çº¦ 12 ä»¥ä¸ŠåŒºå—ç”Ÿæˆï¼Œåœæ­¢æŒ–çŸ¿&gt; miner.stop();// æŒ–çŸ¿ç»“æŸï¼ŒæŸ¥çœ‹ coinbase è´¦æˆ· coin æ•°é‡&gt; coinContractIns.balances("0x33213084015DAB454fEe16eb369FA2a8E6E65eEE")30000//è§£é” coinbase è´¦æˆ·ï¼Œè¿›è¡Œäº¤æ˜“&gt; personal.unlockAccount(eth.coinbase)Unlock account 0x33213084015dab454fee16eb369fa2a8e6e65eeePassphrase:true// å‘é€ç»™è´¦æˆ· 0x55213084015DAB454fEe16eb369FA2a8E6E65ebbï¼ˆè¿™ä¸ªè´¦æˆ·å¯ä»¥éšæ„å¡«å†™ï¼Œä¿è¯ 20 Byteï¼‰10000 ä¸ª coin&gt; coinContractIns.send("0x55213084015DAB454fEe16eb369FA2a8E6E65ebb", 10000);INFO [10-07|12:47:17.161] Submitted transaction fullhash=0xf0ec8dc4daf6d85cf55be8289a37fbd271437658b2a02fc330272403192d863e recipient=0x7227255a42"0xf0ec8dc4daf6d85cf55be8289a37fbd271437658b2a02fc330272403192d863e"// äº¤æ˜“è¿˜æœªæ‰§è¡Œï¼Œè¿™ä¸ªè´¦æˆ·ä½™é¢è¿˜æ˜¯ 0 &gt; coinContractIns.balances("0x55213084015DAB454fEe16eb369FA2a8E6E65ebb")0// ä¸Šè¿°æ“ä½œå¹¶æœªæ‰§è¡Œï¼Œéœ€è¦å¯åŠ¨æŒ–çŸ¿&gt; miner.start();&gt; // ç­‰å¾…çº¦ 12 ä»¥ä¸ŠåŒºå—ç”Ÿæˆï¼Œåœæ­¢æŒ–çŸ¿&gt; miner.stop();// æŒ–çŸ¿ç»“æŸï¼ŒæŸ¥çœ‹è´¦æˆ·çš„ coin ä½™é¢ï¼Œåˆçº¦æ‰§è¡ŒæˆåŠŸã€‚&gt; coinContractIns.balances("0x55213084015DAB454fEe16eb369FA2a8E6E65ebb")10000&gt; coinContractIns.balances("0x33213084015DAB454fEe16eb369FA2a8E6E65eEE")20000&gt; Mist éƒ¨ç½²æ™ºèƒ½åˆçº¦é€šè¿‡ Mist éƒ¨ç½²æ™ºèƒ½åˆçº¦éžå¸¸ç®€å•æ–¹ä¾¿ã€‚æ‰“å¼€ Mist ï¼Œé€‰æ‹©ã€CONTRACTã€‘-&gt;ã€DEPLOY NEW CONTRACTã€‘ï¼Œåœ¨ ã€SOLIDITY CONTRACT SOURCE CODEã€‘ ä¸­ï¼Œå°† coin ä¾‹å­ä»£ç ç²˜è´´è¿›æ¥ï¼Œå°†åˆçº¦æ”¹ä¸º LTCCoin ã€‚ ç‚¹å‡»ã€DEPLOYã€‘è¾“å…¥è´¦æˆ·å¯†ç åˆ›å»ºåˆçº¦ï¼ˆè¿™é‡Œåˆ›å»ºè´¦æˆ·é€‰æ‹© Account1ï¼‰ã€‚ ç‚¹å‡»ã€WALLETSã€‘åœ¨ä¸‹é¢çš„ã€Latest Transactionã€‘å¯ä»¥çœ‹åˆ°åˆçº¦æ­£åœ¨åˆ›å»ºä¸­ï¼Œè¿™é‡Œéœ€è¦åœ¨ Geth Console å¯åŠ¨æŒ–çŸ¿ï¼Œåˆçº¦æ‰èƒ½åˆ›å»ºæˆåŠŸï¼Œå½“ç„¶è¿›è¡Œä»»ä½•äº¤æ˜“æ“ä½œéƒ½éœ€è¦æŒ–çŸ¿æ¥å®Œæˆã€‚ æŒ–çŸ¿åŽï¼Œé€‰æ‹©ã€CONTRACTã€‘æŸ¥çœ‹åˆçº¦éƒ¨ç½²æˆåŠŸã€‚ ç„¶åŽåœ¨å³ä¾§ã€Select functionã€‘é€‰æ‹©ç›¸åº”æ“ä½œï¼Œæ³¨æ„æ‰§è¡Œ mint å‡½æ•°æ‰§è¡Œè´¦æˆ·éœ€è¦é€‰æ‹©ä¸ºåˆ›å»ºè´¦æˆ· Account1 ï¼Œäº¤æ˜“æˆåŠŸéœ€è¦æŒ–çŸ¿ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åŸºäºŽä»¥å¤ªåŠæ­å»ºç§æœ‰é“¾]]></title>
      <url>%2F2018%2F10%2F02%2FBuilding-a-private-chain-based-on-Ethereum%2F</url>
      <content type="text"><![CDATA[åœ¨è‡ªå·±çš„ç§æœ‰é“¾ä¸ŠæŒ–çŸ¿å’Œäº¤æ˜“ åŒºå—é“¾ç›®å‰ä¸šç•Œå…³äºŽåŒºå—é“¾å°šæ— æƒå¨ç»Ÿä¸€çš„å®šä¹‰ã€‚åŒºå—é“¾ç®€å•æ¥è¯´ï¼Œæ˜¯ä¸€ç§é“¾å¼çš„æ•°æ®ç»“æž„ï¼ŒåŒºå—ä¹‹é—´æŒ‰ç…§æ—¶é—´é¡ºåºè¿žæŽ¥ï¼Œåˆ©ç”¨å¯†ç å­¦æ–¹å¼ä¿è¯æ•°æ®ä¸æ˜“ä¸²æ”¹å’Œä¸æ˜“ä¼ªé€ ï¼Œå¹¶åœ¨ç½‘ç»œæ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œåˆ†å¸ƒå¼å­˜å‚¨çš„å…±äº«è´¦æœ¬ã€‚ è°ˆåˆ°åŒºå—é“¾å°±ä¸å¾—ä¸æåŠæœ€è¿‘ä»·æ ¼ç»åŽ†è¿‡å±±è½¦çš„æ¯”ç‰¹å¸ï¼ˆBTCï¼‰ï¼Œæ¯”ç‰¹å¸å¯¹ç¤¾ä¼šçš„è´¡çŒ®å’Œä»·å€¼ä¸»è¦åœ¨äºŽï¼Œé€šè¿‡å®žè·µéªŒè¯äº†èƒŒåŽæ”¯æ’‘å…¶è¿ä½œçš„åŒºå—é“¾æŠ€æœ¯ã€‚äº†è§£æ¯”ç‰¹å¸çš„åŸºæœ¬åŽŸç†ï¼Œè¯·ç§»æ­¥ä¸€ä¸ªæ•…äº‹å‘Šè¯‰ä½ æ¯”ç‰¹å¸çš„åŽŸç†åŠè¿ä½œæœºåˆ¶ ç›®å‰äº’è”ç½‘ä¸»è¦ä½œä¸ºâ€œä¿¡æ¯â€ä¼ é€’çš„å¹³å°ï¼Œè€ŒåŒºå—é“¾æŠ€æœ¯çš„å‘å±•å’Œå®Œå–„å°†èµ‹äºˆäº’è”ç½‘ä¼ é€’â€œä¿¡ä»»â€å’Œâ€œä»·å€¼â€çš„èƒ½åŠ›ï¼Œå°±ç›®å‰çš„çŽ¯å¢ƒè€Œè¨€ï¼ŒåŒºå—é“¾æŠ€æœ¯çš„ç‚’ä½œå¯èƒ½è¦å¤šäºŽæŠ€æœ¯æœ¬èº«çš„è½åœ°å’Œåˆ›æ–°ã€‚åŒºå—é“¾æŠ€æœ¯ä½œä¸ºäº’è”ç½‘ä¼ é€’â€œä¿¡ä»»â€å’Œä»·å€¼çš„è§£å†³æ–¹æ¡ˆï¼Œæœ¬èº«ä¹Ÿæœ‰å…¶ç›¸åº”çš„ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ã€‚ç”±äºŽåŒºå—é“¾åŸºäºŽ P2P ç½‘ç»œï¼Œè¦æ±‚å…¨ç½‘èŠ‚ç‚¹ä¿å­˜åŒä¸€ä»½æ•°æ®ï¼Œä»¥æ•ˆçŽ‡æ¥æ¢å–å®‰å…¨æ€§ï¼ˆæ‰§è¡Œå¤§é‡çš„æœ¬è´¨ä¸Šæ¯«æ— æ„ä¹‰çš„è®¡ç®—ï¼Œæµªè´¹å¤§é‡çš„ç”µåŠ›ï¼‰ï¼Œå› æ­¤å¯¹æ•ˆçŽ‡è¦æ±‚å¾ˆé«˜çš„åœºæ™¯å¹¶ä¸é€‚åˆåŒºå—é“¾æŠ€æœ¯ã€‚ ä»¥å¤ªåŠ ä»¥å¤ªåŠï¼ˆè‹±è¯­ï¼šEthereumï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„æœ‰æ™ºèƒ½åˆçº¦åŠŸèƒ½çš„å…¬å…±åŒºå—é“¾å¹³å°ã€‚é€šè¿‡å…¶ä¸“ç”¨åŠ å¯†è´§å¸ä»¥å¤ªå¸ï¼ˆ Ether ï¼Œåˆç§°â€œä»¥å¤ªå¸â€ï¼‰æä¾›åŽ»ä¸­å¿ƒåŒ–çš„è™šæ‹Ÿæœºï¼ˆç§°ä¸ºâ€œä»¥å¤ªè™šæ‹Ÿæœºâ€ Ethereum Virtual Machine ï¼‰æ¥å¤„ç†ç‚¹å¯¹ç‚¹åˆçº¦ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œä»¥å¤ªåŠå°±æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨åŒºå—é“¾æŠ€æœ¯ä¹‹ä¸Šçš„æ”¯æŒåŽ»ä¸­å¿ƒåŒ–åº”ç”¨å¼€å‘çš„åŸºç¡€å¹³å°ã€‚ä»¥å¤ªåŠä¸ŽåŽ»ä¸­å¿ƒåŒ– App ä¹‹é—´çš„å…³ç³»ç›¸å½“äºŽæ“ä½œç³»ç»Ÿä¸Žè¿è¡Œåœ¨è¯¥æ“ä½œç³»ç»Ÿä¹‹ä¸Š App ä¹‹é—´çš„å…³ç³»ã€‚ åœ¨ä»¥å¤ªåŠå‡ºçŽ°ä¹‹å‰ï¼ŒåŒºå—é“¾åº”ç”¨æ˜¯è¿™æ ·çŽ©çš„ï¼šæ‹·è´ä¸€ä»½æ¯”ç‰¹å¸ä»£ç ï¼Œç„¶åŽåŽ»æ”¹åº•å±‚ä»£ç å¦‚åŠ å¯†ç®—æ³•ï¼Œå…±è¯†æœºåˆ¶ï¼Œç½‘ç»œåè®®ç­‰ç­‰ï¼ˆå¾ˆå¤šå±±å¯¨å¸å°±æ˜¯è¿™æ ·è¯žç”Ÿçš„ï¼Œæ”¹æ”¹å°±å‡ºæ¥ä¸€ä¸ªæ–°å¸ï¼Œç„¶åŽåŽ» ICO å‰²éŸ­èœï¼Œä¿—ç§°â€œç©ºæ°”å¸â€ï¼‰ã€‚ä»¥å¤ªåŠå¹³å°å¯¹åº•å±‚åŒºå—é“¾æŠ€æœ¯è¿›è¡Œäº†å°è£…ï¼Œè®©åŒºå—é“¾åº”ç”¨å¼€å‘è€…å¯ä»¥ç›´æŽ¥åŸºäºŽä»¥å¤ªåŠå¹³å°è¿›è¡Œå¼€å‘ï¼Œå¼€å‘è€…åªè¦ä¸“æ³¨äºŽåº”ç”¨æœ¬èº«çš„å¼€å‘ï¼Œä»Žè€Œå¤§å¤§é™ä½Žäº†éš¾åº¦ã€‚ ä¸‹é¢æ‰’ä¸€æ‰’ä»¥å¤ªåŠçš„åˆ›å§‹äººã€‚ä»¥å¤ªåŠæœ€åˆç”± Vitalik Buterin åœ¨ 2013 å¹´æå‡ºï¼ŒVitalik Buterin ä½•è®¸äººä¹Ÿï¼Œä¸šå†…ç§°ä¹‹ä¸º V ç¥žï¼Œ1994 å¹´ç”ŸäºŽä¿„ç½—æ–¯ï¼Œé»‘å®¢èƒŒæ™¯ã€‚ 17 å²å¼€å§‹ç ”ç©¶æ¯”ç‰¹å¸ï¼Œåˆ›ã€Šæ¯”ç‰¹å¸æ‚å¿—ã€‹ï¼› 19 å²è‡ªåŠ æ‹¿å¤§æ»‘é“å¢å¤§å­¦ä¼‘å­¦ï¼Œå¹¶åœ¨è¯¥å¹´ 11 æœˆï¼Œå…¬å¸ƒã€Šä»¥å¤ªåŠç™½çš®ä¹¦ã€‹åˆç‰ˆï¼Œå¼€å§‹å‹Ÿé›†å¼€å‘è€…ï¼› 20 å²èŽ·å¾—æå°”å¥–å­¦é‡‘ã€æˆç«‹éžè¥åˆ©ç»„ç»‡ä»¥å¤ªåŠåŸºé‡‘ä¼šï¼Œåœ¨è¿ˆé˜¿å¯†çš„æ¯”ç‰¹å¸ä¼šè®®å…¬å¼€å‘è¡¨ä»¥å¤ªåŠè®¡ç”»ï¼Œè¯¥å¹´ 7 æœˆï¼Œå¯åŠ¨ä»¥å¤ªåŠè®¡ç”»ä¼—å”®å‹Ÿèµ„ï¼Œå‹Ÿå¾— 3.1 ä¸‡æžšæ¯”ç‰¹å¸ï¼ˆå½“æ—¶çº¦åˆ 1840 ä¸‡ç¾Žå…ƒï¼‰ï¼› 21 å²ä»¥å¤ªåŠæœ€åˆç‰ˆæœ¬ Frontier é—®ä¸–ã€ä»¥å¤ªå¸å¼€å§‹åœ¨ä¸–ç•Œå„åœ°äº¤æ˜“æ‰€å…¬å¼€äº¤æ˜“ï¼› 22 å²è¢«ã€Šè´¢æ˜Ÿã€‹æ‚å¿—è¯„é€‰ä¸º 2016 å¹´ 40 å²ä»¥ä¸‹çš„ 40 å¤§æ°å‡ºäººç‰©ã€‚ æ­å»ºç§æœ‰é“¾å®‰è£…ä»¥å¤ªåŠå®¢æˆ·ç«¯ ç§»æ­¥https://github.com/ethereum/mist/releases ä¸‹è½½å¯¹åº”æ“ä½œç³»ç»Ÿçš„ä»¥å¤ªåŠé’±åŒ…å’Œ Mistï¼ˆåŽ»ä¸­å¿ƒåŒ–åº”ç”¨æµè§ˆå™¨ï¼‰ã€‚ ä»¥å¤ªåŠé’±åŒ…å¯åŠ¨åŽä¼šè‡ªåŠ¨ä¸‹è½½ä»¥å¤ªåŠå‘½ä»¤è¡Œå®¢æˆ·ç«¯ Geth ï¼ŒGeth ç›®å‰ä½¿ç”¨éžå¸¸å¹¿æ³›ï¼ŒåŸºäºŽ GO è¯­è¨€å¼€å‘ã€‚å®‰è£…åŽçš„è·¯å¾„ C:\Users\haohao\AppData\Roaming\Ethereum Wallet\binaries\Geth\unpacked ï¼Œå°†è¯¥è·¯å¾„é…ç½®ä¸ºçŽ¯å¢ƒå˜é‡ï¼ˆæ³¨æ„è‹±æ–‡åˆ†å·ï¼‰ã€‚å¯ä»¥é€šè¿‡ geth --help æŸ¥çœ‹ Geth æ˜¯å¦å®‰è£…æˆåŠŸã€‚ å®šä¹‰åˆ›ä¸–åŒºå—åŒºå—é“¾çš„ç¬¬ä¸€ä¸ªåŒºå—ç§°ä¸ºåˆ›ä¸–åŒºå—ï¼Œå®ƒæ˜¯åŒºå—é“¾é‡Œé¢æ‰€æœ‰åŒºå—çš„å…±åŒç¥–å…ˆï¼Œè¿™æ„å‘³ç€ä½ ä»Žä»»ä¸€åŒºå—ï¼Œå¾ªé“¾å‘åŽå›žæº¯ï¼Œæœ€ç»ˆéƒ½å°†åˆ°è¾¾åˆ›ä¸–åŒºå—ã€‚ä»¥å¤ªåŠæ”¯æŒè‡ªå®šä¹‰åˆ›ä¸–åŒºå—ï¼Œè¦è¿è¡Œç§æœ‰é“¾ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰è‡ªå·±çš„åˆ›ä¸–åŒºå—ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ª JSON æ–‡ä»¶è¡¨ç¤ºåˆ›ä¸–åŒºå—çš„ä¿¡æ¯ã€‚ åœ¨ C ç›˜åˆ›å»ºç›®å½• C:\MyChains\T1 ï¼Œè¯¥ç›®å½•ä¸»è¦ç”¨äºŽå­˜å‚¨ç§æœ‰é“¾æ•°æ®ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º MyGenesis.json æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ï¼š 1234567891011121314151617&#123; "config": &#123; "chainId": 2048, "homesteadBlock": 0, "eip155Block": 0, "eip158Block": 0 &#125;, "alloc" : &#123;&#125;, "coinbase" : "0x0000000000000000000000000000000000000000", "difficulty" : "0x10", "extraData" : "", "gasLimit" : "0x222222", "nonce" : "0x000000000000001", "mixhash" : "0x0000000000000000000000000000000000000000000000000000000000000000", "parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000", "timestamp" : "0x00"&#125; åˆå§‹åŒ–åŒºå—é“¾å‘½ä»¤è¡Œåœ¨ C:\MyChains\T1 è·¯å¾„ä¸‹ï¼Œå…³é—­ä»¥å¤ªåŠé’±åŒ…å’Œ Mist ï¼Œåˆå§‹åŒ–åŒºå—é“¾æ‰§è¡Œå‘½ä»¤ï¼š 1geth --identity "dev" --rpc --rpccorsdomain "*" --datadir "C:\MyChains\T1" --rpcapi "db,eth,net,web3" --networkid 100 init "./MyGenesis.json" æ‰§è¡ŒæˆåŠŸåŽæ˜¾ç¤ºï¼š å¯åŠ¨ç§æœ‰é“¾å‘½ä»¤è¡Œåœ¨ C:\MyChains\T1 è·¯å¾„ä¸‹ï¼Œå…³é—­ä»¥å¤ªåŠé’±åŒ…å’Œ Mist ï¼Œå¯åŠ¨ç§æœ‰é“¾æ‰§è¡Œå‘½ä»¤ï¼š 1geth --datadir "C:\MyChains\T1" --identity "dev" --rpccorsdomain "*" --networkid 100 console æ‰§è¡ŒæˆåŠŸåŽæ˜¾ç¤ºï¼š åˆ›å»ºä»¥å¤ªåŠè´¦æˆ·ç§æœ‰é“¾å¯åŠ¨æˆåŠŸåŽï¼Œä¾¿ä¼šè¿›å…¥ä»¥å¤ªåŠ Geth Console æŽ§åˆ¶å°ï¼Œä»¥ &gt; ç¬¦å·å¼€å§‹ã€‚æŸ¥çœ‹ç§æœ‰é“¾ä¸Šçš„è´¦æˆ·ï¼ˆç›®å‰è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•è´¦æˆ·ï¼‰ã€‚ 12&gt; eth.accounts[] é€šè¿‡ personal.newAccount() æŒ‡ä»¤ï¼ˆè¾“å…¥ä¸¤æ¬¡å¯†ç ï¼‰åˆ›å»º 2 ä¸ªæ–°è´¦æˆ·ã€‚ æŸ¥çœ‹è´¦æˆ·ä½™é¢(ç›®å‰ä¸¤ä¸ªè´¦æˆ·ä½™é¢å‡ä¸º 0 )ï¼š 1234&gt; eth.getBalance(eth.accounts[0])0&gt; eth.getBalance(eth.accounts[1])0 è¦ä½¿è´¦æˆ·æœ‰ä½™é¢ï¼Œå¯ä»¥é€šè¿‡è½¬è´¦æˆ–è€…æŒ–çŸ¿æ¥èŽ·å–ä»¥å¤ªå¸ï¼ˆETHï¼‰ã€‚ æŒ–çŸ¿ä»¥å¤ªåŠé€šè¿‡å‘½ä»¤ miner.start([çº¿ç¨‹æ•°]) æ¥å¯åŠ¨æŒ–çŸ¿ï¼Œè¿™é‡Œå¯åŠ¨ 5 ä¸ªçº¿ç¨‹è¿›è¡ŒæŒ–çŸ¿ï¼š å½“ percentage=100 åŽï¼Œé€šè¿‡å‘½ä»¤ miner.stop() ç»ˆæ­¢æŒ–çŸ¿ã€‚åœæ­¢æŒ–çŸ¿åŽï¼ŒæŸ¥çœ‹è´¦æˆ·ä½™é¢ï¼š PS: getBalance() è¿”å›žå€¼çš„å•ä½æ˜¯ wei ï¼Œ wei æ˜¯ä»¥å¤ªå¸çš„æœ€å°å•ä½ï¼Œ1 ä¸ªä»¥å¤ªå¸ = 10 çš„ 18 æ¬¡æ–¹ä¸ª wei ã€‚æŸ¥çœ‹è´¦æˆ·æœ‰å¤šå°‘ä¸ªä»¥å¤ªå¸ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ web3.fromWei() å°† wei æ¢ç®—æˆä»¥å¤ªå¸ã€‚ è½¬è´¦ç›®å‰æˆ‘ä»¬æœ‰ä¸¤ä¸ªè´¦æˆ·ï¼Œè´¦æˆ· 0 æœ‰ 105 ä¸ªä»¥å¤ªå¸ï¼Œ è´¦æˆ· 1 æœ‰ 0 ä¸ªä»¥å¤ªå¸ã€‚çŽ°åœ¨é€šè¿‡æ“ä½œè´¦æˆ· 0 å‘è´¦æˆ· 1 è½¬ 10 ä¸ªä»¥å¤ªå¸ã€‚ é¦–å…ˆé€šè¿‡è´¦æˆ· 0 çš„å¯†ç å¯¹è´¦æˆ· 0 è¿›è¡Œè§£é”ï¼š 1234&gt; personal.unlockAccount(eth.accounts[0])Unlock account 0x33213084015dab454fee16eb369fa2a8e6e65eeePassphrase:true æ“ä½œè´¦æˆ· 0 å‘è´¦æˆ· 1 è½¬ 10 ä¸ªä»¥å¤ªå¸: 123456&gt; count = web3.toWei(10,'ether')"10000000000000000000"&gt; eth.sendTransaction(&#123;from:eth.accounts[0],to:eth.accounts[1],value:count&#125;)INFO [10-02|21:28:11.870] Setting new local account address=0x33213084015DAB454fEe16eb369FA2a8E6E65eEEINFO [10-02|21:28:11.885] Submitted transaction fullhash=0xa7adb20cd2665d888b64bbccbf29ad5a5a1feb461ffb940"0xa7adb20cd2665d888b64bbccbf29ad5a5a1feb461ffb9407447c8dc608886a7e" äº¤æ˜“å‘é€åŽï¼ŒæŸ¥çœ‹è´¦æˆ· 1 çš„ä½™é¢ï¼Œå‘çŽ°è¿˜æ˜¯ 0 ã€‚ 1234567&gt; eth.getBalance(eth.accounts[1])0&gt; txpool.status&#123; pending: 1, queued: 0&#125; è´¦æˆ· 0 è½¬ç»™è´¦æˆ· 1 çš„ä»¥å¤ªå¸è¿˜æœªåˆ°è´¦ï¼Œé€šè¿‡ txpool.status å‘½ä»¤æŸ¥çœ‹ï¼Œæœ‰ä¸€ç¬”äº¤æ˜“æœªå¤„ç†ï¼Œpending å­—æ®µè¡¨ç¤ºäº¤æ˜“å·²æäº¤ä½†è¿˜æœªè¢«å¤„ç†çš„äº¤æ˜“ã€‚ä¸ºä»€ä¹ˆäº¤æ˜“æœªè¢«å¤„ç†å‘¢ï¼Ÿå› ä¸ºå½“å‰é“¾ä¸Šæ²¡æœ‰çŸ¿å·¥åœ¨æŒ–çŸ¿ï¼Œå³è¯¥åŒºå—é“¾æ²¡æœ‰ç®—åŠ›æ¥å¤„ç†äº¤æ˜“ã€‚é€šè¿‡å‘½ä»¤ miner.start(1);admin.sleepBlocks(1);miner.stop(); å¯åŠ¨æŒ–çŸ¿ï¼Œå¹¶åœ¨æŒ–åˆ°ä¸€ä¸ªåŒºå—åŽåœæ­¢æŒ–çŸ¿ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114&gt; miner.start(1);admin.sleepBlocks(1);miner.stop();INFO [10-02|21:29:01.378] Updated mining threads threads=1INFO [10-02|21:29:01.390] Transaction pool price threshold updated price=1000000000INFO [10-02|21:29:01.396] Commit new mining work number=22 sealhash=ee23d4â€¦78362e uncles=0 txs=0INFO [10-02|21:29:01.434] Commit new mining work number=22 sealhash=3ca4ddâ€¦c456e1 uncles=0 txs=1INFO [10-02|21:29:04.772] Generating DAG in progress epoch=1 percentage=0 elapsed=2.123sINFO [10-02|21:29:06.896] Generating DAG in progress epoch=1 percentage=1 elapsed=4.246sINFO [10-02|21:29:08.924] Generating DAG in progress epoch=1 percentage=2 elapsed=6.274sINFO [10-02|21:29:10.851] Generating DAG in progress epoch=1 percentage=3 elapsed=8.201sINFO [10-02|21:29:12.717] Successfully sealed new block number=22 sealhash=3ca4ddâ€¦c456e1 hash=0d293aâ€¦fINFO [10-02|21:29:12.881] ðŸ”¨ mined potential block number=22 hash=0d293aâ€¦fa74a1INFO [10-02|21:29:12.892] Commit new mining work number=23 sealhash=e1b40bâ€¦1b3631 uncles=0 txs=0INFO [10-02|21:29:13.023] Generating DAG in progress epoch=1 percentage=4 elapsed=10.373snull&gt; INFO [10-02|21:29:14.682] Generating DAG in progress epoch=1 percentage=5 elapsed=12.032sINFO [10-02|21:29:16.528] Generating DAG in progress epoch=1 percentage=6 elapsed=13.878sINFO [10-02|21:29:18.519] Generating DAG in progress epoch=1 percentage=7 elapsed=15.869sINFO [10-02|21:29:20.207] Generating DAG in progress epoch=1 percentage=8 elapsed=17.558sINFO [10-02|21:29:22.042] Generating DAG in progress epoch=1 percentage=9 elapsed=19.393sINFO [10-02|21:29:23.899] Generating DAG in progress epoch=1 percentage=10 elapsed=21.249sINFO [10-02|21:29:25.817] Generating DAG in progress epoch=1 percentage=11 elapsed=23.167sINFO [10-02|21:29:27.605] Generating DAG in progress epoch=1 percentage=12 elapsed=24.955sINFO [10-02|21:29:29.529] Generating DAG in progress epoch=1 percentage=13 elapsed=26.879sINFO [10-02|21:29:31.255] Generating DAG in progress epoch=1 percentage=14 elapsed=28.605sINFO [10-02|21:29:33.227] Generating DAG in progress epoch=1 percentage=15 elapsed=30.577sINFO [10-02|21:29:35.041] Generating DAG in progress epoch=1 percentage=16 elapsed=32.391sINFO [10-02|21:29:36.542] Generating DAG in progress epoch=1 percentage=17 elapsed=33.892sINFO [10-02|21:29:38.093] Generating DAG in progress epoch=1 percentage=18 elapsed=35.444sINFO [10-02|21:29:39.928] Generating DAG in progress epoch=1 percentage=19 elapsed=37.279sINFO [10-02|21:29:41.835] Generating DAG in progress epoch=1 percentage=20 elapsed=39.185sINFO [10-02|21:29:43.817] Generating DAG in progress epoch=1 percentage=21 elapsed=41.167sINFO [10-02|21:29:45.506] Generating DAG in progress epoch=1 percentage=22 elapsed=42.856sINFO [10-02|21:29:47.383] Generating DAG in progress epoch=1 percentage=23 elapsed=44.733sINFO [10-02|21:29:49.006] Generating DAG in progress epoch=1 percentage=24 elapsed=46.356sINFO [10-02|21:29:51.061] Generating DAG in progress epoch=1 percentage=25 elapsed=48.411sINFO [10-02|21:29:52.928] Generating DAG in progress epoch=1 percentage=26 elapsed=50.278sINFO [10-02|21:29:54.690] Generating DAG in progress epoch=1 percentage=27 elapsed=52.040sINFO [10-02|21:29:56.612] Generating DAG in progress epoch=1 percentage=28 elapsed=53.963sINFO [10-02|21:29:58.547] Generating DAG in progress epoch=1 percentage=29 elapsed=55.897sINFO [10-02|21:30:00.662] Generating DAG in progress epoch=1 percentage=30 elapsed=58.012sINFO [10-02|21:30:02.853] Generating DAG in progress epoch=1 percentage=31 elapsed=1m0.203sINFO [10-02|21:30:04.967] Generating DAG in progress epoch=1 percentage=32 elapsed=1m2.317sINFO [10-02|21:30:07.100] Generating DAG in progress epoch=1 percentage=33 elapsed=1m4.450sINFO [10-02|21:30:09.305] Generating DAG in progress epoch=1 percentage=34 elapsed=1m6.655sINFO [10-02|21:30:12.027] Generating DAG in progress epoch=1 percentage=35 elapsed=1m9.377sINFO [10-02|21:30:15.647] Generating DAG in progress epoch=1 percentage=36 elapsed=1m12.997sINFO [10-02|21:30:18.841] Generating DAG in progress epoch=1 percentage=37 elapsed=1m16.191sINFO [10-02|21:30:21.048] Generating DAG in progress epoch=1 percentage=38 elapsed=1m18.398sINFO [10-02|21:30:22.907] Generating DAG in progress epoch=1 percentage=39 elapsed=1m20.257sINFO [10-02|21:30:25.220] Generating DAG in progress epoch=1 percentage=40 elapsed=1m22.570sERROR[10-02|21:30:25.367] The pipe is being closed.INFO [10-02|21:30:27.847] Generating DAG in progress epoch=1 percentage=41 elapsed=1m25.197sINFO [10-02|21:30:30.042] Generating DAG in progress epoch=1 percentage=42 elapsed=1m27.392sINFO [10-02|21:30:32.096] Generating DAG in progress epoch=1 percentage=43 elapsed=1m29.447sINFO [10-02|21:30:34.722] Generating DAG in progress epoch=1 percentage=44 elapsed=1m32.072sINFO [10-02|21:30:36.573] Generating DAG in progress epoch=1 percentage=45 elapsed=1m33.923sINFO [10-02|21:30:38.233] Generating DAG in progress epoch=1 percentage=46 elapsed=1m35.583sINFO [10-02|21:30:40.176] Generating DAG in progress epoch=1 percentage=47 elapsed=1m37.526sINFO [10-02|21:30:41.973] Generating DAG in progress epoch=1 percentage=48 elapsed=1m39.323sINFO [10-02|21:30:43.541] Generating DAG in progress epoch=1 percentage=49 elapsed=1m40.891sERROR[10-02|21:30:45.251] The pipe is being closed.INFO [10-02|21:30:45.603] Generating DAG in progress epoch=1 percentage=50 elapsed=1m42.953sINFO [10-02|21:30:47.923] Generating DAG in progress epoch=1 percentage=51 elapsed=1m45.274sINFO [10-02|21:30:49.805] Generating DAG in progress epoch=1 percentage=52 elapsed=1m47.156sINFO [10-02|21:30:51.919] Generating DAG in progress epoch=1 percentage=53 elapsed=1m49.269sINFO [10-02|21:30:53.608] Generating DAG in progress epoch=1 percentage=54 elapsed=1m50.958sINFO [10-02|21:30:55.495] Generating DAG in progress epoch=1 percentage=55 elapsed=1m52.845sINFO [10-02|21:30:57.525] Generating DAG in progress epoch=1 percentage=56 elapsed=1m54.875sINFO [10-02|21:30:59.282] Generating DAG in progress epoch=1 percentage=57 elapsed=1m56.632sINFO [10-02|21:31:01.103] Generating DAG in progress epoch=1 percentage=58 elapsed=1m58.453sINFO [10-02|21:31:02.786] Generating DAG in progress epoch=1 percentage=59 elapsed=2m0.136sINFO [10-02|21:31:04.432] Generating DAG in progress epoch=1 percentage=60 elapsed=2m1.782sINFO [10-02|21:31:06.310] Generating DAG in progress epoch=1 percentage=61 elapsed=2m3.661sINFO [10-02|21:31:08.257] Generating DAG in progress epoch=1 percentage=62 elapsed=2m5.607sINFO [10-02|21:31:10.020] Generating DAG in progress epoch=1 percentage=63 elapsed=2m7.370sINFO [10-02|21:31:11.977] Generating DAG in progress epoch=1 percentage=64 elapsed=2m9.327sINFO [10-02|21:31:13.658] Generating DAG in progress epoch=1 percentage=65 elapsed=2m11.008sINFO [10-02|21:31:15.305] Generating DAG in progress epoch=1 percentage=66 elapsed=2m12.655sINFO [10-02|21:31:17.153] Generating DAG in progress epoch=1 percentage=67 elapsed=2m14.503sINFO [10-02|21:31:19.010] Generating DAG in progress epoch=1 percentage=68 elapsed=2m16.360sINFO [10-02|21:31:20.714] Generating DAG in progress epoch=1 percentage=69 elapsed=2m18.064sINFO [10-02|21:31:22.771] Generating DAG in progress epoch=1 percentage=70 elapsed=2m20.122sINFO [10-02|21:31:24.663] Generating DAG in progress epoch=1 percentage=71 elapsed=2m22.014sINFO [10-02|21:31:26.595] Generating DAG in progress epoch=1 percentage=72 elapsed=2m23.945sINFO [10-02|21:31:28.383] Generating DAG in progress epoch=1 percentage=73 elapsed=2m25.733sINFO [10-02|21:31:30.136] Generating DAG in progress epoch=1 percentage=74 elapsed=2m27.486sINFO [10-02|21:31:31.953] Generating DAG in progress epoch=1 percentage=75 elapsed=2m29.303sINFO [10-02|21:31:33.914] Generating DAG in progress epoch=1 percentage=76 elapsed=2m31.264sINFO [10-02|21:31:35.726] Generating DAG in progress epoch=1 percentage=77 elapsed=2m33.076sINFO [10-02|21:31:37.357] Generating DAG in progress epoch=1 percentage=78 elapsed=2m34.707sINFO [10-02|21:31:39.145] Generating DAG in progress epoch=1 percentage=79 elapsed=2m36.495sINFO [10-02|21:31:40.857] Generating DAG in progress epoch=1 percentage=80 elapsed=2m38.208sINFO [10-02|21:31:42.481] Generating DAG in progress epoch=1 percentage=81 elapsed=2m39.832sINFO [10-02|21:31:44.210] Generating DAG in progress epoch=1 percentage=82 elapsed=2m41.560sINFO [10-02|21:31:46.065] Generating DAG in progress epoch=1 percentage=83 elapsed=2m43.415sINFO [10-02|21:31:48.009] Generating DAG in progress epoch=1 percentage=84 elapsed=2m45.359sINFO [10-02|21:31:49.535] Generating DAG in progress epoch=1 percentage=85 elapsed=2m46.885sINFO [10-02|21:31:51.370] Generating DAG in progress epoch=1 percentage=86 elapsed=2m48.720sINFO [10-02|21:31:53.217] Generating DAG in progress epoch=1 percentage=87 elapsed=2m50.567sINFO [10-02|21:31:55.001] Generating DAG in progress epoch=1 percentage=88 elapsed=2m52.351sINFO [10-02|21:31:56.863] Generating DAG in progress epoch=1 percentage=89 elapsed=2m54.213sINFO [10-02|21:31:58.758] Generating DAG in progress epoch=1 percentage=90 elapsed=2m56.109sINFO [10-02|21:32:01.015] Generating DAG in progress epoch=1 percentage=91 elapsed=2m58.365sINFO [10-02|21:32:02.656] Generating DAG in progress epoch=1 percentage=92 elapsed=3m0.006sINFO [10-02|21:32:04.260] Generating DAG in progress epoch=1 percentage=93 elapsed=3m1.610sINFO [10-02|21:32:06.299] Generating DAG in progress epoch=1 percentage=94 elapsed=3m3.649sINFO [10-02|21:32:08.470] Generating DAG in progress epoch=1 percentage=95 elapsed=3m5.820sINFO [10-02|21:32:10.052] Generating DAG in progress epoch=1 percentage=96 elapsed=3m7.402sINFO [10-02|21:32:12.307] Generating DAG in progress epoch=1 percentage=97 elapsed=3m9.657sINFO [10-02|21:32:15.145] Generating DAG in progress epoch=1 percentage=98 elapsed=3m12.496sINFO [10-02|21:32:19.571] Generating DAG in progress epoch=1 percentage=99 elapsed=3m16.921sINFO [10-02|21:32:19.586] Generated ethash verification cache epoch=1 elapsed=3m16.936s åœ¨æŸ¥çœ‹æœªå¤„ç†çš„äº¤æ˜“æ•°åŠä¸¤ä¸ªè´¦æˆ·çš„ä½™é¢ï¼š 12345678910&gt; stxpool.status&#123; pending: 0, queued: 0&#125;&gt;&gt; web3.fromWei(eth.getBalance(eth.accounts[1]),'ether')10&gt; web3.fromWei(eth.getBalance(eth.accounts[0]),'ether')95 å¯ä»¥çœ‹åˆ°æœªå¤„ç†äº¤æ˜“æ•°ä¸º 0 ï¼Œè´¦æˆ· 0 ä½™é¢ä¸º 10 ä¸ªä»¥å¤ªå¸ã€‚ä¹Ÿå¯ä»¥æ‰“å¼€ä»¥å¤ªåŠé’±åŒ…æˆ– Mist æŸ¥çœ‹è´¦æˆ·åŠä½™é¢ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ¯•ä¸šåŽçš„è¿™åŠå¹´]]></title>
      <url>%2F2018%2F09%2F09%2Fhalf-a-year-after-graduation%2F</url>
      <content type="text"><![CDATA[è¿™åŠå¹´éƒ½åœ¨å¹²å•¥ å·¥ä½œåˆšæ¥å…¬å¸å‡ å¤©ï¼ŒTeam Leader ä¾¿ç»™æˆ‘åˆ†é…äº†ä¸€ä¸ªç‹¬ç«‹å¼€å‘çš„ä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡æœ‰ç›¸å½“ä¸€éƒ¨åˆ†å¯¹æˆ‘æ¥è¯´æ˜¯é™Œç”Ÿçš„é¢†åŸŸã€‚Leader é—®æˆ‘ï¼Œå°ä¼™å­ï¼Œå‡ å¤©å¯ä»¥æžå®šå•Šï¼Ÿç„¶åŽï¼Œå½“æ—¶ä¸çŸ¥é“è‡ªå·±å“ªæ¥çš„è‡ªä¿¡ï¼Œéšå£ä¸€å¥ï¼Œä¸¤å¤©å¯ä»¥æžå®šï¼è¯´å®Œä¹‹åŽå½“æ—¶å°±åŽæ‚”äº†ã€‚è¯´å®žåœ¨è¯ï¼Œè¯„ä¼°å·¥ä½œé‡çš„ç¡®ä¹Ÿæ˜¯ä¸€ç§èƒ½åŠ›ã€‚äº‹å®žè¯æ˜Žæ¬ ç¼ºè¿™ç§èƒ½åŠ›çš„æˆ‘ï¼Œè¢«ç»“ç»“å®žå®žæ‰“è„¸ã€‚è¿™ä¸ªé¡¹ç›®æœ€åŽåŸºæœ¬å®Œæˆç”¨äº†ä¸€å‘¨ï¼ŒJava å±‚å°±æžäº†å¿«ä¸¤å¤©ï¼ŒæœŸé—´é¡¹ç›®ç»ç†æ¯å¤©è¿‡æ¥å‚¬ä¸€ä¸‹ï¼Œé—®ä¸€ä¸‹è¿›åº¦ï¼Œè¯´ä¸€ä¸‹ deadline ï¼Œæžå¾—æˆ‘æ¯å¤©â€œåŽ‹åŠ›å±±å¤§â€ï¼Œä¸€æƒ³åˆ°â€œè¢«æ‰“è„¸â€ï¼Œåˆ†åˆ†é’Ÿæƒ³åˆ‡è…¹ï¼Œå¥½åœ¨ Leader å’Œé¡¹ç›®ç»ç†æœ€åŽéƒ½æ²¡è·Ÿæˆ‘è®¡è¾ƒï¼Œä¼°è®¡ä¹Ÿæ˜¯æ— è¯­å•Šã€‚å“Žï¼Œä»¥åŽé•¿ç‚¹å¿ƒå•Šã€‚ è¿˜æœ‰å°±æ˜¯ï¼Œèº«è¾¹æœ‰å¾ˆæ£’çš„åŒäº‹ã€‚æžç¬¬ä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸Žæˆ‘ä»¬ Team æ— å…³çš„ç®—æ³•å“¥ï¼Œå ç”¨è‡ªå·±çš„å·¥ä½œæ—¶é—´è€å¿ƒè·Ÿæˆ‘åˆ†æžæˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œæ•²ä»£ç ä¸€ä¸ä¸è‹Ÿï¼Œé—®é¢˜å¿…é¡»æ‰¾åˆ° root cause ï¼Œä¸èƒ½é€ƒé¿é—®é¢˜ï¼Œç€å®žç»™æˆ‘ä¸Šäº†ä¸€è¯¾ã€‚ è¿™å‡ ä¸ªæœˆï¼Œå‰å‰åŽåŽä¹Ÿç‹¬ç«‹æžäº†å¥½å‡ ä¸ªé¡¹ç›®ï¼Œå¯¹æœ¬ Team çš„ç›¸å…³ä¸šåŠ¡ä¸Šæ‰‹äº†ï¼Œå¯ä»¥æŒ¤æŒ¤æ—¶é—´æ‰©å±•ä¸€ä¸‹å·¥ä½œä¸­ç”¨åˆ°çš„é™Œç”ŸçŸ¥è¯†é¢†åŸŸï¼Œå¯ä»¥æ‹†æ‹†è½®å­äº†ã€‚ å­¦ä¹ ç¦»å¼€å­¦æ ¡ä¹‹åŽï¼Œå­¦ä¹ çš„å½¢å¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå·¥ä½œä¹‹å¤–çš„å­¦ä¹ ä¸»è¦å‘ç”Ÿåœ¨é€šå‹¤æ—¶é—´ï¼ŒèŠ±é’±è®¢é˜…äº†å¾—åˆ°ã€å–œé©¬æ‹‰é›… FM ç­‰ä¸€äº›ä»˜è´¹ä¸“æ ï¼Œè¿›äº†å‡ ä¸ªå¤§ä½¬çš„çŸ¥è¯†æ˜Ÿçƒï¼Œä¸»è¦çš„è®¢é˜…ç±»åž‹æ˜¯æŠ•èµ„ç†è´¢ï¼ˆè™½ç„¶æ²¡é’±ä¹Ÿåè¦å­¦ï¼‰ã€åŽ†å²ã€å¿ƒç†å­¦ã€ç»æµŽå­¦ã€‚æœ€è¿‘å¬ä¸‹æ¥ï¼Œç¡®å®žæƒ³åæ§½ä¸€ä¸‹éƒ¨åˆ†å¿ƒç†å­¦ä¸“æ ï¼Œä¸ªäººæ„Ÿè§‰æ¯”è¾ƒåžƒåœ¾ï¼Œè®²çš„è§‚ç‚¹åŠä¾‹å­å¤§éƒ¨åˆ†ç¼ºä¹é€»è¾‘å…³è”æ€§å’Œè¯´æœåŠ›ï¼Œå‡ ä¸ªè—¤æ ¡æ¯•ä¸šçš„å–è¿‡ä¸å°‘æ´‹å¢¨æ°´å°±æ•¢è·‘å›žå›½å†…çŸ¥è¯†ä»˜è´¹å¹³å°åœˆé’±ï¼Œè¿˜æœ‰ä¸ªäººæ„Ÿè§‰å¾—åˆ°çš„ 19.9 å…ƒçš„ç²¾å“è¯¾ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åžƒåœ¾ï¼Œå†æ¬¡å°è¯ä¾¿å®œæ²¡å¥½è´§è¿™ç§æœ´ç´ çš„é“ç†ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸å°‘è´¨é‡è¿‡ç¡¬çš„ä»˜è´¹è¯¾ï¼Œæ¯”å¦‚æ–½å±•è€å¸ˆçš„ã€Šä¸­å›½å²çº²äº”åè®²ã€‹ï¼Œè§‚ç‚¹ç‹¬ç‰¹ï¼Œåˆ†æžè§’åº¦å¤šå…ƒï¼Œè¿˜æœ‰åŽ»å¹´å§šå…†ä¸°çš„ç»æµŽå­¦è¯¾ç­‰ã€‚ è¦é—®å¬äº†è¿™äº›ä»˜è´¹è¯¾æœ‰ä»€ä¹ˆæ”¶èŽ·ï¼Ÿä»˜è´¹åªæ˜¯åšä¸€ä¸‹ç­›é€‰ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„æ”¶èŽ·ï¼ˆå¯èƒ½ä¸ªäººé¢†æ‚Ÿèƒ½åŠ›æœ‰é™ï¼‰ï¼Œåªæ˜¯æ»¡è¶³ä¸€ä¸‹å¥½å¥‡å¿ƒå’Œå…´è¶£ï¼Œç¼“è§£ä¸€ä¸‹ç„¦è™‘ï¼ˆä¸ªäººæ„Ÿè§‰çŸ¥è¯†ä»˜è´¹å®žé™…ä¸Šæ˜¯åˆ¶é€ ç„¦è™‘ï¼‰ã€‚ è¿˜æœ‰å°±æ˜¯è®¢é˜…äº†ä¸å°‘è´¨é‡ä¸é”™çš„å…¬å·ï¼Œç¢Žç‰‡åŒ–é˜…è¯»ï¼ŒåŸ¹å…»è‡ªå·±çš„é˜…è¯»ä¹ æƒ¯ï¼Œæ¯•ä¸šåŽï¼Œæ²¡äº†è€ƒè¯•ï¼ŒçŽ°åœ¨å·²ç»æ²¡æœ‰è€å¿ƒå°†ä¸€æœ¬ä¹¦å®Œå®Œæ•´æ•´çš„çœ‹ä¸€éã€‚ç­‰ç­‰ï¼Œç¬‘æ¥å¥½åƒè¯´è¿‡ï¼Œä»–è®¤ä¸ºç¢Žç‰‡åŒ–é˜…è¯»ï¼ˆå­¦ä¹ ï¼‰éƒ½æ˜¯æ‰¯æ·¡ï¼Œä½ è§è¿‡é æ¡ç¡¬å¸æˆä¸ºå¯Œç¿çš„å—ï¼Œäº‘äº‘ã€‚ å®¶åº­åœ¨æ­å·žç”Ÿæ´»çš„è¿™å‡ å¹´ï¼Œè§è¯äº†æˆ¿ä»·å¦‚åç«ç®­èˆ¬ä¸Šæ¶¨ï¼Œæ˜ŽçŸ¥å‰å‡ å¹´ä¸Šè½¦åˆ†åˆ†é’Ÿç¿»å€ï¼Œå¯æ˜¯æ²¡é’±ï¼Œå€Ÿéƒ½å€Ÿä¸åˆ°é‚£ç§ï¼Œä½ è¯´æ°”ä¸æ°”ã€‚æœ€è¿‘ 1 å¹´æˆ¿ä»·é™äº†ï¼Œæˆ¿ç§Ÿæ¶¨äº†èµ·æ¥ï¼Œå†åŠ ä¸Šé‡Žè›®èµ„æœ¬å…¥å±€ï¼Œæœ€è¿‘æžäº†å¥½å‡ ä¸ªçƒ­ç‚¹ã€‚æˆ‘ä»¬çš„æˆ¿ç§Ÿä»Žä¸€å¼€å§‹çš„ 1000 å¤šä¹Ÿåˆ°çŽ°åœ¨çš„ 3000 å¤šï¼Œæ¢æˆä¸¤å±…ä¸»è¦æ˜¯è¦æœ‰å°å®å®äº†ï¼Œå¦å¤–æ­å·žç‰©ä»·ä¹Ÿé«˜çš„ä¸€ç¬”ï¼Œæˆ‘å¦ˆä»Žè€å®¶è¿‡æ¥ï¼Œéƒ½èˆä¸å¾—ä¹°èœã€‚ ä»–æ¥äº†ï¼Œæˆ‘å°±è¦å°½æˆ‘æ‰€èƒ½ç»™ä»–æœ€å¥½çš„ ä¸Šä¸ªæœˆåº•ï¼Œæˆ‘å®¶å°å®å®é™ç”Ÿäº†ã€‚è¾›è‹¦åª³å¦‡å„¿äº†ï¼Œ12 çº§çš„é˜µç—›æŒç»­äº†ä¸€ä¸ªä¸‹åˆï¼Œç–¼åˆ°è‡ªå·±ç²¾ç¥žéƒ½å·²ç»å´©æºƒäº†ï¼Œè¿˜åœ¨ä¸ºå®å®çš„å®‰å…¨æ‹…å¿§ï¼ŒåŠªåŠ›é…åˆåŒ»ç”Ÿã€‚åªæœ‰è¿›äº†äº§æˆ¿ä½ æ‰çŸ¥é“ï¼Œæ¯ä¸€ä¸ªæ¯äº²éƒ½éžå¸¸ä¼Ÿå¤§ã€‚ ä¸€äº›è€å¸ˆæœ‹å‹éƒ½è¯´ï¼Œæˆ‘è¿™ä¸ªå¹´é¾„æ®µæœ‰å°å®å®æœ‰ç‚¹æ—©ï¼ŒæŽ¥ä¸‹æ¥åœ¨è¿™ä¸ªåŸŽå¸‚ç”Ÿæ´»çš„æ‹…å­å¯èƒ½ä¼šæ›´é‡ã€‚æ‰€ä»¥ï¼Œç‰¹åˆ«æ„Ÿæ¿€æˆ‘çš„çˆ¶æ¯å’Œå²³çˆ¶å²³æ¯å¯¹æˆ‘ä»¬çš„æ”¯æŒå’Œå¸®åŠ©ï¼Œå¸®æˆ‘ä»¬åˆ†æ‹…äº†ç”Ÿæ´»çš„åŽ‹åŠ›ã€‚ä»–æ¥äº†ï¼Œæˆ‘å°±è¦å°½æˆ‘æ‰€èƒ½ç»™ä»–æœ€å¥½çš„ï¼Œåœ¨æˆ‘æ‡ˆæ€ çš„æ—¶å€™ï¼Œèº«åŽä¼šå¤šä¸€åŒå°æ‰‹æŽ¨ç€æˆ‘ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ä¸¤ä¸ªå¸¸è§çš„ NDK ç¼–è¯‘é”™è¯¯]]></title>
      <url>%2F2018%2F06%2F16%2FTwo-common-ndk-compilation-errors%2F</url>
      <content type="text"><![CDATA[NDK ç¼–è¯‘ä¸­ç»å¸¸å‡ºçŽ°çš„ä¸¤ä¸ªé—®é¢˜ æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ NDK ç¼–è¯‘ä¸­ç»å¸¸å‡ºçŽ°çš„ä¸¤ä¸ªé—®é¢˜çš„è§£å†³åŠžæ³•ã€‚ å¸¸è§é”™è¯¯ä¸€123error: undefined reference to &apos;omp_set_num_threads&apos;error: undefined reference to &apos;omp_get_num_threads&apos;error: undefined reference to &apos;GOMP_parallel&apos; åŽŸå› ï¼šæœªæä¾›æ”¯æŒ OpenMP OpenMPï¼ˆOpen Multi-Processingï¼‰æ˜¯ç”± OpenMP Architecture Review Board æå‡ºçš„ï¼Œå¹¶å·²è¢«å¹¿æ³›æŽ¥å—çš„ï¼Œç”¨äºŽå…±äº«å†…å­˜å¹¶è¡Œç³»ç»Ÿå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„ä¸€å¥—æŒ‡å¯¼æ€§æ³¨é‡Šã€‚OpenMP æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€åŒ…æ‹¬ C è¯­è¨€ã€C++ ç­‰ã€‚OpenMP æä¾›äº†å¯¹å¹¶è¡Œç®—æ³•çš„é«˜å±‚çš„æŠ½è±¡æè¿°ï¼Œç¨‹åºå‘˜é€šè¿‡åœ¨æºä»£ç ä¸­åŠ å…¥ä¸“ç”¨çš„ pragma æ¥æŒ‡æ˜Žè‡ªå·±çš„æ„å›¾ï¼Œç”±æ­¤ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨å°†ç¨‹åºè¿›è¡Œå¹¶è¡ŒåŒ–ï¼Œå¹¶åœ¨å¿…è¦ä¹‹å¤„åŠ å…¥åŒæ­¥äº’æ–¥ä»¥åŠé€šä¿¡ã€‚å½“é€‰æ‹©å¿½ç•¥è¿™äº› pragma ï¼Œæˆ–è€…ç¼–è¯‘å™¨ä¸æ”¯æŒ OpenMP æ—¶ï¼Œç¨‹åºåˆå¯é€€åŒ–ä¸ºé€šå¸¸çš„ç¨‹åºï¼ˆä¸€èˆ¬ä¸ºä¸²è¡Œï¼‰ï¼Œä»£ç ä»ç„¶å¯ä»¥æ­£å¸¸è¿ä½œï¼Œåªæ˜¯ä¸èƒ½åˆ©ç”¨å¤šçº¿ç¨‹æ¥åŠ é€Ÿç¨‹åºæ‰§è¡Œã€‚ åœ¨ local_ldlibs æ·»åŠ æ”¯æŒ OpenMP1LOCAL_LDLIBS := -llog -fopenmp å¸¸è§é”™è¯¯äºŒ123error: undefined reference to &apos;std::ios_base::Init::Init()&apos;error: undefined reference to &apos;std::ios_base::Init::~Init()&apos;error: undefined reference to &apos;std::__throw_length_error(char const*)&apos; åŽŸå› ï¼šæœªæä¾›æ”¯æŒ GNU STL Android NDK é»˜è®¤æ”¯æŒçš„æ˜¯æœ€å°ç³»ç»Ÿ C++ è¿è¡Œæ—¶åº“ï¼ˆlibstdc++ï¼‰ NDK è¿è¡Œæ—¶åº“ è¯¦ç»†è§ï¼šhttps://developer.android.com/ndk/guides/cpp-support?hl=zh-cn åœ¨ Android.mk æ–‡ä»¶ä¸­è®¾ç½® 123456#STL path and libsGNU_STL_PATH :=$(NDK_ROOT)/sources/cxx-stl/gnu-libstdc++/$(NDK_TOOLCHAIN_VERSION)/libs/$(TARGET_ARCH_ABI)GNU_STL_LIB_NAME :=gnustl_static#link system libs and stlLOCAL_LDLIBS := -llog -L$(GNU_STL_PATH) -l$(GNU_STL_LIB_NAME) åœ¨ Application.mk æ–‡ä»¶ä¸­è®¾ç½®1APP_STL := gnustl_static]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK ç›´æ’­æŽ¨æµä¸Žå¼•æµ]]></title>
      <url>%2F2018%2F02%2F10%2FNDK-live-streaming-push-and-pull%2F</url>
      <content type="text"><![CDATA[æœ€å¥½çš„å¹´ç»ˆå¥–æ˜¯æ‹¥æœ‰éšæ—¶å¯ä»¥è·³æ§½çš„èƒ½åŠ›ã€‚ æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ç›´æ’­æŠ€æœ¯ä¸­æŽ¨æµä¸Žå¼•æµçš„ç®€å•å®žçŽ°ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸Žæ’­æ”¾ NDK FFmpeg ç¼–è¯‘ NDK FFmpeg éŸ³è§†é¢‘è§£ç  NDK ç›´æ’­æµåª’ä½“æœåŠ¡å™¨æ­å»º æµåª’ä½“æœåŠ¡å™¨æµ‹è¯•é¦–å…ˆåˆ©ç”¨å¿«ç›´æ’­ appï¼ˆå…¶ä»–æ”¯æŒ RTMP æŽ¨æµä¸Žå¼•æµçš„ app äº¦å¯ï¼‰å’Œ ffplay.exe å¯¹æµåª’ä½“æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ã€‚ å¿«ç›´æ’­çš„æŽ¨æµç•Œé¢å’Œå¼•æµç•Œé¢ Windows ä¸‹åˆ©ç”¨ ffplay è¿›è¡Œå¼•æµï¼Œå‘½ä»¤è¡Œæ‰§è¡Œï¼š12ffplay rtmp://192.168.0.0/live/test # ip åœ°å€æ¢æˆæµåª’ä½“æœåŠ¡å™¨çš„åœ°å€ï¼Œ test è¡¨ç¤ºç›´æ’­æˆ¿é—´å· æµ‹è¯•ç»“æžœï¼š æŽ¨æµæœ¬æ–‡ç›´æ’­æŽ¨æµæ­¥éª¤ï¼š ä½¿ç”¨ AudioRecord é‡‡é›†éŸ³é¢‘ï¼Œä½¿ç”¨ Camera API é‡‡é›†è§†é¢‘æ•°æ® åˆ†åˆ«ä½¿ç”¨ faac å’Œ xh264 ç¬¬ä¸‰æ–¹åº“åœ¨ Native å±‚å¯¹éŸ³é¢‘å’Œè§†é¢‘è¿›è¡Œç¼–ç  åˆ©ç”¨ rtmp-dump ç¬¬ä¸‰æ–¹åº“è¿›è¡Œæ‰“åŒ…å’ŒæŽ¨æµ å·¥ç¨‹ç›®å½•ï¼š ä¸»è¦çš„ JNI æ–¹æ³•ï¼š123456789101112131415161718192021222324252627282930313233343536373839public class NativePush &#123; public native void startPush(String url); public native void stopPush(); public native void release(); /** * è®¾ç½®è§†é¢‘å‚æ•° * @param width * @param height * @param bitrate * @param fps */ public native void setVideoOptions(int width, int height, int bitrate, int fps); /** * è®¾ç½®éŸ³é¢‘å‚æ•° * @param sampleRateInHz * @param channel */ public native void setAudioOptions(int sampleRateInHz, int channel); /** * å‘é€è§†é¢‘æ•°æ® * @param data */ public native void fireVideo(byte[] data); /** * å‘é€éŸ³é¢‘æ•°æ® * @param data * @param len */ public native void fireAudio(byte[] data, int len);&#125; è§†é¢‘é‡‡é›†è§†é¢‘é‡‡é›†ä¸»è¦åŸºäºŽ Camera ç›¸å…³ API ï¼Œåˆ©ç”¨ SurfaceView è¿›è¡Œé¢„è§ˆï¼Œé€šè¿‡ PreviewCallback èŽ·å–ç›¸æœºé¢„è§ˆæ•°æ®ã€‚ è§†é¢‘é¢„è§ˆä¸»è¦ä»£ç å®žçŽ°ï¼š123456789101112131415161718192021222324252627282930public void startPreview()&#123; try &#123; mCamera = Camera.open(mVideoParams.getCameraId()); Camera.Parameters param = mCamera.getParameters(); List&lt;Camera.Size&gt; previewSizes = param.getSupportedPreviewSizes(); int length = previewSizes.size(); for (int i = 0; i &lt; length; i++) &#123; Log.i(TAG, "SupportedPreviewSizes : " + previewSizes.get(i).width + "x" + previewSizes.get(i).height); &#125; mVideoParams.setWidth(previewSizes.get(0).width); mVideoParams.setHeight(previewSizes.get(0).height); param.setPreviewFormat(ImageFormat.NV21); param.setPreviewSize(mVideoParams.getWidth(), mVideoParams.getHeight()); mCamera.setParameters(param); //mCamera.setDisplayOrientation(90); // ç«–å± mCamera.setPreviewDisplay(mSurfaceHolder); buffer = new byte[mVideoParams.getWidth() * mVideoParams.getHeight() * 4]; mCamera.addCallbackBuffer(buffer); mCamera.setPreviewCallbackWithBuffer(this); mCamera.startPreview(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; åˆ©ç”¨ FrameCallback èŽ·å–é¢„è§ˆæ•°æ®ä¼ å…¥ Native å±‚ï¼Œç„¶åŽè¿›è¡Œç¼–ç ï¼š1234567891011@Overridepublic void onPreviewFrame(byte[] bytes, Camera camera) &#123; if (mCamera != null) &#123; mCamera.addCallbackBuffer(buffer); &#125; if (mIsPushing) &#123; mNativePush.fireVideo(bytes); &#125;&#125; éŸ³é¢‘é‡‡é›†éŸ³é¢‘é‡‡é›†åŸºäºŽ AudioRecord å®žçŽ°ï¼Œåœ¨ä¸€ä¸ªå­çº¿ç¨‹é‡‡é›†éŸ³é¢‘ PCM æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¸æ–­ä¼ å…¥ Native å±‚è¿›è¡Œç¼–ç ã€‚12345678910111213141516private class AudioRecordRunnable implements Runnable &#123; @Override public void run() &#123; mAudioRecord.startRecording(); while (mIsPushing) &#123; //é€šè¿‡AudioRecordä¸æ–­è¯»å–éŸ³é¢‘æ•°æ® byte[] buffer = new byte[mMinBufferSize]; int length = mAudioRecord.read(buffer, 0, buffer.length); if (length &gt; 0) &#123; //ä¼ é€’ç»™ Native ä»£ç ï¼Œè¿›è¡ŒéŸ³é¢‘ç¼–ç  mNativePush.fireAudio(buffer, length); &#125; &#125; &#125;&#125; ç¼–ç å’ŒæŽ¨æµéŸ³è§†é¢‘æ•°æ®ç¼–ç å’ŒæŽ¨æµåœ¨ Native å±‚å®žçŽ°ï¼Œé¦–å…ˆæ·»åŠ  faac ï¼Œ x264 ï¼Œ librtmp ç¬¬ä¸‰æ–¹åº“åˆ° AS å·¥ç¨‹ï¼Œç„¶åŽåˆå§‹åŒ–ç›¸å…³è®¾ç½®ï¼ŒåŸºäºŽç”Ÿäº§è€…ä¸Žæ¶ˆè´¹è€…æ¨¡å¼ï¼Œå°†ç¼–ç åŽçš„éŸ³è§†é¢‘æ•°æ®ï¼Œåœ¨ç”Ÿäº§è€…çº¿ç¨‹ä¸­æ‰“åŒ… RTMPPacket æ”¾å…¥åŒå‘é“¾è¡¨ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ä»Žé“¾è¡¨ä¸­å– RTMPPacket ï¼Œé€šè¿‡ RTMP_SendPacket æ–¹æ³•å‘é€ç»™æœåŠ¡å™¨ã€‚ x264 åˆå§‹åŒ–ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051JNIEXPORT void JNICALLJava_com_haohao_live_jni_NativePush_setVideoOptions(JNIEnv *env, jobject instance, jint width, jint height, jint bitRate, jint fps) &#123; x264_param_t param; //x264_param_default_preset è®¾ç½® x264_param_default_preset(&amp;param, "ultrafast", "zerolatency"); //ç¼–ç è¾“å…¥çš„åƒç´ æ ¼å¼YUV420P param.i_csp = X264_CSP_I420; param.i_width = width; param.i_height = height; y_len = width * height; u_len = y_len / 4; v_len = u_len; //å‚æ•°i_rc_methodè¡¨ç¤ºç çŽ‡æŽ§åˆ¶ï¼ŒCQP(æ’å®šè´¨é‡)ï¼ŒCRF(æ’å®šç çŽ‡)ï¼ŒABR(å¹³å‡ç çŽ‡) //æ’å®šç çŽ‡ï¼Œä¼šå°½é‡æŽ§åˆ¶åœ¨å›ºå®šç çŽ‡ param.rc.i_rc_method = X264_RC_CRF; param.rc.i_bitrate = bitRate / 1000; //* ç çŽ‡(æ¯”ç‰¹çŽ‡,å•ä½Kbps) param.rc.i_vbv_max_bitrate = bitRate / 1000 * 1.2; //çž¬æ—¶æœ€å¤§ç çŽ‡ //ç çŽ‡æŽ§åˆ¶ä¸é€šè¿‡timebaseå’Œtimestampï¼Œè€Œæ˜¯fps param.b_vfr_input = 0; param.i_fps_num = fps; //* å¸§çŽ‡åˆ†å­ param.i_fps_den = 1; //* å¸§çŽ‡åˆ†æ¯ param.i_timebase_den = param.i_fps_num; param.i_timebase_num = param.i_fps_den; param.i_threads = 1;//å¹¶è¡Œç¼–ç çº¿ç¨‹æ•°é‡ï¼Œ0é»˜è®¤ä¸ºå¤šçº¿ç¨‹ //æ˜¯å¦æŠŠSPSå’ŒPPSæ”¾å…¥æ¯ä¸€ä¸ªå…³é”®å¸§ //SPS Sequence Parameter Set åºåˆ—å‚æ•°é›†ï¼ŒPPS Picture Parameter Set å›¾åƒå‚æ•°é›† //ä¸ºäº†æé«˜å›¾åƒçš„çº é”™èƒ½åŠ› param.b_repeat_headers = 1; //è®¾ç½®Levelçº§åˆ« param.i_level_idc = 51; //è®¾ç½®Profileæ¡£æ¬¡ //baselineçº§åˆ«ï¼Œæ²¡æœ‰Bå¸§,åªæœ‰ I å¸§å’Œ P å¸§ x264_param_apply_profile(&amp;param, "baseline"); //x264_picture_tï¼ˆè¾“å…¥å›¾åƒï¼‰åˆå§‹åŒ– x264_picture_alloc(&amp;pic_in, param.i_csp, param.i_width, param.i_height); pic_in.i_pts = 0; //æ‰“å¼€ç¼–ç å™¨ video_encode_handle = x264_encoder_open(&amp;param); if (video_encode_handle) &#123; LOGI("æ‰“å¼€è§†é¢‘ç¼–ç å™¨æˆåŠŸ"); &#125; else &#123; throwNativeError(env, INIT_FAILED); &#125;&#125; faac åˆå§‹åŒ–ï¼š123456789101112131415161718192021222324252627282930JNIEXPORT void JNICALLJava_com_haohao_live_jni_NativePush_setAudioOptions(JNIEnv *env, jobject instance, jint sampleRateInHz, jint channel) &#123; audio_encode_handle = faacEncOpen(sampleRateInHz, channel, &amp;nInputSamples, &amp;nMaxOutputBytes); if (!audio_encode_handle) &#123; LOGE("éŸ³é¢‘ç¼–ç å™¨æ‰“å¼€å¤±è´¥"); return; &#125; //è®¾ç½®éŸ³é¢‘ç¼–ç å‚æ•° faacEncConfigurationPtr p_config = faacEncGetCurrentConfiguration(audio_encode_handle); p_config-&gt;mpegVersion = MPEG4; p_config-&gt;allowMidside = 1; p_config-&gt;aacObjectType = LOW; p_config-&gt;outputFormat = 0; //è¾“å‡ºæ˜¯å¦åŒ…å«ADTSå¤´ p_config-&gt;useTns = 1; //æ—¶åŸŸå™ªéŸ³æŽ§åˆ¶,å¤§æ¦‚å°±æ˜¯æ¶ˆçˆ†éŸ³ p_config-&gt;useLfe = 0;// p_config-&gt;inputFormat = FAAC_INPUT_16BIT; p_config-&gt;quantqual = 100; p_config-&gt;bandWidth = 0; //é¢‘å®½ p_config-&gt;shortctl = SHORTCTL_NORMAL; if (!faacEncSetConfiguration(audio_encode_handle, p_config)) &#123; LOGE("%s", "éŸ³é¢‘ç¼–ç å™¨é…ç½®å¤±è´¥.."); throwNativeError(env, INIT_FAILED); return; &#125; LOGI("%s", "éŸ³é¢‘ç¼–ç å™¨é…ç½®æˆåŠŸ");&#125; å¯¹è§†é¢‘æ•°æ®è¿›è¡Œç¼–ç æ‰“åŒ…ï¼Œé€šè¿‡ add_rtmp_packet æ”¾å…¥é“¾è¡¨ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960JNIEXPORT void JNICALLJava_com_haohao_live_jni_NativePush_fireVideo(JNIEnv *env, jobject instance, jbyteArray buffer_) &#123; //è§†é¢‘æ•°æ®è½¬ä¸ºYUV420P //NV21-&gt;YUV420P jbyte *nv21_buffer = (*env)-&gt;GetByteArrayElements(env, buffer_, NULL); jbyte *u = pic_in.img.plane[1]; jbyte *v = pic_in.img.plane[2]; //nv21 4:2:0 Formats, 12 Bits per Pixel //nv21ä¸Žyuv420pï¼Œyä¸ªæ•°ä¸€è‡´ï¼Œuvä½ç½®å¯¹è°ƒ //nv21è½¬yuv420p y = w*h,u/v=w*h/4 //nv21 = yvu yuv420p=yuv y=y u=y+1+1 v=y+1 //å¦‚æžœè¦è¿›è¡Œå›¾åƒå¤„ç†ï¼ˆç¾Žé¢œï¼‰ï¼Œå¯ä»¥å†è½¬æ¢ä¸ºRGB //è¿˜å¯ä»¥ç»“åˆOpenCVè¯†åˆ«äººè„¸ç­‰ç­‰ memcpy(pic_in.img.plane[0], nv21_buffer, y_len); int i; for (i = 0; i &lt; u_len; i++) &#123; *(u + i) = *(nv21_buffer + y_len + i * 2 + 1); *(v + i) = *(nv21_buffer + y_len + i * 2); &#125; //h264ç¼–ç å¾—åˆ°NALUæ•°ç»„ x264_nal_t *nal = NULL; //NAL int n_nal = -1; //NALUçš„ä¸ªæ•° //è¿›è¡Œh264ç¼–ç  if (x264_encoder_encode(video_encode_handle, &amp;nal, &amp;n_nal, &amp;pic_in, &amp;pic_out) &lt; 0) &#123; LOGE("%s", "ç¼–ç å¤±è´¥"); return; &#125; //ä½¿ç”¨rtmpåè®®å°†h264ç¼–ç çš„è§†é¢‘æ•°æ®å‘é€ç»™æµåª’ä½“æœåŠ¡å™¨ //å¸§åˆ†ä¸ºå…³é”®å¸§å’Œæ™®é€šå¸§ï¼Œä¸ºäº†æé«˜ç”»é¢çš„çº é”™çŽ‡ï¼Œå…³é”®å¸§åº”åŒ…å«SPSå’ŒPPSæ•°æ® int sps_len, pps_len; unsigned char sps[100]; unsigned char pps[100]; memset(sps, 0, 100); memset(pps, 0, 100); pic_in.i_pts += 1; //é¡ºåºç´¯åŠ  //éåŽ†NALUæ•°ç»„ï¼Œæ ¹æ®NALUçš„ç±»åž‹åˆ¤æ–­ for (i = 0; i &lt; n_nal; i++) &#123; if (nal[i].i_type == NAL_SPS) &#123; //å¤åˆ¶SPSæ•°æ®ï¼Œåºåˆ—å‚æ•°é›†(Sequence parameter set) sps_len = nal[i].i_payload - 4; memcpy(sps, nal[i].p_payload + 4, sps_len); //ä¸å¤åˆ¶å››å­—èŠ‚èµ·å§‹ç  &#125; else if (nal[i].i_type == NAL_PPS) &#123; //å¤åˆ¶PPSæ•°æ®ï¼Œå›¾åƒå‚æ•°é›†ï¼ˆPicture parameter setï¼‰ pps_len = nal[i].i_payload - 4; memcpy(pps, nal[i].p_payload + 4, pps_len); //ä¸å¤åˆ¶å››å­—èŠ‚èµ·å§‹ç  //å‘é€åºåˆ—ä¿¡æ¯ //h264å…³é”®å¸§ä¼šåŒ…å«SPSå’ŒPPSæ•°æ® add_264_sequence_header(pps, sps, pps_len, sps_len); &#125; else &#123; //å‘é€å¸§ä¿¡æ¯ add_264_body(nal[i].p_payload, nal[i].i_payload); &#125; &#125; (*env)-&gt;ReleaseByteArrayElements(env, buffer_, nv21_buffer, 0);&#125; åŒæ ·ï¼Œå¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œç¼–ç æ‰“åŒ…æ”¾å…¥é“¾è¡¨ï¼š12345678910111213141516171819202122232425262728293031323334353637JNIEXPORT void JNICALLJava_com_haohao_live_jni_NativePush_fireAudio(JNIEnv *env, jobject instance, jbyteArray buffer_, jint length) &#123; int *pcmbuf; unsigned char *bitbuf; jbyte *b_buffer = (*env)-&gt;GetByteArrayElements(env, buffer_, 0); pcmbuf = (short *) malloc(nInputSamples * sizeof(int)); bitbuf = (unsigned char *) malloc(nMaxOutputBytes * sizeof(unsigned char)); int nByteCount = 0; unsigned int nBufferSize = (unsigned int) length / 2; unsigned short *buf = (unsigned short *) b_buffer; while (nByteCount &lt; nBufferSize) &#123; int audioLength = nInputSamples; if ((nByteCount + nInputSamples) &gt;= nBufferSize) &#123; audioLength = nBufferSize - nByteCount; &#125; int i; for (i = 0; i &lt; audioLength; i++) &#123;//æ¯æ¬¡ä»Žå®žæ—¶çš„pcméŸ³é¢‘é˜Ÿåˆ—ä¸­è¯»å‡ºé‡åŒ–ä½æ•°ä¸º8çš„pcmæ•°æ®ã€‚ int s = ((int16_t *) buf + nByteCount)[i]; pcmbuf[i] = s &lt;&lt; 8;//ç”¨8ä¸ªäºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºä¸€ä¸ªé‡‡æ ·é‡åŒ–ç‚¹ï¼ˆæ¨¡æ•°è½¬æ¢ï¼‰ &#125; nByteCount += nInputSamples; //åˆ©ç”¨FAACè¿›è¡Œç¼–ç ï¼Œpcmbufä¸ºè½¬æ¢åŽçš„pcmæµæ•°æ®ï¼ŒaudioLengthä¸ºè°ƒç”¨faacEncOpenæ—¶å¾—åˆ°çš„è¾“å…¥é‡‡æ ·æ•°ï¼Œbitbufä¸ºç¼–ç åŽçš„æ•°æ®buffï¼ŒnMaxOutputBytesä¸ºè°ƒç”¨faacEncOpenæ—¶å¾—åˆ°çš„æœ€å¤§è¾“å‡ºå­—èŠ‚æ•° int byteslen = faacEncEncode(audio_encode_handle, pcmbuf, audioLength, bitbuf, nMaxOutputBytes); if (byteslen &lt; 1) &#123; continue; &#125; add_aac_body(bitbuf, byteslen);//ä»Žbitbufä¸­å¾—åˆ°ç¼–ç åŽçš„aacæ•°æ®æµï¼Œæ”¾åˆ°æ•°æ®é˜Ÿåˆ— &#125; if (bitbuf) free(bitbuf); if (pcmbuf) free(pcmbuf); (*env)-&gt;ReleaseByteArrayElements(env, buffer_, b_buffer, 0);&#125; æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­ä»Žé“¾è¡¨ä¸­å– RTMPPacket å‘é€ç»™æœåŠ¡å™¨ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364void *push_thread(void *arg) &#123; JNIEnv *env;//èŽ·å–å½“å‰çº¿ç¨‹JNIEnv (*javaVM)-&gt;AttachCurrentThread(javaVM, &amp;env, NULL); //å»ºç«‹RTMPè¿žæŽ¥ RTMP *rtmp = RTMP_Alloc(); if (!rtmp) &#123; LOGE("rtmpåˆå§‹åŒ–å¤±è´¥"); goto end; &#125; RTMP_Init(rtmp); rtmp-&gt;Link.timeout = 5; //è¿žæŽ¥è¶…æ—¶çš„æ—¶é—´ //è®¾ç½®æµåª’ä½“åœ°å€ RTMP_SetupURL(rtmp, rtmp_path); //å‘å¸ƒrtmpæ•°æ®æµ RTMP_EnableWrite(rtmp); //å»ºç«‹è¿žæŽ¥ if (!RTMP_Connect(rtmp, NULL)) &#123; LOGE("%s", "RTMP è¿žæŽ¥å¤±è´¥"); throwNativeError(env, CONNECT_FAILED); goto end; &#125; //è®¡æ—¶ start_time = RTMP_GetTime(); if (!RTMP_ConnectStream(rtmp, 0)) &#123; //è¿žæŽ¥æµ LOGE("%s", "RTMP ConnectStream failed"); throwNativeError(env, CONNECT_FAILED); goto end; &#125; is_pushing = TRUE; //å‘é€AACå¤´ä¿¡æ¯ add_aac_sequence_header(); while (is_pushing) &#123; //å‘é€ pthread_mutex_lock(&amp;mutex); pthread_cond_wait(&amp;cond, &amp;mutex); //å–å‡ºé˜Ÿåˆ—ä¸­çš„RTMPPacket RTMPPacket *packet = queue_get_first(); if (packet) &#123; queue_delete_first(); //ç§»é™¤ packet-&gt;m_nInfoField2 = rtmp-&gt;m_stream_id; //RTMPåè®®ï¼Œstream_idæ•°æ® int i = RTMP_SendPacket(rtmp, packet, TRUE); //TRUEæ”¾å…¥librtmpé˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸æ˜¯ç«‹å³å‘é€ if (!i) &#123; LOGE("RTMP æ–­å¼€"); RTMPPacket_Free(packet); pthread_mutex_unlock(&amp;mutex); goto end; &#125; else &#123; LOGI("%s", "rtmp send packet"); &#125; RTMPPacket_Free(packet); &#125; pthread_mutex_unlock(&amp;mutex); &#125; end: LOGI("%s", "é‡Šæ”¾èµ„æº"); free(rtmp_path); RTMP_Close(rtmp); RTMP_Free(rtmp); (*javaVM)-&gt;DetachCurrentThread(javaVM); return 0;&#125; å¼•æµè¿™é‡Œå¼•æµå°±ä¸åšå±•å¼€è®²ï¼Œå¯ä»¥é€šè¿‡ QLive çš„ SDK æˆ–è€… vitamio ï¼ˆå°æ¥ æ€»ï¼‰ç­‰ç¬¬ä¸‰æ–¹åº“å®žçŽ°ã€‚ åŸºäºŽ vitamio å®žçŽ°å¼•æµï¼š1234567891011121314private void init()&#123; mVideoView = (VideoView) findViewById(R.id.live_player_view); mVideoView.setVideoPath(SPUtils.getInstance(this).getString(SPUtils.KEY_NGINX_SER_URI)); mVideoView.setMediaController(new MediaController(this)); mVideoView.requestFocus(); mVideoView.setOnPreparedListener(new MediaPlayer.OnPreparedListener() &#123; @Override public void onPrepared(MediaPlayer mp) &#123; mp.setPlaybackSpeed(1.0f); &#125; &#125;);&#125; PSï¼šæºç åœ°å€ï¼šhttps://github.com/githubhaohao/NDKLive]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK ç›´æ’­æµåª’ä½“æœåŠ¡å™¨æ­å»º]]></title>
      <url>%2F2018%2F02%2F03%2FNDK-set-up-streaming-media-server%2F</url>
      <content type="text"><![CDATA[æ ‘ç«‹ä¸€ä¸ªè¿œå¤§çš„ç›®æ ‡æ˜¯å¿…è¦çš„ï¼Œç„¶è€Œä»…é ç›®æ ‡åšåŠ¨åŠ›ï¼Œè¿™ç§åŠ¨åŠ›å°±æ˜¯å¼ºè¿«å¼çš„ï¼Œè€Œæœ‰è¿™ç§åŠ¨åŠ›çš„äººéžå¸¸å®¹æ˜“ç„¦è™‘ã€‚ æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹åŸºäºŽ Nginx æ­å»ºä¸€ä¸ªéžå¸¸ç®€å•çš„æµåª’ä½“æœåŠ¡å™¨ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸Žæ’­æ”¾ NDK FFmpeg ç¼–è¯‘ NDK FFmpeg éŸ³è§†é¢‘è§£ç  NginxNginx æ˜¯ç”±ä¿„ç½—æ–¯äºº Igor Sysoev ç¼–å†™çš„è½»é‡çº§ Web æœåŠ¡å™¨ï¼Œå‘éŸ³ä¸º â€œengine xâ€ï¼Œä¹Ÿå¯ç”¨ä½œåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼ŒäºŽ 2004 å¹´å…¬å¼€å‘å¸ƒï¼Œéµå¾ª BSD å¼€æºè®¸å¯ï¼Œå®ƒä»¥é«˜ç¨³å®šæ€§ã€ä¸°å¯Œçš„åŠŸèƒ½ä»¥åŠä½Žç³»ç»Ÿå¼€é”€è€Œå‡ºåã€‚Nginx ä¹Ÿæ˜¯ä¸€ç§æ¨¡å—åŒ–çš„æœåŠ¡å™¨ï¼ŒåŸºäºŽ Nginx å¯ä»¥çµæ´»æ·»åŠ å„ç§åŠŸèƒ½æ¨¡å—ï¼Œå¦‚ HTTP æ¨¡å—ã€WebSocket æ¨¡å—ã€RTMP æ¨¡å—ç­‰ï¼Œä¸åŒæ¨¡å—å ç”¨ä¸åŒçš„ç«¯å£ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œå¦‚æœ¬æ–‡ä¸­è¦ä½¿ç”¨çš„ RTMP æ¨¡å—é»˜è®¤ç«¯å£ä¸º 1935 ã€‚ æœ¬æ–‡ä¸­çš„ Nginx æœåŠ¡å™¨åªæ·»åŠ äº†ä¸€ä¸ª RTMP æ¨¡å—ï¼Œç”¨ä½œä¸€ä¸ªç®€å•çš„æµåª’ä½“æœåŠ¡å™¨ã€‚ RTMP åè®®RTMP ï¼ˆ Real Time Message Protocol ï¼‰åè®®æ˜¯ä¸€ç§å®žæ—¶ä¿¡æ¯ä¼ è¾“åè®®ï¼Œç”± Adobe å…¬å¸å¼€å‘ï¼Œç”¨æ¥è§£å†³å¤šåª’ä½“æ•°æ®ä¼ è¾“æµçš„å¤šè·¯å¤ç”¨ï¼ˆ Multiplexing ï¼‰å’Œåˆ†åŒ…ï¼ˆ packetizing ï¼‰çš„é—®é¢˜ï¼Œå®ƒæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¼ è¾“å±‚é€šå¸¸åŸºäºŽ TCP å®žçŽ°ã€‚RTMP åè®®åœ¨å‰æœŸå¹¶æœªå—åˆ°å¤ªå¤šçš„é‡è§†ï¼Œè¿‘ä¸¤å¹´éšç€ VR ä»¥åŠè§†é¢‘ç›´æ’­é¢†åŸŸçš„ç«çƒ­ï¼ŒRTMP åè®®æ­£é€æ¸æˆä¸ºä¸»æµã€‚ ç›´æ’­æ¡†æž¶ æ­å»ºä¸€ä¸ªç®€æ˜“çš„ç›´æ’­æ¡†æž¶éœ€è¦ä¸‰ä¸ªè§’è‰²ï¼šç›´æ’­ï¼ˆæŽ¨æµï¼‰å®¢æˆ·ç«¯ï¼Œæµåª’ä½“æœåŠ¡å™¨å’Œå¼•æµå®¢æˆ·ç«¯ã€‚ å®‰è£… NginxçŽ¯å¢ƒï¼š Ubuntu 16.04 ï¼Œæ³¨æ„ï¼šè‹¥ä½¿ç”¨é˜¿é‡Œäº‘ä¸»æœºéœ€è¦é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼Œå¼€æ”¾ 80 ã€1935 ç­‰ç«¯å£ã€‚ å®‰è£… nginx å’Œ nginx-rtmp ç¼–è¯‘ä¾èµ–å·¥å…·:1sudo apt-get install build-essential libpcre3 libpcre3-dev libssl-dev å·¥ä½œç›®å½•ï¼š123mkdir nginxchmod +x -R nginx/cd live ä¸‹è½½ nginx å’Œ nginx-rtmp æºç :12wget http://nginx.org/download/nginx-1.8.1.tar.gzwget https://github.com/arut/nginx-rtmp-module/archive/master.zip è§£åŽ‹ï¼š1234# å®‰è£… unzip# sudo apt-get install unziptar -zxvf nginx-1.8.1.tar.gzunzip master.zip æ·»åŠ  rtmp-nginx æ¨¡å—:12cd nginx-1.8.1./configure --with-http_ssl_module --add-module=../nginx-rtmp-module-master ç¼–è¯‘ã€å®‰è£…ï¼š1234# ç¼–è¯‘ nginx æºç make# å®‰è£…sudo make install å¯åŠ¨ Nginx æœåŠ¡ï¼š12sudo service nginx start# sudo service nginx stop åœæ­¢ æ‰“å¼€æµè§ˆå™¨ http://127.0.0.1/ æˆ–è€…è¾“å…¥é˜¿é‡Œäº‘ä¸»æœºçš„å…¬ç½‘ ip : å®‰è£… FFmpegï¼š123sudo apt-get install ffmpeg# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ffmpeg -v é…ç½® nginx æœåŠ¡å™¨ï¼š1234567891011121314151617181920# è¿›å…¥ nginx å®‰è£…ç›®å½•cd /usr/local/nginx# ä¿®æ”¹é…ç½®æ–‡ä»¶ /usr/local/nginx/conf/nginx.conf# åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç rtmp &#123; server &#123; listen 1935; chunk_size 4096; application live &#123; live on; record off; exec ffmpeg -i rtmp://localhost/live/$name -threads 1 -c:v libx264 -profile:v baseline -b:v 350K -s 640x360 -f flv -c:a aac -ac 1 -strict -2 -b:a 56k rtmp://localhost/live360p/$name; &#125; application live360p &#123; live on; record off; &#125; &#125;&#125; é‡å¯ nginx æœåŠ¡å™¨ï¼š1sudo service nginx restart åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€ä¸ªç®€å•çš„æµåª’ä½“æœåŠ¡å™¨æ­å»ºå®Œæˆï¼ŒæŽ¥ä¸‹æ¥å°†å®žçŽ°æœåŠ¡å™¨ä¸Žå®¢æˆ·ç«¯ä¹‹é—´çš„æŽ¨æµå’Œå¼•æµã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK FFmpeg éŸ³è§†é¢‘è§£ç ]]></title>
      <url>%2F2018%2F01%2F24%2FNDK-FFmpeg-video-decoding%2F</url>
      <content type="text"><![CDATA[è¯¸è‘›äº®èº¬è€•éš†ä¸­çš„æ—¶å€™ï¼Œä¸Žå¥½å‹çŸ³å¹¿å…ƒã€å¾åº¶ã€å­Ÿå…¬å¨åœ¨ä¸€èµ·æ±‚å­¦ï¼Œå…¶ä»–ä¸‰äººè¯»ä¹¦éƒ½æ˜¯ä¸€å®šè¦æ»šç“œçƒ‚ç†Ÿï¼Œåªæœ‰è¯¸è‘›äº®åªè§‚å…¶å¤§ç•¥ã€‚ æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ FFmpeg éŸ³è§†é¢‘è§£ç ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸Žæ’­æ”¾ NDK FFmpeg ç¼–è¯‘ å°è£…æ ¼å¼æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„è§†é¢‘æ ¼å¼ï¼Œå¦‚ mp4 ã€ mkv ã€ rmvb ã€flv ç­‰ï¼Œè¡¨ç¤ºçš„æ˜¯éŸ³è§†é¢‘çš„å°è£…æ ¼å¼ï¼Œå°è£…æ ¼å¼å®žè´¨ä¸Šæ˜¯æŠŠéŸ³é¢‘æ•°æ®ã€è§†é¢‘æ•°æ®å’Œå­—å¹•æ•°æ®æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶çš„è§„èŒƒã€‚ä»ŽæŠ€æœ¯çš„è§’åº¦æ¥è®²ï¼Œä¼˜ç§€çš„éŸ³è§†é¢‘å°è£…æ ¼å¼åº”è¯¥æ”¯æŒå¤§å¤šæ•°éŸ³è§†é¢‘ç¼–ç æ ‡å‡†ã€‚ä¸»è¦çš„å°è£…æ ¼å¼: åç§° æœºæž„ æ”¯æŒçš„è§†é¢‘ç¼–ç  æ”¯æŒçš„éŸ³é¢‘ç¼–ç  ä½¿ç”¨é¢†åŸŸ AVI å¾®è½¯ å‡ ä¹Žæ‰€æœ‰æ ¼å¼ å‡ ä¹Žæ‰€æœ‰æ ¼å¼ BT ä¸‹è½½å½±è§† MP4 MPEG MPEG-4 ï¼Œ H.264 ï¼Œ H.263 ç­‰ AAC ï¼Œ MPEG-1 ç­‰ äº’è”ç½‘è§†é¢‘ç½‘ç«™ FLV Adobe VP6 ï¼Œ H.264 MP3 ï¼Œ AAC ç­‰ äº’è”ç½‘è§†é¢‘ç½‘ç«™ MKV CoreCodec å‡ ä¹Žæ‰€æœ‰æ ¼å¼ å‡ ä¹Žæ‰€æœ‰æ ¼å¼ äº’è”ç½‘è§†é¢‘ç½‘ç«™ RMVB Real Networks RealVideo 8 ï¼Œ 9 ï¼Œ 10 AAC ï¼Œ Cook Codec BT ä¸‹è½½å½±è§† ç¼–ç æ ¼å¼ç¼–ç çš„ç›®çš„åœ¨äºŽé€šè¿‡åŽ‹ç¼©ç®—æ³•é™ä½Žæ•°æ®é‡ï¼Œæé«˜æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“æ•ˆçŽ‡ã€‚è§†é¢‘ç¼–ç æ˜¯å°†è§†é¢‘åƒç´ æ•°æ®ï¼ˆ RGB ï¼Œ YUV ç­‰ï¼‰åŽ‹ç¼©æˆä¸ºè§†é¢‘ç æµã€‚éŸ³é¢‘ç¼–ç æ˜¯å°†éŸ³é¢‘é‡‡æ ·æ•°æ®ï¼ˆ PCM ç­‰ï¼‰åŽ‹ç¼©æˆä¸ºéŸ³é¢‘ç æµã€‚ä¸»è¦è§†é¢‘ç¼–ç æ ¼å¼ï¼š åç§° æœºæž„ æŽ¨å‡ºæ—¶é—´ ä½¿ç”¨é¢†åŸŸ H.265 MPEG/ITU-T 2013 ç ”å‘ä¸­ H.264 MPEG/ITU-T 2003 å„ä¸ªé¢†åŸŸ MPEG4 MPEG 2001 å°ä¼— MPEG2 MPEG 1994 æ•°å­—ç”µè§† VP9 Google 2013 ç ”å‘ä¸­ VP8 Google 2008 å°ä¼— ä¸»è¦éŸ³é¢‘ç¼–ç æ ¼å¼ï¼š åç§° æœºæž„ æŽ¨å‡ºæ—¶é—´ ä½¿ç”¨é¢†åŸŸ AAC MPEG 1997 å„ä¸ªé¢†åŸŸ AC-3 Dolby 1992 ç”µå½± MP3 MPEG 1993 æ—©æœŸæ™®åŠ WMV å¾®è½¯ 1999 Windows éŸ³è§†é¢‘è§£ç æµç¨‹ è§£å°è£…æ ¼å¼ã€‚å°†è¾“å…¥çš„æŒ‰ç…§ä¸€å®šæ ¼å¼å°è£…çš„éŸ³è§†é¢‘æ•°æ®ï¼Œåˆ†ç¦»æˆä¸ºéŸ³é¢‘æµåŽ‹ç¼©ç¼–ç æ•°æ®å’Œè§†é¢‘æµåŽ‹ç¼©ç¼–ç æ•°æ®ã€‚ è§£ç ã€‚å°†è§†é¢‘å’ŒéŸ³é¢‘çš„åŽ‹ç¼©ç¼–ç æ•°æ®ï¼Œè§£ç æˆä¸ºéžåŽ‹ç¼©çš„è§†é¢‘å’ŒéŸ³é¢‘åŽŸå§‹æ•°æ®ã€‚è§†é¢‘åŽ‹ç¼©æ•°æ®é€šè¿‡è§£ç è¾“å‡ºä¸ºåƒç´ æ•°æ®ï¼Œå¦‚ YUV420P ã€ RGB ç­‰ï¼›éŸ³é¢‘åŽ‹ç¼©æ•°æ®é€šè¿‡è§£ç è¾“å‡ºä¸ºéžåŽ‹ç¼©çš„éŸ³é¢‘æŠ½æ ·æ•°æ®ï¼Œå¦‚ PCM æ•°æ®ã€‚ éŸ³è§†é¢‘åŒæ­¥ã€‚åŒæ­¥è§£ç å‡ºæ¥çš„è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®ï¼Œå¹¶å°†éŸ³è§†é¢‘æ•°æ®é€è‡³ç³»ç»Ÿçš„å£°å¡å’Œæ˜¾å¡ï¼Œæ’­æ”¾å’Œæ˜¾ç¤ºå‡ºæ¥ã€‚ FFmpeg å‡½æ•°åº“FFmpeg ä¸€èˆ¬æœ‰ 8 ä¸ªå‡½æ•°åº“ï¼Œå„ä¸ªå‡½æ•°åº“çš„åŠŸèƒ½å¦‚ä¸‹ï¼š å‡½æ•°åº“ åŠŸèƒ½ avcodec éŸ³è§†é¢‘ç¼–è§£ç  avdevice å¤šåª’ä½“è®¾å¤‡è¾“å…¥è¾“å‡º avfilter æ»¤é•œç‰¹æ•ˆ avformat å°è£…æ ¼å¼å¤„ç† postproc åŽåŠ å·¥ avutil å·¥å…·åº“ swresample éŸ³é¢‘é‡‡æ ·æ•°æ®æ ¼å¼è½¬æ¢ swscale è§†é¢‘åƒç´ æ•°æ®æ ¼å¼è½¬æ¢ FFmpeg éŸ³è§†é¢‘è§£ç FFmpeg éŸ³è§†é¢‘è§£ç ä¸»è¦æµç¨‹ä»£ç æè¿°ï¼š1234561. av_register_all() //æ³¨å†Œç»„ä»¶2. avformat_alloc_context //èŽ·å–å°è£…æ ¼å¼ä¸Šä¸‹æ–‡3. avformat_find_stream_info //èŽ·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯4. avcodec_find_decoder //èŽ·å–è§£ç å™¨5. avcodec_open2 //æ‰“å¼€è§£ç å™¨6. avcodec_decode_video2 æˆ– avcodec_decode_audio4 //è§£ç éŸ³è§†é¢‘å¸§ åœ¨ AS å·¥ç¨‹ä¸­å¼•å…¥ FFmpeg 8 ä¸ªåŠ¨æ€åº“å’Œ libyuv ï¼ˆè´Ÿè´£è§†é¢‘åƒç´ æ•°æ®æ ¼å¼è½¬æ¢ï¼‰åŠ¨æ€åº“ã€‚å·¥ç¨‹çš„å¤´æ–‡ä»¶ç›®å½•ï¼šå·¥ç¨‹çš„åŠ¨æ€åº“ç›®å½•ï¼š Java å±‚ API ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990package com.haohao.ffmpeg;import android.media.AudioFormat;import android.media.AudioManager;import android.media.AudioTrack;import android.util.Log;import android.view.Surface;/** * author: haohao * time: 2017/12/19 * mail: haohaochang86@gmail.com * desc: AVUtils */public class AVUtils &#123; private static final String TAG = "AVUtils"; private static AVCallback AVCallback; private static AVCallback sAVCallback; public static void registerCallback(AVCallback callback) &#123; sAVCallback = callback; &#125; static &#123; System.loadLibrary("avfilter-5"); System.loadLibrary("avdevice-56"); System.loadLibrary("yuv"); System.loadLibrary("avutil-54"); System.loadLibrary("swresample-1"); System.loadLibrary("avcodec-56"); System.loadLibrary("avformat-56"); System.loadLibrary("swscale-3"); System.loadLibrary("postproc-53"); System.loadLibrary("native-lib"); &#125; /** * è§£ç è§†é¢‘ä¸­çš„è§†é¢‘åŽ‹ç¼©æ•°æ® * @param input_file_path è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ * @param output_file_path è§†é¢‘åŽ‹ç¼©æ•°æ®è§£ç åŽè¾“å‡ºçš„ YUV æ–‡ä»¶è·¯å¾„ */ public static native void videoDecode(String input_file_path, String output_file_path); /** * æ˜¾ç¤ºè§†é¢‘è§†é¢‘è§£ç åŽåƒç´ æ•°æ® * @param input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ * @param surface ç”¨äºŽæ˜¾ç¤ºè§†é¢‘è§†é¢‘è§£ç åŽçš„ RGBA åƒç´ æ•°æ® */ public static native void videoRender(String input, Surface surface); /** * è§£ç è§†é¢‘ä¸­çš„éŸ³é¢‘åŽ‹ç¼©æ•°æ® * @param input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ * @param output éŸ³é¢‘åŽ‹ç¼©æ•°æ®è§£ç åŽè¾“å‡ºçš„ PCM æ–‡ä»¶è·¯å¾„ */ public static native void audioDecode(String input, String output); /** * æ’­æ”¾è§†é¢‘ä¸­çš„éŸ³é¢‘æ•°æ® * @param input è¾“å…¥çš„è§†é¢‘æ–‡ä»¶è·¯å¾„ */ public static native void audioPlay(String input); /** * åˆ›å»ºä¸€ä¸ª AudioTrack å¯¹è±¡ï¼Œç”¨äºŽæ’­æ”¾éŸ³é¢‘,åœ¨ Native å±‚ä¸­è°ƒç”¨ã€‚ */ public static AudioTrack createAudioTrack(int sampleRate, int num_channel) &#123; int audioFormat = AudioFormat.ENCODING_PCM_16BIT; Log.i(TAG, "å£°é“æ•°:" + num_channel); int channelConfig; if (num_channel == 1) &#123; channelConfig = android.media.AudioFormat.CHANNEL_OUT_MONO; &#125; else if (num_channel == 2) &#123; channelConfig = android.media.AudioFormat.CHANNEL_OUT_STEREO; &#125; else &#123; channelConfig = android.media.AudioFormat.CHANNEL_OUT_STEREO; &#125; int bufferSize = AudioTrack.getMinBufferSize(sampleRate, channelConfig, audioFormat); AudioTrack audioTrack = new AudioTrack( AudioManager.STREAM_MUSIC, sampleRate, channelConfig, audioFormat, bufferSize, AudioTrack.MODE_STREAM); return audioTrack; &#125; public interface AVCallback &#123; void onFinish(); &#125;&#125; MySurfaceView.java 12345678910111213141516171819202122232425/** * author: haohao * time: 2017/12/20 * mail: haohaochang86@gmail.com * desc: MySurfaceView */public class MySurfaceView extends SurfaceView &#123; public MySurfaceView(Context context) &#123; super(context); &#125; public MySurfaceView(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125; public MySurfaceView(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(context, attrs, defStyleAttr); &#125; private void init()&#123; // è®¾ç½®åƒç´ ç»˜åˆ¶æ ¼å¼ä¸º RGBA_8888 SurfaceHolder holder = getHolder(); holder.setFormat(PixelFormat.RGBA_8888); &#125;&#125; activity_main.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;FrameLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;com.haohao.ffmpeg.MySurfaceView android:id="@+id/my_surface_view" android:layout_width="match_parent" android:layout_height="match_parent" /&gt; &lt;LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="vertical"&gt; &lt;LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:alpha="0.7" android:orientation="horizontal"&gt; &lt;Button android:id="@+id/video_decode_btn" android:layout_width="0dp" android:layout_weight="1" android:layout_height="wrap_content" android:text="è§†é¢‘è§£ç " /&gt; &lt;Button android:id="@+id/video_render_btn" android:layout_width="0dp" android:layout_weight="1" android:layout_height="wrap_content" android:text="è§†é¢‘æ¸²æŸ“" /&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:alpha="0.7" android:orientation="horizontal"&gt; &lt;Button android:id="@+id/audio_decode_btn" android:layout_width="0dp" android:layout_weight="1" android:layout_height="wrap_content" android:text="éŸ³é¢‘è§£ç " /&gt; &lt;Button android:id="@+id/audio_play_btn" android:layout_width="0dp" android:layout_weight="1" android:layout_height="wrap_content" android:text="éŸ³é¢‘æ’­æ”¾" /&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt;&lt;/FrameLayout&gt; MainActivity.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112public class MainActivity extends AppCompatActivity implements View.OnClickListener, AVUtils.AVCallback &#123; private static final String TAG = "MainActivity"; private static final String BASE_PATH = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separatorChar; private String input_video_file_path = BASE_PATH + "input.mp4"; private String output_video_file_path = BASE_PATH + "output.yuv"; private String input_audio_file_path = BASE_PATH + "hello.mp3"; private String output_audio_file_path = BASE_PATH + "hello.pcm"; private String video_src = BASE_PATH + "ffmpeg.mp4"; private Button mDecodeVideoBtn; private Button mVideoRenderBtn; private Button mAudioPlayBtn, mAudioDecodeBtn; private ProgressDialog mProgressDialog; private ExecutorService mExecutorService; private MySurfaceView mySurfaceView; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123; requestPermissions(new String[]&#123;Manifest.permission.READ_EXTERNAL_STORAGE, Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.MOUNT_UNMOUNT_FILESYSTEMS&#125;, 0); &#125; mDecodeVideoBtn = (Button)findViewById(R.id.video_decode_btn); mVideoRenderBtn = (Button)findViewById(R.id.video_render_btn); mAudioDecodeBtn = (Button) findViewById(R.id.audio_decode_btn); mAudioPlayBtn = (Button)findViewById(R.id.audio_play_btn); mySurfaceView = (MySurfaceView) findViewById(R.id.my_surface_view); mDecodeVideoBtn.setOnClickListener(this); mVideoRenderBtn.setOnClickListener(this); mAudioDecodeBtn.setOnClickListener(this); mAudioPlayBtn.setOnClickListener(this); AVUtils.registerCallback(this); mProgressDialog = new ProgressDialog(this); mProgressDialog.setCanceledOnTouchOutside(false); mExecutorService = Executors.newFixedThreadPool(2); &#125; @Override public void onClick(View view) &#123; int id = view.getId(); switch (id) &#123; case R.id.video_decode_btn: mProgressDialog.setMessage("æ­£åœ¨è§£ç ..."); mProgressDialog.show(); mExecutorService.submit(new Runnable() &#123; @Override public void run() &#123; AVUtils.videoDecode(input_video_file_path, output_video_file_path); &#125; &#125;); break; case R.id.video_render_btn: mExecutorService.submit(new Runnable() &#123; @Override public void run() &#123; AVUtils.videoRender(input_video_file_path, mySurfaceView.getHolder().getSurface()); &#125; &#125;); break; case R.id.audio_decode_btn: mProgressDialog.setMessage("æ­£åœ¨è§£ç ..."); mProgressDialog.show(); mExecutorService.submit(new Runnable() &#123; @Override public void run() &#123; AVUtils.audioDecode(input_audio_file_path, output_audio_file_path); &#125; &#125;); break; case R.id.audio_play_btn: mExecutorService.submit(new Runnable() &#123; @Override public void run() &#123; AVUtils.audioPlay(input_video_file_path); &#125; &#125;); break; &#125; &#125; @Override public void onFinish() &#123; runOnUiThread(new Runnable() &#123; @Override public void run() &#123; if (mProgressDialog.isShowing()) &#123; mProgressDialog.dismiss(); &#125; Toast.makeText(MainActivity.this, "è§£ç å®Œæˆ", Toast.LENGTH_SHORT).show(); &#125; &#125;); &#125; @Override protected void onDestroy() &#123; super.onDestroy(); mExecutorService.shutdown(); &#125;&#125; nativelib.c 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579#include &lt;jni.h&gt;#include &lt;string.h&gt;#include &lt;android/log.h&gt;#include &lt;stdio.h&gt;#include &lt;libavutil/time.h&gt;//ç¼–ç #include "include/libavcodec/avcodec.h"//å°è£…æ ¼å¼å¤„ç†#include "include/libavformat/avformat.h"//åƒç´ å¤„ç†#include "include/libswscale/swscale.h"#define LOGI(FORMAT, ...) __android_log_print(ANDROID_LOG_INFO,"haohao",FORMAT,##__VA_ARGS__);#define LOGE(FORMAT, ...) __android_log_print(ANDROID_LOG_ERROR,"haohao",FORMAT,##__VA_ARGS__);//ä¸­æ–‡å­—ç¬¦ä¸²è½¬æ¢jstring charsToUTF8String(JNIEnv *env, char *s) &#123; jclass string_cls = (*env)-&gt;FindClass(env, "java/lang/String"); jmethodID mid = (*env)-&gt;GetMethodID(env, string_cls, "&lt;init&gt;", "([BLjava/lang/String;)V"); jbyteArray jb_arr = (*env)-&gt;NewByteArray(env, strlen(s)); (*env)-&gt;SetByteArrayRegion(env, jb_arr, 0, strlen(s), s); jstring charset = (*env)-&gt;NewStringUTF(env, "UTF-8"); return (*env)-&gt;NewObject(env, string_cls, mid, jb_arr, charset);&#125;JNIEXPORT void JNICALLJava_com_haohao_ffmpeg_AVUtils_videoDecode(JNIEnv *env, jclass type, jstring input_, jstring output_) &#123; //è®¿é—®é™æ€æ–¹æ³• jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, "onNativeCallback", "()V"); //éœ€è¦è½¬ç çš„è§†é¢‘æ–‡ä»¶(è¾“å…¥çš„è§†é¢‘æ–‡ä»¶) const char *input = (*env)-&gt;GetStringUTFChars(env, input_, 0); const char *output = (*env)-&gt;GetStringUTFChars(env, output_, 0); //æ³¨å†Œæ‰€æœ‰ç»„ä»¶ av_register_all(); //å°è£…æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œç»Ÿé¢†å…¨å±€çš„ç»“æž„ä½“ï¼Œä¿å­˜äº†è§†é¢‘æ–‡ä»¶å°è£…æ ¼å¼çš„ç›¸å…³ä¿¡æ¯ AVFormatContext *pFormatCtx = avformat_alloc_context(); //æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶ if (avformat_open_input(&amp;pFormatCtx, input, NULL, NULL) != 0) &#123; LOGE("%s", "æ— æ³•æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶"); return; &#125; //èŽ·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼Œä¾‹å¦‚å¾—åˆ°è§†é¢‘çš„å®½é«˜ if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) &#123; LOGE("%s", "æ— æ³•èŽ·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯"); return; &#125; //èŽ·å–è§†é¢‘æµçš„ç´¢å¼•ä½ç½® //éåŽ†æ‰€æœ‰ç±»åž‹çš„æµï¼ˆéŸ³é¢‘æµã€è§†é¢‘æµã€å­—å¹•æµï¼‰ï¼Œæ‰¾åˆ°è§†é¢‘æµ int v_stream_idx = -1; int i = 0; for (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; //åˆ¤æ–­è§†é¢‘æµ if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123; v_stream_idx = i; break; &#125; &#125; if (v_stream_idx == -1) &#123; LOGE("%s", "æ‰¾ä¸åˆ°è§†é¢‘æµ\n"); return; &#125; //æ ¹æ®è§†é¢‘çš„ç¼–ç æ–¹å¼ï¼ŒèŽ·å–å¯¹åº”çš„è§£ç å™¨ AVCodecContext *pCodecCtx = pFormatCtx-&gt;streams[v_stream_idx]-&gt;codec; //æ ¹æ®ç¼–è§£ç ä¸Šä¸‹æ–‡ä¸­çš„ç¼–ç  id æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨ AVCodec *pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id); if (pCodec == NULL) &#123; LOGE("%s", "æ‰¾ä¸åˆ°è§£ç å™¨ï¼Œæˆ–è€…è§†é¢‘å·²åŠ å¯†\n"); return; &#125; //æ‰“å¼€è§£ç å™¨ï¼Œè§£ç å™¨æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬ç¼–è¯‘FFmpegçš„æ—¶å€™æ²¡æœ‰ç¼–è¯‘å¯¹åº”ç±»åž‹çš„è§£ç å™¨ï¼‰ if (avcodec_open2(pCodecCtx, pCodec, NULL) &lt; 0) &#123; LOGE("%s", "è§£ç å™¨æ— æ³•æ‰“å¼€\n"); return; &#125; //è¾“å‡ºè§†é¢‘ä¿¡æ¯ LOGI("è§†é¢‘çš„æ–‡ä»¶æ ¼å¼ï¼š%s", pFormatCtx-&gt;iformat-&gt;name); LOGI("è§†é¢‘æ—¶é•¿ï¼š%lld", (pFormatCtx-&gt;duration) / (1000 * 1000)); LOGI("è§†é¢‘çš„å®½é«˜ï¼š%d,%d", pCodecCtx-&gt;width, pCodecCtx-&gt;height); LOGI("è§£ç å™¨çš„åç§°ï¼š%s", pCodec-&gt;name); //å‡†å¤‡è¯»å– //AVPacketç”¨äºŽå­˜å‚¨ä¸€å¸§ä¸€å¸§çš„åŽ‹ç¼©æ•°æ®ï¼ˆH264ï¼‰ //ç¼“å†²åŒºï¼Œå¼€è¾Ÿç©ºé—´ AVPacket *packet = (AVPacket *) av_malloc(sizeof(AVPacket)); //AVFrameç”¨äºŽå­˜å‚¨è§£ç åŽçš„åƒç´ æ•°æ®(YUV) //å†…å­˜åˆ†é… AVFrame *pFrame = av_frame_alloc(); //YUV420 AVFrame *pFrameYUV = av_frame_alloc(); //åªæœ‰æŒ‡å®šäº†AVFrameçš„åƒç´ æ ¼å¼ã€ç”»é¢å¤§å°æ‰èƒ½çœŸæ­£åˆ†é…å†…å­˜ //ç¼“å†²åŒºåˆ†é…å†…å­˜ uint8_t *out_buffer = (uint8_t *) av_malloc( avpicture_get_size(AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height)); //åˆå§‹åŒ–ç¼“å†²åŒº avpicture_fill((AVPicture *) pFrameYUV, out_buffer, AV_PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height); //ç”¨äºŽè½¬ç ï¼ˆç¼©æ”¾ï¼‰çš„å‚æ•°ï¼Œè½¬ä¹‹å‰çš„å®½é«˜ï¼Œè½¬ä¹‹åŽçš„å®½é«˜ï¼Œæ ¼å¼ç­‰ struct SwsContext *sws_ctx = sws_getContext(pCodecCtx-&gt;width, pCodecCtx-&gt;height, pCodecCtx-&gt;pix_fmt, pCodecCtx-&gt;width, pCodecCtx-&gt;height, AV_PIX_FMT_YUV420P, SWS_BICUBIC, NULL, NULL, NULL); int got_picture, ret; //è¾“å‡ºæ–‡ä»¶ FILE *fp_yuv = fopen(output, "wb+"); int frame_count = 0; //ä¸€å¸§ä¸€å¸§çš„è¯»å–åŽ‹ç¼©æ•°æ® while (av_read_frame(pFormatCtx, packet) &gt;= 0) &#123; //åªè¦è§†é¢‘åŽ‹ç¼©æ•°æ®ï¼ˆæ ¹æ®æµçš„ç´¢å¼•ä½ç½®åˆ¤æ–­ï¼‰ if (packet-&gt;stream_index == v_stream_idx) &#123; //è§£ç ä¸€å¸§è§†é¢‘åŽ‹ç¼©æ•°æ®ï¼Œå¾—åˆ°è§†é¢‘åƒç´ æ•°æ® ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;got_picture, packet); if (ret &lt; 0) &#123; LOGE("%s", "è§£ç é”™è¯¯"); return; &#125; //ä¸º 0 è¯´æ˜Žè§£ç å®Œæˆï¼Œéž0æ­£åœ¨è§£ç  if (got_picture) &#123; //AVFrameè½¬ä¸ºåƒç´ æ ¼å¼YUV420ï¼Œå®½é«˜ //2 6è¾“å…¥ã€è¾“å‡ºæ•°æ® //3 7è¾“å…¥ã€è¾“å‡ºç”»é¢ä¸€è¡Œçš„æ•°æ®çš„å¤§å° AVFrame è½¬æ¢æ˜¯ä¸€è¡Œä¸€è¡Œè½¬æ¢çš„ //4 è¾“å…¥æ•°æ®ç¬¬ä¸€åˆ—è¦è½¬ç çš„ä½ç½® ä»Ž0å¼€å§‹ //5 è¾“å…¥ç”»é¢çš„é«˜åº¦ sws_scale(sws_ctx, pFrame-&gt;data, pFrame-&gt;linesize, 0, pCodecCtx-&gt;height, pFrameYUV-&gt;data, pFrameYUV-&gt;linesize); //è¾“å‡ºåˆ°YUVæ–‡ä»¶ //AVFrameåƒç´ å¸§å†™å…¥æ–‡ä»¶ //dataè§£ç åŽçš„å›¾åƒåƒç´ æ•°æ®ï¼ˆéŸ³é¢‘é‡‡æ ·æ•°æ®ï¼‰ //Y äº®åº¦ UV è‰²åº¦ï¼ˆåŽ‹ç¼©äº†ï¼‰ äººå¯¹äº®åº¦æ›´åŠ æ•æ„Ÿ //U V ä¸ªæ•°æ˜¯Yçš„1/4 int y_size = pCodecCtx-&gt;width * pCodecCtx-&gt;height; fwrite(pFrameYUV-&gt;data[0], 1, y_size, fp_yuv); fwrite(pFrameYUV-&gt;data[1], 1, y_size / 4, fp_yuv); fwrite(pFrameYUV-&gt;data[2], 1, y_size / 4, fp_yuv); frame_count++; LOGI("è§£ç ç¬¬%då¸§", frame_count); &#125; &#125; //é‡Šæ”¾èµ„æº av_free_packet(packet); &#125; fclose(fp_yuv); av_frame_free(&amp;pFrame); avcodec_close(pCodecCtx); avformat_free_context(pFormatCtx); (*env)-&gt;ReleaseStringUTFChars(env, input_, input); (*env)-&gt;ReleaseStringUTFChars(env, output_, output); //é€šçŸ¥ Java å±‚è§£ç å®Œæ¯• (*env)-&gt;CallStaticVoidMethod(env, type, mid);&#125;//ä½¿ç”¨è¿™ä¸¤ä¸ª Window ç›¸å…³çš„å¤´æ–‡ä»¶éœ€è¦åœ¨ CMake è„šæœ¬ä¸­å¼•å…¥ android åº“#include &lt;android/native_window_jni.h&gt;#include &lt;android/native_window.h&gt;#include "include/yuv/libyuv.h"JNIEXPORT void JNICALLJava_com_haohao_ffmpeg_AVUtils_videoRender(JNIEnv *env, jclass type, jstring input_, jobject surface) &#123; //éœ€è¦è½¬ç çš„è§†é¢‘æ–‡ä»¶(è¾“å…¥çš„è§†é¢‘æ–‡ä»¶) const char *input = (*env)-&gt;GetStringUTFChars(env, input_, 0); //æ³¨å†Œæ‰€æœ‰ç»„ä»¶ av_register_all(); //avcodec_register_all(); //å°è£…æ ¼å¼ä¸Šä¸‹æ–‡ï¼Œç»Ÿé¢†å…¨å±€çš„ç»“æž„ä½“ï¼Œä¿å­˜äº†è§†é¢‘æ–‡ä»¶å°è£…æ ¼å¼çš„ç›¸å…³ä¿¡æ¯ AVFormatContext *pFormatCtx = avformat_alloc_context(); //æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶ if (avformat_open_input(&amp;pFormatCtx, input, NULL, NULL) != 0) &#123; LOGE("%s", "æ— æ³•æ‰“å¼€è¾“å…¥è§†é¢‘æ–‡ä»¶"); return; &#125; //èŽ·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯ï¼Œä¾‹å¦‚å¾—åˆ°è§†é¢‘çš„å®½é«˜ //ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºä½ éœ€è¦èŽ·å–ä»€ä¹ˆä¿¡æ¯ï¼Œæ¯”å¦‚è§†é¢‘çš„å…ƒæ•°æ® if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) &#123; LOGE("%s", "æ— æ³•èŽ·å–è§†é¢‘æ–‡ä»¶ä¿¡æ¯"); return; &#125; //èŽ·å–è§†é¢‘æµçš„ç´¢å¼•ä½ç½® //éåŽ†æ‰€æœ‰ç±»åž‹çš„æµï¼ˆéŸ³é¢‘æµã€è§†é¢‘æµã€å­—å¹•æµï¼‰ï¼Œæ‰¾åˆ°è§†é¢‘æµ int v_stream_idx = -1; int i = 0; //number of streams for (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; //æµçš„ç±»åž‹ if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO) &#123; v_stream_idx = i; break; &#125; &#125; if (v_stream_idx == -1) &#123; LOGE("%s", "æ‰¾ä¸åˆ°è§†é¢‘æµ\n"); return; &#125; //èŽ·å–è§†é¢‘æµä¸­çš„ç¼–è§£ç ä¸Šä¸‹æ–‡ AVCodecContext *pCodecCtx = pFormatCtx-&gt;streams[v_stream_idx]-&gt;codec; //æ ¹æ®ç¼–è§£ç ä¸Šä¸‹æ–‡ä¸­çš„ç¼–ç  id æŸ¥æ‰¾å¯¹åº”çš„è§£ç å™¨ AVCodec *pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id); if (pCodec == NULL) &#123; LOGE("%s", "æ‰¾ä¸åˆ°è§£ç å™¨ï¼Œæˆ–è€…è§†é¢‘å·²åŠ å¯†\n"); return; &#125; //æ‰“å¼€è§£ç å™¨ï¼Œè§£ç å™¨æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬ç¼–è¯‘FFmpegçš„æ—¶å€™æ²¡æœ‰ç¼–è¯‘å¯¹åº”ç±»åž‹çš„è§£ç å™¨ï¼‰ if (avcodec_open2(pCodecCtx, pCodec, NULL) &lt; 0) &#123; LOGE("%s", "è§£ç å™¨æ— æ³•æ‰“å¼€\n"); return; &#125; //å‡†å¤‡è¯»å– //AVPacketç”¨äºŽå­˜å‚¨ä¸€å¸§ä¸€å¸§çš„åŽ‹ç¼©æ•°æ®ï¼ˆH264ï¼‰ //ç¼“å†²åŒºï¼Œå¼€è¾Ÿç©ºé—´ AVPacket *packet = (AVPacket *) av_malloc(sizeof(AVPacket)); //AVFrameç”¨äºŽå­˜å‚¨è§£ç åŽçš„åƒç´ æ•°æ®(YUV) //å†…å­˜åˆ†é… AVFrame *yuv_frame = av_frame_alloc(); AVFrame *rgb_frame = av_frame_alloc(); int got_picture, ret; int frame_count = 0; //çª—ä½“ ANativeWindow *pWindow = ANativeWindow_fromSurface(env, surface); //ç»˜åˆ¶æ—¶çš„ç¼“å†²åŒº ANativeWindow_Buffer out_buffer; //ä¸€å¸§ä¸€å¸§çš„è¯»å–åŽ‹ç¼©æ•°æ® while (av_read_frame(pFormatCtx, packet) &gt;= 0) &#123; //åªè¦è§†é¢‘åŽ‹ç¼©æ•°æ®ï¼ˆæ ¹æ®æµçš„ç´¢å¼•ä½ç½®åˆ¤æ–­ï¼‰ if (packet-&gt;stream_index == v_stream_idx) &#123; //7.è§£ç ä¸€å¸§è§†é¢‘åŽ‹ç¼©æ•°æ®ï¼Œå¾—åˆ°è§†é¢‘åƒç´ æ•°æ® ret = avcodec_decode_video2(pCodecCtx, yuv_frame, &amp;got_picture, packet); if (ret &lt; 0) &#123; LOGE("%s", "è§£ç é”™è¯¯"); return; &#125; //ä¸º0è¯´æ˜Žè§£ç å®Œæˆï¼Œéž0æ­£åœ¨è§£ç  if (got_picture) &#123; //lock window //è®¾ç½®ç¼“å†²åŒºçš„å±žæ€§ï¼šå®½é«˜ã€åƒç´ æ ¼å¼ï¼ˆéœ€è¦ä¸ŽJavaå±‚çš„æ ¼å¼ä¸€è‡´ï¼‰ ANativeWindow_setBuffersGeometry(pWindow, pCodecCtx-&gt;width, pCodecCtx-&gt;height, WINDOW_FORMAT_RGBA_8888); ANativeWindow_lock(pWindow, &amp;out_buffer, NULL); //åˆå§‹åŒ–ç¼“å†²åŒº //è®¾ç½®å±žæ€§ï¼Œåƒç´ æ ¼å¼ã€å®½é«˜ //rgb_frameçš„ç¼“å†²åŒºå°±æ˜¯Windowçš„ç¼“å†²åŒºï¼ŒåŒä¸€ä¸ªï¼Œè§£é”çš„æ—¶å€™å°±ä¼šè¿›è¡Œç»˜åˆ¶ avpicture_fill((AVPicture *) rgb_frame, out_buffer.bits, AV_PIX_FMT_RGBA, pCodecCtx-&gt;width, pCodecCtx-&gt;height); //YUVæ ¼å¼çš„æ•°æ®è½¬æ¢æˆRGBA 8888æ ¼å¼çš„æ•°æ®, FFmpeg ä¹Ÿå¯ä»¥è½¬æ¢ï¼Œä½†æ˜¯å­˜åœ¨é—®é¢˜ï¼Œä½¿ç”¨libyuvè¿™ä¸ªåº“å®žçŽ° I420ToARGB(yuv_frame-&gt;data[0], yuv_frame-&gt;linesize[0], yuv_frame-&gt;data[2], yuv_frame-&gt;linesize[2], yuv_frame-&gt;data[1], yuv_frame-&gt;linesize[1], rgb_frame-&gt;data[0], rgb_frame-&gt;linesize[0], pCodecCtx-&gt;width, pCodecCtx-&gt;height); //3ã€unlock window ANativeWindow_unlockAndPost(pWindow); frame_count++; LOGI("è§£ç ç»˜åˆ¶ç¬¬%då¸§", frame_count); &#125; &#125; //é‡Šæ”¾èµ„æº av_free_packet(packet); &#125; av_frame_free(&amp;yuv_frame); avcodec_close(pCodecCtx); avformat_free_context(pFormatCtx); (*env)-&gt;ReleaseStringUTFChars(env, input_, input);&#125;#include "libswresample/swresample.h"#define MAX_AUDIO_FRME_SIZE 48000 * 4//éŸ³é¢‘è§£ç ï¼ˆé‡é‡‡æ ·ï¼‰JNIEXPORT void JNICALLJava_com_haohao_ffmpeg_AVUtils_audioDecode(JNIEnv *env, jclass type, jstring input_, jstring output_) &#123; //è®¿é—®é™æ€æ–¹æ³• jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, "onNativeCallback", "()V"); const char *input = (*env)-&gt;GetStringUTFChars(env, input_, 0); const char *output = (*env)-&gt;GetStringUTFChars(env, output_, 0); //æ³¨å†Œç»„ä»¶ av_register_all(); AVFormatContext *pFormatCtx = avformat_alloc_context(); //æ‰“å¼€éŸ³é¢‘æ–‡ä»¶ if (avformat_open_input(&amp;pFormatCtx, input, NULL, NULL) != 0) &#123; LOGI("%s", "æ— æ³•æ‰“å¼€éŸ³é¢‘æ–‡ä»¶"); return; &#125; //èŽ·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯ if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) &#123; LOGI("%s", "æ— æ³•èŽ·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯"); return; &#125; //èŽ·å–éŸ³é¢‘æµç´¢å¼•ä½ç½® int i = 0, audio_stream_idx = -1; for (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_AUDIO) &#123; audio_stream_idx = i; break; &#125; &#125; //èŽ·å–è§£ç å™¨ AVCodecContext *codecCtx = pFormatCtx-&gt;streams[audio_stream_idx]-&gt;codec; AVCodec *codec = avcodec_find_decoder(codecCtx-&gt;codec_id); if (codec == NULL) &#123; LOGI("%s", "æ— æ³•èŽ·å–è§£ç å™¨"); return; &#125; //æ‰“å¼€è§£ç å™¨ if (avcodec_open2(codecCtx, codec, NULL) &lt; 0) &#123; LOGI("%s", "æ— æ³•æ‰“å¼€è§£ç å™¨"); return; &#125; //åŽ‹ç¼©æ•°æ® AVPacket *packet = (AVPacket *) av_malloc(sizeof(AVPacket)); //è§£åŽ‹ç¼©æ•°æ® AVFrame *frame = av_frame_alloc(); //frame-&gt;16bit 44100 PCM ç»Ÿä¸€éŸ³é¢‘é‡‡æ ·æ ¼å¼ä¸Žé‡‡æ ·çŽ‡ SwrContext *swrCtx = swr_alloc(); //é‡é‡‡æ ·è®¾ç½®å‚æ•° //è¾“å…¥çš„é‡‡æ ·æ ¼å¼ enum AVSampleFormat in_sample_fmt = codecCtx-&gt;sample_fmt; //è¾“å‡ºé‡‡æ ·æ ¼å¼16bit PCM enum AVSampleFormat out_sample_fmt = AV_SAMPLE_FMT_S16; //è¾“å…¥é‡‡æ ·çŽ‡ int in_sample_rate = codecCtx-&gt;sample_rate; //è¾“å‡ºé‡‡æ ·çŽ‡ int out_sample_rate = 44100; //èŽ·å–è¾“å…¥çš„å£°é“å¸ƒå±€ //æ ¹æ®å£°é“ä¸ªæ•°èŽ·å–é»˜è®¤çš„å£°é“å¸ƒå±€ï¼ˆ2ä¸ªå£°é“ï¼Œé»˜è®¤ç«‹ä½“å£°stereoï¼‰ //av_get_default_channel_layout(codecCtx-&gt;channels); uint64_t in_ch_layout = codecCtx-&gt;channel_layout; //è¾“å‡ºçš„å£°é“å¸ƒå±€ï¼ˆç«‹ä½“å£°ï¼‰ uint64_t out_ch_layout = AV_CH_LAYOUT_STEREO; swr_alloc_set_opts(swrCtx, out_ch_layout, out_sample_fmt, out_sample_rate, in_ch_layout, in_sample_fmt, in_sample_rate, 0, NULL); swr_init(swrCtx); //è¾“å‡ºçš„å£°é“ä¸ªæ•° int out_channel_nb = av_get_channel_layout_nb_channels(out_ch_layout); //é‡é‡‡æ ·è®¾ç½®å‚æ•° //ä½å®½16bit é‡‡æ ·çŽ‡ 44100HZ çš„ PCM æ•°æ® uint8_t *out_buffer = (uint8_t *) av_malloc(MAX_AUDIO_FRME_SIZE); FILE *fp_pcm = fopen(output, "wb"); int got_frame = 0, index = 0, ret; //ä¸æ–­è¯»å–åŽ‹ç¼©æ•°æ® while (av_read_frame(pFormatCtx, packet) &gt;= 0) &#123; //è§£ç  ret = avcodec_decode_audio4(codecCtx, frame, &amp;got_frame, packet); if (ret &lt; 0) &#123; LOGI("%s", "è§£ç å®Œæˆ"); &#125; //è§£ç ä¸€å¸§æˆåŠŸ if (got_frame &gt; 0) &#123; LOGI("è§£ç ï¼š%d", index++); swr_convert(swrCtx, &amp;out_buffer, MAX_AUDIO_FRME_SIZE, frame-&gt;data, frame-&gt;nb_samples); //èŽ·å–sampleçš„size int out_buffer_size = av_samples_get_buffer_size(NULL, out_channel_nb, frame-&gt;nb_samples, out_sample_fmt, 1); fwrite(out_buffer, 1, out_buffer_size, fp_pcm); &#125; av_free_packet(packet); &#125; fclose(fp_pcm); av_frame_free(&amp;frame); av_free(out_buffer); swr_free(&amp;swrCtx); avcodec_close(codecCtx); avformat_close_input(&amp;pFormatCtx); (*env)-&gt;ReleaseStringUTFChars(env, input_, input); (*env)-&gt;ReleaseStringUTFChars(env, output_, output); //é€šçŸ¥ Java å±‚è§£ç å®Œæˆ (*env)-&gt;CallStaticVoidMethod(env, type, mid);&#125;JNIEXPORT void JNICALLJava_com_haohao_ffmpeg_AVUtils_audioPlay(JNIEnv *env, jclass type, jstring input_) &#123; const char *input = (*env)-&gt;GetStringUTFChars(env, input_, 0); LOGI("%s", "sound"); //æ³¨å†Œç»„ä»¶ av_register_all(); AVFormatContext *pFormatCtx = avformat_alloc_context(); //æ‰“å¼€éŸ³é¢‘æ–‡ä»¶ if (avformat_open_input(&amp;pFormatCtx, input, NULL, NULL) != 0) &#123; LOGI("%s", "æ— æ³•æ‰“å¼€éŸ³é¢‘æ–‡ä»¶"); return; &#125; //èŽ·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯ if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0) &#123; LOGI("%s", "æ— æ³•èŽ·å–è¾“å…¥æ–‡ä»¶ä¿¡æ¯"); return; &#125; //èŽ·å–éŸ³é¢‘æµç´¢å¼•ä½ç½® int i = 0, audio_stream_idx = -1; for (; i &lt; pFormatCtx-&gt;nb_streams; i++) &#123; if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_AUDIO) &#123; audio_stream_idx = i; break; &#125; &#125; //èŽ·å–è§£ç å™¨ AVCodecContext *codecCtx = pFormatCtx-&gt;streams[audio_stream_idx]-&gt;codec; AVCodec *codec = avcodec_find_decoder(codecCtx-&gt;codec_id); if (codec == NULL) &#123; LOGI("%s", "æ— æ³•èŽ·å–è§£ç å™¨"); return; &#125; //æ‰“å¼€è§£ç å™¨ if (avcodec_open2(codecCtx, codec, NULL) &lt; 0) &#123; LOGI("%s", "æ— æ³•æ‰“å¼€è§£ç å™¨"); return; &#125; //åŽ‹ç¼©æ•°æ® AVPacket *packet = (AVPacket *) av_malloc(sizeof(AVPacket)); //è§£åŽ‹ç¼©æ•°æ® AVFrame *frame = av_frame_alloc(); //frame-&gt;16bit 44100 PCM ç»Ÿä¸€éŸ³é¢‘é‡‡æ ·æ ¼å¼ä¸Žé‡‡æ ·çŽ‡ SwrContext *swrCtx = swr_alloc(); //è¾“å…¥çš„é‡‡æ ·æ ¼å¼ enum AVSampleFormat in_sample_fmt = codecCtx-&gt;sample_fmt; //è¾“å‡ºé‡‡æ ·æ ¼å¼16bit PCM enum AVSampleFormat out_sample_fmt = AV_SAMPLE_FMT_S16; //è¾“å…¥é‡‡æ ·çŽ‡ int in_sample_rate = codecCtx-&gt;sample_rate; //è¾“å‡ºé‡‡æ ·çŽ‡ int out_sample_rate = in_sample_rate; //èŽ·å–è¾“å…¥çš„å£°é“å¸ƒå±€ //æ ¹æ®å£°é“ä¸ªæ•°èŽ·å–é»˜è®¤çš„å£°é“å¸ƒå±€ï¼ˆ2ä¸ªå£°é“ï¼Œé»˜è®¤ç«‹ä½“å£°stereoï¼‰ //av_get_default_channel_layout(codecCtx-&gt;channels); uint64_t in_ch_layout = codecCtx-&gt;channel_layout; //è¾“å‡ºçš„å£°é“å¸ƒå±€ï¼ˆç«‹ä½“å£°ï¼‰ uint64_t out_ch_layout = AV_CH_LAYOUT_STEREO; swr_alloc_set_opts(swrCtx, out_ch_layout, out_sample_fmt, out_sample_rate, in_ch_layout, in_sample_fmt, in_sample_rate, 0, NULL); swr_init(swrCtx); //è¾“å‡ºçš„å£°é“ä¸ªæ•° int out_channel_nb = av_get_channel_layout_nb_channels(out_ch_layout); //AudioTrackå¯¹è±¡ jmethodID create_audio_track_mid = (*env)-&gt;GetStaticMethodID(env, type, "createAudioTrack", "(II)Landroid/media/AudioTrack;"); jobject audio_track = (*env)-&gt;CallStaticObjectMethod(env, type, create_audio_track_mid, out_sample_rate, out_channel_nb); //è°ƒç”¨AudioTrack.playæ–¹æ³• jclass audio_track_class = (*env)-&gt;GetObjectClass(env, audio_track); jmethodID audio_track_play_mid = (*env)-&gt;GetMethodID(env, audio_track_class, "play", "()V"); jmethodID audio_track_stop_mid = (*env)-&gt;GetMethodID(env, audio_track_class, "stop", "()V"); (*env)-&gt;CallVoidMethod(env, audio_track, audio_track_play_mid); //AudioTrack.write jmethodID audio_track_write_mid = (*env)-&gt;GetMethodID(env, audio_track_class, "write", "([BII)I"); //16bit 44100 PCM æ•°æ® uint8_t *out_buffer = (uint8_t *) av_malloc(MAX_AUDIO_FRME_SIZE); int got_frame = 0, index = 0, ret; //ä¸æ–­è¯»å–åŽ‹ç¼©æ•°æ® while (av_read_frame(pFormatCtx, packet) &gt;= 0) &#123; //è§£ç éŸ³é¢‘ç±»åž‹çš„Packet if (packet-&gt;stream_index == audio_stream_idx) &#123; //è§£ç  ret = avcodec_decode_audio4(codecCtx, frame, &amp;got_frame, packet); if (ret &lt; 0) &#123; LOGI("%s", "è§£ç å®Œæˆ"); &#125; //è§£ç ä¸€å¸§æˆåŠŸ if (got_frame &gt; 0) &#123; LOGI("è§£ç ï¼š%d", index++); swr_convert(swrCtx, &amp;out_buffer, MAX_AUDIO_FRME_SIZE, (const uint8_t **) frame-&gt;data, frame-&gt;nb_samples); //èŽ·å–sampleçš„size int out_buffer_size = av_samples_get_buffer_size(NULL, out_channel_nb, frame-&gt;nb_samples, out_sample_fmt, 1); //out_bufferç¼“å†²åŒºæ•°æ®ï¼Œè½¬æˆbyteæ•°ç»„ jbyteArray audio_sample_array = (*env)-&gt;NewByteArray(env, out_buffer_size); jbyte *sample_bytep = (*env)-&gt;GetByteArrayElements(env, audio_sample_array, NULL); //out_bufferçš„æ•°æ®å¤åˆ¶åˆ°sampe_bytep memcpy(sample_bytep, out_buffer, out_buffer_size); //åŒæ­¥ (*env)-&gt;ReleaseByteArrayElements(env, audio_sample_array, sample_bytep, 0); //AudioTrack.write PCMæ•°æ® (*env)-&gt;CallIntMethod(env, audio_track, audio_track_write_mid, audio_sample_array, 0, out_buffer_size); //é‡Šæ”¾å±€éƒ¨å¼•ç”¨ (*env)-&gt;DeleteLocalRef(env, audio_sample_array); &#125; &#125; av_free_packet(packet); &#125; (*env)-&gt;CallVoidMethod(env, audio_track, audio_track_stop_mid); av_frame_free(&amp;frame); av_free(out_buffer); swr_free(&amp;swrCtx); avcodec_close(codecCtx); avformat_close_input(&amp;pFormatCtx); (*env)-&gt;ReleaseStringUTFChars(env, input_, input);&#125; CMakeLists.txt1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980cmake_minimum_required(VERSION 3.4.1)include_directories($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/include)set(jnilibs "$&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs")set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;)add_library( # Sets the name of the library. native-lib # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). src/main/cpp/native-lib.c)# æ·»åŠ  FFmpeg çš„ 8 ä¸ªå‡½æ•°åº“å’Œ yuvlib åº“add_library(avutil-54 SHARED IMPORTED )set_target_properties(avutil-54 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libavutil-54.so")add_library(swresample-1 SHARED IMPORTED )set_target_properties(swresample-1 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libswresample-1.so")add_library(avcodec-56 SHARED IMPORTED )set_target_properties(avcodec-56 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libavcodec-56.so")add_library(avformat-56 SHARED IMPORTED )set_target_properties(avformat-56 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libavformat-56.so")add_library(swscale-3 SHARED IMPORTED )set_target_properties(swscale-3 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libswscale-3.so")add_library(postproc-53 SHARED IMPORTED )set_target_properties(postproc-53 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libpostproc-53.so")add_library(avfilter-5 SHARED IMPORTED )set_target_properties(avfilter-5 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libavfilter-5.so")add_library(avdevice-56 SHARED IMPORTED )set_target_properties(avdevice-56 PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libavdevice-56.so")add_library(yuv SHARED IMPORTED )set_target_properties(yuv PROPERTIES IMPORTED_LOCATION "$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libyuv.so")find_library( # Sets the name of the path variable. log-lib # Specifies the name of the NDK library that # you want CMake to locate. log )#æ‰¾åˆ° Android ç³»ç»Ÿ Window ç»˜åˆ¶ç›¸å…³çš„åº“find_library( android-lib android )target_link_libraries( native-lib $&#123;log-lib&#125; $&#123;android-lib&#125; avutil-54 swresample-1 avcodec-56 avformat-56 swscale-3 postproc-53 avfilter-5 avdevice-56 yuv) PSï¼š æ³¨æ„æ·»åŠ æ–‡ä»¶è¯»å†™æƒé™ã€‚ å…³æ³¨å…¬ä¼—å· AndroidGeeks ï¼Œå¹¶åœ¨åŽå°å›žå¤ ffmpeglib èŽ·å–ç›¸åº”çš„å‡½æ•°åº“ã€‚ å‚è€ƒæ–‡ç« é›·éœ„éª…åšå®¢ http://blog.csdn.net/leixiaohua1020/article/details/15811977Jason çš„ NDK å¼€å‘é«˜çº§æ•™ç¨‹]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK FFmpeg ç¼–è¯‘]]></title>
      <url>%2F2018%2F01%2F20%2FNDK-FFmpeg-compile%2F</url>
      <content type="text"><![CDATA[äº’è”ç½‘æ—¶ä»£é™åˆ¶ä¸ªäººå‘å±•çš„ä¸å†æ˜¯æŽŒæ¡çŸ¥è¯†å’Œä¿¡æ¯çš„å¤šå°‘ï¼Œè€Œæ˜¯ä¸ªäººçš„è®¤çŸ¥æ°´å¹³ã€‚ æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ Linux çŽ¯å¢ƒä¸‹ FFmpeg çš„ç¼–è¯‘ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸Žæ’­æ”¾ FFmpeg æ˜¯ä»€ä¹ˆï¼ŸFFmpeg å…¨ç§°ï¼ˆFirst Forward MPEGï¼‰ï¼Œæ˜¯ä¸€æ¬¾é¢†å…ˆçš„å¼€æºå¤šåª’ä½“æ¡†æž¶ï¼Œé‡‡ç”¨ LGPL æˆ– GPL è®¸å¯è¯ï¼Œé™¤äº†å…·æœ‰éŸ³è§†é¢‘ç¼–è§£ç åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰è§†é¢‘æ ¼å¼è½¬æ¢ã€è§†é¢‘æŠ“å›¾ã€è§†é¢‘æ°´å°ã€æŽ¨æµç­‰åŠŸèƒ½ã€‚ FFmpeg åœ¨ Linux å¹³å°ä¸‹å¼€å‘ï¼Œä½†å®ƒåŒæ ·ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæ“ä½œç³»ç»ŸçŽ¯å¢ƒä¸­ç¼–è¯‘è¿è¡Œï¼ŒåŒ…æ‹¬ Windows ã€Mac OS X ç­‰ã€‚ FFmpegçš„å®˜æ–¹ç½‘ç«™æ˜¯ï¼šhttp://ffmpeg.org/ Windows å¹³å°ä¸‹ï¼Œç¼–è¯‘å¥½çš„å¯ç”¨ç‰ˆæœ¬ä¸€èˆ¬æœ‰ä¸‰ä¸ªï¼š Static ï¼ŒShared ï¼ŒDev ã€‚Static é‡Œé¢æœ‰ 3 ä¸ªåº”ç”¨ç¨‹åºï¼šffmpeg.exe ï¼Œffplay.exe ï¼Œffprobe.exe ï¼ŒåŠ¨æ€é“¾æŽ¥åº“éƒ½è¢«ç¼–è¯‘åœ¨ exe æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ª exe çš„ä½“ç§¯éƒ½å¾ˆå¤§ï¼Œå¯ç›´æŽ¥è¿è¡Œï¼Œå¦‚æ’­æ”¾ä¸€æ®µè§†é¢‘ï¼Œå‘½ä»¤è¡Œä¸‹æ‰§è¡Œï¼šffmpeg video.mp4ã€‚Shared é‡Œé¢é™¤äº† 3 ä¸ªåº”ç”¨ç¨‹åºï¼šffmpeg.exe ï¼Œffplay.exe ï¼Œffprobe.exe ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›åŠ¨æ€é“¾æŽ¥åº“ï¼Œå¦‚ avcodec-54.dll ä¹‹ç±»çš„ï¼ŒShared é‡Œé¢çš„ exe ä½“ç§¯è¾ƒå°ã€‚Dev ç‰ˆæœ¬ä¸»è¦ç”¨äºŽå¼€å‘çš„ï¼Œé‡Œé¢åŒ…å«äº†ä¸€äº›åº“æ–‡ä»¶ xxx.lib å’Œæ–‡ä»¶ xxx.h ã€‚ Linux å¹³å°ä¸‹ï¼Œæœ¬æ–‡é€‰æ‹©çš„ç‰ˆæœ¬æ˜¯ 2.6.9 ï¼Œåœ°å€ï¼šhttp://ffmpeg.org/olddownload.html ç¼–è¯‘ FFmpegæ­å»º Linux å¼€å‘çŽ¯å¢ƒï¼Œå®‰è£… Ubuntu è™šæ‹Ÿæœºæˆ–è€…ç”µè„‘è£…æˆåŒç³»ç»Ÿï¼Œæˆ–è€…è´­ä¹°ä¸€ä¸ªä½Žé…çš„é˜¿é‡Œäº‘ä¸»æœºï¼Œæ–‡ä»¶ä¼ è¾“å·¥å…·æŽ¨è FileZilla æˆ– XFTP ã€‚ Linux çŽ¯å¢ƒä¸‹é…ç½® NDKé¦–å…ˆä¸‹è½½ Linux çŽ¯å¢ƒä¸‹çš„ NDK ï¼ˆæ³¨æ„ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œå¦‚ android-ndk-r11c-linux-x86_64.bin ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£åŽ‹ç¼©ï¼š./android-ndk-r11c-linux-x86_64.biné…ç½®çŽ¯å¢ƒå˜é‡ï¼Œé¦–å…ˆç¼–è¾‘ .bashrc æ–‡ä»¶ã€‚vim ~/.bashrcåœ¨æ–‡ä»¶ç»“å°¾æ·»åŠ ä¸¤è¡Œä»£ç ï¼š12export NDKROOT=( NDK è§£åŽ‹çš„æ ¹ç›®å½•ï¼‰å¦‚ ã€/usr/workspace/ndk/android-ndk-r11cexport PATH=$NDKROOT:$PATH æ›´æ–°çŽ¯å¢ƒå˜é‡ï¼šsource ~/.bashrc ç¼–è¯‘å‡†å¤‡é¦–å…ˆä¸‹è½½ FFmpeg ï¼Œåœ°å€ï¼šhttp://ffmpeg.org/olddownload.htmlã€‚è§£åŽ‹ï¼šuzip ffmpeg-2.6.9.zipç„¶åŽç¼–å†™ç”¨äºŽç¼–è¯‘çš„ Shell è„šæœ¬ï¼Œåœ¨ ffmpeg-2.6.9 æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼švim build_android.sh1234567891011121314151617181920212223242526272829303132#!/bin/bashmake cleanexport NDK=/home/wuhuannan/Android/Sdk/ndk-bundleexport SYSROOT=$NDK/platforms/android-14/arch-arm/export TOOLCHAIN=$NDK/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64export CPU=armexport PREFIX=$(pwd)/android/$CPUexport ADDI_CFLAGS="-marm"./configure --target-os=linux \--prefix=$PREFIX --arch=arm \--disable-doc \--enable-shared \--disable-static \--disable-yasm \--disable-symver \--enable-gpl \--disable-ffmpeg \--disable-ffplay \--disable-ffprobe \--disable-ffserver \--disable-doc \--disable-symver \--cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \--enable-cross-compile \--sysroot=$SYSROOT \--extra-cflags="-Os -fpic $ADDI_CFLAGS" \--extra-ldflags="$ADDI_LDFLAGS" \$ADDITIONAL_CONFIGURE_FLAGmake cleanmakemake install ç„¶åŽä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ configure æ–‡ä»¶ã€‚1234567891011#æ‰¾åˆ°å¹¶æ³¨é‡Šä»¥ä¸‹ä»£ç #SLIBNAME_WITH_MAJOR='$(SLIBNAME).$(LIBMAJOR)'#LIB_INSTALL_EXTRA_CMD='$$(RANLIB) "$(LIBDIR)/$(LIBNAME)"'#SLIB_INSTALL_NAME='$(SLIBNAME_WITH_VERSION)'#SLIB_INSTALL_LINKS='$(SLIBNAME_WITH_MAJOR) $(SLIBNAME)'#åœ¨ä¸Šè¿°ä»£ç ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç SLIBNAME_WITH_MAJOR='$(SLIBPREF)$(FULLNAME)-$(LIBMAJOR)$(SLIBSUF)'LIB_INSTALL_EXTRA_CMD='$$(RANLIB)"$(LIBDIR)/$(LIBNAME)"'SLIB_INSTALL_NAME='$(SLIBNAME_WITH_MAJOR)'SLIB_INSTALL_LINKS='$(SLIBNAME)' ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š chmod +x build_android.sh configure æ‰§è¡Œä¸€ä¸‹è„šæœ¬å¼€å§‹ç¼–è¯‘ï¼š ./build_android.sh çº¦å‡ åˆ†é’ŸåŽï¼Œç¼–è¯‘ç”Ÿæˆçš„åŠ¨æ€åº“æ–‡ä»¶å¦‚ä¸‹ï¼š åŽç»­æˆ‘ä»¬å°†åœ¨ Android çŽ¯å¢ƒä¸‹çš„éŸ³è§†é¢‘ç¼–è§£ç ä¸­ä½¿ç”¨è¿™ä¸ªåŠ¨æ€åº“ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK Android OpenSL ES éŸ³é¢‘é‡‡é›†ä¸Žæ’­æ”¾]]></title>
      <url>%2F2018%2F01%2F15%2FNDK-Android-OpenSL-ES-Tutorial%2F</url>
      <content type="text"><![CDATA[ä¸è¦ç”¨æˆ˜æœ¯ä¸Šçš„å‹¤å¥‹æŽ©ç›–æˆ˜ç•¥ä¸Šçš„æ‡’æƒ°ã€‚ æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹åŸºäºŽ Android OpenSL ES å®žçŽ°éŸ³é¢‘çš„é‡‡é›†ä¸Žæ’­æ”¾ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ OpenSL ES æ˜¯ä»€ä¹ˆï¼ŸOpenSL ES æ˜¯ä¸€ä¸ªé’ˆå¯¹åµŒå…¥å¼ç³»ç»Ÿçš„å¼€æ”¾ç¡¬ä»¶éŸ³é¢‘åŠ é€Ÿåº“ï¼Œä¹Ÿå¯ä»¥å°†å…¶è§†ä¸ºä¸€å¥—é’ˆå¯¹åµŒå…¥å¼å¹³å°çš„éŸ³é¢‘æ ‡å‡†ï¼Œå…¨ç§°ä¸ºï¼š Open Sound Library for Embedded Systems ï¼Œå®ƒæä¾›äº†ä¸€å¥—é«˜æ€§èƒ½ã€ ä½Žå»¶è¿Ÿçš„éŸ³é¢‘åŠŸèƒ½å®žçŽ°æ–¹æ³•ï¼Œå¹¶ä¸”å®žçŽ°äº†è½¯ç¡¬ä»¶éŸ³é¢‘æ€§èƒ½çš„è·¨å¹³å°éƒ¨ç½²ï¼Œå¤§å¤§é™ä½Žäº†ä¸Šå±‚å¤„ç†éŸ³é¢‘åº”ç”¨çš„å¼€å‘éš¾åº¦ã€‚ åœ¨ Android å¼€å‘ä¸­ï¼ŒGoogle å®˜æ–¹ä»Ž Android 2.3 ï¼ˆAPI 9ï¼‰å¼€å§‹ï¼Œä¾¿æ”¯æŒäº† OpenSL ES æ ‡å‡† ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œäº†æ‰©å±•ã€‚æœ¬æ–‡ä»‹ç»çš„ OpenSL ES æ˜¯é’ˆå¯¹ Android NDK å¼€å‘æ¥è¯´ã€‚ OpenSL ES çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µåŸºäºŽ c è¯­è¨€çš„é¢å‘å¯¹è±¡æŽ¥å£OpenSL ES æ˜¯åŸºäºŽ c è¯­è¨€å®žçŽ°çš„ï¼Œä½†å…¶æä¾›çš„æŽ¥å£æ˜¯é‡‡ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å®žçŽ°ï¼ŒOpenSL ES çš„å¤§å¤šæ•° API æ˜¯é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨çš„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œä¸»è¦çš„é€»è¾‘æ˜¯å®žä¾‹åŒ–å¼•æ“Žå¯¹è±¡å’ŒèŽ·å–å¼•æ“Žå¯¹è±¡æŽ¥å£ï¼š12345678910SLresult result;// realize the engineresult = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE);assert(SL_RESULT_SUCCESS == result);(void)result;result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine);assert(SL_RESULT_SUCCESS == result);(void)result; å¯¹è±¡å’ŒæŽ¥å£æ¦‚å¿µObject å’Œ Interface OpenSL ES ä¸­çš„ä¸¤å¤§åŸºæœ¬æ¦‚å¿µï¼Œå¯ä»¥ç±»æ¯”ä¸º Java ä¸­çš„å¯¹è±¡å’ŒæŽ¥å£ã€‚åœ¨ OpenSL ES ä¸­ï¼Œ æ¯ä¸ª Object å¯ä»¥å­˜åœ¨ä¸€ç³»åˆ—çš„ Interface ï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªå¯¹è±¡éƒ½æä¾›äº†ä¸€ç³»åˆ—çš„åŸºæœ¬æ“ä½œï¼Œå¦‚ Realizeï¼ŒGetStateï¼ŒDestroy ç­‰ã€‚é‡è¦çš„ä¸€ç‚¹ï¼Œåªæœ‰é€šè¿‡ GetInterface æ–¹æ³•æ‹¿åˆ° Object çš„ Interface ï¼Œæ‰èƒ½ä½¿ç”¨ Object æä¾›çš„åŠŸèƒ½ã€‚ å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸOpenSL ES çš„ Object ä¸€èˆ¬æœ‰ä¸‰ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ï¼š SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰ï¼ŒSL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰ï¼ŒSL_OBJECT_STATE_SUSPENDEDï¼ˆæŒ‚èµ·ï¼‰ã€‚ Object å¤„äºŽ SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰çŠ¶æ€æ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶åˆ†é…èµ„æºï¼›è°ƒç”¨ Realize æ–¹æ³•åŽä¾¿è¿›å…¥ SL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰çŠ¶æ€ï¼Œæ­¤æ—¶å¯¹è±¡çš„å„ä¸ªåŠŸèƒ½å’Œèµ„æºå¯ä»¥æ­£å¸¸è®¿é—®ï¼›å½“ç³»ç»ŸéŸ³é¢‘ç›¸å…³çš„ç¡¬ä»¶è®¾å¤‡è¢«å…¶ä»–è¿›ç¨‹å ç”¨æ—¶ï¼ŒOpenSL ES Object ä¾¿ä¼šè¿›å…¥ SL_OBJECT_STATE_SUSPENDED ï¼ˆæŒ‚èµ·ï¼‰çŠ¶æ€ï¼ŒéšåŽè°ƒç”¨ Resume æ–¹æ³•å¯ä½¿å¯¹è±¡é‡å›ž SL_OBJECT_STATE_REALIZEDï¼ˆå¯ç”¨ï¼‰çŠ¶æ€ï¼›å½“ Object ä½¿ç”¨ç»“æŸåŽï¼Œè°ƒç”¨ Destroy æ–¹æ³•é‡Šæ”¾èµ„æºï¼Œæ˜¯å¯¹è±¡é‡å›ž SL_OBJECT_STATE_UNREALIZED ï¼ˆä¸å¯ç”¨ï¼‰çŠ¶æ€ã€‚ OpenSL ES å¸¸ç”¨çš„ Object å’Œ InterfaceAudio å¼•æ“Žå¯¹è±¡å’ŒæŽ¥å£Audio å¼•æ“Žå¯¹è±¡å’ŒæŽ¥å£ï¼Œå³ Engine Object å’Œ SLEngineItf Interface ã€‚Engine Object çš„ä¸»è¦åŠŸèƒ½æ˜¯ç®¡ç† Audio Engine çš„ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›å¼•æ“Žå¯¹è±¡çš„ç®¡ç†æŽ¥å£ã€‚å¼•æ“Žå¯¹è±¡çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š1234567891011121314151617181920SLresult result;// åˆ›å»ºå¼•æ“Žå¯¹è±¡result = slCreateEngine(&amp;engineObject, 0, NULL, 0, NULL, NULL);assert(SL_RESULT_SUCCESS == result);(void)result;// å®žä¾‹åŒ–result = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE);assert(SL_RESULT_SUCCESS == result);(void)result;// èŽ·å–å¼•æ“Žå¯¹è±¡æŽ¥å£result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine);assert(SL_RESULT_SUCCESS == result);(void)result;// é‡Šæ”¾å¼•æ“Žå¯¹è±¡çš„èµ„æºresult = (*engineObject)-&gt;Destroy(engineObject, SL_BOOLEAN_FALSE);assert(SL_RESULT_SUCCESS == result);(void)result; SLRecordItf å’Œ SLPlayItfSLRecordItf å’Œ SLPlayItf åˆ†åˆ«æŠ½è±¡å¤šåª’ä½“åŠŸèƒ½ recorder å’Œ player ï¼Œé€šè¿‡ SLEngineItf çš„ CreateAudioPlayer å’Œ CreateAudioRecorder æ–¹æ³•åˆ†åˆ«åˆ›å»º player å’Œ recorder å¯¹è±¡å®žä¾‹ã€‚1234567891011121314// åˆ›å»º audio recorder å¯¹è±¡result = (*engineEngine)-&gt;CreateAudioRecorder(engineEngine, &amp;recorderObject , &amp;recSource, &amp;dataSink, NUM_RECORDER_EXPLICIT_INTERFACES, iids, required);// åˆ›å»º audio player å¯¹è±¡SLresult result = (*engineEngine)-&gt;CreateAudioPlayer( engineEngine, &amp;audioPlayerObject, &amp;dataSource, &amp;dataSink, 1, interfaceIDs, requiredInterfaces); SLDataSource å’Œ SLDataSinkOpenSL ES ä¸­çš„ SLDataSource å’Œ SLDataSink ç»“æž„ä½“ï¼Œä¸»è¦ç”¨äºŽæž„å»º audio player å’Œ recorder å¯¹è±¡ï¼Œå…¶ä¸­ SLDataSource è¡¨ç¤ºéŸ³é¢‘æ•°æ®æ¥æºçš„ä¿¡æ¯ï¼ŒSLDataSink è¡¨ç¤ºéŸ³é¢‘æ•°æ®è¾“å‡ºä¿¡æ¯ã€‚1234567891011121314151617181920212223242526272829303132// æ•°æ®æºç®€å•ç¼“å†²é˜Ÿåˆ—å®šä½å™¨SLDataLocator_AndroidSimpleBufferQueue dataSou SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEU 1&#125;;// PCM æ•°æ®æºæ ¼å¼SLDataFormat_PCM dataSourceFormat = &#123; SL_DATAFORMAT_PCM, // æ ¼å¼ç±»åž‹ wav_get_channels(wav), // é€šé“æ•° wav_get_rate(wav) * 1000, //é‡‡æ ·çŽ‡ wav_get_bits(wav), // ä½å®½ wav_get_bits(wav), SL_SPEAKER_FRONT_CENTER, // é€šé“å±è”½ SL_BYTEORDER_LITTLEENDIAN // å­—èŠ‚é¡ºåº&#125;;// æ•°æ®æºSLDataSource dataSource = &#123; &amp;dataSourceLocator, &amp;dataSourceFormat&#125;;// é’ˆå¯¹æ•°æ®æŽ¥æ”¶å™¨çš„è¾“å‡ºæ··åˆå®šä½å™¨(æ··éŸ³å™¨)SLDataLocator_OutputMix dataSinkLocator = &#123; SL_DATALOCATOR_OUTPUTMIX, // å®šä½å™¨ç±»åž‹ outputMixObject // è¾“å‡ºæ··åˆ&#125;;// è¾“å‡ºSLDataSink dataSink = &#123; &amp;dataSinkLocator, // å®šä½å™¨ 0,&#125;; OpenSL ES Recorder å’Œ Player åŠŸèƒ½æž„å»ºAudio RecorderAudio Player PSï¼š Audio Player çš„ Data Source ä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°å­˜å‚¨æˆ–ç¼“å­˜çš„éŸ³é¢‘æ•°æ®ï¼Œä»¥ä¸Šå›¾ç‰‡æ¥è‡ªäºŽ Jhuster çš„åšå®¢ã€‚ ä»£ç å®žçŽ°ä»¥ä¸‹ä»£ç ä¸»è¦å®žçŽ°éŸ³é¢‘æ•°æ®çš„é‡‡é›†ã€ä¿å­˜å’Œæ’­æ”¾ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358//// Created by haohao on 2018/1/12.//#include &lt;jni.h&gt;#include &lt;string&gt;#include &lt;assert.h&gt;#include &lt;SLES/OpenSLES.h&gt;#include &lt;SLES/OpenSLES_Android.h&gt;#include &lt;android/log.h&gt;#define AUDIO_SRC_PATH "/sdcard/audio.pcm"#define LOGI(FORMAT, ...) __android_log_print(ANDROID_LOG_INFO,"haohao",FORMAT,##__VA_ARGS__);#define LOGE(FORMAT, ...) __android_log_print(ANDROID_LOG_ERROR,"haohao",FORMAT,##__VA_ARGS__);#define NUM_RECORDER_EXPLICIT_INTERFACES 2#define NUM_BUFFER_QUEUE 1#define SAMPLE_RATE 44100#define PERIOD_TIME 20 // 20ms#define FRAME_SIZE SAMPLE_RATE * PERIOD_TIME / 1000#define CHANNELS 2#define BUFFER_SIZE (FRAME_SIZE * CHANNELS)// engine interfacesstatic SLObjectItf engineObject = NULL;static SLEngineItf engineEngine = NULL;// audio recorder interfacesstatic SLObjectItf recorderObject = NULL;static SLRecordItf recorderRecord = NULL;static SLAndroidSimpleBufferQueueItf recorderBuffQueueItf = NULL;static SLAndroidConfigurationItf configItf = NULL;// pcm audio player interfacesstatic SLObjectItf playerObject = NULL;static SLPlayItf playerPlay = NULL;static SLObjectItf outputMixObjext = NULL; // æ··éŸ³å™¨static SLAndroidSimpleBufferQueueItf playerBufferQueueItf = NULL;void createEngine()&#123; SLEngineOption EngineOption[] = &#123; &#123;(SLuint32) SL_ENGINEOPTION_THREADSAFE, (SLuint32) SL_BOOLEAN_TRUE&#125; &#125;; SLresult result; result = slCreateEngine(&amp;engineObject, 1, EngineOption, 0, NULL, NULL); assert(SL_RESULT_SUCCESS == result); /* Realizing the SL Engine in synchronous mode. */ result = (*engineObject)-&gt;Realize(engineObject, SL_BOOLEAN_FALSE); assert(SL_RESULT_SUCCESS == result); // get the engine interface, which is needed in order to create other objects result = (*engineObject)-&gt;GetInterface(engineObject, SL_IID_ENGINE, &amp;engineEngine); assert(SL_RESULT_SUCCESS == result);&#125;class AudioContext &#123;public: FILE *pfile; uint8_t *buffer; size_t bufferSize; AudioContext(FILE *pfile, uint8_t *buffer, size_t bufferSize)&#123; this-&gt;pfile = pfile; this-&gt;buffer = buffer; this-&gt;bufferSize = bufferSize; &#125;&#125;;static AudioContext *recorderContext = NULL;// å½•åˆ¶éŸ³é¢‘æ—¶çš„å›žè°ƒvoid AudioRecorderCallback(SLAndroidSimpleBufferQueueItf bufferQueueItf, void *context)&#123; AudioContext *recorderContext = (AudioContext*)context; assert(recorderContext != NULL); if (recorderContext-&gt;buffer != NULL) &#123; fwrite(recorderContext-&gt;buffer, recorderContext-&gt;bufferSize, 1, recorderContext-&gt;pfile); LOGI("save a frame audio data."); SLresult result; SLuint32 state; result = (*recorderRecord)-&gt;GetRecordState(recorderRecord, &amp;state); assert(SL_RESULT_SUCCESS == result); (void) result; if (state == SL_RECORDSTATE_RECORDING) &#123; result = (*bufferQueueItf)-&gt;Enqueue(bufferQueueItf, recorderContext-&gt;buffer, recorderContext-&gt;bufferSize); assert(SL_RESULT_SUCCESS == result); (void) result; &#125; &#125;&#125;// æ’­æ”¾éŸ³é¢‘æ—¶çš„å›žè°ƒvoid AudioPlayerCallback(SLAndroidSimpleBufferQueueItf bufferQueueItf, void *context)&#123; AudioContext *playerContext = (AudioContext*)context; if (!feof(playerContext-&gt;pfile)) &#123; fread(playerContext-&gt;buffer, playerContext-&gt;bufferSize, 1, playerContext-&gt;pfile); LOGI("read a frame audio data."); (*bufferQueueItf)-&gt;Enqueue(bufferQueueItf, playerContext-&gt;buffer, playerContext-&gt;bufferSize); &#125; else &#123; fclose(playerContext-&gt;pfile); delete playerContext-&gt;buffer; &#125;&#125;// åˆ›å»ºéŸ³é¢‘æ’­æ”¾å™¨void createAudioPlayer(SLEngineItf engineEngine, SLObjectItf outputMixObject, SLObjectItf &amp;audioPlayerObject)&#123; SLDataLocator_AndroidSimpleBufferQueue dataSourceLocator = &#123; SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE, 1 &#125;; // PCM æ•°æ®æºæ ¼å¼ SLDataFormat_PCM dataSourceFormat = &#123; SL_DATAFORMAT_PCM, 2, SL_SAMPLINGRATE_44_1, SL_PCMSAMPLEFORMAT_FIXED_16, 16, SL_SPEAKER_FRONT_LEFT| SL_SPEAKER_FRONT_RIGHT, SL_BYTEORDER_LITTLEENDIAN &#125;; SLDataSource dataSource = &#123; &amp;dataSourceLocator, &amp;dataSourceFormat &#125;; SLDataLocator_OutputMix dataSinkLocator = &#123; SL_DATALOCATOR_OUTPUTMIX, // å®šä½å™¨ç±»åž‹ outputMixObject // è¾“å‡ºæ··åˆ &#125;; SLDataSink dataSink = &#123; &amp;dataSinkLocator, // å®šä½å™¨ 0, &#125;; // éœ€è¦çš„æŽ¥å£ SLInterfaceID interfaceIDs[] = &#123; SL_IID_BUFFERQUEUE &#125;; SLboolean requiredInterfaces[] = &#123; SL_BOOLEAN_TRUE &#125;; // åˆ›å»ºéŸ³é¢‘æ’­æ”¾å¯¹è±¡ SLresult result = (*engineEngine)-&gt;CreateAudioPlayer( engineEngine, &amp;audioPlayerObject, &amp;dataSource, &amp;dataSink, 1, interfaceIDs, requiredInterfaces ); assert(SL_RESULT_SUCCESS == result); (void) result;&#125;extern "C" &#123;// å¼€å§‹æ’­æ”¾éŸ³é¢‘JNIEXPORT void JNICALLJava_com_haohao_opensl_1es_AudioRecorder_startPlay(JNIEnv *env, jobject instance) &#123; // åˆ›å»ºå¼•æ“Ž if (engineEngine == NULL) &#123; createEngine(); &#125; // åˆ›å»ºæ··éŸ³å™¨ SLresult result; result = (*engineEngine)-&gt;CreateOutputMix(engineEngine, &amp;outputMixObjext, 0, 0, 0); assert(SL_RESULT_SUCCESS == result); (void) result; result = (*outputMixObjext)-&gt;Realize(outputMixObjext, SL_BOOLEAN_FALSE); assert(SL_RESULT_SUCCESS == result); (void) result; FILE *p_file = fopen(AUDIO_SRC_PATH, "r"); // åˆ›å»ºæ’­æ”¾å™¨ createAudioPlayer(engineEngine, outputMixObjext, playerObject); result = (*playerObject)-&gt;Realize(playerObject, SL_BOOLEAN_FALSE); assert(SL_RESULT_SUCCESS == result); (void) result; result = (*playerObject)-&gt;GetInterface(playerObject, SL_IID_BUFFERQUEUE, &amp;playerBufferQueueItf); assert(SL_RESULT_SUCCESS == result); (void) result; uint8_t *buffer = new uint8_t[BUFFER_SIZE]; AudioContext *playerContext = new AudioContext(p_file, buffer, BUFFER_SIZE); result = (*playerBufferQueueItf)-&gt;RegisterCallback(playerBufferQueueItf, AudioPlayerCallback, playerContext); assert(SL_RESULT_SUCCESS == result); (void) result; result = (*playerObject)-&gt;GetInterface(playerObject, SL_IID_PLAY, &amp;playerPlay); assert(SL_RESULT_SUCCESS == result); (void) result; result = (*playerPlay)-&gt;SetPlayState(playerPlay, SL_PLAYSTATE_PLAYING); assert(SL_RESULT_SUCCESS == result); AudioPlayerCallback(playerBufferQueueItf, playerContext);&#125;// åœæ­¢æ’­æ”¾éŸ³é¢‘JNIEXPORT void JNICALLJava_com_haohao_opensl_1es_AudioRecorder_stopPlay(JNIEnv *env, jobject instance) &#123; if (playerPlay != NULL) &#123; SLresult result; result = (*playerPlay)-&gt;SetPlayState(playerPlay, SL_PLAYSTATE_STOPPED); assert(SL_RESULT_SUCCESS == result); &#125;&#125;// å¼€å§‹é‡‡é›†éŸ³é¢‘æ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°JNIEXPORT void JNICALLJava_com_haohao_opensl_1es_AudioRecorder_startRecord(JNIEnv *env, jobject instance) &#123; if (engineEngine == NULL) &#123; createEngine(); &#125; if (recorderObject != NULL) &#123; LOGI("Audio recorder already has been created."); return ; &#125; FILE *p_file = fopen(AUDIO_SRC_PATH, "w"); if (p_file == NULL) &#123; LOGI("Fail to open file."); return ; &#125; SLresult result; /* setup the data source*/ SLDataLocator_IODevice ioDevice = &#123; SL_DATALOCATOR_IODEVICE, SL_IODEVICE_AUDIOINPUT, SL_DEFAULTDEVICEID_AUDIOINPUT, NULL &#125;; SLDataSource recSource = &#123;&amp;ioDevice, NULL&#125;; SLDataLocator_AndroidSimpleBufferQueue recBufferQueue = &#123; SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE, NUM_BUFFER_QUEUE &#125;; SLDataFormat_PCM pcm = &#123; SL_DATAFORMAT_PCM, // pcm æ ¼å¼çš„æ•°æ® 2, // 2 ä¸ªå£°é“ï¼ˆç«‹ä½“å£°ï¼‰ SL_SAMPLINGRATE_44_1, // 44100hz çš„é‡‡æ ·é¢‘çŽ‡ SL_PCMSAMPLEFORMAT_FIXED_16, SL_PCMSAMPLEFORMAT_FIXED_16, SL_SPEAKER_FRONT_LEFT| SL_SPEAKER_FRONT_RIGHT, SL_BYTEORDER_LITTLEENDIAN &#125;; SLDataSink dataSink = &#123; &amp;recBufferQueue, &amp;pcm &#125;; SLInterfaceID iids[NUM_RECORDER_EXPLICIT_INTERFACES] = &#123;SL_IID_ANDROIDSIMPLEBUFFERQUEUE, SL_IID_ANDROIDCONFIGURATION&#125;; SLboolean required[NUM_RECORDER_EXPLICIT_INTERFACES] = &#123;SL_BOOLEAN_TRUE, SL_BOOLEAN_TRUE&#125;; /* Create the audio recorder */ result = (*engineEngine)-&gt;CreateAudioRecorder(engineEngine, &amp;recorderObject , &amp;recSource, &amp;dataSink, NUM_RECORDER_EXPLICIT_INTERFACES, iids, required); assert(SL_RESULT_SUCCESS == result); /* get the android configuration interface*/ result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_ANDROIDCONFIGURATION, &amp;configItf); assert(SL_RESULT_SUCCESS == result); /* Realize the recorder in synchronous mode. */ result = (*recorderObject)-&gt;Realize(recorderObject, SL_BOOLEAN_FALSE); assert(SL_RESULT_SUCCESS == result); /* Get the buffer queue interface which was explicitly requested */ result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_ANDROIDSIMPLEBUFFERQUEUE, (void*) &amp;recorderBuffQueueItf); assert(SL_RESULT_SUCCESS == result); /* get the record interface */ result = (*recorderObject)-&gt;GetInterface(recorderObject, SL_IID_RECORD, &amp;recorderRecord); assert(SL_RESULT_SUCCESS == result); uint8_t *buffer = new uint8_t[BUFFER_SIZE]; recorderContext = new AudioContext(p_file, buffer, BUFFER_SIZE); result = (*recorderBuffQueueItf)-&gt;RegisterCallback(recorderBuffQueueItf, AudioRecorderCallback, recorderContext); assert(SL_RESULT_SUCCESS == result); /* Enqueue buffers to map the region of memory allocated to store the recorded data */ result = (*recorderBuffQueueItf)-&gt;Enqueue(recorderBuffQueueItf, recorderContext-&gt;buffer, BUFFER_SIZE); assert(SL_RESULT_SUCCESS == result); /* Start recording */ // å¼€å§‹å½•åˆ¶éŸ³é¢‘ result = (*recorderRecord)-&gt;SetRecordState(recorderRecord, SL_RECORDSTATE_RECORDING); assert(SL_RESULT_SUCCESS == result); LOGI("Starting recording");&#125;// åœæ­¢éŸ³é¢‘é‡‡é›†JNIEXPORT void JNICALLJava_com_haohao_opensl_1es_AudioRecorder_stopRecord(JNIEnv *env, jobject instance) &#123; if (recorderRecord != NULL) &#123; SLresult result = (*recorderRecord)-&gt;SetRecordState(recorderRecord, SL_RECORDSTATE_STOPPED); assert(SL_RESULT_SUCCESS == result); if (recorderContext != NULL) &#123; fclose(recorderContext-&gt;pfile); delete recorderContext-&gt;buffer; &#125; &#125;&#125;// é‡Šæ”¾èµ„æºJNIEXPORT void JNICALLJava_com_haohao_opensl_1es_AudioRecorder_release(JNIEnv *env, jobject instance) &#123; if (recorderObject != NULL) &#123; (*recorderObject)-&gt;Destroy(recorderObject); recorderObject = NULL; recorderRecord = NULL; recorderBuffQueueItf = NULL; configItf = NULL; recorderContext = NULL; &#125; if (playerObject != NULL) &#123; (*playerObject)-&gt;Destroy(playerObject); playerObject = NULL; playerPlay = NULL; playerBufferQueueItf = NULL; outputMixObjext = NULL; &#125; // destroy engine object, and invalidate all associated interfaces if (engineObject != NULL) &#123; (*engineObject)-&gt;Destroy(engineObject); engineObject = NULL; engineEngine = NULL; &#125;&#125;&#125;; CMake è„šæœ¬ CMakeLists.txt ã€‚123456789101112131415cmake_minimum_required(VERSION 3.4.1)add_library( # Sets the name of the library. audio-recorder # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). src/main/cpp/audio-recorder.cpp)target_link_libraries(audio-recorder android log OpenSLES)]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK POSIX å¤šçº¿ç¨‹ç¼–ç¨‹]]></title>
      <url>%2F2018%2F01%2F09%2FNDK-posix-multi-thread%2F</url>
      <content type="text"><![CDATA[äººä»·å€¼çš„é«˜ä½Žå–å†³äºŽç¨€ç¼ºæ€§ï¼Œå³ä¸å¯ä»£æ›¿æ€§ã€‚ æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹å¸¸ç”¨çš„ API ã€‚ æœ¬åšå®¢ NDK å¼€å‘ç³»åˆ—æ–‡ç« ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’ POSIXPOSIX å…¨ç§°æ˜¯ Portable Operating System Interface of UNIX ï¼Œè¡¨ç¤ºå¯ç§»æ¤æ“ä½œç³»ç»ŸæŽ¥å£ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹æ ‡å‡†ã€‚å®ƒå®šä¹‰äº†æ“ä½œç³»ç»Ÿåº”è¯¥ä¸ºåº”ç”¨ç¨‹åºæä¾›çš„æŽ¥å£æ ‡å‡†ï¼Œæ˜¯ IEEE ä¸ºè¦åœ¨å„ç§ UNIX æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„è½¯ä»¶è€Œå®šä¹‰çš„ä¸€ç³»åˆ— API æ ‡å‡†çš„æ€»ç§°ã€‚ PthreadsPOSIX çº¿ç¨‹æ˜¯ POSIX çš„çº¿ç¨‹æ ‡å‡†ï¼Œä¹Ÿç§°ä¸º Pthreads ï¼Œå®ƒå®šä¹‰äº†åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„ä¸€å¥— API ã€‚æœ¬æ–‡çš„ Pthreads æ˜¯å®žçŽ° POSIX çº¿ç¨‹æ ‡å‡†çš„ c è¯­è¨€ç¼–ç¨‹åº“ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬å¤šçº¿ç¨‹çš„å®žçŽ°ç”± POSIX å¤šçº¿ç¨‹ç¼–ç¨‹å®žçŽ°ï¼Œè€Œ Android ç³»ç»ŸåŸºäºŽ Linux ç³»ç»Ÿï¼ŒåŽŸç”Ÿä¾¿æ”¯æŒ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚ POSIX Linux ç¼–è¯‘å‘½ä»¤ï¼šgcc hello.c -o hello -lpthreadï¼Œæ‰§è¡Œå‘½ä»¤ï¼š./helloã€‚ ç”±äºŽæœ¬æ–‡è®²çš„æ˜¯ NDK å¼€å‘ï¼Œä»£ç ç¼–è¯‘åŸºäºŽ Android å¹³å°å®žçŽ°ã€‚ POSIX çº¿ç¨‹åˆ›å»ºçº¿ç¨‹åˆ›å»ºç›¸å…³ APIï¼špthread_t çº¿ç¨‹ id ã€‚pthread_create è´Ÿè´£åˆ›å»ºçº¿ç¨‹ï¼Œä¼ å…¥ pthread_tï¼ˆçº¿ç¨‹ ID ï¼‰çš„æŒ‡é’ˆï¼Œçº¿ç¨‹çš„æ‰§è¡Œæ–¹æ³•å’Œä¼ å…¥çº¿ç¨‹çš„å‚æ•°ã€‚pthread_join ä½¿å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…æŒ‡å®šçº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå¹¶èŽ·å–çº¿ç¨‹è¿”å›žå€¼ã€‚pthread_exit é€€å‡ºå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å½“å‰çº¿ç¨‹çš„è¿”å›žå€¼ã€‚pthread_cancel ç»ˆæ­¢å½“å‰çº¿ç¨‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include "hello-thread.h"#define NUM_THREADS 5// ç±»ä¼¼äºŽ Java Runnablevoid *run(void *arg)&#123; // å–ä¼ å…¥å½“å‰çº¿ç¨‹çš„å‚æ•° char *thread_tag = (char*)arg; for (int i = 0; i &lt; 5; ++i) &#123; LOGD("%s thread %d", thread_tag, i); if (i == 4) &#123; // ç»“æŸå½“å‰çº¿ç¨‹,å‚æ•°ä¸ºçº¿ç¨‹ç»“æŸåŽçš„è¿”å›žå€¼ pthread_exit(thread_tag); //pthread_cancel(); send a cancellation request to a thread &#125; &#125; return 0; // çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®ŒæˆåŽçš„è¿”å›žå€¼&#125;void create_threads()&#123; LOGD("Main thread"); char tag_arr[][5] = &#123;"No.1","No.2","No.3","No.4","No.5"&#125;; //çº¿ç¨‹ id ï¼Œç”¨äºŽåŒºåˆ†çº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ id pthread_t tids[NUM_THREADS]; for (int i = 0; i &lt; NUM_THREADS; ++i) &#123; // åˆ›å»ºçº¿ç¨‹ï¼ŒæŒ‡å®š run æ–¹æ³•ï¼Œä¼ å…¥å‚æ•° tags[i] pthread_create(&amp;tids[i], NULL, run, (void *) tag_arr[i]); &#125; void *return_val[NUM_THREADS]; for (int i = 0; i &lt; NUM_THREADS; ++i) &#123; // é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç­‰å¾…æŒ‡å®š tid çš„çº¿ç¨‹ç»“æŸï¼Œå¹¶èŽ·å–çº¿ç¨‹è¿”å›žå€¼ // join with a terminated thread pthread_join(tids[i], &amp;return_val[i]); LOGD("thread %s terminated.", (char*)return_val[i]); &#125;&#125; è¿è¡Œç»“æžœï¼š12345678910111213141516171819202122232425262728293031I/hello-thread: Main threadI/hello-thread: No.1 thread 0I/hello-thread: No.1 thread 1I/hello-thread: No.1 thread 2I/hello-thread: No.1 thread 3I/hello-thread: No.1 thread 4I/hello-thread: No.2 thread 0I/hello-thread: No.2 thread 1I/hello-thread: No.2 thread 2I/hello-thread: No.2 thread 3I/hello-thread: No.2 thread 4I/hello-thread: No.3 thread 0I/hello-thread: No.3 thread 1I/hello-thread: No.3 thread 2I/hello-thread: No.3 thread 3I/hello-thread: No.3 thread 4I/hello-thread: No.4 thread 0I/hello-thread: No.4 thread 1I/hello-thread: No.4 thread 2I/hello-thread: No.4 thread 3I/hello-thread: No.4 thread 4I/hello-thread: thread No.1 terminated.I/hello-thread: No.5 thread 0I/hello-thread: No.5 thread 1I/hello-thread: No.5 thread 2I/hello-thread: No.5 thread 3I/hello-thread: No.5 thread 4I/hello-thread: thread No.2 terminated.I/hello-thread: thread No.3 terminated.I/hello-thread: thread No.4 terminated.I/hello-thread: thread No.5 terminated. POSIX çº¿ç¨‹åŒæ­¥çº¿ç¨‹åŒæ­¥ç›¸å…³ API :pthread_mutex_t äº’æ–¥é”ã€‚pthread_mutex_init åˆå§‹åŒ–äº’æ–¥é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚pthread_mutex_destroy é”€æ¯äº’æ–¥é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚pthread_mutex_lock åŠ é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚pthread_mutex_unlock è§£é”ï¼Œéœ€ä¼ å…¥äº’æ–¥é”çš„æŒ‡é’ˆã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include "hello-thread.h"int g_count = 0;// äº’æ–¥é”pthread_mutex_t mutex;void *asyn_run(void *arg)&#123; // lock pthread_mutex_lock(&amp;mutex); // å–ä¼ å…¥å½“å‰çº¿ç¨‹çš„å‚æ•° char *thread_tag = (char*)arg; for (int i = 0; i &lt; 10; ++i) &#123; // ä¼‘çœ  200 ms usleep(200 * 1000); g_count ++; LOGD("%s thread %d, g_count = %d", thread_tag, i, g_count); &#125; // unlock pthread_mutex_unlock(&amp;mutex); return thread_tag; // çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®ŒæˆåŽçš„è¿”å›žå€¼&#125;void syn_thread()&#123; LOGD("Main thread"); // åˆå§‹åŒ–äº’æ–¥é” pthread_mutex_init(&amp;mutex, NULL); pthread_t t1, t2; // åˆ›å»º 2 ä¸ªçº¿ç¨‹ pthread_create(&amp;t1, NULL, asyn_run, "No.1"); pthread_create(&amp;t2, NULL, asyn_run, "No.2"); void *rtn_val[2]; pthread_join(t1, &amp;rtn_val[0]); pthread_join(t2, &amp;rtn_val[1]); LOGD("thread %s terminated.", (char*)rtn_val[0]); LOGD("thread %s terminated.", (char*)rtn_val[1]); // é”€æ¯äº’æ–¥é” pthread_mutex_destroy(&amp;mutex);&#125; è¿è¡Œç»“æžœï¼š12345678910111213141516171819202122I/hello-thread: No.1 thread 0, g_count = 1I/hello-thread: No.1 thread 1, g_count = 2I/hello-thread: No.1 thread 2, g_count = 3I/hello-thread: No.1 thread 3, g_count = 4I/hello-thread: No.1 thread 4, g_count = 5I/hello-thread: No.1 thread 5, g_count = 6I/hello-thread: No.1 thread 6, g_count = 7I/hello-thread: No.1 thread 7, g_count = 8I/hello-thread: No.1 thread 8, g_count = 9I/hello-thread: No.1 thread 9, g_count = 10I/hello-thread: No.2 thread 0, g_count = 11I/hello-thread: No.2 thread 1, g_count = 12I/hello-thread: No.2 thread 2, g_count = 13I/hello-thread: No.2 thread 3, g_count = 14I/hello-thread: No.2 thread 4, g_count = 15I/hello-thread: No.2 thread 5, g_count = 16I/hello-thread: No.2 thread 6, g_count = 17I/hello-thread: No.2 thread 7, g_count = 18I/hello-thread: No.2 thread 8, g_count = 19I/hello-thread: No.2 thread 9, g_count = 20I/hello-thread: thread No.1 terminated.I/hello-thread: thread No.2 terminated. POSIX çº¿ç¨‹é—´é€šä¿¡çº¿ç¨‹é—´é€šä¿¡ç›¸å…³ API ï¼špthread_cond_t æ¡ä»¶å˜é‡ï¼Œæ¡ä»¶å˜é‡æ˜¯çº¿ç¨‹åŒæ­¥çš„ä¸€ç§æ‰‹æ®µï¼Œä½¿çº¿ç¨‹å¯ä»¥ä¼‘çœ ç­‰å¾…æŸç§æ¡ä»¶å‡ºçŽ°ã€‚pthread_cond_signal å‘é€ä¸€ä¸ªä¿¡å·ç»™å¦å¤–ä¸€ä¸ªæ­£åœ¨å¤„äºŽé˜»å¡žç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼ŒåŽŸæœ¬è¿™ä¸¤ä¸ªçº¿ç¨‹ç«žäº‰åŒä¸€ä¸ª mutex lock ã€‚pthread_cond_wait ä½¿å½“å‰çº¿ç¨‹å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œç›´åˆ°æŽ¥æ”¶åˆ°å…¶ä»–çº¿ç¨‹å‘é€å¯¹åº”çš„ cond_signal ã€‚pthread_cond_init åˆå§‹åŒ–æ¡ä»¶å˜é‡ã€‚pthread_cond_destroy é”€æ¯æ¡ä»¶å˜é‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include "hello-thread.h"// å…±äº«æ•°æ®volatile int shared_count = 0;pthread_mutex_t pthread_mutex;// æ¡ä»¶å˜é‡pthread_cond_t pthread_cond;void *producer(void *arg)&#123; char *tag = (char*)arg; for (;;) &#123; pthread_mutex_lock(&amp;pthread_mutex); // ç”Ÿäº§è€…ç”Ÿäº§äº§å“ shared_count ++; LOGD("%s thread ç”Ÿäº§äº§å“, count = %d", tag, shared_count); // é€šçŸ¥æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹ pthread_cond_signal(&amp;pthread_cond); pthread_mutex_unlock(&amp;pthread_mutex); // ä¼‘çœ  200 ms usleep(200 * 1000); &#125; return (void*)0;&#125;void *consumer(void *arg)&#123; char* tag = (char*)arg; for(;;)&#123; pthread_mutex_lock(&amp;pthread_mutex); while (shared_count == 0)&#123; // å½“æ²¡æœ‰äº§å“å¯ä»¥æ¶ˆè´¹æ—¶ï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§ï¼ˆç­‰å¾…æ¡ä»¶å˜é‡è¢«å”¤é†’ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾äº’æ–¥é”ï¼‰ // å½“è¢«å…¶ä»–çº¿ç¨‹å”¤é†’æ—¶ï¼Œè§£é™¤é˜»å¡žçŠ¶æ€ï¼Œé‡æ–°ç”³è¯·èŽ·å¾—äº’æ–¥é” pthread_cond_wait(&amp;pthread_cond, &amp;pthread_mutex); &#125; shared_count --; LOGD("%s thread æ¶ˆè´¹äº§å“, count = %d", tag, shared_count); pthread_mutex_unlock(&amp;pthread_mutex); // ä¼‘çœ  500 ms usleep(500 * 1000); &#125; return (void*)0;&#125;;// çº¿ç¨‹é—´é€šä¿¡void communicate_thread()&#123; pthread_mutex_init(&amp;pthread_mutex, NULL); // åˆå§‹åŒ–æ¡ä»¶å˜é‡ pthread_cond_init(&amp;pthread_cond, NULL); // çº¿ç¨‹ id pthread_t producer_tid, consumer_tid; // åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹ pthread_create(&amp;producer_tid, NULL, producer, "producer"); // åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹ pthread_create(&amp;consumer_tid, NULL, consumer, "consumer"); // ç­‰å¾…çº¿ç¨‹ç»“æŸ pthread_join(producer_tid, NULL); pthread_join(consumer_tid, NULL); // é”€æ¯äº’æ–¥é” pthread_mutex_destroy(&amp;pthread_mutex); // é”€æ¯æ¡ä»¶å˜é‡ pthread_cond_destroy(&amp;pthread_cond);&#125; è¿è¡Œç»“æžœ:12345678910111213141516I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 1I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 0I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 1I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 2I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 1I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 2I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 3I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 2I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 3I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 4I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 5I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 4I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 5I/hello-thread: producer thread ç”Ÿäº§äº§å“, count = 6I/hello-thread: consumer thread æ¶ˆè´¹äº§å“, count = 5......]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK å¼€å‘ä¸­ Native ä¸Ž Java äº¤äº’]]></title>
      <url>%2F2018%2F01%2F06%2FNDK-native-call-java-method%2F</url>
      <content type="text"><![CDATA[äººç”Ÿè¿œæ¯”æˆ‘ä»¬æƒ³è±¡å¾—æ¼«é•¿ï¼Œæ‰€ä»¥ä¸äº‰ä¸€åŸŽä¸€æ± çš„å¾—å¤±ï¼Œè¦æŠŠä¸€åˆ‡æœºä¼šå’ŒæŒ«æŠ˜éƒ½æ”¾åˆ°å°½å¯èƒ½é•¿çš„å‘¨æœŸé‡Œæ¥æ€è€ƒã€‚ æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Native å±‚ä¸Ž Java äº¤äº’æ–¹å¼ å‰é¢æ–‡ç« åˆ†åˆ«ä»‹ç»çš„ NDK ç¼–è¯‘æ–¹å¼å’Œç¬¬ä¸‰æ–¹åº“çš„å¼•å…¥æ–¹å¼ï¼š NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼ åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ Java ä¸Ž JNI æ•°æ®ç±»åž‹å¯¹åº”å…³ç³» Java æ•°æ®ç±»åž‹ JNI æ•°æ®ç±»åž‹ boolean jboolean byte jbyte char jchar short jshort int jint long jlong float jfloat double jdouble String jstring Object jobject byte[] jbyteArray Object[] jobjectArray Native ä¸­çš„ç­¾åNDK å¼€å‘ä¸­ä¼šç”¨åˆ° Java å¯¹è±¡çš„å±žæ€§ç­¾åå’Œæ–¹æ³•ç­¾åï¼Œç”¨äºŽåŒºåˆ†ä¸åŒçš„å±žæ€§å’Œæ–¹æ³•ã€‚ å±žæ€§ç­¾åå±žæ€§çš„ç­¾åå°±æ˜¯å±žæ€§ç±»åž‹çš„ç®€ç§°ã€‚å±žæ€§ç±»åž‹ä¸Žå…¶ç­¾åçš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š å±žæ€§ç±»åž‹ ç±»åž‹ç­¾å boolean Z byte B char C short S int I long L float F double D void V String Ljava/lang/String; Object ä»¥ L å¼€å¤´ï¼ŒåŽåŠ å®Œæ•´çš„åŒ…åï¼Œå¹¶ä»¥åˆ†å·ç»“æŸ byte[] [B Object[] ä»¥ [ å¼€å¤´ï¼ŒåŽåŠ å¯¹è±¡ç±»åž‹ç­¾åï¼Œä¾‹å¦‚ String[] å¯¹åº” [Ljava/lang/String; æ–¹æ³•ç­¾åæ–¹æ³•ç­¾åæ ¼å¼ï¼š(å‚æ•°ç±»åž‹ç­¾å)è¿”å›žå€¼ç±»åž‹ç­¾å é‚£ä¹ˆå¦‚ä½•èŽ·å–æ–¹æ³•ç­¾åï¼Ÿæ‰§è¡Œå‘½ä»¤ javah &lt;class æ–‡ä»¶çš„å…¨å&gt;å¦‚ javah com.haohao.hellojni.NativeTest.class ç”Ÿæˆ com_haohao_hellojni_NativeTest.h æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­ä¾¿æ ‡å‡ºäº†æ–¹æ³•çš„ Signature ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869/* DO NOT EDIT THIS FILE - it is machine generated */#include &lt;jni.h&gt;/* Header for class com_haohao_hellojni_NativeTest */#ifndef _Included_com_haohao_hellojni_NativeTest#define _Included_com_haohao_hellojni_NativeTest#ifdef __cplusplusextern "C" &#123;#endif/* * Class: com_haohao_hellojni_NativeTest * Method: getString * Signature: ()Ljava/lang/String; */JNIEXPORT jstring JNICALL Java_com_haohao_hellojni_NativeTest_getString__ (JNIEnv *, jobject);/* * Class: com_haohao_hellojni_NativeTest * Method: getString * Signature: (Ljava/lang/String;)Ljava/lang/String; */JNIEXPORT jstring JNICALL Java_com_haohao_hellojni_NativeTest_getString__Ljava_lang_String_2 (JNIEnv *, jobject, jstring);/* * Class: com_haohao_hellojni_NativeTest * Method: getInt * Signature: ()I */JNIEXPORT jint JNICALL Java_com_haohao_hellojni_NativeTest_getInt__ (JNIEnv *, jobject);/* * Class: com_haohao_hellojni_NativeTest * Method: getInt * Signature: (I)I */JNIEXPORT jint JNICALL Java_com_haohao_hellojni_NativeTest_getInt__I (JNIEnv *, jobject, jint);/* * Class: com_haohao_hellojni_NativeTest * Method: input * Signature: (Ljava/lang/String;I)V */JNIEXPORT void JNICALL Java_com_haohao_hellojni_NativeTest_input__Ljava_lang_String_2I (JNIEnv *, jobject, jstring, jint);/* * Class: com_haohao_hellojni_NativeTest * Method: input * Signature: ([Ljava/lang/String;I)V */JNIEXPORT void JNICALL Java_com_haohao_hellojni_NativeTest_input___3Ljava_lang_String_2I (JNIEnv *, jobject, jobjectArray, jint);/* * Class: com_haohao_hellojni_NativeTest * Method: getBytes * Signature: ([Ljava/lang/String;Ljava/lang/String;)[B */JNIEXPORT jbyteArray JNICALL Java_com_haohao_hellojni_NativeTest_getBytes (JNIEnv *, jobject, jobjectArray, jstring);#ifdef __cplusplus&#125;#endif#endif Native ä¸Ž Java äº¤äº’è®¾ç½®ä¸€ä¸ªç®€å•çš„ç±» NativeUtils.java ç”¨äºŽæµ‹è¯•ï¼ŒNative ä¸Ž Java äº¤äº’çš„å®žçŽ°ç±»ä¼¼äºŽ Java çš„åå°„æœºåˆ¶ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940package com.haohao.hellojni;import android.util.Log;/** * author: haohao * time: 2018/1/1 * mail: haohaochang86@gmail.com * desc: description */public class NativeUtils &#123; static &#123; System.loadLibrary("native-utils"); &#125; private static final String TAG = "NativeUtils"; public static int staticProp = -1; public int prop = -1; public String getStringFromJava(String str)&#123; Log.i(TAG, "getStringFromJava: "+ str); return "Hello C , I am from Java."; &#125; public static String getStringFromJavaStatic(String str)&#123; Log.i(TAG, "getStringFromJavaStatic: " + str); return "Hello C , I am from Java static."; &#125; public native void accessJavaClassProp(); public native void callJavaClassMethod(); public static native void accessStaticJavaProp(); public static native void callStaticJavaMethod();&#125; è®¿é—® Java å¯¹è±¡çš„éžé™æ€å±žæ€§123456789101112131415JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_accessJavaClassProp(JNIEnv *env, jobject instance) &#123; //è®¿é—® Java å¯¹è±¡çš„éžé™æ€å±žæ€§ //é€šè¿‡ JNIEnv å’Œå¯¹è±¡ instance å®žä¾‹æ‹¿åˆ° class ã€‚ jclass cls = (*env)-&gt;GetObjectClass(env, instance); //èŽ·å–å±žæ€§çš„ field id jfieldID fid = (*env)-&gt;GetFieldID(env, cls, "prop", "I"); //é€šè¿‡ field id èŽ·å–å±žæ€§çš„å€¼ jint prop = (*env)-&gt;GetIntField(env, instance, fid); //åœ¨ Native å±‚ä¿®æ”¹å±žæ€§ prop += 101; (*env)-&gt;SetIntField(env, instance, fid, prop);&#125; è°ƒç”¨ Java å¯¹è±¡çš„éžé™æ€æ–¹æ³•1234567891011121314151617JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_callJavaClassMethod(JNIEnv *env, jobject instance) &#123; //è°ƒç”¨ Java å¯¹è±¡çš„éžé™æ€æ–¹æ³• jclass myClass = (*env)-&gt;GetObjectClass(env, instance); //èŽ·å–å‘æ–¹æ³•çš„ method id jmethodID mid = (*env)-&gt;GetMethodID(env, myClass, "getStringFromJava", "(Ljava/lang/String;)Ljava/lang/String;"); //è°ƒç”¨ Java å¯¹è±¡çš„æ–¹æ³• jstring jstr = (*env)-&gt;CallObjectMethod(env, instance, mid, (*env)-&gt;NewStringUTF(env, "Hello Java, I am From C.")); //jstring è½¬æ¢ä¸º c çš„å­—ç¬¦ä¸² const char* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, NULL); LOGD("%s", cstr); //æ³¨æ„åŒºåˆ«å¯¹å¾… Java å­—ç¬¦ä¸²å’Œ C çš„å­—ç¬¦ä¸²ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»åž‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½éœ€è¦è¿›è¡Œç±»åž‹è½¬æ¢ //é‡Šæ”¾èµ„æº (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);&#125; è®¿é—® Java å¯¹è±¡çš„é™æ€å±žæ€§12345678910JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_accessStaticJavaProp(JNIEnv *env, jclass type) &#123; //è®¿é—® Java å¯¹è±¡çš„é™æ€å±žæ€§, jfieldID fid = (*env)-&gt;GetStaticFieldID(env, type, "staticProp", "I"); jint staticProp = (*env)-&gt;GetStaticIntField(env, type, fid); staticProp += 101; (*env)-&gt;SetStaticIntField(env, type, fid, staticProp);&#125; è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³•123456789101112JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_callStaticJavaMethod(JNIEnv *env, jclass type) &#123; //è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³• jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, "getStringFromJavaStatic", "(Ljava/lang/String;)Ljava/lang/String;"); jstring jstr = (*env)-&gt;CallStaticObjectMethod(env, type, mid, (*env)-&gt;NewStringUTF(env, "Hello Java, I am From C.")); const char* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, NULL); LOGD("%s", cstr); //é‡Šæ”¾èµ„æº (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);&#125; æµ‹è¯•123456789nativeUtils = new NativeUtils();Log.i(TAG, "old prop : " + nativeUtils.prop);nativeUtils.accessJavaClassProp();Log.i(TAG, "new prop : " + nativeUtils.prop);Log.i(TAG, "old static prop : " + NativeUtils.staticProp);NativeUtils.accessStaticJavaProp();Log.i(TAG, "new static prop : " + NativeUtils.staticProp);nativeUtils.callJavaClassMethod();NativeUtils.callStaticJavaMethod(); native-utils.c å®Œæ•´ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667//// Created by haohao on 2018/1/1.//#include &lt;jni.h&gt;#include &lt;android/log.h&gt;#define TAG "native-utils"#define LOGD(...) __android_log_print(ANDROID_LOG_INFO,TAG ,__VA_ARGS__) // å®šä¹‰LOGDç±»åž‹JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_accessJavaClassProp(JNIEnv *env, jobject instance) &#123; //è®¿é—® Java å¯¹è±¡çš„éžé™æ€å±žæ€§ //é€šè¿‡ JNIEnv å’Œå¯¹è±¡ instance å®žä¾‹æ‹¿åˆ° class ã€‚ jclass cls = (*env)-&gt;GetObjectClass(env, instance); //èŽ·å–å±žæ€§çš„ field id jfieldID fid = (*env)-&gt;GetFieldID(env, cls, "prop", "I"); //é€šè¿‡ field id èŽ·å–å±žæ€§çš„å€¼ jint prop = (*env)-&gt;GetIntField(env, instance, fid); //åœ¨ Native å±‚ä¿®æ”¹å±žæ€§ prop += 101; (*env)-&gt;SetIntField(env, instance, fid, prop);&#125;JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_callJavaClassMethod(JNIEnv *env, jobject instance) &#123; //è°ƒç”¨ Java å¯¹è±¡çš„éžé™æ€æ–¹æ³• jclass myClass = (*env)-&gt;GetObjectClass(env, instance); //èŽ·å–å‘æ–¹æ³•çš„ method id jmethodID mid = (*env)-&gt;GetMethodID(env, myClass, "getStringFromJava", "(Ljava/lang/String;)Ljava/lang/String;"); //è°ƒç”¨ Java å¯¹è±¡çš„æ–¹æ³• jstring jstr = (*env)-&gt;CallObjectMethod(env, instance, mid, (*env)-&gt;NewStringUTF(env, "Hello Java, I am From C.")); //jstring è½¬æ¢ä¸º c çš„å­—ç¬¦ä¸² const char* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, NULL); LOGD("%s", cstr); //æ³¨æ„åŒºåˆ«å¯¹å¾… Java å­—ç¬¦ä¸²å’Œ C çš„å­—ç¬¦ä¸²ï¼Œé™¤äº†åŸºæœ¬æ•°æ®ç±»åž‹ä¹‹å¤–ï¼Œå…¶ä»–éƒ½éœ€è¦è¿›è¡Œç±»åž‹è½¬æ¢ //é‡Šæ”¾èµ„æº (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);&#125;JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_accessStaticJavaProp(JNIEnv *env, jclass type) &#123; //è®¿é—® Java å¯¹è±¡çš„é™æ€å±žæ€§, jfieldID fid = (*env)-&gt;GetStaticFieldID(env, type, "staticProp", "I"); jint staticProp = (*env)-&gt;GetStaticIntField(env, type, fid); staticProp += 101; (*env)-&gt;SetStaticIntField(env, type, fid, staticProp);&#125;JNIEXPORT void JNICALLJava_com_haohao_hellojni_NativeUtils_callStaticJavaMethod(JNIEnv *env, jclass type) &#123; //è°ƒç”¨ Java å¯¹è±¡çš„é™æ€æ–¹æ³• jmethodID mid = (*env)-&gt;GetStaticMethodID(env, type, "getStringFromJavaStatic", "(Ljava/lang/String;)Ljava/lang/String;"); jstring jstr = (*env)-&gt;CallStaticObjectMethod(env, type, mid, (*env)-&gt;NewStringUTF(env, "Hello Java, I am From C.")); const char* cstr = (*env)-&gt;GetStringUTFChars(env, jstr, NULL); LOGD("%s", cstr); //é‡Šæ”¾èµ„æº (*env)-&gt;ReleaseStringUTFChars(env, jstr, cstr);&#125; ç»“æžœ12345678I/MainActivity: old prop : -1I/MainActivity: new prop : 100I/MainActivity: old static prop : -1I/MainActivity: new static prop : 100I/NativeUtils: getStringFromJava: Hello Java, I am From C.I/native-utils: Hello C , I am from Java.I/NativeUtils: getStringFromJavaStatic: Hello Java, I am From C.I/native-utils: Hello C , I am from Java static.]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ä½ å¥½ 2018]]></title>
      <url>%2F2018%2F01%2F01%2Fhello-2018%2F</url>
      <content type="text"><![CDATA[ä¸º 2018 ç«‹å‡ ä¸ª FLAG å›žçœ‹ 20172017 æ˜¯æžå…¶å¹³æ·¡çš„ä¸€å¹´ï¼Œä¹Ÿæ˜¯å­•è‚²å¸Œæœ›çš„ä¸€å¹´ã€‚2017 æˆ‘è¿˜åœ¨è¯»ç ”ï¼Œ2017 æˆ‘è¿˜åœ¨ç§Ÿæˆ¿ã€‚å¦‚æžœéžè¦ç”¨å‡ ä¸ªå­—æ¥å½¢å®¹ 2017 å¹´ï¼Œé‚£å°±æ˜¯â€œå­¦ä¹ â€ã€â€œç¾Žé£Ÿâ€ã€â€œç”µå½±â€ã€‚ æ•´ä¸ª 2017 å¹´ï¼Œæˆ‘å’Œåª³å¦‡å„¿ï¼Œçœ‹äº†å¾ˆå¤šåœºç”µå½±ï¼Œåƒäº†å¾ˆå¤šé¡¿å¤§é¤ï¼ˆç›´æŽ¥çš„åŽæžœå°±æ˜¯å¯¼è‡´æˆ‘çš„ä½“é‡å¢žåŠ  10 æ–¤ï¼‰ï¼Œè¿™ä¹Ÿè®¸æ˜¯æˆ‘ä»¬æœ€å¤§çš„å…±åŒçˆ±å¥½ã€‚2017 å¹´ä¸»è¦é åª³å¦‡å„¿çš„å·¥ä½œæ”¶å…¥å’Œæˆ‘ç ”ç©¶ç”Ÿçš„å¾®è–„è¡¥è¶³ï¼Œæ”¯æ’‘ç€æˆ‘ä»¬çš„â€œç”µå½±â€ã€â€œç¾Žé£Ÿâ€å’Œæˆ¿ç§Ÿï¼Œå¦å¤–æˆ‘ä»¬è¿˜å–œæ¬¢åˆ°å¤„èµ°èµ°ã€‚ æŽ¥ä¸‹æ¥ä¸»è¦æ€»ç»“ä¸€ä¸‹ï¼Œ2017 å¹´åœ¨æŠ€æœ¯æ–¹é¢çš„ä¸€äº›æ”¶èŽ·ã€‚é™¤äº†æžé¡¹ç›®ä¹‹å¤–ï¼Œä¸ŠåŠå¹´ä¸»è¦æŽŒæ¡äº† Facebook çš„å…¨å®¶æ¡¶ï¼ŒåŒ…æ‹¬ RN å’Œ React å‰ç«¯å¼€å‘æŠ€æœ¯ï¼Œä¸‹åŠå¹´ä»¥å®Œæˆè®ºæ–‡ä¸ºç›®çš„å­¦ä¹ äº† Python å’Œ TensorFlow å¼€å‘ï¼Œå†åˆ°åŽæ¥ï¼Œç³»ç»Ÿåœ°å­¦ä¹ äº† Kotlin Android å¼€å‘ã€‚ä»¥ä¸ŠæŠ€æœ¯å­¦ä¹ éƒ½æ˜¯åŸºäºŽä¸ªäººå…´è¶£ï¼Œè‡ªå·±åšäº†å‡ ä¸ªå°é¡¹ç›®ï¼Œå¹¶æ²¡æœ‰è¿ç”¨çš„ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚æ€»ä½“æ¥è¯´ï¼Œå¯¹å¸¸è§„å¼€å‘ä¸­çš„æŠ€æœ¯æ ˆæœ‰äº†ä¸€å®šçš„æŽŒæ¡ï¼Œä½†å¹¶æ²¡æœ‰æ·±å…¥ï¼Œè¿™ä¹Ÿæ˜¯å…´è¶£å¤ªå¹¿æ³›çš„ç¼ºç‚¹ã€‚ å›žæœ› 2017 ï¼Œéžå¸¸æ„Ÿè°¢å¯¼å¸ˆå’ŒåŒå­¦åœ¨ç”Ÿæ´»å’Œå­¦ä¹ ä¸Šç»™äºˆæˆ‘çš„å¸®åŠ©ï¼Œæ„Ÿè°¢æˆ‘çš„å®¶äººç»™äºˆæˆ‘çš„é™ªä¼´å’Œæ”¯æŒã€‚ å±•æœ› 2018ä¸å¾—ä¸è¯´ï¼Œæ—¶é—´è¿‡å¾—çœŸçš„æ˜¯å¤ªå¿«äº†ï¼Œå¤§ä¸€çš„ç”Ÿæ´»è¿˜åŽ†åŽ†åœ¨ç›®ï¼Œå¯æ˜¯é‚£å·²ç»æ˜¯ 7 å¹´å‰çš„äº‹äº†ã€‚æ­£å¦‚ï¼Œä¸Šå¸æ‚„æ‚„å·èµ°äº†æˆ‘ä»¬çš„çº¯çœŸï¼Œå´ç¥žåœ£åœ°è¯´æ˜¯æˆé•¿çš„ä»£ä»·ã€‚ é©¬ä¸Šå°±è¦æ¯•ä¸šäº†ï¼ŒæŽ¥ä¸‹æ¥å¿…é¡»è¦ç‹¬å½“ä¸€é¢ï¼Œç»™æˆ‘çš„ 2018 ç«‹å‡ ä¸ª FLAG ï¼ˆå¸Œæœ›æ˜Žå¹´å†çœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ä¸ä¼šè„¸ç–¼ï¼‰ã€‚ ç”Ÿæ´»ç»§ç»­åŸ¹å…»æˆ‘å’Œåª³å¦‡å„¿å…±åŒçˆ±å¥½ï¼Œâ€œç”µå½±â€ã€â€œç¾Žé£Ÿâ€ï¼Œåœ¨è¿½åŠ ä¸€ä¸ªâ€œåˆ°å¤„èµ°èµ°â€ã€‚ç»§ç»­åŸ¹å…»æˆ‘çš„æ–°æŠ€èƒ½â€“çƒ¹é¥ªï¼Œå…·ä½“ä¸€ç‚¹å°±æ˜¯ç²¾é€šåª³å¦‡å„¿æœ€å–œæ¬¢åƒçš„é‚£å‡ é“èœçš„åšæ³•ã€‚ç­‰æœªæ¥ä»€ä¹ˆæ—¶å€™äººå·¥æ™ºèƒ½ä¹Ÿæ·˜æ±°äº†ï¼Œé‚£æˆ‘å°±å½“åŽ¨å¸ˆå’¯ï¼Œäººç±»æ€»è¦åƒé¥­çš„ï¼Œå“ˆå“ˆã€‚ æŠ€æœ¯ç†Ÿç»ƒæŽŒæ¡éŸ³è§†é¢‘ç¼–è§£ç æŠ€æœ¯ï¼Œè‡³å°‘æžä¸€ä¸ªå¼€æºé¡¹ç›®ï¼›æŽŒæ¡åŸºäºŽç§»åŠ¨ç«¯çš„ TensorFlow å¼€å‘ã€‚ æ–‡ç« ç»§ç»­æ‰“ç†è‡ªå·±çš„å…¬ä¼—å·ã€åšå®¢ï¼Œä¿è¯å‘¨æœŸæ€§æ›´æ–°ã€‚ å¥èº«æ¯«æ— ç–‘é—®ï¼Œèº«ä½“æ˜¯é©å‘½çš„æœ¬é’±ï¼Œæ˜¯ä¸€åˆ‡ç¾Žå¥½çš„åŸºçŸ³ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹ç»å¸¸è°ƒä¾ƒè‡ªå·±æ˜¯åƒé’æ˜¥é¥­çš„ç¨‹åºå‘˜æ¥è¯´ã€‚ 2017 å¹´ç”±äºŽå®žéªŒå®¤åˆ¶åº¦ç­‰å„ç§åŽŸå› ï¼ˆå…¶å®žä¸»è¦æ˜¯è‡ªå·±å¤ªæ‡’ï¼‰ï¼Œå‘¨æœŸè¿åŠ¨éƒ½æ²¡åšæŒä¸‹æ¥ã€‚ 2018 å¹´é‡åŒ–ç›®æ ‡ï¼Œç¡®ä¿ä½“é‡æ¯”çŽ°åœ¨ä¸‹é™ 10 æ–¤ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æŽ¨è 2 æ¬¾ Google è®¿é—®å·¥å…·]]></title>
      <url>%2F2017%2F12%2F31%2Frecommended-2-Google-access-tools%2F</url>
      <content type="text"><![CDATA[å½±å“äººç”Ÿå‘½è¿çš„é€‰æ‹©ï¼Œä¸åœ¨äºŽæŸä¸ªé‡è¦å…³å¤´çš„é‡å¤§äº‹ä»¶ï¼Œè€Œåœ¨äºŽä¸€äº›å¾ˆæ— æ‰€è°“çš„äº‹æƒ…ã€‚&gt; 2017 å¹´æœ€åŽä¸€ç¯‡æ–‡ç« ï¼Œåªæœ‰ç¦åˆ©ï¼Œæ²¡æœ‰å¹²è´§ã€‚# iShadow #iShadow æ˜¯ä¸€ä¸ªæä¾›ç§‘å­¦ä¸Šç½‘æœåŠ¡çš„ç½‘ç«™ã€‚å½“ç„¶ç§‘å­¦ä¸Šç½‘å·¥å…·ä¸åªæœ‰æŸé£Žã€æŸç¯ã€**-Net ç­‰ï¼ŒiShadow ç½‘ç«™æ•´ä½“é£Žæ ¼ç‹¬æ ‘ä¸€å¸œï¼Œè¿›å…¥è¯¥ç½‘ç«™åŽï¼Œä½ é¦–å…ˆä¼šå› çœ‹åˆ°ä¸€å¤§å †ç¾Žé£Ÿè€Œå£æ°´ç›´æµã€‚iShadow ç½‘ç«™ä¸»ç•Œé¢ è¿™ä¸ªç½‘ç«™ç»™äººçš„ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯ï¼Œå®ƒæ˜¯æžç¾Žé£Ÿçƒ¹é¥ªçš„ï¼Œä½†ç»†æƒ³ä¸€ä¸‹ä¹Ÿæ²¡é”™ï¼Œæ¯•ç«Ÿå¤§éƒ¨åˆ†ç¨‹åºå‘˜éƒ½æ˜¯åƒè´§ã€‚è¯¥ç½‘ç«™æä¾›å…è´¹å’Œä»˜è´¹çš„ SS è´¦å·ï¼Œå…è´¹è´¦å·çš„å¯†ç æ¯ 6 ä¸ªå°æ—¶æ›´æ¢ä¸€æ¬¡ï¼Œé€Ÿåº¦è‰¯å¥½ï¼Œå¯¹äºŽä¸€èˆ¬éœ€æ±‚çš„å¼€å‘è€…è¶³å¤Ÿäº†ã€‚ ä½¿ç”¨æ•™ç¨‹æ”¯æŒå››ç§å¹³å°ï¼Œé…ç½®éžå¸¸æ–¹ä¾¿ã€‚ç‚¹å‡»ä¸€é“ç¾Žé£ŸåŽï¼Œä¸Šæ–¹ä¼šå‡ºçŽ°ä¸€ä¸ªäºŒç»´ç ï¼Œç”¨ä½ çš„å®¢æˆ·ç«¯æ‰«æä¸€ä¸‹å°±å®Œæˆé…ç½®ã€‚ iShadow ç½‘ç«™åœ°å€ï¼š https://global.ishadowx.net/ ç”±äºŽä¸å¯æŠ—åŠ›ï¼Œç½‘å€ä¼šä¸æ–­å˜æ›´ï¼Œä½†åªéœ€è¦è®°ä½å’Œæœç´¢ iShadow å…³é”®è¯ã€‚ Google è®¿é—®åŠ©æ‰‹ Google è®¿é—®åŠ©æ‰‹æ˜¯ä¸€æ¬¾æµè§ˆå™¨æ’ä»¶ï¼Œè¯¥æ’ä»¶å¯ä»¥åŠ©ä½ ä½¿ç”¨ Google æ‰€æä¾›çš„æœåŠ¡ï¼Œå¦‚æœç´¢å¼•æ“Žã€Gmail ç­‰ï¼Œä½¿ç”¨éžå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å±è”½æŽ‰äº†å¤§éƒ¨åˆ†å›½å¤–ç½‘ç«™ï¼ŒåŒ…æ‹¬ Android å®˜ç½‘ç­‰ã€‚é‚£ä¹ˆï¼Œæ€Žæ ·æ‰èƒ½èŽ·å¾—æ’ä»¶å‘¢ï¼Ÿå…³æ³¨ã€Ž AndroidGeeks ã€å…¬ä¼—å· ï¼Œå¹¶åœ¨å…¬ä¼—å·åŽå°å›žå¤å…³é”®å­—ã€Ž Google ã€ï¼Œå³å¯èŽ·å¾—è¯¥æ’ä»¶ã€‚ èŽ·å¾—è¯¥æ’ä»¶åŽï¼Œæ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œç„¶åŽè¿›å…¥chrome://extensions/ æ‰©å±•ç¨‹åºé¡µé¢ï¼Œå°† .crx æ–‡ä»¶ç›´æŽ¥æ‹–è¿›åŽ»ï¼Œå³å®Œæˆæ’ä»¶å®‰è£…ã€‚ å®‰è£…å®ŒæˆåŽï¼Œè¿›å…¥ Chrome æµè§ˆå™¨çš„è®¾ç½®é¡µé¢ï¼Œå³ chrome://settings/ ï¼Œå°†å¯åŠ¨é¡µè®¾ç½®ä¸º hao123 ä¸»é¡µï¼ˆå¿å¿å§ï¼‰ï¼Œé‡å¯æµè§ˆå™¨ï¼Œå³å¯ä»¥ä½¿ç”¨ Google æœåŠ¡ã€‚ å…¬ä¼—å·æ–‡ç« é“¾æŽ¥ https://mp.weixin.qq.com/s/Zh5aZQH7er6CAzZNUifwLA]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åœ¨ NDK å¼€å‘ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“]]></title>
      <url>%2F2017%2F11%2F11%2FNDK-packaging-third-party-static-and-dynamic-lib%2F</url>
      <content type="text"><![CDATA[è‡ªå¾‹çš„å‰æœŸæ˜¯å…´å¥‹çš„ï¼Œä¸­æœŸæ˜¯ç—›è‹¦çš„ï¼ŒåŽæœŸæ˜¯äº«å—çš„ã€‚ æœ¬ç¯‡ä»‹ç»åœ¨ NDK å¼€å‘ä¸­é€šè¿‡ CMake å¼•å…¥ç¬¬ä¸‰æ–¹é™æ€åº“å’ŒåŠ¨æ€åº“ã€‚ é™æ€åº“å’ŒåŠ¨æ€åº“é™æ€åº“é™æ€åº“æ–‡ä»¶åŽç¼€ä¸€èˆ¬ä¸º .a ï¼Œåˆ©ç”¨é™æ€åº“ç¼–è¯‘æˆçš„å¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸æ¯”è¾ƒå¤§ï¼Œç¼–è¯‘åŽçš„æ‰§è¡Œç¨‹åºä¸éœ€è¦å¤–éƒ¨å‡½æ•°åº“çš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œå¦‚æžœä¸€ä¸ªç¨‹åºä¾èµ–çš„é™æ€åº“å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç¨‹åºå°±éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ åŠ¨æ€åº“åŠ¨æ€åº“ä¹Ÿç§°ä¸ºå…±äº«åº“ï¼ŒåŠ¨æ€åº“æ–‡ä»¶åŽç¼€ä¸€èˆ¬ä¸º .so (Linux) æˆ– .dll (Windows) ï¼Œç›¸å¯¹äºŽé™æ€åº“ï¼ŒåŠ¨æ€åº“åœ¨ç¼–è¯‘æ—¶, å¹¶æ²¡æœ‰è¢«ç¼–è¯‘è¿›ç›®æ ‡ä»£ç ä¸­ï¼Œç¨‹åºæ‰§è¡Œåˆ°ç›¸å…³å‡½æ•°æ—¶æ‰è°ƒç”¨åŠ¨æ€åº“é‡Œçš„ç›¸å…³å‡½æ•°ï¼ŒåŠ¨æ€åº“ç¼–è¯‘åŽæ‰€äº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸è¾ƒå°ã€‚ç”±äºŽåŠ¨æ€åº“æ²¡æœ‰è¢«æ•´åˆè¿›ç¨‹åºï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°ç”³è¯·å¹¶è°ƒç”¨ï¼Œå› æ­¤ç¨‹åºçš„è¿è¡ŒçŽ¯å¢ƒä¸­å¿…é¡»æä¾›ç›¸åº”çš„åº“ã€‚åŠ¨æ€åº“çš„æ”¹å˜å¹¶ä¸å½±å“ç¨‹åºï¼Œä¾¿äºŽå‡çº§ã€‚ ä¸¤ç§å‡½æ•°åº“ç‰¹ç‚¹é™æ€åº“ï¼šç¼–è¯‘åŽçš„æ‰§è¡Œç¨‹åºä¸éœ€è¦å¤–éƒ¨çš„å‡½æ•°åº“æ”¯æŒï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­å·²ç»è¢«è½½å…¥å¯æ‰§è¡Œç¨‹åº,ç¨‹åºè¿è¡Œæ—¶å°†ä¸å†éœ€è¦è¯¥é™æ€åº“ï¼›åŠ¨æ€åº“ï¼šåŠ¨æ€åº“çš„ä»£ç åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰è½½å…¥å†…å­˜ï¼Œè€Œç¼–è¯‘è¿‡ç¨‹ä¸­ä»…ç®€å•çš„å¼•ç”¨ï¼Œä»£ç ä½“ç§¯è¾ƒå°ï¼Œå¹¶ä¸”åŠ¨æ€åº“ä¸Žç¨‹åºä»£ç ç‹¬ç«‹ï¼Œå¯å¤ç”¨ï¼Œè€¦åˆåº¦ä½Žï¼› ç”Ÿæˆç¬¬ä¸‰æ–¹åŠ¨æ€åº“å’Œé™æ€åº“æœ¬æ–‡ä¸»è¦é€šè¿‡ CMake å·¥å…·æž„å»ºï¼Œè¯·ç¡®ä¿ AS ç‰ˆæœ¬åœ¨ 2.2 ä»¥ä¸Šã€‚æœ¬èŠ‚ç®€å•ç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“å’Œé™æ€åº“ï¼Œæ¨¡ä»¿æˆ‘ä»¬è¦å¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ã€‚æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œé€‰æ‹© Support C++ ï¼Œæ–‡ä»¶ç»“æž„ï¼š æ–‡ä»¶ haohao/haohao.h ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„ç»“æž„ä½“å’Œä¸€ä¸ªç®€å•çš„ç±»ã€‚ 12345678910111213141516171819202122232425262728293031323334353637//// Created by haohao on 2017/12/14.//#ifndef NDKLIB_HAOHAO_H#define NDKLIB_HAOHAO_H#include &lt;stddef.h&gt;#include &lt;android/log.h&gt;#include &lt;jni.h&gt;#include &lt;string&gt;#define LOG_E(...) __android_log_print(ANDROID_LOG_ERROR,"HaoHao",__VA_ARGS__)#ifdef __cplusplusextern "C" &#123;#endiftypedef struct &#123; std::string (*getResponse)();&#125; HaoHao_FUN;class HaoHao&#123;public: HaoHao(std::string, int); std::string getHaoHaoWord();private: std::string name; int age;&#125;;extern __attribute__ ((visibility ("default"))) HaoHao_FUN haohao_fun;#ifdef __cplusplus&#125;#endif#endif //NDKLIB_HAOHAO_H haohao/haohao.cpp ï¼Œå®žä¾‹åŒ–ä¸€ä¸ªç»“æž„ä½“ã€‚ 123456789101112131415161718192021#include "haohao.h"HaoHao::HaoHao(std::string name, int age) &#123; this-&gt;name = name; this-&gt;age = age;&#125;std::string HaoHao::getHaoHaoWord() &#123; char tem[3]; sprintf(tem, "%d", age); return "Hello, My name is " + name + " I am " + tem + " years old";&#125;std::string get_response()&#123; HaoHao hao = HaoHao("chary", 23); return hao.getHaoHaoWord();&#125;__attribute__ ((visibility ("default"))) HaoHao_FUN haohao_fun = &#123; get_response&#125;; haohao/CMakeLists.txt 123456cmake_minimum_required(VERSION 3.4.1)add_library(haohao STATIC haohao.cpp ) // æ·»åŠ ä¸ºé™æ€åº“find_library(log-lib log )target_link_libraries(haohao $&#123;log-lib&#125; ) nannan/nannan.h ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„ç»“æž„ä½“ï¼Œæä¾›ç»™å…¶ä»–ç¨‹åºä½¿ç”¨ã€‚ 123456789101112131415161718192021222324#ifndef NDKLIB_NANNAN_H#define NDKLIB_NANNAN_H#include &lt;stddef.h&gt;#include &lt;android/log.h&gt;#include &lt;jni.h&gt;#include &lt;string&gt;#define LOG_E(...) __android_log_print(ANDROID_LOG_ERROR,"NanNan",__VA_ARGS__)#ifdef __cplusplusextern "C" &#123;#endiftypedef struct &#123; std::string (*getResponse)(); std::int32_t (*getNanNanKey)();&#125; NANNAN_FUN;extern __attribute__ ((visibility ("default"))) NANNAN_FUN nannan_fun;#ifdef __cplusplus&#125;#endif#endif //NDKLIB_NANNAN_H nannan/nannan.cpp 12345678910111213141516#include "nannan.h"std::string get_nannan_response()&#123; LOG_E("Nannan get response"); return "Hello, My name is Nannan!";&#125;std::int32_t get_nannan_age()&#123; LOG_E("Nannan get age"); return 23;&#125;__attribute__ ((visibility ("default"))) NANNAN_FUN nannan_fun = &#123; get_nannan_response, get_nannan_age&#125;; nannan/CmakeLists.txt 1234567cmake_minimum_required(VERSION 3.4.1)add_library(nannan SHARED nannan.cpp ) // æ·»åŠ ä¸ºåŠ¨æ€åº“find_library(log-lib log )target_link_libraries(nannan $&#123;log-lib&#125; ) æ ¹ç›®å½•ä¸‹çš„ CMakeLists.txt 123456789cmake_minimum_required(VERSION 3.4.1)include_directories($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp)set(jnilibs &quot;$&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs&quot;)set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;)set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++14 -pthread -DMGULK_LOG_STDERR=1 -Wall -Wextra -Wnon-virtual-dtor -g&quot;)ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/haohao)ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/nannan) app/build.gradle make å·¥ç¨‹ï¼Œåœ¨ app/src/main/jniLibs ç›®å½•ä¸‹ç”Ÿæˆäº†æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ã€‚ å¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œå°†ä¸ŠèŠ‚ç”Ÿæˆçš„ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶æ‹·è´åˆ° app/src/main/jniLibs ç›®å½•ä¸‹ï¼Œåœ¨ cpp ç›®å½•ä¸‹æ–°å»º include ç›®å½•ï¼Œæ‹·è´ç¬¬ä¸‰æ–¹åº“çš„å¤´æ–‡ä»¶åœ¨ include ç›®å½•ä¸‹ã€‚å·¥ç¨‹ç›®å½• MainActivity.java 1234567891011121314151617181920212223242526272829package com.haohao.ndklib;import android.support.v7.app.AppCompatActivity;import android.os.Bundle;import android.widget.TextView;public class MainActivity extends AppCompatActivity &#123; // Used to load the 'native-lib' library on application startup. static &#123; System.loadLibrary("native"); &#125; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); // Example of a call to a native method TextView tv = (TextView) findViewById(R.id.sample_text); tv.setText(stringFromJNI()); &#125; /** * A native method that is implemented by the 'native-lib' native library, * which is packaged with this application. */ public native String stringFromJNI();&#125; native/native.cpp ï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹åº“æä¾›çš„ API ã€‚ 1234567891011121314151617181920#include &lt;jni.h&gt;#include &lt;string&gt;#include &lt;nannan.h&gt;#include &lt;haohao.h&gt;extern "C"&#123;JNIEXPORT jstring JNICALLJava_com_haohao_ndklib_MainActivity_stringFromJNI(JNIEnv *env, jobject instance) &#123; char age[3]; sprintf(age, "%d", nannan_fun.getNanNanKey()); std::string value = nannan_fun.getResponse() + " I am " + age + " years old.\n"; value += haohao_fun.getResponse(); //std::string value = "Hello"; return env-&gt;NewStringUTF(value.c_str());&#125;&#125; native/CMakeLists.txt æ–‡ä»¶ã€‚ 12345678910111213add_library(native SHARED native.cpp)# å¼•å…¥ .so æ–‡ä»¶add_library(nannan SHARED IMPORTED )set_target_properties(nannan PROPERTIES IMPORTED_LOCATION &quot;$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libnannan.so&quot;)# å¼•å…¥ .a æ–‡ä»¶add_library(haohao STATIC IMPORTED )set_target_properties(haohao PROPERTIES IMPORTED_LOCATION &quot;$&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;/libhaohao.a&quot;)find_library( log-lib log )target_link_libraries(native nannan haohao $&#123;log-lib&#125;) æ ¹ç›®å½•ä¸‹çš„ CMakeLists.txt æ–‡ä»¶ã€‚ 123456789cmake_minimum_required(VERSION 3.4.1)include_directories($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/include)set(jnilibs &quot;$&#123;CMAKE_SOURCE_DIR&#125;/src/main/jniLibs&quot;)set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;jnilibs&#125;/$&#123;ANDROID_ABI&#125;)set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++14 -pthread -DMGULK_LOG_STDERR=1 -Wall -Wextra -Wnon-virtual-dtor -g&quot;)ADD_SUBDIRECTORY($&#123;CMAKE_SOURCE_DIR&#125;/src/main/cpp/native) app/build.gradle æ–‡ä»¶é…ç½®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445apply plugin: 'com.android.application'android &#123; compileSdkVersion 25 buildToolsVersion "25.0.3" defaultConfig &#123; applicationId "com.haohao.ndklib" minSdkVersion 15 targetSdkVersion 25 versionCode 1 versionName "1.0" testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner" externalNativeBuild &#123; cmake &#123; arguments '-DANDROID_PLATFORM=android-15', '-DANDROID_TOOLCHAIN=clang', '-DANDROID_STL=gnustl_static'// cppFlags "-DANDROID_STL=c++_static" abiFilters 'armeabi-v7a','x86_64', 'arm64-v8a','x86' &#125; &#125; &#125; buildTypes &#123; release &#123; minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' &#125; &#125; externalNativeBuild &#123; cmake &#123; path "CMakeLists.txt" &#125; &#125;&#125;dependencies &#123; compile fileTree(dir: 'libs', include: ['*.jar']) androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', &#123; exclude group: 'com.android.support', module: 'support-annotations' &#125;) compile 'com.android.support:appcompat-v7:25.3.1' testCompile 'junit:junit:4.12' compile 'com.android.support.constraint:constraint-layout:1.0.2'&#125; build å·¥ç¨‹åŽï¼Œç”Ÿæˆ libnative.so ï¼Œç›´æŽ¥è¿è¡Œé¡¹ç›®ï¼Œå®‰è£… apk ã€‚ æœ¬æ–‡ç¤ºä¾‹ä»£ç  https://github.com/githubhaohao/NDKLib]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NDK ç¼–è¯‘çš„ä¸‰ç§æ–¹å¼]]></title>
      <url>%2F2017%2F11%2F04%2FNDK-compiled-three-ways%2F</url>
      <content type="text"><![CDATA[åšä»»ä½•äº‹éƒ½ä¸å¯èƒ½æœ‰ 100% çš„å‡†å¤‡ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¸€è¾¹å‡†å¤‡ä¸€è¾¹é¢å¯¹æœªçŸ¥ã€‚ æœ¬ç¯‡ä»¥å›¾æ–‡çš„æ–¹å¼ä»‹ç»ä¸€ä¸‹ Android NDK ç¼–è¯‘çš„å‡ ç§æ–¹å¼ é€šè¿‡ Android Studio é»˜è®¤çš„æ–¹å¼åˆ›å»ºå¸¦æœ‰ native æ–¹æ³•çš„ç±»ï¼Œbuild é¡¹ç›®ã€‚ ç”Ÿæˆä¸Žç±»åç›¸å…³çš„ .h æ–‡ä»¶ã€‚è¿›å…¥ app -&gt; build -&gt; intermediates -&gt; classes -&gt; debug ç›®å½•ä¸‹æ‰§è¡Œï¼š javah com.haohao.hellojni.MyJNI ï¼ˆå…ˆé…ç½®å¥½ JDK çš„çŽ¯å¢ƒå˜é‡ï¼‰,ç”Ÿæˆ com_haohao_hellojni_MyJNI.h æ–‡ä»¶ åˆ›å»º cpp æ–‡ä»¶ã€‚åœ¨ main æ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»º jni ç›®å½•ï¼Œå‰ªåˆ‡ .h æ–‡ä»¶åˆ° jni ç›®å½•ä¸‹ï¼Œåˆ›å»º hello.cpp æ–‡ä»¶ hello.cpp é…ç½® build.gradle æ–‡ä»¶ã€‚ä¿®æ”¹ app/build.gradle æ–‡ä»¶ï¼Œ muduleName ä¸ºå¼•å…¥çš„ .so name , ç›´æŽ¥è¿è¡Œé¡¹ç›®ï¼Œå®‰è£… apk ï¼Œè¿è¡Œå°± OK äº† ç”Ÿæˆçš„ .so æ–‡ä»¶ä½ç½®ã€‚ PSï¼š æœªæŒ‡å®š CPU æ¡†æž¶æ—¶ï¼ŒAS ä¼šç”Ÿæˆæ”¯æŒæ‰€æœ‰ CPU æ¡†æž¶çš„ .so æ–‡ä»¶ã€‚ é€šè¿‡ ndk-buildåˆ›å»º Android.mk å’Œ Application.mk æ–‡ä»¶ã€‚æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåœ¨ app ç›®å½•ä¸‹ï¼ˆä»»ç›®å½•ä¸‹éƒ½å¯ä»¥ï¼‰æ–°å»º jni æ–‡ä»¶ï¼Œæ·»åŠ  Android.mk å’Œ Application.mk æ–‡ä»¶ï¼Œä»¥åŠ com_haohao_hellojni_MyJNI.h æ–‡ä»¶ï¼ˆè¿ç”¨ä¸Šä¸€å°èŠ‚çš„æ–¹æ³•ç”Ÿæˆï¼‰ã€‚Android.mk12345678910LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)# è¦ç”Ÿæˆçš„.soåº“åç§°ã€‚javaä»£ç System.loadLibrary(&quot;hello&quot;);åŠ è½½çš„å°±æ˜¯å®ƒLOCAL_MODULE := hello# C++æ–‡ä»¶LOCAL_SRC_FILES := hello.cppinclude $(BUILD_SHARED_LIBRARY) Application.mk123# ä¸å†™ APP_ABI ä¼šç”Ÿæˆå…¨éƒ¨æ”¯æŒçš„å¹³å°,ç›®å‰æ”¯æŒï¼šarmeabi arm64-v8a armeabi-v7a# APP_ABI := armeabi arm64-v8a armeabi-v7a mips mips64 x86 x86_64APP_ABI := armeabi arm64-v8a armeabi-v7a ç”Ÿæˆ .so æ–‡ä»¶ã€‚åœ¨ jni ç›®å½•ä¸‹ï¼ˆé…ç½®å¥½NDKçŽ¯å¢ƒå˜é‡ï¼‰ç›´æŽ¥æ‰§è¡Œ ndk-build ï¼Œ ç”Ÿæˆ .so æ–‡ä»¶ã€‚ é…ç½®é¡¹ç›®å·¥ç¨‹ã€‚åœ¨ main ç›®å½•ä¸‹æ–°å»º jniLibs ç›®å½•ï¼Œå¹¶æ‹·è´ armeabi arm64-v8a armeabi-v7a æ–‡ä»¶å¤¹ï¼Œè¿è¡Œ proj ã€‚ é€šè¿‡ CMake å·¥å…·ã€‚ä»Ž Android Studio 2.2 å¼€å§‹ï¼Œå°±é»˜è®¤ä½¿ç”¨ CMake å·¥å…·æž„å»º NDK é¡¹ç›®ï¼Œè¯·ç¡®ä¿ä½ çš„ AS ç‰ˆæœ¬å¤§äºŽ 2.2 ã€‚ é€šè¿‡ IDE è‡ªåŠ¨æž„å»ºåˆ›å»ºé¡¹ç›®æ—¶ï¼Œå‹¾é€‰ Include C++ support é€‰æ‹©é»˜è®¤çš„ Toolchain Default AS è‡ªåŠ¨ç”Ÿæˆ CMakeLists.txt æ–‡ä»¶ï¼ˆCMake æž„å»ºè„šæœ¬ï¼‰ CMakeLists.txt1234567891011121314151617181920212223242526272829303132333435363738394041424344# For more information about using CMake with Android Studio, read the# documentation: https://d.android.com/studio/projects/add-native-code.html# Sets the minimum version of CMake required to build the native library. # æŒ‡å®šCMakeçš„æœ€å°ç‰ˆæœ¬cmake_minimum_required(VERSION 3.4.1)# Creates and names a library, sets it as either STATIC# or SHARED, and provides the relative paths to its source code.# You can define multiple libraries, and CMake builds them for you.# Gradle automatically packages shared libraries with your APK.# è®¾ç½®æ¨¡å—åä¸º native-libï¼ŒSHARED å¯åˆ†äº«çš„ï¼Œä»¥åŠé…ç½®æºæ–‡ä»¶çš„è·¯å¾„add_library( # Sets the name of the library. è®¾ç½®æ¨¡å—å native-lib # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). æ–‡ä»¶è·¯å¾„ src/main/cpp/native-lib.cpp )# Searches for a specified prebuilt library and stores the path as a# variable. Because CMake includes system libraries in the search path by# default, you only need to specify the name of the public NDK library# you want to add. CMake verifies that the library exists before# completing its build.# æ‰¾åˆ° log æœ¬åœ°æ¨¡å—find_library( # Sets the name of the path variable. log-lib # Specifies the name of the NDK library that # you want CMake to locate. log )# Specifies libraries CMake should link to your target library. You# can link multiple libraries, such as libraries you define in this# build script, prebuilt third-party libraries, or system libraries.# å…³è” native-lib æ¨¡å—å’Œ log æ¨¡å—target_link_libraries( # Specifies the target library. native-lib # Links the target library to the log library # included in the NDK. $&#123;log-lib&#125; ) åœ¨é…ç½® app/build.gradle ï¼Œé’ˆå¯¹ç‰¹æ®Šå¹³å° abiFilters ã€‚é…ç½®å®Œæˆä¹‹åŽï¼ŒåŒæ­¥ï¼Œè¿è¡Œã€‚ æ‰‹åŠ¨æž„å»ºæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œåˆ›å»º native ç±»ï¼Œå¿«æ·é”® Alt + Enter ,è‡ªåŠ¨åˆ›å»º jni ç›®å½•å’Œç›¸åº”çš„ .cpp æ–‡ä»¶ã€‚ native-lib.cpp1234567891011#include &lt;jni.h&gt;#include &lt;string&gt;extern "C"JNIEXPORT jstring JNICALLJava_com_haohao_ndk_1cpp_MyJNI_stringFromJNI(JNIEnv *env, jobject instance) &#123; std::string hello = "Hello from C++"; return env-&gt;NewStringUTF(hello.c_str());&#125; åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹åˆ›å»º CMakeLists.txt æ–‡ä»¶ã€‚1234567891011# æŒ‡å®šCMakeçš„æœ€å°ç‰ˆæœ¬cmake_minimum_required(VERSION 3.4.1)add_library( # Sets the name of the library. è®¾ç½®æ¨¡å—å native-lib # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). æ–‡ä»¶è·¯å¾„ src/main/cpp/native-lib.cpp ) é€‰æ‹© app modulde ï¼Œå³å‡»é€‰æ‹©Link C++ Project with Gradleã€‚ é€‰æ‹©è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ã€‚ app/build.gradle ä¼šè‡ªåŠ¨åŒæ­¥ã€‚åŒæ­¥å®ŒæˆåŽï¼Œè¿è¡Œé¡¹ç›®ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡]]></title>
      <url>%2F2017%2F10%2F27%2Fcustom-android-system-service%2F</url>
      <content type="text"><![CDATA[ä¸€ä»¶äº‹å¦‚æžœçŠ¹è±«åšè¿˜æ˜¯ä¸åšï¼Œé€‰â€œåšâ€ã€‚ åšäº†ä¹Ÿå¯èƒ½ä¼šåŽæ‚”ï¼Œä½†æ˜¯è¿™ç§åŽæ‚”å’Œâ€œæ²¡åšâ€è€Œäº§ç”Ÿçš„ä¸€è¾ˆå­çš„å¦„å¿µç›¸æ¯”ï¼Œåå¤„å°å¤šäº†ã€‚ æœ¬ç¯‡è¯¦ç»†ä»‹ç»ä¸€ä¸‹åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡çš„è¿‡ç¨‹ã€‚ åœ¨ Android ç³»ç»Ÿæºç ä¸­è‡ªå®šä¹‰ç³»ç»ŸæœåŠ¡ï¼ˆCustom System Service in AOSPï¼‰é…ç½®ç¼–è¯‘çŽ¯å¢ƒï¼ˆInitial AOSP build environment.ï¼‰cd AOSP root dirsource build/envsetup.shlunch2 å®šä¹‰ Service çš„ AIDL æ–‡ä»¶ï¼ˆDefine service AIDL fileï¼‰path: frameworks/base/core/java/android/os/Create IHaoHaoService.aidl file 12345678package android.os;interface IHaoHaoService &#123; void setVal(String key,String value); String getVal(String key);&#125; ä¿®æ”¹ Android æ¨¡å—æ–‡ä»¶ï¼ˆModify Android.mk fileï¼‰path: frameworks/base/Android.mk 1234567891011121314151617181920212223242526......## READ ME: ############################################################ When updating this list of aidl files, consider if that aidl is## part of the SDK API. If it is, also add it to the list below that## is preprocessed and distributed with the SDK. This list should## not contain any aidl files for parcelables, but the one below should## if you intend for 3rd parties to be able to send those objects## across process boundaries.#### READ ME: ########################################################LOCAL_SRC_FILES += \ ...... core/java/android/os/IPowerManager.aidl \ core/java/android/os/IRemoteCallback.aidl \ core/java/android/os/ISchedulingPolicyService.aidl \ core/java/android/os/IUpdateLock.aidl \ core/java/android/os/IUserManager.aidl \ core/java/android/os/IVibratorService.aidl \ core/java/android/os/IHaoHaoService.aidl \ ...... è¿›è¡Œæ¨¡å—ç¼–è¯‘ï¼š ~/aosp/android-6.0.1_r1$ mmm frameworks/base generate IHaoHaoService.java file. åˆ›å»º HaoHaoService æ–‡ä»¶ï¼ˆCreate HaoHaoService fileï¼‰path: frameworks/base/services/core/java/com/android/server/Create HaoHaoService.java file. 1234567891011121314151617181920212223242526package com.android.server;import android.util.Slog; import android.os.RemoteException;import android.os.IHaoHaoService;import java.util.HashMap;public class HaoHaoService extends IHaoHaoService.Stub &#123; private static HashMap&lt;String,String&gt; mCache = null; private static final String TAG="HaoHaoService"; public HaoHaoService() &#123; mCache = new HashMap&lt;&gt;(); Slog.d(TAG, "HaoHaoService starting."); &#125; public void setVal(String key, String value) throws RemoteException &#123; mCache.put(key, value); &#125; public String getVal(String key) throws RemoteException &#123; return mCache.get(key); &#125;&#125; æ³¨å†ŒæœåŠ¡ï¼ˆRegister serviceï¼‰Modify frameworks/base/core/java/android/content/Context.javaAdd: 12345678 /** * Use with &#123;@link #getSystemService&#125; to retrieve a * &#123;@link android.os.IHaoHaoService&#125; for accessing the HaoHao service. * * @see #getSystemService * @hide */public static final String HAOHAO_SERVICE = "haohao"; Modify frameworks/base/services/java/com/android/server/SystemServer.javaFind function startOtherServices()Add: 1234567try &#123; Slog.i(TAG, "***HaoHao Service***"); ServiceManager.addService(Context.HAOHAO_SERVICE, new HaoHaoService());&#125; catch (Throwable e) &#123; Slog.e(TAG, "Failure starting HaoHao Service", e);&#125; Create HaoHaoServiceManager.java filepath: frameworks/base/core/java/android/app/ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package android.app;/** * Created by haohao on 17/10/2. */import android.annotation.SdkConstant;import android.annotation.SystemApi;import android.content.Context;import android.content.Intent;import android.os.Build;import android.os.Parcel;import android.os.Parcelable;import android.os.RemoteException;import android.os.IHaoHaoService;import android.util.Log;public class HaoHaoServiceManager &#123; private static final String TAG = "HaoHaoServiceManager"; private IHaoHaoService mService; public HaoHaoServiceManager(Context context, IHaoHaoService service)&#123; mService = service; &#125; public void setVal(String key,String value)&#123; try &#123; mService.setVal(key,value); &#125; catch(Exception e)&#123; Log.e(TAG, e.toString()); e.printStackTrace(); &#125; &#125; public String getVal(String key)&#123; try &#123; return mService.getVal(key); &#125; catch(Exception e)&#123; Log.e(TAG, e.toString()); e.printStackTrace(); &#125; return null; &#125;&#125; Register service in SystemServiceRegistry.java filepath: frameworks/base/core/java/android/app/SystemServiceRegistry.javaAdd: 1234567891011121314import android.os.IHaoHaoService; ...... registerService(Context.HAOHAO_SERVICE, HaoHaoServiceManager.class, new CachedServiceFetcher&lt;HaoHaoServiceManager&gt;() &#123; @Override public HaoHaoServiceManager createService(ContextImpl ctx) &#123; IBinder binder = ServiceManager.getService(Context.HAOHAO_SERVICE); IHaoHaoService service = IHaoHaoService.Stub.asInterface(binder); return new HaoHaoServiceManager(ctx, service); &#125;&#125;); ...... Modify SePolicy Build Checkpath: external/sepolicy/service.te Add: 1type haohao_service, system_api_service, system_server_service, service_manager_type; path: external/sepolicy/service_contexts Add: 1haohao u:object_r:haohao_service:s0 service_contexts 1234567accessibility u:object_r:accessibility_service:s0account u:object_r:account_service:s0activity u:object_r:activity_service:s0alarm u:object_r:alarm_service:s0haohao u:object_r:haohao_service:s0android.security.keystore u:object_r:keystore_service:s0android.service.gatekeeper.IGateKeeperService u:object_r:gatekeeper_service:s0 Update api and build~/aosp/android-6.0.1_r1$ make update-api -j8 ~/aosp/android-6.0.1_r1$ make -j8 Test service in your Activity123456@Overridepublic void onCreate() &#123; super.onCreate(); mHaoHaoServiceManager = (HaoHaoServiceManager)getSystemService(Context.HAOHAO_SERVICE); mHaoHaoServiceManager.setVal("haohao", "Android Developer");]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æž„ä¸Žç®—æ³•ï¼ˆJava å®žçŽ°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆä¸‰ï¼‰]]></title>
      <url>%2F2017%2F10%2F20%2FJava-data-structure-stack-and-queue%2F</url>
      <content type="text"><![CDATA[ç”Ÿæ´»è‹Ÿä¸”çš„äººï¼Œå‚»äº†å§å”§çš„åŽ»äº†è¯—å’Œè¿œæ–¹ï¼›è€Œé¼“å¹è¯—å’Œè¿œæ–¹çš„äººï¼Œå·¥ä½œæ¯”è°éƒ½ç§¯æžã€‚ æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹æ ˆå’Œé˜Ÿåˆ—çš„å®žçŽ°ï¼Œå®ƒä»¬æ˜¯æ•°æ®ç»“æž„ä¸Žç®—æ³•ä¸­éžå¸¸é‡è¦çš„åŸºç¡€ã€‚ æ ˆï¼ˆStackï¼‰ æ ˆæ˜¯é™å®šåœ¨è¡¨å°¾è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„çº¿æ€§è¡¨ã€‚å…è®¸æ’å…¥çš„ç«¯ç§°ä¸ºæ ˆé¡¶ï¼Œå¦ä¸€ç«¯ç§°ä¸ºæ ˆåº•ã€‚ æ ˆçš„æŠ½è±¡æ•°æ®ç±»åž‹1234567891011public interface Stack&lt;T&gt; &#123; T pop(); void push(T item); int size(); boolean isEmpty();&#125; æ ˆçš„å®žçŽ°(é“¾æ ˆ)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667public class LinkedStack&lt;T&gt; implements Stack&lt;T&gt; &#123; private Node head; private int count; public LinkedStack() &#123; head = null; count = 0; &#125; @Override public T pop() &#123; if (head == null) &#123; throw new IllegalStateException("the stack is null."); &#125; Node node = head; head = head.getNext(); node.setNext(null); return (T) node.getElement(); &#125; @Override public void push(T item) &#123; Node node = new Node(item); node.setNext(head); head = node; count ++; &#125; @Override public int size() &#123; return count; &#125; @Override public boolean isEmpty() &#123; return count == 0; &#125; @Override public String toString() &#123; if (head == null) &#123; return null; &#125; else &#123; Node p = head; StringBuilder stringBuilder = new StringBuilder(); while (p != null) &#123; stringBuilder.append(p.getElement()).append("\n"); p = p.getNext(); &#125; return stringBuilder.toString(); &#125; &#125; public static void main(String[] args) &#123; LinkedStack&lt;String&gt; linkedStack = new LinkedStack&lt;String&gt;(); linkedStack.push("Android"); linkedStack.push("iOS"); linkedStack.push("Kotlin"); System.out.println(linkedStack.toString()); System.out.println("pop -&gt; " + linkedStack.pop()); System.out.println("pop -&gt; " + linkedStack.pop()); System.out.println(linkedStack.toString()); &#125;&#125; è¾“å‡ºï¼š 1234567KotliniOSAndroidpop -&gt; Kotlinpop -&gt; iOSAndroid é˜Ÿåˆ—ï¼ˆQueueï¼‰ é˜Ÿåˆ—æ˜¯åªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œçš„çº¿æ€§è¡¨ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„çº¿æ€§è¡¨ï¼ˆFIFOï¼‰ã€‚å…è®¸æ’å…¥çš„ä¸€æ®µç§°ä¸ºé˜Ÿå°¾ï¼Œå…è®¸åˆ é™¤çš„ä¸€ç«¯ç§°ä¸ºé˜Ÿå¤´ã€‚ é˜Ÿåˆ—çš„æŠ½è±¡æ•°æ®ç±»åž‹123456789101112public interface Queue&lt;T&gt; &#123; void enQueue(T item); T deQueue(); T peek(); int size(); boolean isEmpty();&#125; é˜Ÿåˆ—å®žçŽ°ï¼ˆé“¾é˜Ÿåˆ—ï¼‰12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485public class LinkedQueue&lt;T&gt; implements Queue&lt;T&gt; &#123; private int size; private Node head; public LinkedQueue() &#123; size = 0; head = null; &#125; @Override public void enQueue(T item) &#123; Node node = new Node(item); if (head == null) &#123; head = node; &#125; else &#123; Node p = head; Node prev = null; while (p != null) &#123; prev = p; p = p.getNext(); &#125; prev.setNext(node); &#125; size++; &#125; @Override public T deQueue() &#123; if (head == null) &#123; throw new IllegalStateException("the queue is empty."); &#125; Node node = head; head = head.getNext(); node.setNext(null); size --; return (T) node.getElement(); &#125; @Override public T peek() &#123; return (T) head.getElement(); &#125; @Override public int size() &#123; return size; &#125; @Override public boolean isEmpty() &#123; return size == 0; &#125; @Override public String toString() &#123; if (isEmpty()) &#123; return null; &#125; else &#123; StringBuilder stringBuilder = new StringBuilder(); Node p = head; while (p != null) &#123; stringBuilder.append(p.getElement()).append("\n"); p = p.getNext(); &#125; return stringBuilder.toString(); &#125; &#125; public static void main(String[] args) &#123; LinkedQueue&lt;String&gt; linkedQueue = new LinkedQueue&lt;String&gt;(); linkedQueue.enQueue("Android"); linkedQueue.enQueue("iOS"); linkedQueue.enQueue("Kotlin"); linkedQueue.enQueue("Java"); System.out.println(linkedQueue.toString()); System.out.println("LinkedQueue dequeue -&gt; " + linkedQueue.deQueue()); System.out.println("LinkedQueue dequeue -&gt; " + linkedQueue.deQueue()); System.out.println(linkedQueue.toString()); &#125;&#125; è¾“å‡ºï¼š123456789AndroidiOSKotlinJavaLinkedQueue dequeue -&gt; AndroidLinkedQueue dequeue -&gt; iOSKotlinJava]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Socket Socket.io Websocket ä¸Ž HTTP ä¹‹é—´çš„åŒºåˆ«]]></title>
      <url>%2F2017%2F09%2F30%2Fdiff-between-socket-websocket-socket-io-and-http%2F</url>
      <content type="text"><![CDATA[æ•™è‚²çš„ç›®çš„ä»Žæ¥éƒ½æ˜¯ç²¾ç¥žçš„ç‹¬ç«‹è€Œä¸æ˜¯ç»™äºˆè‹¦å¤´ï¼Œé™¤éžæœ‰äººä¸å¸Œæœ›çœ‹åˆ°ä½ å¤ªâ€œè‡ªåœ¨â€ï¼Œéœ€è¦é€šè¿‡åˆ¶åº¦å±•ç¤ºæƒåŠ›çš„å¨ä¸¥ æœ¬ç¯‡ä»Žç‰¹å¾è§’åº¦ä»‹ç»ä¸€ä¸‹ï¼ŒSocketã€ Socket.ioã€ Websocketã€ HTTP ä¹‹é—´çš„åŒºåˆ«ã€‚ Socket ã€ Socket.io ã€ Websocket ã€ HTTP ä¹‹é—´çš„åŒºåˆ« Socket æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„å¯¹äºŽä¼ è¾“å±‚ï¼ˆTCP / UDPï¼‰æŠ½è±¡çš„æŽ¥å£ï¼Œæ˜¯ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µï¼Œè€Œ Websocket ã€Socket.io ä¸Ž HTTP ä¸€æ ·æ˜¯ä¸€ä¸ªæˆæ–‡çš„äº’è”ç½‘åè®®ã€‚å¦å¤–ï¼ŒWebsocket å’Œ HTTP éƒ½æ˜¯åŸºäºŽ TCP ä¼ è¾“æ•°æ®ï¼ŒSocket.io å¯ä»¥çœ‹ä½œæ˜¯å¯¹ Websocket å’Œ HTTP çš„åˆä¸€æ¬¡å°è£…ã€‚ HTTP æ˜¯åŸºäºŽè¯·æ±‚å“åº”å¼çš„ï¼Œå³é€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡ç«¯åšå‡ºå“åº”ï¼Œæ— çŠ¶æ€ï¼Œæ— è¿žæŽ¥ã€‚æ— çŠ¶æ€ï¼šæ¯æ¬¡è¿žæŽ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ç»“æŸåŽæ–­å¼€è¿žæŽ¥ã€‚æ— è¿žæŽ¥ï¼šå¯¹äºŽäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚ ä»¥å¾€å®žçŽ°å³æ—¶é€šè®¯çš„æ‰‹æ®µï¼šè½®è¯¢ï¼šå®¢æˆ·ç«¯å®šæ—¶å‘æœåŠ¡å™¨å‘é€ Ajax è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŽ¥åˆ°è¯·æ±‚åŽé©¬ä¸Šè¿”å›žå“åº”ä¿¡æ¯å¹¶å…³é—­è¿žæŽ¥ã€‚é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ Ajax è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŽ¥åˆ°è¯·æ±‚åŽ hold ä½è¿žæŽ¥ï¼Œç›´åˆ°æœ‰æ–°æ¶ˆæ¯æ‰è¿”å›žå“åº”ä¿¡æ¯å¹¶å…³é—­è¿žæŽ¥ï¼Œå®¢æˆ·ç«¯å¤„ç†å®Œå“åº”ä¿¡æ¯åŽå†å‘æœåŠ¡å™¨å‘é€æ–°çš„è¯·æ±‚ã€‚é•¿è¿žæŽ¥ï¼šåœ¨é¡µé¢é‡ŒåµŒå…¥ä¸€ä¸ªéšè”µ iframeï¼Œå°†è¿™ä¸ªéšè”µ iframe çš„ src å±žæ€§è®¾ä¸ºå¯¹ä¸€ä¸ªé•¿è¿žæŽ¥çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å°±èƒ½æºæºä¸æ–­åœ°å¾€å®¢æˆ·ç«¯è¾“å…¥æ•°æ®ã€‚Flash Socketï¼šåœ¨é¡µé¢ä¸­å†…åµŒå…¥ä¸€ä¸ªä½¿ç”¨äº† Socket ç±»çš„ Flash ç¨‹åº JavaScript é€šè¿‡è°ƒç”¨æ­¤ Flash ç¨‹åºæä¾›çš„ Socket æŽ¥å£ä¸ŽæœåŠ¡å™¨ç«¯çš„ Socket æŽ¥å£è¿›è¡Œé€šä¿¡ï¼ŒJavaScript åœ¨æ”¶åˆ°æœåŠ¡å™¨ç«¯ä¼ é€çš„ä¿¡æ¯åŽæŽ§åˆ¶é¡µé¢çš„æ˜¾ç¤ºã€‚ Websocket çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†è§£å†³ HTTP åœ¨å³æ—¶é€šä¿¡ä¸­å­˜åœ¨çš„ä¸è¶³ï¼ŒHTTP æ˜¯é€šè¿‡ Polling å®žçŽ°å³æ—¶é€šä¿¡å­˜åœ¨å¾ˆå¤§çš„èµ„æºå¼€é”€ã€‚ Webscoket æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œè¿žæŽ¥å»ºç«‹ä¹‹åŽä¾¿ä¸Ž HTTP åè®®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒWebsocket è¿žæŽ¥å»ºç«‹ä¹‹åŽï¼Œclient ä¸Ž server å¯ä»¥åŒæ—¶æ”¶å‘æ•°æ®ï¼Œå…¨åŒå·¥é€šè®¯ã€‚ Socket.io æ”¯æŒ Websocket åè®®ï¼Œæ”¯æŒå¤šç§è½®è¯¢æœºåˆ¶ï¼Œå®ƒå®žçŽ°äº†å®žæ—¶ã€åŒå‘ã€åŸºäºŽäº‹ä»¶çš„é€šè®¯æœºåˆ¶ï¼Œå¤©ç”Ÿç”¨æ¥è§£å†³å®žæ—¶é€šè®¯é—®é¢˜ã€‚å¦å¤–ï¼ŒSocket.io èƒ½å¤Ÿæ ¹æ®æµè§ˆå™¨å¯¹é€šè®¯æœºåˆ¶çš„æ”¯æŒæƒ…å†µè‡ªåŠ¨åœ°é€‰æ‹©æœ€ä½³çš„æ–¹å¼æ¥å®žçŽ°ç½‘ç»œå®žæ—¶åº”ç”¨ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æž„ä¸Žç®—æ³•ï¼ˆJava å®žçŽ°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆäºŒï¼‰]]></title>
      <url>%2F2017%2F09%2F26%2FJava-data-structure-linkedlist%2F</url>
      <content type="text"><![CDATA[å› ä¸ºæˆ‘ä»¬çš„è¨€è¯­è¡¨è¾¾äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè€Œæˆ‘ä»¬çš„æƒ³æ³•åˆ›é€ äº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹å•é“¾è¡¨ï¼Œå•å¾ªçŽ¯é“¾è¡¨å’ŒåŒå‘å¾ªçŽ¯é“¾è¡¨ã€‚é“¾è¡¨æ˜¯çº¿æ€§è¡¨çš„æ ¸å¿ƒå†…å®¹ï¼Œå•é“¾è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æž„æˆæ ˆå’Œé˜Ÿåˆ—ã€‚ å•é“¾è¡¨èŠ‚ç‚¹12345678910111213141516171819202122232425262728293031323334353637/** * Created by HaohaoChang on 2017/9/9. */public class Node &#123; Object data; // æ•°æ®å…ƒç´  Node next; // ä¸‹ä¸€èŠ‚ç‚¹çš„å¯¹è±¡å¼•ç”¨ public Node(Node nextval) &#123; // ç”¨äºŽå¤´ç»“ç‚¹çš„æž„é€ å‡½æ•° next = nextval; &#125; public Node(Object obj, Node nextval) &#123; // ç”¨äºŽä¸‹ä¸€èŠ‚ç‚¹çš„æž„é€ å‡½æ•° data = obj; next = nextval; &#125; public Object getElement() &#123; return data; &#125; public Node getNext() &#123; return next; &#125; public void setElement(Object data) &#123; this.data = data; &#125; public void setNext(Node next) &#123; this.next = next; &#125; @Override public String toString() &#123; return data.toString(); &#125;&#125; å•é“¾è¡¨ æœ¬ç¯‡çš„å•é“¾è¡¨æ˜¯å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091/** * Created by HaohaoChang on 2017/9/9. * å•é“¾è¡¨ * | a0 | next | --&gt; | a1 | next | --&gt; | a2 | next | --&gt; ... --&gt; | an | null | * æ—¶é—´å¤æ‚åº¦O(n) */public class SingleLinkedList implements List &#123; Node head; // å¤´æŒ‡é’ˆ Node current; // å½“å‰èŠ‚ç‚¹ä½ç½® int size; // æ•°æ®å…ƒç´ ä¸ªæ•° public SingleLinkedList() &#123; head = current = new Node(null); size = 0; &#125; @Override public int size() &#123; return size; &#125; @Override public void insert(int index, Object o) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size) &#123; throw new IllegalStateException("å‚æ•°é”™è¯¯"); &#125; locate(index - 1); current.setNext(new Node(o, current.next)); size ++; System.out.println("insert node : " + o); &#125; @Override public Object delete(int index) throws IllegalArgumentException &#123; if (size == 0) &#123; throw new IllegalArgumentException("é“¾è¡¨å·²ç©ºï¼Œæ²¡æœ‰å…ƒç´ å¯ä»¥åˆ é™¤"); &#125; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; locate(index - 1); Object o = current.next.getElement(); current.setNext(current.next.next); size --; System.out.println("delete node : " + o); return o; &#125; @Override public Object getData(int index) &#123; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; locate(index); return current.getElement(); &#125; @Override public boolean isEmpty() &#123; return size == 0; &#125; public void locate(int index) throws IllegalArgumentException &#123; // å®šä½ if (index &lt; -1 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; if (index == -1) &#123; current = head; return; &#125; current = head.next; int j = 0; while (current != null &amp;&amp; j &lt; index) &#123; current = current.next; j++; &#125; &#125; public static void main(String[] args) &#123; SingleLinkedList singleLinkedList = new SingleLinkedList(); singleLinkedList.insert(0, "Android"); singleLinkedList.insert(1, "iOS"); singleLinkedList.insert(2, "React Native"); singleLinkedList.insert(3, "Kotlin"); singleLinkedList.delete(0); System.out.println(singleLinkedList.size()); &#125; è¿è¡Œè¾“å‡ºï¼š123456insert node : Androidinsert node : iOSinsert node : React Nativeinsert node : Kotlindelete node : Android3 å•å¾ªçŽ¯é“¾è¡¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111/** * Created by HaohaoChang on 2017/9/22. */public class SingleCirLinkedList implements List&#123; Node head; Node current; int size; public SingleCirLinkedList() &#123; head = current = new Node(null); head.setNext(head); size = 0; &#125; @Override public int size() &#123; return size; &#125; @Override public void insert(int index, Object o) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; locate(index - 1); current.setNext(new Node(o, current.getNext())); size ++; &#125; @Override public Object delete(int index) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; locate(index - 1); Object o = current.getNext().getElement(); System.out.println("delete : " + o); current.setNext(current.getNext().getNext()); size --; return o; &#125; @Override public Object getData(int index) throws IllegalArgumentException&#123; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; locate(index - 1); return current.getNext().getElement(); &#125; @Override public boolean isEmpty() &#123; return size == 0; &#125; @Override public String toString() &#123; if (size == 0) &#123; return "null"; &#125; StringBuilder stringBuilder = new StringBuilder(); Node p = head.getNext(); while (p != head) &#123; stringBuilder.append(p.getElement()).append("\n"); p = p.getNext(); &#125; return stringBuilder.toString(); &#125; /** * index å–å€¼èŒƒå›´ -1 è‡³ size - 2 éœ€è¦è€ƒè™‘ 0 -1 è¿™ä¸¤ç§ç‰¹æ®Šæƒ…å†µ */ private void locate(int index) throws IllegalArgumentException &#123; if (index &lt; -1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; if (index == -1) &#123; current = head; return; &#125; int j = 0; current = head.getNext(); while (current != head &amp;&amp; j &lt; index) &#123; current = current.getNext(); j++; &#125; &#125; public static void main(String[] args) &#123; SingleCirLinkedList cirLinkedList = new SingleCirLinkedList(); cirLinkedList.insert(0, "Android"); cirLinkedList.insert(1, "iOS"); cirLinkedList.insert(2, "Kotlin"); System.out.println(cirLinkedList.getData(0)); System.out.println(cirLinkedList.getData(1)); System.out.println(cirLinkedList.getData(2)); cirLinkedList.delete(1); System.out.println(cirLinkedList.toString()); &#125;&#125; è¿è¡Œè¾“å‡ºï¼š123456AndroidiOSKotlindelete : iOSAndroidKotlin åŒå‘å¾ªçŽ¯é“¾è¡¨åŒå‘å¾ªçŽ¯é“¾è¡¨èŠ‚ç‚¹123456789101112131415161718192021222324252627282930313233343536373839404142/** * Created by HaohaoChang on 2017/9/25. * åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ */public class DulNode &#123; Object element; DulNode prior; // ç›´æŽ¥å‰é©±æŒ‡é’ˆ DulNode next; // ç›´æŽ¥åŽç»§æŒ‡é’ˆ public DulNode() &#123; &#125; public DulNode(Object element, DulNode prior, DulNode next) &#123; this.element = element; this.prior = prior; this.next = next; &#125; public Object getElement() &#123; return element; &#125; public DulNode getPrior() &#123; return prior; &#125; public DulNode getNext() &#123; return next; &#125; public void setElement(Object element) &#123; this.element = element; &#125; public void setPrior(DulNode prior) &#123; this.prior = prior; &#125; public void setNext(DulNode next) &#123; this.next = next; &#125;&#125; åŒå‘å¾ªçŽ¯é“¾è¡¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126/** * Created by HaohaoChang on 2017/9/25. */public class CirDulLinkedList implements List &#123; DulNode head; // å¤´ç»“ç‚¹ int size; public CirDulLinkedList() &#123; // åˆå§‹åŒ–å¤´ç»“ç‚¹ head = new DulNode(); head.setPrior(head); head.setNext(head); head.setElement(null); &#125; @Override public int size() &#123; return size; &#125; @Override public void insert(int index, Object o) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; if (index == size) &#123; // ç‰¹æ®Šæƒ…å†µï¼Œåœ¨å°¾éƒ¨ç›´æŽ¥æ·»åŠ èŠ‚ç‚¹ add(o); &#125; else &#123; DulNode p = search(index); DulNode s = p.getPrior(); DulNode newNode = new DulNode(o, s, p); s.setNext(newNode); p.setPrior(newNode); size++; &#125; &#125; @Override public Object delete(int index) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; DulNode p = search(index); Object o = p.getElement(); DulNode s = p.getPrior(); s.setNext(p.getNext()); p.getNext().setPrior(s); size--; System.out.println("CirDulLinkedList.delete : " + o); return o; &#125; @Override public Object getData(int index) throws IllegalArgumentException &#123; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("å‚æ•°é”™è¯¯"); &#125; return search(index).getElement(); &#125; @Override public boolean isEmpty() &#123; return size == 0; &#125; @Override public String toString() throws IllegalStateException &#123; if (size == 0) &#123; throw new IllegalStateException("é“¾è¡¨ä¸ºç©º"); &#125; StringBuilder stringBuilder = new StringBuilder(); DulNode p = head.getNext(); while (p != head) &#123; stringBuilder.append(p.getElement()).append("\n"); p = p.getNext(); &#125; return stringBuilder.toString(); &#125; /** * ç›´æŽ¥åœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ èŠ‚ç‚¹ */ private void add(Object o) &#123; DulNode rear = head.getPrior(); DulNode newNode = new DulNode(o, rear, head); rear.setNext(newNode); head.setPrior(newNode); size++; &#125; // æŒ‰ç…§ä½ç½®æŸ¥æ‰¾èŠ‚ç‚¹ private DulNode search(int index) throws IllegalArgumentException &#123; DulNode p = null; if (index &gt; size / 2) &#123; // ä½äºŽé“¾è¡¨çš„åŽåŠéƒ¨åˆ†ï¼Œåå‘æŸ¥è¯¢ p = head.getPrior(); for (int i = size - 1; i &gt; index; i--) &#123; p = p.getPrior(); &#125; &#125; else &#123; // ä½äºŽé“¾è¡¨çš„å‰åŠéƒ¨åˆ†ï¼Œæ­£å‘æŸ¥è¯¢ p = head.getNext(); for (int i = 0; i &lt; index; i++) &#123; p = p.getNext(); &#125; &#125; return p; &#125; public static void main(String[] args) &#123; CirDulLinkedList cirDulLinkedList = new CirDulLinkedList(); cirDulLinkedList.insert(0, "Android"); cirDulLinkedList.insert(1, "iOS"); cirDulLinkedList.insert(2, "Kotlin"); cirDulLinkedList.add("ReactNative"); System.out.println(cirDulLinkedList.toString()); cirDulLinkedList.delete(2); System.out.println(cirDulLinkedList.toString()); &#125;&#125;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æ•°æ®ç»“æž„ä¸Žç®—æ³•ï¼ˆJava å®žçŽ°ï¼‰ä¹‹çº¿æ€§è¡¨ï¼ˆä¸€ï¼‰]]></title>
      <url>%2F2017%2F09%2F26%2FJava-data-structure-lineartable%2F</url>
      <content type="text"><![CDATA[æˆå¹´äººå­¦ä¹ çš„ç›®çš„ï¼Œåº”è¯¥æ˜¯è¿½æ±‚æ›´å¥½çš„æ€ç»´æ¨¡åž‹ï¼Œè€Œä¸æ˜¯æ›´å¤šçš„çŸ¥è¯†ã€‚ çº¿æ€§è¡¨ çº¿æ€§è¡¨ï¼ˆLinear Listï¼‰æ˜¯ç”± nï¼ˆnâ‰¥0ï¼‰ä¸ªæ•°æ®å…ƒç´ ï¼ˆç»“ç‚¹ï¼‰a[0]ï¼Œa[1]ï¼Œa[2]â€¦ï¼Œa[n-1] ç»„æˆçš„æœ‰é™åºåˆ—ã€‚ çº¿æ€§è¡¨æŒ‰ç…§å­˜å‚¨ç»“æž„åˆ†ä¸ºï¼šé¡ºåºè¡¨å’Œé“¾è¡¨é¡ºåºè¡¨ï¼šç”¨ä¸€å—åœ°å€è¿žç»­çš„å­˜å‚¨ç©ºé—´ä¾æ¬¡å­˜å‚¨çº¿æ€§è¡¨ä¸­çš„æ•°æ®å…ƒç´ ï¼›é“¾è¡¨ï¼šé“¾å¼å­˜å‚¨ç»“æž„çš„çº¿æ€§è¡¨ï¼Œé€»è¾‘ä¸Šç›¸é‚»çš„å…ƒç´ åœ¨ç‰©ç†ä¸Šå¯ä»¥ä¸ç›¸é‚»ï¼Œå…ƒç´ é—´çš„é€»è¾‘å…³ç³»è¡¨çŽ°åœ¨èŠ‚ç‚¹çš„è¿žæŽ¥ä¸Šã€‚ æŠ½è±¡çº¿æ€§è¡¨123456789101112131415/** * Created by HaohaoChang on 2017/9/8. * æŠ½è±¡çº¿æ€§è¡¨æ“ä½œ */public interface List &#123; int size(); void insert(int index, Object o); Object delete(int index); Object getData(int index); boolean isEmpty();&#125; é¡ºåºè¡¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127/** * Created by HaohaoChang on 2017/9/8. * é¡ºåºè¡¨ * æ•°æ®å…ƒç´ å­˜å‚¨åœ¨è¿žç»­åœ°å€ç©ºé—´çš„å†…å­˜å•å…ƒ * æ’å…¥/åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦O(n) */public class SeqList implements List &#123; private static final String TAG = "SeqList"; final int defultSize = 10; int maxSize; int size; Object[] array; public SeqList() &#123; initiate(defultSize); &#125; public SeqList(int size) &#123; initiate(size); &#125; private void initiate(int sz) &#123; maxSize = sz; size = 0; array = new Object[sz]; &#125; @Override public int size() &#123; return size; &#125; @Override public void insert(int index, Object o) throws IllegalArgumentException &#123; if (maxSize == index) &#123; throw new IllegalArgumentException("Seq list is full."); &#125; if (index &lt; 0 || index &gt; size) &#123; throw new IllegalArgumentException("argument error."); &#125; for (int i = size; i &gt; index; i--) &#123; array[i] = array[i-1]; &#125; array[index] = o; size ++; System.out.println("insert item : " + o); &#125; public void add(Object o) throws IllegalArgumentException &#123; if (maxSize == size) &#123; throw new IllegalArgumentException("Seq list is full."); &#125; array[size] = o; size ++; System.out.println("add item : " + o); &#125; @Override public Object delete(int index) &#123; if (size == 0) &#123; throw new IllegalArgumentException("Seq list is empty."); &#125; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("argument error."); &#125; Object o = array[index]; for (int i = index; i &lt; size - 1; i++) &#123; array[i] = array[i + 1]; &#125; size --; System.out.println("delete item : " + o + ",index : " + index); return o; &#125; @Override public Object getData(int index) &#123; if (size == 0) &#123; throw new IllegalArgumentException("Seq list is empty."); &#125; if (index &lt; 0 || index &gt; size - 1) &#123; throw new IllegalArgumentException("argument error."); &#125; return array[index]; &#125; @Override public boolean isEmpty() &#123; return size == 0; &#125; @Override public String toString() &#123; if (size == 0) &#123; return "null"; &#125; StringBuilder stringBuilder = new StringBuilder(); for (int i = 0; i &lt; size; i++) &#123; stringBuilder.append("index : ").append(i).append(", value : ").append(array[i]).append("\n"); &#125; return stringBuilder.toString(); &#125; public static void main(String[] args) &#123; SeqList seqList = new SeqList(); seqList.insert(0, "Kotlin"); seqList.add("Android"); seqList.insert(2, "NodeJS"); System.out.println(seqList); seqList.delete(0); seqList.delete(0); System.out.println(seqList); &#125;&#125; ä»£ç è¿è¡Œç»“æžœï¼š12345678910insert item : Kotlinadd item : Androidinsert item : NodeJSindex : 0, value : Kotlinindex : 1, value : Androidindex : 2, value : NodeJSdelete item : Kotlin,index : 0delete item : Android,index : 0index : 0, value : NodeJS å¯å˜å®¹é‡çš„é¡ºåºè¡¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122/** * Created by HaohaoChang on 2017/9/13. * å¯å˜å®¹é‡é¡ºåºè¡¨ */public class VarSeqList implements List &#123; static final int defaultSize = 10; int size; int length; Object[] array; public VarSeqList() &#123; array = new Object[defaultSize]; size = defaultSize; length = 0; &#125; @Override public int size() &#123; return length; &#125; @Override public void insert(int index, Object o) &#123; if (index &lt; 0 || index &gt; length) &#123; throw new IllegalStateException("å‚æ•°é”™è¯¯"); &#125; if (length == size) &#123; extend(); &#125; for (int i = length; i &gt; index; i--) &#123; array[i] = array[i -1]; &#125; array[index] = o; length ++; &#125; @Override public Object delete(int index) &#123; System.out.println(index + " ," + length); if (length == 0) &#123; throw new IllegalStateException("åˆ—è¡¨ä¸ºç©º"); &#125; if (index &lt; 0 || index &gt; length - 1) &#123; throw new IllegalStateException("å‚æ•°é”™è¯¯"); &#125; Object o = array[index]; for (int i = index; i &lt; length - 1; i++) &#123; array[i] = array[i + 1]; &#125; length --; return o; &#125; @Override public Object getData(int index) &#123; if (length == 0) &#123; throw new IllegalStateException("åˆ—è¡¨ä¸ºç©º"); &#125; if (index &lt; 0 || index &gt; length - 1) &#123; throw new IllegalStateException("å‚æ•°é”™è¯¯"); &#125; return array[index]; &#125; @Override public boolean isEmpty() &#123; return length == 0; &#125; @Override public String toString() &#123; if (length == 0) &#123; throw new IllegalStateException("åˆ—è¡¨ä¸ºç©º"); &#125; StringBuilder stringBuilder = new StringBuilder(); for (int i = 0; i &lt; length; i++) &#123; stringBuilder.append(getData(i)).append("\n"); &#125; return stringBuilder.toString(); &#125; public void add(Object o) &#123; if (length == size) &#123; extend(); &#125; array[length] = o; length ++; &#125; private void extend() &#123; // å°å¿ƒè¶Šç•Œ size *= 2; Object[] newArray = new Object[size]; for (int i = 0; i &lt; length; i++) &#123; newArray[i] = array[i]; &#125; array = newArray; &#125; private void clear() &#123; length = 0; size = defaultSize; array = new Object[size]; &#125; public static void main(String[] args) &#123; VarSeqList varSeqList = new VarSeqList(); for (int i = 0; i &lt; 1000; i++) &#123; varSeqList.add(i); &#125; for (int i = 0; i &lt; 995; i++) &#123; varSeqList.delete(0); &#125; System.out.println(varSeqList.toString()); &#125;&#125;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æµè§ˆå™¨ä»Žè¾“å…¥ Url åˆ°å±•ç¤ºå‡ºé¡µé¢éƒ½ç»åŽ†äº†å“ªäº›è¿‡ç¨‹]]></title>
      <url>%2F2017%2F09%2F23%2Ffrom-url-to-page-displaying%2F</url>
      <content type="text"><![CDATA[å½“ä½ æƒ³å®Œå…¨å‡†å¤‡å¥½å†åšä¸€ä»¶äº‹çš„æ—¶å€™ï¼Œä¸å¦‚å…ˆåšèµ·æ¥ï¼Œè¾¹åšè¾¹å‡†å¤‡ æœ¬ç¯‡ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œæµè§ˆå™¨ä»Žè¾“å…¥ Url åˆ°å±•ç¤ºå‡ºé¡µé¢éƒ½ç»åŽ†äº†å“ªäº›è¿‡ç¨‹ã€‚ è¾“å…¥åŸŸååœ¨æµè§ˆå™¨è¾“å…¥ç½‘å€æ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®åŽ†å²è®°å½•ã€ä¹¦ç­¾æ™ºèƒ½åŒ¹é…è¡¥å…¨åŸŸåæˆ–è€… url ã€‚ä¾‹å¦‚ chrome æµè§ˆå™¨ï¼Œç”šè‡³ä¼šæ ¹æ®åŒ¹é…ç»“æžœç›´æŽ¥æŠŠç½‘é¡µåŠ è½½å‡ºæ¥ã€‚ è§£æžåŸŸåè¯·æ±‚å‘èµ·æ—¶ï¼Œæµè§ˆå™¨é¦–å…ˆè§£æžåŸŸåï¼Œä¸€èˆ¬ä¼šé¦–å…ˆæŸ¥çœ‹æœ¬åœ°çš„ hosts æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ç›¸å…³åŸŸåä¸Ž ip åœ°å€çš„å¯¹åº”è§„åˆ™ï¼Œè‹¥æŸ¥æ‰¾åˆ°çš„è¯ï¼Œå°±ç›´æŽ¥ä½¿ç”¨ hosts æ–‡ä»¶é‡Œé¢çš„ ip åœ°å€ã€‚ è‹¥åœ¨æœ¬åœ° hosts æ–‡ä»¶ä¸­ï¼Œæœªæ‰¾åˆ°ç›®æ ‡åŸŸåä¸Ž ip åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæµè§ˆå™¨ä¾¿ä¼šå‘æœ¬åœ° DNS æœåŠ¡å™¨å‘èµ·ä¸€ä¸ª DNS è¯·æ±‚ï¼Œæœ¬åœ° DNS æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åŽï¼Œä¾¿ä¼šæŸ¥è¯¢å…¶ç¼“å­˜è®°å½•ï¼Œè‹¥æŸ¥è¯¢åˆ°æ­¤è®°å½•ä¾¿ç›´æŽ¥è¿”å›žç»“æžœã€‚ è‹¥æœ¬åœ° DNS æœåŠ¡å™¨ç¼“å­˜ä¸­æœªæŸ¥è¯¢åˆ°ç›¸å…³è®°å½•ï¼Œä¾¿å‘ DNS æ ¹æœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œæ ¹ DNS æœåŠ¡å™¨æ²¡æœ‰è®°å½•å…·ä½“çš„åŸŸåä¸Ž ip åœ°å€çš„æ˜ å°„å…³ç³»ï¼Œè€Œæ˜¯è¿”å›žåŸŸæœåŠ¡å™¨çš„åœ°å€ã€‚ æœ¬åœ° DNS ç»§ç»­å‘åŸŸæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒåŸŸæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åŽï¼Œè¿”å›žåŸŸåè§£æžæœåŠ¡å™¨çš„åœ°å€ã€‚æœ€åŽæœ¬åœ° DNS æœåŠ¡å™¨å‘åŸŸåè§£æžæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒåŸŸåè§£æžæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä¹‹åŽï¼Œè¿”å›žåŸŸåä¸Ž ip æ˜ å°„å…³ç³»ä¿¡æ¯ï¼Œç„¶åŽæœ¬åœ° DNS æœåŠ¡å™¨å°†æ˜ å°„ä¿¡æ¯ä¿å­˜åˆ°å…¶ç¼“å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå°† ip åœ°å€è¿”å›žç»™ç”¨æˆ·ç”µè„‘ã€‚ å›¾ç‰‡æ¥è‡ªç½‘ç»œ æµè§ˆå™¨å‘èµ· http è¯·æ±‚æµè§ˆå™¨èŽ·å–åˆ°åŸŸåå¯¹åº”çš„ ip åœ°å€ä¹‹åŽï¼Œä¾¿ä¼šä»¥ä¸€ä¸ªéšæœºç«¯å£ï¼ˆ1024&lt; port &lt; 65535ï¼‰å‘æœåŠ¡ç«¯ web ç¨‹åº 80 ç«¯å£å‘èµ· TCP è¿žæŽ¥è¯·æ±‚ã€‚ æµè§ˆå™¨ä¸ŽæœåŠ¡ç«¯ç»è¿‡ 3 æ¬¡ TCP æ¡æ‰‹ä¹‹åŽï¼Œå»ºç«‹ TCP è¿žæŽ¥ï¼Œç„¶åŽæµè§ˆå™¨å‘èµ·ä¸€ä¸ª http è¯·æ±‚ã€‚ä¸€èˆ¬çš„æµè§ˆå™¨åªèƒ½å‘èµ· GET æˆ–è€… POST è¯·æ±‚ã€‚ è¯·æ±‚ä¿¡æ ¼å¼åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š è¯·æ±‚è¡Œï¼ˆè¯·æ±‚æ–¹æ³• URI åè®®/ç‰ˆæœ¬ï¼‰ è¯·æ±‚å¤´(ç¼“å­˜ã€å®¢æˆ·ç«¯èº«ä»½ä¿¡æ¯ç­‰) ç©ºè¡Œ æ¶ˆæ¯ä½“ http è¯·æ±‚æ ¼å¼ç¤ºä¾‹ï¼š1234567GET /index.html HTTP/1.1Cache-Control:max-age=0Cookie:gsScrollPos=; _ga=GA1.2.329038035.1465891024; _gat=1If-Modified-Since:Sun, 01 May 2016 23:59:59 GMTUser-Agent:Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36//æ¶ˆæ¯ä½“ PSï¼šå¸¸ç”¨çš„è¯·æ±‚æ–¹æ³•æœ‰ GET/POST/DELETE/PUT/HEAD ã€‚ ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾ TCP ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯ï¼šä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å› è€Œäº§ç”Ÿä¸å¿…è¦çš„å“åº”å¼€é”€ã€‚ åœ¨è°¢å¸Œä»è‘—ã€Šè®¡ç®—æœºç½‘ç»œã€‹ç¬¬å››ç‰ˆä¸­è®²â€œä¸‰æ¬¡æ¡æ‰‹â€çš„ç›®çš„æ˜¯â€œä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯â€ã€‚åœ¨å¦ä¸€éƒ¨ç»å…¸çš„ã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸€ä¹¦ä¸­è®²â€œä¸‰æ¬¡æ¡æ‰‹â€çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³â€œç½‘ç»œä¸­å­˜åœ¨å»¶è¿Ÿçš„é‡å¤åˆ†ç»„â€çš„é—®é¢˜ã€‚ TCP å››æ¬¡æŒ¥æ‰‹çš„ç›®çš„æ˜¯ï¼šä¸ºç¡®ä¿æ”¶å‘åŒæ–¹æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§ã€‚ é‚£å››æ¬¡åˆ†æ‰‹åˆæ˜¯ä¸ºä½•å‘¢ï¼ŸTCPåè®®æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ã€å¯é çš„ã€åŸºäºŽå­—èŠ‚æµçš„è¿è¾“å±‚é€šä¿¡åè®®ã€‚TCPæ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå½“ä¸»æœº1å‘å‡ºFINæŠ¥æ–‡æ®µæ—¶ï¼Œåªæ˜¯è¡¨ç¤ºä¸»æœº1å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¸»æœº1å‘Šè¯‰ä¸»æœº2ï¼Œå®ƒçš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†ï¼›ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™ä¸»æœº1è¿˜æ˜¯å¯ä»¥æŽ¥å—æ¥è‡ªä¸»æœº2çš„æ•°æ®ï¼›å½“ä¸»æœº2è¿”å›žACKæŠ¥æ–‡æ®µæ—¶ï¼Œè¡¨ç¤ºå®ƒå·²ç»çŸ¥é“ä¸»æœº1æ²¡æœ‰æ•°æ®å‘é€äº†ï¼Œä½†æ˜¯ä¸»æœº2è¿˜æ˜¯å¯ä»¥å‘é€æ•°æ®åˆ°ä¸»æœº1çš„ï¼›å½“ä¸»æœº2ä¹Ÿå‘é€äº†FINæŠ¥æ–‡æ®µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¡¨ç¤ºä¸»æœº2ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå°±ä¼šå‘Šè¯‰ä¸»æœº1ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¹‹åŽå½¼æ­¤å°±ä¼šæ„‰å¿«çš„ä¸­æ–­è¿™æ¬¡TCPè¿žæŽ¥ã€‚å¦‚æžœè¦æ­£ç¡®çš„ç†è§£å››æ¬¡åˆ†æ‰‹çš„åŽŸç†ï¼Œå°±éœ€è¦äº†è§£å››æ¬¡åˆ†æ‰‹è¿‡ç¨‹ä¸­çš„çŠ¶æ€å˜åŒ–ã€‚ æœåŠ¡å™¨è¿”å›ž http å“åº”æœåŠ¡ç«¯è¿”å›ž http å“åº”çš„æ ¼å¼åŒ…å«å››ä¸ªéƒ¨åˆ†: å“åº”è¡Œï¼ˆçŠ¶æ€è¡Œï¼‰ï¼ˆåè®®/ç‰ˆæœ¬å· çŠ¶æ€ç  çŠ¶æ€è¯´æ˜Žï¼‰ å“åº”å¤´ï¼ˆå“åº”å¤´æ˜¯æœåŠ¡å™¨ä¼ é€’ç»™å®¢æˆ·ç«¯ç”¨äºŽè¯´æ˜ŽæœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠå°†æ¥ç»§ç»­è®¿é—®è¯¥èµ„æºæ—¶çš„ç­–ç•¥ã€‚ï¼‰ ç©ºè¡Œ æ¶ˆæ¯ä½“ï¼ˆå“åº”ä½“æ˜¯æœåŠ¡ç«¯è¿”å›žç»™å®¢æˆ·ç«¯çš„ HTML æ–‡æœ¬å†…å®¹ï¼Œæˆ–è€…å…¶ä»–æ ¼å¼çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šè§†é¢‘æµã€å›¾ç‰‡æˆ–è€…éŸ³é¢‘æ•°æ®ã€‚ï¼‰ http å“åº”æ ¼å¼ç¤ºä¾‹ï¼š12345678910111213HTTP/1.1 200 OKDate: Sat, 31 Dec 2016 23:59:59 GMTContent-Type: text/html;charset=ISO-8859-1Content-Length: 113ï¼œhtmlï¼žï¼œheadï¼žï¼œtitleï¼žHaohaoï¼œ/titleï¼žï¼œ/headï¼žï¼œbodyï¼žHello Worldï¼ï¼œ/bodyï¼žï¼œ/htmlï¼ž PSï¼šæœåŠ¡å™¨åœ¨è¿”å›žå“åº”ä¹‹å‰å¯èƒ½ä¼šç»è¿‡é‡å®šå‘ã€åå‘ä»£ç†æœåŠ¡å™¨è¯·æ±‚ç­‰è¿‡ç¨‹ã€‚ æµè§ˆå™¨å¤„ç†å“åº”ä»¥æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ä½“ä¸º HTML æ–‡æœ¬ä¸ºä¾‹ï¼Œæµè§ˆå™¨è§£æž HTML æ–‡æœ¬æ—¶ï¼Œä¼šâ€è‡ªä¸Šè€Œä¸‹â€œåŠ è½½ï¼Œå¹¶åœ¨åŠ è½½è¿‡ç¨‹ä¸­è¿›è¡Œè§£æžæ¸²æŸ“å±•çŽ°ç»™ç”¨æˆ·ã€‚åœ¨è§£æžè¿‡ç¨‹ä¸­ï¼Œå¦‚æžœé‡åˆ°è¯·æ±‚å¤–éƒ¨èµ„æºæ—¶ï¼Œå¦‚å›¾ç‰‡ã€å¤–é“¾çš„ CSS ã€ js ç­‰ï¼Œè¯·æ±‚è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸ä¼šå½±å“æ•´ä¸ª HTML æ–‡æ¡£çš„åŠ è½½ã€‚ å‚è€ƒæ–‡ç« https://foofish.net/http-request-process.html https://github.com/jawil/blog/issues/14]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[æŽ¥å£ä¸ŽæŠ½è±¡ç±»çš„åŒºåˆ«ï¼ˆJava 7ç‰ˆæœ¬ï¼‰]]></title>
      <url>%2F2017%2F09%2F20%2Fdiff-between-interface-and-abstract-class%2F</url>
      <content type="text"><![CDATA[ä½ çœ‹èµ·æ¥åƒä»€ä¹ˆåœ°ä½ï¼Œä½ å°±æ˜¯ä»€ä¹ˆåœ°ä½ï¼Œäº’è”ç½‘æ—¶ä»£ä¹Ÿæ˜¯ä¸€ä¸ªçœ‹é¢œçš„æ—¶ä»£ï¼Œè™½æ— å¥ˆï¼Œä½†æ˜¯äº‹å®ž æœ¬ç¯‡ä»Ž 8 ä¸ªæ–¹é¢ä»‹ç»ä¸€ä¸‹ï¼ŒæŽ¥å£ä¸ŽæŠ½è±¡ç±»çš„åŒºåˆ«ã€‚ æŠ½è±¡æŽ¥å£ä¸ŽæŠ½è±¡ç±»å…·å¤‡æŠ½è±¡å¤šç±»å¯¹è±¡ç›¸åŒå±žæ€§ç‰¹å¾çš„ç‰¹ç‚¹ï¼Œå‡å¯ä½œä¸ºä¸€ç§è§„èŒƒã€‚ å±žæ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰æŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡ä¸Žæ™®é€šçš„ Java ç±»å£°æ˜Žä¸€æ ·ï¼›æŽ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ public static final ç±»åž‹çš„ã€‚ æ–¹æ³•å®žçŽ°æŠ½è±¡ç±»å¯ä»¥æœ‰æ–¹æ³•å®žçŽ°ï¼Œä¹Ÿå¯ä»¥ç”¨ abstract å…³é”®å­—å°†å…¶æŠ½è±¡åŒ–ï¼›æŽ¥å£ä¸å­˜åœ¨æ–¹æ³•å®žçŽ°ï¼Œæ‰€æœ‰çš„æ–¹æ³•å‡ä¸º public æŠ½è±¡æ–¹æ³•ã€‚ å®žä¾‹åŒ–æŠ½è±¡ç±»æœ‰æž„é€ å‡½æ•°ï¼Œä½†ä¸èƒ½å®žä¾‹åŒ–ï¼Œé™¤äº†ä¸èƒ½å®žä¾‹åŒ–ä¹‹å¤–ï¼Œä¸Žæ™®é€šçš„ Java ç±»æ²¡æœ‰åŒºåˆ«ï¼›æŽ¥å£æ²¡æœ‰å®žä¾‹åŒ–çš„æ¦‚å¿µï¼Œæ— æž„é€ å‡½æ•°ã€‚ ç»§æ‰¿æŠ½è±¡ç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†å¯ä»¥å®žçŽ°å¤šä¸ªæŽ¥å£ï¼›ä¸€ä¸ªæŽ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæŽ¥å£ã€‚ å­ç±»å®žçŽ°å­ç±»é€šè¿‡ extends å…³é”®å­—æ¥ç»§æ‰¿æŠ½è±¡ç±»ï¼Œå¦‚æžœå­ç±»ä¸æ˜¯æŠ½è±¡ç±»çš„è¯ï¼Œå®ƒéœ€è¦æä¾›æŠ½è±¡ç±»ä¸­æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å®žçŽ°ï¼›å­ç±»é€šè¿‡ implements å…³é”®å­—æ¥å®žçŽ°æŽ¥å£ï¼Œéœ€è¦æä¾›æŽ¥å£ä¸­æ‰€æœ‰å£°æ˜Žæ–¹æ³•çš„å®žçŽ°ã€‚ è®¿é—®ä¿®é¥°ç¬¦æŠ½è±¡ç±»ä¸­æŠ½è±¡æ–¹æ³•å¯ä»¥æœ‰ publicã€ protected å’Œ default è¿™äº›ä¿®é¥°ç¬¦ï¼›æŽ¥å£æ–¹æ³•é»˜è®¤ä¿®é¥°ç¬¦æ˜¯ public ï¼Œä¸å¯ä»¥ä½¿ç”¨å…¶å®ƒä¿®é¥°ç¬¦ã€‚ è®¿é—®é€Ÿåº¦åŒç­‰æ¡ä»¶ä¸‹ï¼Œå¯¹æŠ½è±¡ç±»æ–¹æ³•çš„è®¿é—®é€Ÿåº¦å¿«äºŽæŽ¥å£ï¼ŒæŽ¥å£éœ€è¦èŠ±æ—¶é—´å¯»æ‰¾ç±»ä¸­å®žçŽ°çš„æ–¹æ³•ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[2017 ä¸‹åŠå¹´å­¦ä¹ è§„åˆ’]]></title>
      <url>%2F2017%2F09%2F06%2F2017-study-plan%2F</url>
      <content type="text"><![CDATA[ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯ 10 å¹´å‰ï¼Œå…¶æ¬¡æ˜¯çŽ°åœ¨ã€‚ æœ€è¿‘å·®ä¸å¤šè§£å†³äº†å°è®ºæ–‡çš„é—®é¢˜ï¼Œå¿ƒç†è´Ÿæ‹…ä¸€ä¸‹å­å‡è½»ä¸€å¤§åŠã€‚ä¸Šä¸ªæœˆèŠ±äº† 20 å¤šå¤©æ—¶é—´åœ¨å¤–åœ°ç»´æŠ¤é¡¹ç›®ï¼Œå‘å•Šï¼Œå“ªæ˜¯ç»´æŠ¤é¡¹ç›®ï¼Œå…¶å®žå°±æ˜¯çŽ°åœºå¼€å‘è°ƒè¯•æµ‹è¯•æ–°åŠŸèƒ½ã€‚è¿™ä¸€æžä¸è¦ç´§ï¼Œå½»åº•æ‰“ä¹±äº†ä¸ªäººè®¡åˆ’ï¼Œæœ¬æ¥è®ºæ–‡æ˜¯ä¹æœˆåˆå®Œæˆï¼Œä¸€ç›´æ‹–åˆ°çŽ°åœ¨ï¼Œæžå¾—çŽ°åœ¨è®¡åˆ’å¾ˆæ··ä¹±ï¼Œè‡ªå·±å¾ˆå¤´ç–¼ï¼Œæ›´ç‰¹ä¹ˆå¤´ç–¼çš„æ˜¯è‡ªå·±çš„åšå®¢å’Œå…¬ä¼—å·ä¹Ÿæœ‰å°†è¿‘ä¸€ä¸ªæœˆæ²¡ç»´æŠ¤äº†ï¼Œåˆä¸€æ¬¡è¢«â€œå•ªå•ªâ€æ‰“è„¸ã€‚ æˆ‘ä¹ æƒ¯äºŽæœªæ¥çš„ç”Ÿæ´»æœ‰ä¸€ä¸ªå¤§è‡´çš„å®‰æŽ’ï¼Œä¸­é—´å¯ä»¥æœ‰ç‚¹å°æ’æ›²ï¼Œä½†æ˜¯ä¸è¦æ‰“ä¹±èŠ‚å¥å°±å¥½ã€‚ æŽ¥ä¸‹æ¥å°±æ˜¯æ¯•ä¸šå­£æ‰¾å·¥ä½œï¼ŒåŽ‹åŠ›å±±å¤§ï¼Œæ‰€ä»¥ç›®å‰å¿…é¡»è¦æœ‰ä¸€ä¸ªæ˜Žç¡®çš„è§„åˆ’ã€‚ä¸»è¦åº”å¯¹æŽ¥ä¸‹æ¥çš„é¢è¯•ã€è®ºæ–‡ã€‚ æŽ¥ä¸‹æ¥æ¯å¤©è§£å†³æŽ‰çš„çŸ¥è¯†ç‚¹éƒ½ä¼šåœ¨ä¸Šé¢åšè®°å½•ã€‚ 2017 ä¸‹å­¦å¹´å­¦ä¹ è§„åˆ’å¤§è®ºæ–‡10 æœˆä»½ä¹‹å‰å®Œæˆè®ºæ–‡æ¡†æž¶ï¼Œå…¶ä»– TBD JavaæŒ‰ç…§ Java å·¥ç¨‹å¸ˆçš„æ ‡å‡†å‚¨å¤‡ Java åŸºç¡€çŸ¥è¯† AndroidAndroid è¿›é˜¶ä¹¦ç±åå¤å­¦ä¹  ã€ŠAndroidå¼€å‘è‰ºæœ¯æŽ¢ç´¢ã€‹ã€ŠAndroidæºç è®¾è®¡æ¨¡å¼ã€‹ ä¸“ä¸šä¹¦ç± è®¾è®¡æ¨¡å¼ç†Ÿæ‚‰å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼å…­å¤§åŽŸåˆ™ + 24 ç§è®¾è®¡æ¨¡å¼ Android æž¶æž„ç†Ÿæ‚‰ MVP MVVM Clean æž¶æž„ å¼€æºåº“æºç é˜…è¯»ç†Ÿæ‚‰ RxJava Retrofit Glide ç­‰å¸¸ç”¨å¼€æºåº“çš„åŽŸç†å’Œæµç¨‹ã€‚ æ¯å¤©é˜…è¯»ä¼˜ç§€çš„å¼€æºåº“æºç ä¸å°‘äºŽåŠä¸ªå°æ—¶ã€‚ æ•°æ®ç»“æž„è§£å†³æŽ‰ä¸¤æœ¬ä¹¦ï¼š å¤§è¯æ•°æ®ç»“æž„ ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å— ç®—æ³•æ—¶é—´å¤æ‚åº¦çº¿æ€§è¡¨ é¡ºåºè¡¨çº¿æ€§è¡¨ å•é“¾è¡¨çº¿æ€§è¡¨ å¾ªçŽ¯å•é“¾è¡¨çº¿æ€§è¡¨ å¾ªçŽ¯åŒé“¾è¡¨æ ˆ é¡ºåºæ ˆæ ˆ é“¾æ ˆé˜Ÿåˆ— é¡ºåºå¾ªçŽ¯é˜Ÿåˆ—é˜Ÿåˆ— é“¾é˜Ÿåˆ—äºŒå‰æ ‘ï¼Œæ ‘å›¾ è®¡ç®—æœºç½‘ç»œè®¡ç®—æœºç½‘è·¯åŸºç¡€ç‰©ç†å±‚æ•°æ®é“¾è·¯å±‚ç½‘ç»œå±‚è¿è¾“å±‚ æ“ä½œç³»ç»Ÿæ“ä½œç³»ç»ŸåŽŸç†]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Java çº¿ç¨‹çš„ä¸ƒç§çŠ¶æ€]]></title>
      <url>%2F2017%2F07%2F21%2FJava-thread-7-kinds-of-state%2F</url>
      <content type="text"><![CDATA[æ˜ŽçŸ¥å¯¹è¦åšçš„äº‹æƒ…è¿›è¡Œæ‹–å»¶ï¼Œå®ƒæ‰€æ¶ˆè€—çš„å¿ƒç†èƒ½é‡ä¼šè¿œè¿œå¤šäºŽåšäº‹æƒ…æœ¬èº« æœ¬ç¯‡æ„Ÿæ€§åœ°ä»‹ç»ä¸€ä¸‹ Java çº¿ç¨‹çš„ä¸ƒç§çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ Java çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾ Java çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾ Java çº¿ç¨‹çŠ¶æ€åœ¨ Java çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒæŒ‰å¤æ‚çš„å¹¶å‘åœºæ™¯è€ƒè™‘ï¼Œå¯å°† Java çº¿ç¨‹çš„çŠ¶æ€åˆ†ä¸ºä¸ƒç§ï¼Œåˆ†åˆ«æ˜¯ï¼šæ–°å»ºï¼ˆNewï¼‰ï¼Œå¯è¿è¡Œï¼ˆRunnable æˆ– Readyï¼‰ï¼Œè¿è¡Œï¼ˆRunningï¼‰ï¼Œæ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰ï¼Œé™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰ï¼Œé˜»å¡žï¼ˆBlockedï¼‰ï¼Œç»“æŸï¼ˆTerminatedï¼‰ã€‚ æ–°å»ºï¼ˆNewï¼‰çŠ¶æ€æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œå°šæœªæ‰§è¡Œã€‚ å¯è¿è¡Œï¼ˆRunnable æˆ– Readyï¼‰çŠ¶æ€æ–°åˆ›å»ºçš„çº¿ç¨‹è°ƒç”¨ start æ–¹æ³•åŽä¾¿å¤„äºŽ Runnable çŠ¶æ€ï¼Œåˆšåˆšç»“æŸç­‰å¾…ï¼ˆèŽ·å–åˆ°é”ï¼‰æˆ–åˆšç»“æŸé˜»å¡žçŠ¶æ€çš„çº¿ç¨‹ä¹Ÿä¼šå¤„äºŽ Runnable çŠ¶æ€ï¼Œå¤„äºŽè¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºŽå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…èŽ·å– CPU èµ„æºã€‚ è¿è¡Œï¼ˆRunningï¼‰çŠ¶æ€å¤„äºŽ Runnable çŠ¶æ€çš„çº¿ç¨‹èŽ·å–åˆ° CPU èµ„æºï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚ æ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰çŠ¶æ€synchronized ä»£ç å—å†…è¢«é”ä½çš„å¯¹è±¡è°ƒç”¨äº†å®ƒçš„ wait() æ–¹æ³•æˆ–è€…åœ¨å½“å‰çº¿ç¨‹ä¸­è°ƒç”¨äº†å…¶ä»–çº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°†ä¼šé‡Šæ”¾å æœ‰çš„é”ï¼Œé‡Šæ”¾ CPU èµ„æºï¼Œé˜»å¡žåœ¨ç­‰å¾…é˜Ÿåˆ—é‡Œé¢ï¼Œä¸€ç›´ç­‰å¾…è¢« synchronized ä¿®é¥°çš„å¯¹è±¡è°ƒç”¨ notify() æˆ– notifyAll() æ–¹æ³•å”¤é†’æˆ–è€… join çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œç»“æŸï¼ˆå¼‚å¸¸é€€å‡ºï¼‰ã€‚åœ¨å¹¶å‘æ—¶ï¼Œå¤„äºŽæ— é™æœŸç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹è¢«å”¤é†’ä¹‹åŽï¼Œè¿˜è¦åŽ»ç«žäº‰å¯¹è±¡çš„é”ï¼Œå¦‚æžœç«žäº‰ä¸åˆ°ï¼Œçº¿ç¨‹å°†ä¼šè¢«é˜»å¡žåœ¨å¯¹è±¡çš„é”æ± ä¸­ï¼Œç«žäº‰åˆ°é”ä¹‹åŽï¼Œçº¿ç¨‹å°†ä¼šå¤„äºŽ Runnable çŠ¶æ€ã€‚ é™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰çŠ¶æ€ä¸Žæ— é™æœŸç­‰å¾…ï¼ˆWaitingï¼‰çŠ¶æ€ä¸åŒä¹‹å¤„åœ¨äºŽï¼Œè°ƒç”¨ wait å’Œ join æ–¹æ³•æ—¶ä¼ å…¥äº†ç­‰å¾…é™å®šæ—¶é—´ã€‚å¦å¤–ï¼Œçº¿ç¨‹è°ƒç”¨ sleep() æ–¹æ³•ä¹Ÿä¼šå¤„äºŽé™æœŸç­‰å¾…ï¼ˆTimed Waitingï¼‰çŠ¶æ€ï¼Œä¼šé‡Šæ”¾ CPU èµ„æºï¼Œä½†å¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œä¸€ç›´åˆ°ä¼‘çœ ç»“æŸå˜æˆ Runnable çŠ¶æ€ã€‚ é˜»å¡žï¼ˆBlockedï¼‰çŠ¶æ€çº¿ç¨‹ç¨‹åºæ‰§è¡Œåˆ° synchronized ä»£ç å—æˆ– Reentrant.lock() æ–¹æ³•ï¼Œå¯¹è±¡çš„é”è¢«å…¶ä»–çº¿ç¨‹å ç”¨æ—¶ï¼Œå½“å‰çº¿ç¨‹å°†ä¼šè¢«é˜»å¡žåœ¨å¯¹è±¡çš„é”æ± ä¸­ï¼Œå¤„äºŽé˜»å¡žï¼ˆBlockedï¼‰çŠ¶æ€ã€‚ ç»“æŸï¼ˆTerminatedï¼‰çŠ¶æ€çº¿ç¨‹ run æ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–è€…å¼‚å¸¸é€€å‡ºï¼Œåˆ™è¯¥çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç»ˆç»“ï¼Œä¸èƒ½å†æ¬¡ä½¿ç”¨ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Java è™šæ‹ŸæœºåŸºç¡€çŸ¥è¯†ï¼ˆäºŒï¼‰]]></title>
      <url>%2F2017%2F07%2F20%2FBasic-knowledge-of-JVM-GC%2F</url>
      <content type="text"><![CDATA[ä¸€åˆ‡åŠªåŠ›éƒ½åº”è¯¥æŒ‡å‘çŽ°å®žï¼Œç»™ç”Ÿæ´»å¸¦æ¥ç›´æŽ¥ã€å¯è§¦ç¢°çš„å˜åŒ– æœ¬ç¯‡æ˜¯ Java è™šæ‹Ÿæœºç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦ä»‹ç» Java è™šæ‹Ÿæœºåžƒåœ¾å›žæ”¶æœºåˆ¶ã€‚ JVM åžƒåœ¾å›žæ”¶æœºåˆ¶ç†è§£ JVM åžƒåœ¾å›žæ”¶æœºåˆ¶éœ€è¦å¼„æ¸…æ¥šä¸¤ä¸ªé—®é¢˜ï¼š ä»€ä¹ˆæ˜¯åžƒåœ¾ï¼Œæˆ–è€…æ€Žä¹ˆåˆ¤å®šåžƒåœ¾ï¼Ÿ æ€Žä¹ˆå›žæ”¶ï¼Œæˆ–è€…é€šè¿‡ä»€ä¹ˆæ–¹å¼å›žæ”¶åžƒåœ¾ï¼Ÿ ä»€ä¹ˆæ˜¯åžƒåœ¾ï¼Œæˆ–è€…æ€Žä¹ˆåˆ¤å®šåžƒåœ¾ï¼Ÿâ€œåžƒåœ¾â€å³ä¸å†å­˜æ´»çš„å¯¹è±¡ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š å¼•ç”¨è®¡æ•°ç®—æ³• å¯è¾¾æ€§åˆ†æžç®—æ³• å¼•ç”¨è®¡æ•°ç®—æ³•ä¸ºæ¯ä¸€ä¸ªåˆ›å»ºçš„å¯¹è±¡åˆ†é…ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨æ¥å­˜å‚¨è¯¥å¯¹è±¡è¢«å¼•ç”¨çš„ä¸ªæ•°ã€‚å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œå¼•ç”¨è®¡æ•°å™¨å°±åŠ  1 ï¼›å½“å¼•ç”¨å¤±æ•ˆï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡ 1 ï¼›å½“å¼•ç”¨è®¡æ•°å™¨ä¸º 0 ï¼Œæ„å‘³è¿™ä¸ªå¯¹è±¡æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯ä»¥è®¤ä¸ºâ€œå¯¹è±¡æ­»åŽ»â€ã€‚ ä½†æ˜¯ï¼Œå¼•ç”¨è®¡æ•°ç®—æ³•å¾ˆéš¾æ£€æµ‹å‡ºå¯¹è±¡ä¹‹é—´çš„å¾ªçŽ¯å¼•ç”¨ï¼Œå½“ä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œå³æ—¶å®ƒä¿©éƒ½ä¸è¢«å¤–ç•Œä»»ä½•ä¸œè¥¿å¼•ç”¨ï¼Œå®ƒä¿©çš„è®¡æ•°éƒ½ä¸ä¸ºé›¶ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè¢«å›žæ”¶ã€‚æ‰€ä»¥ï¼Œ JVM å¹¶æ²¡æœ‰ç”¨æ­¤æ–¹æ¡ˆæ¥æ£€æµ‹å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ å¯è¾¾æ€§åˆ†æžç®—æ³•å¯è¾¾æ€§åˆ†æžç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯ä»¥ä¸€ç³»åˆ— GC Roots å¯¹è±¡ä¸ºèµ·ç‚¹å‡ºå‘ï¼Œç„¶åŽå‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯ç»ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå¤„åœ¨å¼•ç”¨é“¾ä¸Šçš„å¯¹è±¡ç§°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œæˆ–å­˜æ´»å¯¹è±¡ï¼›è€Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿žï¼Œåˆ™è¢«è§†ä¸ºä¸å¯è¾¾å¯¹è±¡ï¼Œæˆ–åžƒåœ¾ã€‚JVM é‡‡ç”¨å¯è¾¾æ€§åˆ†æžç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ å¯è¾¾æ€§åˆ†æžç®—æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»JVM ä¸­å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Rootsï¼ŸGC Roots å¯¹è±¡æœ¬èº«ä¸€å®šæ˜¯å¯è¾¾çš„ï¼Œè¿™æ ·ä»Žå®ƒä»¬å‡ºå‘éåŽ†åˆ°çš„å¯¹è±¡æ‰èƒ½ä¿è¯ä¸€å®šå¯è¾¾ã€‚ä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆï¼ˆå¸§æ ˆä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ æ–¹æ³•åŒºä¸­é™æ€å±žæ€§å¼•ç”¨çš„å¯¹è±¡ã€‚ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚ æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI å¼•ç”¨çš„å¯¹è±¡ã€‚ é€šè¿‡ä»€ä¹ˆæ–¹å¼å›žæ”¶åžƒåœ¾ï¼Ÿå¸¸ç”¨çš„åžƒåœ¾å›žæ”¶æ–¹å¼æœ‰ï¼š æ ‡è®°-æ¸…é™¤ç®—æ³• (Mark-Sweep) æ ‡è®°-æ•´ç†ç®—æ³• (Mark-Compact) å¤åˆ¶ç®—æ³• (Copying) åˆ†ä»£æ”¶é›†ç®—æ³• (Generational Collection) æ ‡è®°-æ¸…é™¤ç®—æ³• (Mark-Sweep)åŸºæœ¬åŽŸç†ï¼šå…ˆæ ‡è®°å‡ºéœ€è¦å›žæ”¶çš„å¯¹è±¡ï¼Œç„¶åŽä¸€å¹¶å›žæ”¶è¢«æ ‡è®°è¿‡çš„å¯¹è±¡ã€‚ é€šè¿‡å¯è¾¾æ€§åˆ†æžç®—æ³•åˆ¤å®šå¯¹è±¡ä¸å¯ç”¨ï¼Œæ˜¯æ ‡è®°çš„ç¬¬ä¸€æ­¥ï¼Œå¦‚æžœå¯¹è±¡å·²ç»è¢«æ ‡è®°ä¸€æ¬¡ï¼Œå®ƒå°†è¢«è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰æ¡ä»¶ä¸ºå¯¹è±¡æ˜¯å¦é‡å†™äº† finalize() æ–¹æ³•ï¼Œæˆ–è€… finalize() å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨ã€‚å½“å¯¹è±¡æ²¡é‡å†™æˆ– finalize() å·²ç»è¢«æ‰§è¡Œè¿‡ï¼Œå°±è¯æ˜Žå¯¹è±¡å·²ç»æ²¡æœ‰å¯èƒ½å†å›žåˆ°å¯ç”¨çŠ¶æ€ï¼Œå¾…è™šæ‹Ÿæœºç¬¬äºŒæ¬¡æ ‡è®°å®ƒæ—¶ï¼Œå°±ä¼šè¢«æ”¾åˆ°å›žæ”¶çš„é›†åˆä¸­ã€‚ æ ‡è®°-æ¸…é™¤ç®—æ³•ç¼ºç‚¹ï¼š æ•ˆçŽ‡ä½Žï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆçŽ‡éƒ½ä¸é«˜ æ˜“äº§ç”Ÿå†…å­˜ç¢Žç‰‡ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åŽä¼šå¯¼è‡´å†…å­˜ä¸­å‡ºçŽ°å¤§é‡çš„ä¸è¿žç»­çš„å†…å­˜ç¢Žç‰‡ï¼Œä¹‹åŽåˆ†é…è¾ƒå¤§å¯¹è±¡çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå¯¼è‡´æ²¡æœ‰è¶³å¤Ÿçš„è¿žç»­å†…å­˜ï¼Œå¯èƒ½ä¼šè§¦å‘å¦ä¸€æ¬¡çš„åžƒåœ¾å›žæ”¶ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿé—´æŽ¥çš„åæ˜ å‡ºäº†æ•ˆçŽ‡ä¸é«˜ã€‚å½“ç„¶ï¼Œ JVM å¹¶ä¸æ˜¯åªç”¨è¿™ä¸€ä¸ªç®—æ³•åŽ»å›žæ”¶åžƒåœ¾ï¼Œè€Œæ˜¯åœ¨å¯¹è±¡å­˜æ´»çŽ‡è¾ƒé«˜çš„æ—¶å€™ï¼Œä½¿ç”¨è¿™ä¸ªç®—æ³•ã€‚ æ ‡è®°-æ•´ç†ç®—æ³• (Mark-Compact)æ ‡è®°-æ•´ç†ç®—æ³•å¯ä»¥è¯´æ˜¯æ ‡è®°-æ¸…é™¤ç®—æ³•çš„å®Œå–„ç‰ˆï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢Žç‰‡ã€‚æ ‡è®°-æ•´ç†ç®—æ³•æ˜¯åœ¨æ ‡è®°åŽï¼Œå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åŽå†æ¸…ç†æŽ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚ å¤åˆ¶ç®—æ³• (Copying)å¤åˆ¶ç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¯ç”¨å†…å­˜å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“è¿™å—å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šï¼Œç„¶åŽæ¸…é™¤å·²ä½¿ç”¨çš„é‚£å—ã€‚è¿™æ ·æ¯æ¬¡å›ºå®šå›žæ”¶ä¸€åŠå†…å­˜ï¼Œå®žçŽ°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆï¼Œå¹¶ä¸”ä¸ä¼šå‡ºçŽ°å†…å­˜ç¢Žç‰‡ã€‚è¿™ä¸ªç®—æ³•çš„ä»£ä»·ä¹Ÿå¾ˆå¤§ï¼Œå°±æ˜¯è¦ç‰ºç‰²ä¸€åŠçš„å†…å­˜ã€‚ä¸»æµçš„å•†ä¸šè™šæ‹Ÿæœºä¸€èˆ¬é‡‡ç”¨å¤åˆ¶ç®—æ³•æ¥å›žæ”¶æ–°ç”Ÿä»£ï¼Œå› ä¸ºæ–°ç”Ÿä»£é‡Œçš„å¯¹è±¡ 98% éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§ 1ï¼š1 çš„æ¯”ä¾‹åˆ’åˆ†å†…å­˜ç©ºé—´ã€‚ä¸€èˆ¬æ–°ç”Ÿä»£åªæœ‰ 10% ï¼ˆä¸ç»å¯¹ï¼‰å·¦å³çš„å¯¹è±¡å­˜æ´»ï¼Œè™šæ‹Ÿæœºçš„åˆ’åˆ†æ¯”ä¾‹å¾€å¾€é«˜äºŽ 8ï¼š1 ã€‚ åˆ†ä»£æ”¶é›†ç®—æ³• (Generational Collection)ç›®å‰ä¸»æµçš„å•†ä¸šè™šæ‹Ÿæœºå‡é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ æ–°ç”Ÿä»£ï¼šå¯¹è±¡å­˜æ´»çŽ‡ä½Žï¼Œæ¯æ¬¡åžƒåœ¾å›žæ”¶åŽéƒ½åªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤é€‚åˆç”¨å¤åˆ¶ç®—æ³•ã€‚ è€å¹´ä»£ï¼šå¯¹è±¡å­˜æ´»çŽ‡é«˜ï¼Œé€‚åˆä½¿ç”¨æ ‡è®°-æ¸…é™¤æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è®¾è®¡æ¨¡å¼ä¹‹ä»£ç†æ¨¡å¼]]></title>
      <url>%2F2017%2F07%2F07%2FAndroid-design-pattern-Proxy-pattern%2F</url>
      <content type="text"><![CDATA[ç”Ÿæ´»ä¸­çš„å¾ˆå¤šçƒ¦æ¼éƒ½æºäºŽç›²ç›®çš„æ”€æ¯”ï¼Œè€Œå¿˜äº†äº«å—è‡ªå·±çš„ç”Ÿæ´» æœ¬æ–‡æ˜¯ Android è®¾è®¡æ¨¡å¼çš„ç¬¬äº”ç¯‡ï¼ŒæŽ¥ä¸‹æ¥ä¼šé™†ç»­æŽ¨å‡ºæ•´ä¸ªå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ç³»åˆ—ã€‚æœ¬ç¯‡ä¸»è¦ä»‹ç»ä¸€ä¸‹åœ¨ Android å¼€å‘ä¸­æ— æ‰€ä¸åœ¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ â€“ ä»£ç†æ¨¡å¼ã€‚è¯´å®ƒæ— æ‰€ä¸åœ¨ï¼Œä¸»è¦æ˜¯å› ä¸º Android å››å¤§ç»„ä»¶çš„åˆ›å»ºå’Œä½¿ç”¨å‡ä¼šæ¶‰åŠä¸Ž Framework å±‚è¿›è¡Œé¢‘ç¹çš„ IPC ï¼Œè€Œ Binder IPC æ¨¡åž‹ä½¿ç”¨çš„å°±æ˜¯ä»£ç†æ¨¡å¼ã€‚ ä»£ç†æ¨¡å¼ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ï¼šä¸ºè®¿é—®å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥å®žçŽ°å¯¹è¢«è®¿é—®è€…çš„è®¿é—®ï¼Œå…¶å®žå°±æ˜¯åœ¨è®¿é—®å¯¹è±¡ä¸Žè¢«è®¿é—®å¯¹è±¡ä¹‹é—´æ·»åŠ ä¸€ä¸ªä¸­ä»‹ï¼Œç”¨æ¥éš”ç¦»è®¿é—®è€…ä¸Žè¢«è®¿é—®è€…çš„å…·ä½“å®žçŽ°ç»†èŠ‚ã€‚å®ƒæ˜¯ä¸€ç§ç»“æž„åž‹è®¾è®¡æ¨¡å¼ã€‚ æ¨¡å¼ç»“æž„ æŠ½è±¡å¯¹è±¡ï¼šå£°æ˜Žäº†ç›®æ ‡å¯¹è±¡å’Œä»£ç†å¯¹è±¡çš„å…±åŒæŽ¥å£ï¼› ç›®æ ‡å¯¹è±¡ï¼šè¢«ä»£ç†æˆ–è€…è¢«è®¿é—®çš„å¯¹è±¡ï¼› ä»£ç†å¯¹è±¡ï¼šä»£ç†å¯¹è±¡å†…éƒ¨æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œä»£ç†å¯¹è±¡ä¸Žç›®æ ‡å¯¹è±¡å®žçŽ°ç›¸åŒçš„æŽ¥å£ï¼Œ Client è®¿é—®ä»£ç†å¯¹è±¡ç›¸å½“äºŽé—´æŽ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚ å›¾ç‰‡æ¥è‡ªäºŽç½‘ç»œ æ¨¡å¼å®žçŽ°ä¸‹é¢æ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„ä¾‹å­ã€‚ æŠ½è±¡å¯¹è±¡123interface CommonInterface &#123; fun operate(str: String)&#125; ç›®æ ‡å¯¹è±¡12345class SubjectObj : CommonInterface &#123; override fun operate(str: String) &#123; println("ç›®æ ‡å¯¹è±¡ : $str") &#125;&#125; ä»£ç†å¯¹è±¡123456class ProxyObj(private val subjectObj: SubjectObj) : CommonInterface &#123; override fun operate(str: String) &#123; println("ä»£ç†å¯¹è±¡ : è°ƒç”¨ç›®æ ‡å¯¹è±¡") subjectObj.operate(str) &#125;&#125; Client123456fun main(args: Array&lt;String&gt;) &#123; val subjectObj = SubjectObj() val proxyObj = ProxyObj(subjectObj) proxyObj.operate("æ‰§è¡Œæ“ä½œ")&#125; Running12ä»£ç†å¯¹è±¡ : è°ƒç”¨ç›®æ ‡å¯¹è±¡ç›®æ ‡å¯¹è±¡ : æ‰§è¡Œæ“ä½œ Android ä¸­çš„ä»£ç†æ¨¡å¼Android Binder ç±»æ˜¯å®žçŽ°è¿›ç¨‹é—´é€šä¿¡çš„åª’ä»‹ï¼Œç”±äºŽè¿›ç¨‹é—´é€šä¿¡è´¯ç©¿å››å¤§ç»„ä»¶ä½¿ç”¨çš„å§‹æœ«ï¼Œæ‰€ä»¥åœ¨ Android å¼€å‘è¿‡ç¨‹ä¸­è¿›ç¨‹é—´é€šä¿¡éšå¤„å¯è§ï¼Œè€Œ Android Binder IPC æ¨¡åž‹æ˜¯åŸºäºŽä»£ç†æ¨¡å¼ã€‚ Android Binder IPC é€šä¿¡æ¨¡åž‹ï¼š Client : æŒæœ‰ Server çš„æœ¬åœ° Binder å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼› Server : æŒæœ‰æœ¬åœ° Binder å¯¹è±¡ï¼Œä¸º Client ç«¯æä¾›åŠŸèƒ½æ€§æœåŠ¡ï¼› ServiceManager : è´Ÿè´£ç®¡ç† Binder æœåŠ¡ï¼Œå¯ä»¥æ ¹æ® Binder Name èŽ·å– Binder å¼•ç”¨ï¼ŒåŠŸèƒ½ç±»ä¼¼äºŽ DNS æœåŠ¡å™¨ï¼› Binder é©±åŠ¨ : Client ä¸Ž Server ï¼Œä»¥åŠ Server ä¸Ž ServiceManager ä¹‹é—´çš„é€šä¿¡éƒ½ä¼šç»è¿‡ Binder é©±åŠ¨ï¼Œç»´æŒ Binder Proxy ä¸Ž Binder å®žä½“å¼•ç”¨ä¹‹é—´çš„æ˜ å°„ï¼Œæ ¹æ® Client ç«¯ç”± Binder Proxy æ‰“åŒ…å‘é€è¿‡æ¥æ•°æ®åŒ…ï¼Œè°ƒç”¨ Server æ–¹æ³•ï¼Œå†å°†è¿”å›žç»“æžœæ‰“åŒ…ç”± Binder Proxy ä¼ å›ž Client ç«¯ã€‚ ä¸‹é¢å®žçŽ°ä¸€ä¸ªæœ€ç®€å•çš„ Binder IPC æ¨¡åž‹ï¼š æŠ½è±¡å¯¹è±¡æŽ¥å£1234public interface RemoteCompute extends android.os.IInterface &#123; // å®žçŽ°ä¸€ä¸ªè¿œç¨‹åŠ æ³•è°ƒç”¨ï¼Œå¹¶å°†ç»“æžœè¿”å›žç»™ Client ç«¯ public int remoteAdd(int arg1, int arg2) throws android.os.RemoteException;&#125; ç›®æ ‡å¯¹è±¡ï¼ˆBinder æœ¬åœ°å¯¹è±¡ï¼‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556// Stub å°±æ˜¯ Binder æœ¬åœ°å¯¹è±¡ï¼Œå®ƒçš„æ–¹æ³•æ˜¯åœ¨ Server è¿›ç¨‹ä¸­æ‰§è¡Œã€‚ public static abstract class Stub extends android.os.Binder implements RemoteCompute &#123; private static final java.lang.String DESCRIPTOR = "cn.haohao.ipc.ICompute"; /** * Construct the stub at attach it to the interface. */ public Stub() &#123; this.attachInterface(this, DESCRIPTOR); &#125; /** * Cast an IBinder object into an cn.haohao.ipc.ICompute interface, * generating a proxy if needed. */ public static RemoteCompute asInterface(android.os.IBinder obj) &#123; if ((obj == null)) &#123; return null; &#125; android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR); if (((iin != null) &amp;&amp; (iin instanceof RemoteCompute))) &#123; return ((RemoteCompute) iin); &#125; return new RemoteCompute.Stub.Proxy(obj); &#125; @Override public android.os.IBinder asBinder() &#123; return this; &#125; @Override public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; case INTERFACE_TRANSACTION: &#123; reply.writeString(DESCRIPTOR); return true; &#125; case TRANSACTION_remoteAdd: &#123; data.enforceInterface(DESCRIPTOR); int _arg0; _arg0 = data.readInt(); int _arg1; _arg1 = data.readInt(); int _result = this.remoteAdd(_arg0, _arg1); reply.writeNoException(); reply.writeInt(_result); return true; &#125; &#125; return super.onTransact(code, data, reply, flags); &#125; static final int TRANSACTION_remoteAdd = (android.os.IBinder.FIRST_CALL_TRANSACTION + 0);&#125; ä»£ç†å¯¹è±¡1234567891011121314151617181920212223242526272829303132333435363738// åœ¨ IPC æ—¶ Proxy å¯¹è±¡åªæ˜¯æŒæœ‰ Binder Proxy å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸¥æ ¼æ¥è¯´å®ƒæ˜¯é—´æŽ¥çš„ä»£ç†ã€‚// Proxy è´Ÿè´£æ‰“åŒ… Client ç«¯çš„è¯·æ±‚å‚æ•°ï¼Œå‘é€ç»™ Binder é©±åŠ¨ï¼Œç”± Binder é©±åŠ¨è°ƒç”¨ Server ç«¯æœ¬åœ° Binder å¯¹è±¡è§£æžæ•°æ®å¹¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼ŒåŒæ—¶ Client ç«¯çº¿ç¨‹æŒ‚èµ·ï¼Œå½“ Server ç«¯æ–¹æ³•æ‰§è¡Œå®Œæ¯•åŽï¼Œå†å°†è¿”å›žç»“æžœæ‰“åŒ…ï¼Œé€šè¿‡ Binder é©±åŠ¨ä¼ å›žåˆ° Client ç«¯çš„ Binder Proxyï¼ŒBinder Proxy ä¼šè§£æžæ•°æ®åŒ…ä¸­çš„å†…å®¹å¹¶å°†åŽŸå§‹ç»“æžœè¿”å›žç»™ Client ç«¯ã€‚private static class Proxy implements RemoteCompute &#123; private android.os.IBinder mRemote; // IPC æ—¶ç”± Binder é©±åŠ¨è¿”å›žçš„ Binder Proxy (Binder ä»£ç†å¯¹è±¡) Proxy(android.os.IBinder remote) &#123; mRemote = remote; Log.d(TAG, "Proxy: remote : " + mRemote); &#125; @Override public android.os.IBinder asBinder() &#123; return mRemote; &#125; public java.lang.String getInterfaceDescriptor() &#123; return DESCRIPTOR; &#125; @Override public int remoteAdd(int arg1, int arg2) throws android.os.RemoteException &#123; Log.d(TAG, "remoteAdd() called with: arg1 = [" + arg1 + "], arg2 = [" + arg2 + "]"); android.os.Parcel _data = android.os.Parcel.obtain(); android.os.Parcel _reply = android.os.Parcel.obtain(); int _result; try &#123; _data.writeInterfaceToken(DESCRIPTOR); _data.writeInt(arg1); _data.writeInt(arg2); mRemote.transact(Stub.TRANSACTION_remoteAdd, _data, _reply, 0); _reply.readException(); _result = _reply.readInt(); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; return _result; &#125;&#125; Client12345678910111213private ServiceConnection mConn = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; // åœ¨ IPC æ—¶ï¼Œservice å°±æ˜¯ Binder é©±åŠ¨è¿”å›žçš„ Binder Proxy å¯¹è±¡çš„å¼•ç”¨ã€‚ remoteCompute = RemoteCompute.Stub.asInterface(service); &#125; @Override public void onServiceDisconnected(ComponentName name) &#123; &#125;&#125;;// è°ƒç”¨è¿œç¨‹æ–¹æ³•int result = remoteCompute.remoteAdd(88, 12); ä»£ç†æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹ é™ä½Žè®¿é—®è€…ä¸Žè¢«è®¿é—®è€…ä¹‹é—´çš„è€¦åˆåº¦ å¯ä»¥æŽ§åˆ¶è®¿é—®è€…å¯¹è¢«è®¿é—®è€…çš„è®¿é—®æƒé™ è™šæ‹Ÿä»£ç†é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå°å¯¹è±¡æ¥ä»£ç†ä¸€ä¸ªå¤§å¯¹è±¡ï¼Œå¯ä»¥å‡å°‘ç³»ç»Ÿå¼€é”€ ç¼ºç‚¹ ä»£ç†å¯¹è±¡ä¼šå¢žåŠ é€»è¾‘çš„å¤æ‚åº¦ å‡æ…¢å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®é€Ÿåº¦]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android ç³»ç»Ÿå¯åŠ¨æµç¨‹]]></title>
      <url>%2F2017%2F07%2F04%2FAndroid-system-boot-process%2F</url>
      <content type="text"><![CDATA[å‡¡äº‹éƒ½å¾€å¥½çš„ä¸€é¢åŽ»æƒ³ï¼Œè¿™ç§ä¹ æƒ¯æ¯”æ”¶å…¥åƒç£…è¿˜å¥½ å¯¹äºŽ Android ç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ï¼Œæ¯ä¸€ä½ Android Developer éƒ½åº”è¯¥çƒ‚ç†ŸäºŽå¿ƒï¼Œå®ƒåœ¨æŸç§ç¨‹åº¦ä¸Šä»£è¡¨ç€ Android å¼€å‘çš„å­¦ä¹ è·¯çº¿ã€‚æœ¬ç¯‡æ„Ÿæ€§åœ°ä»‹ç»ä¸€ä¸‹ Android ç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ã€‚ Android ç³»ç»Ÿå¯åŠ¨æµç¨‹ç¤ºæ„å›¾å›¾ç‰‡æ¥è‡ªäºŽç½‘ç»œ å¯åŠ¨è¿‡ç¨‹ï¼š Loader -&gt; Kernel -&gt; Native -&gt; Framework -&gt; App ã€‚ Android ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹LoaderLoader å±‚æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š Android è®¾å¤‡ä¸Šç”µä»¥åŽï¼Œå¼•å¯¼èŠ¯ç‰‡æ‰§è¡Œå›ºåŒ–åœ¨ Boot ROM é‡Œçš„å¯åŠ¨å¼•å¯¼ä»£ç ï¼ŒåŠ è½½ Boot Loader ä»£ç åˆ°å†…å­˜ï¼› Boot Loader ä»£ç å¼€å§‹æ‰§è¡Œï¼Œæ£€æŸ¥ RAM ï¼Œå®Œæˆç¡¬ä»¶çš„åˆå§‹åŒ–ï¼ŒåŠ è½½Linuxå†…æ ¸ä»£ç åˆ°å†…å­˜ã€‚ KernelLinux å†…æ ¸å¼€å§‹å¯åŠ¨ï¼Œåˆå§‹åŒ–å„ç§è½¯ç¡¬ä»¶çŽ¯å¢ƒï¼ŒåŠ è½½é©±åŠ¨ç¨‹åºï¼ŒæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰§è¡Œinitç¨‹åºã€‚ Native init è¿›ç¨‹ fork å‡º logd ã€ healthd ã€ installd ã€ adbd ç­‰ç”¨æˆ·å®ˆæŠ¤è¿›ç¨‹ï¼› å¯åŠ¨ ServiceManager å’Œ MediaServerï¼ˆæœ¬åœ°æœåŠ¡ï¼‰ï¼› fork å‡º Zygote è¿›ç¨‹ï¼ŒZygote è¿›ç¨‹æ˜¯æ‰€æœ‰ Java è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚ FrameworkFramework å±‚ç”± C++ Framework å±‚å’Œ Java Framework å±‚ç»„æˆã€‚ C++ Framework å±‚C++ Framework å±‚ä¸»è¦è¿è¡Œæœ¬åœ°æœåŠ¡ï¼Œå³ MediaServer è¿›ç¨‹ï¼Œå®ƒæ˜¯ç”± init è¿›ç¨‹ fork è€Œæ¥ï¼Œè´Ÿè´£å¯åŠ¨å’Œç®¡ç†æ•´ä¸ª C++ framework ï¼ŒåŒ…å« AudioFlinger ï¼ŒCamera Service ç­‰æœåŠ¡ã€‚ Java Framework å±‚Java Framework å±‚ä¸»è¦è¿è¡Œ SystemServer è¿›ç¨‹ï¼ŒSystemServer è¿›ç¨‹æ˜¯ Zygote è¿›ç¨‹ fork å‡ºçš„ç¬¬ä¸€ä¸ª Java è¿›ç¨‹ï¼ŒSystemServer è´Ÿè´£å¯åŠ¨å’Œç®¡ç† Java Framework ï¼Œä¸»è¦ç®¡ç† Android æœåŠ¡ï¼Œå¦‚ ActivityManagerService ï¼ŒNotificationManagerService ï¼ŒWindowManagerService ç­‰ï¼Œå®ƒä»¬å‡ä»¥çº¿ç¨‹çš„æ–¹å¼è¿è¡Œåœ¨ SystemServer è¿›ç¨‹ä¸­ã€‚ AppZygote è¿›ç¨‹ fork å‡ºæ¥çš„ç¬¬ä¸€ä¸ª App è¿›ç¨‹æ˜¯ Launcher ï¼Œå³æ¡Œé¢ App ï¼Œæ‰€æœ‰çš„ App è¿›ç¨‹éƒ½æ˜¯ç”± Zygote è¿›ç¨‹ fork ç”Ÿæˆçš„ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[RxJava for Kotlin å®žè·µï¼ˆä¸‰ï¼‰]]></title>
      <url>%2F2017%2F07%2F01%2FRxJava-to-Kotlin-Util-and-Operator%2F</url>
      <content type="text"><![CDATA[æˆ‘ä»¬å¾ˆå°‘æƒ³æˆ‘ä»¬å·²ç»æ‹¥æœ‰çš„ï¼Œè€Œæ€»æ˜¯æƒ³æˆ‘ä»¬æ‰€æ²¡æœ‰çš„ æœ¬ç¯‡æ˜¯ RxJava for Kotlin ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œæœ¬ç³»åˆ—ä»Žå¯è§‚å¯Ÿç³»åˆ—çš„åˆ›å»ºã€ç»„åˆå˜æ¢ä»¥åŠç›‘å¬çš„å®žè·µå…¥æ‰‹ï¼Œæœ€åŽä¸€ç›´åˆ° RxJava çš„å®žçŽ°åŽŸç†åˆ†æžã€‚ ä¸Šä¸€ç¯‡ä¸»è¦ä»‹ç»äº† RxJava å¯è§‚å¯Ÿåºåˆ—å¸¸ç”¨çš„ç»„åˆå’Œå˜æ¢æ–¹å¼ï¼Œæœ¬ç¯‡ä¸»è¦ç®€å•ä»‹ç»å¯è§‚å¯Ÿåºåˆ—åœ¨ç”Ÿäº§å’Œæ¶ˆè´¹æ—¶çº¿ç¨‹çš„è½¬æ¢æ–¹å¼ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰ RxJava æ“ä½œç¬¦ã€‚ RxJava çº¿ç¨‹è½¬æ¢RxJava çš„ç²¾é«“åœ¨äºŽå®ƒçš„å¼‚æ­¥å¤„ç†ï¼Œå¯ä»¥è½»æ¾å®žçŽ°çº¿ç¨‹åˆ‡æ¢ã€‚ RxJava å¸¸ç”¨çº¿ç¨‹åˆ‡æ¢æ“ä½œç¬¦ï¼š subscribeOn ï¼ŒobserveOn ã€‚ subscribeOn : æŒ‡å®š Observable è‡ªèº«åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šæ‰§è¡Œï¼Œå³æŒ‡å®šç”Ÿäº§è€…æ‰€åœ¨çš„çº¿ç¨‹ã€‚ observeOn : æŒ‡å®šä¸€ä¸ªè§‚å¯Ÿè€…åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šè§‚å¯Ÿè¿™ä¸ª Observable å³æŒ‡å®šæ¶ˆè´¹è€…æ‰€åœ¨çš„çº¿ç¨‹. å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œç¬¦ doOnNext ï¼Œäº‹ä»¶åºåˆ—è¢«æ¶ˆè´¹ä¹‹å‰ï¼Œæ³¨å†Œä¸€ä¸ªå›žè°ƒï¼ŒæŽ¥æ”¶ Observable å‘å°„çš„æ¯ä¸€é¡¹æ•°æ®ï¼Œä½†æ˜¯ä¸æ¶ˆè´¹äº‹ä»¶ã€‚é€šå¸¸åœ¨äº‹ä»¶è¢«æ¶ˆè´¹ä¹‹å‰åšä¸€äº›ä¿å­˜æ“ä½œï¼Œä¾‹å¦‚ï¼Œåœ¨è¿›è¡Œç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯¹å“åº”æ•°æ®åšä¸€ä¸‹ç¼“å­˜æ“ä½œã€‚ ä¸€ä¸ªç®€å•çš„çº¿ç¨‹åˆ‡æ¢ä¾‹å­ï¼š12345678910111213141516fun main(args: Array&lt;String&gt;) &#123; /* * observeOn æŒ‡å®šä¸€ä¸ªè§‚å¯Ÿè€…åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šè§‚å¯Ÿè¿™ä¸ª Observable å³æŒ‡å®šæ¶ˆè´¹è€…æ‰€åœ¨çš„çº¿ç¨‹ã€‚ * * subscribeOn æŒ‡å®š Observable è‡ªèº«åœ¨å“ªä¸ªè°ƒåº¦å™¨ä¸Šæ‰§è¡Œï¼Œå³æŒ‡å®šç”Ÿäº§è€…æ‰€åœ¨çš„çº¿ç¨‹ã€‚ * * doOnNext äº‹ä»¶åºåˆ—è¢«æ¶ˆè´¹ä¹‹å‰ï¼Œæ³¨å†Œä¸€ä¸ªå›žè°ƒï¼ŒæŽ¥æ”¶ Observable å‘å°„çš„æ¯ä¸€é¡¹æ•°æ®ï¼Œä½†æ˜¯ä¸æ¶ˆè´¹äº‹ä»¶ã€‚ * */ Observable.from(arrayOf("Hello Kotlin", "Hello RxJava", "Hello Android")) .doOnNext &#123; println("$&#123;Thread.currentThread().name&#125; : $it") &#125; .subscribeOn(Schedulers.io()) .observeOn(Schedulers.newThread()) .subscribe&#123; p -&gt; println("$&#123;Thread.currentThread().name&#125; : $p") &#125;&#125; è¾“å‡ºï¼š123456RxIoScheduler-2 : Hello KotlinRxIoScheduler-2 : Hello RxJavaRxIoScheduler-2 : Hello AndroidRxNewThreadScheduler-1 : Hello KotlinRxNewThreadScheduler-1 : Hello RxJavaRxNewThreadScheduler-1 : Hello Android è‡ªå®šä¹‰æ“ä½œç¬¦RxJava æä¾›äº†æŽ¥å£ Operator å’Œ Transformer æŽ¥å£ç”¨äºŽè½»æ¾å®žçŽ°è‡ªå®šä¹‰æ“ä½œç¬¦ã€‚ è‡ªå®šä¹‰åºåˆ—æ“ä½œç¬¦è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ lift æ“ä½œç¬¦ï¼Œå®ƒå¯ä»¥å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„æ“ä½œç¬¦å’Œå…¶å®ƒçš„æ“ä½œç¬¦ä¸€èµ·åšé“¾å¼è°ƒç”¨ã€‚12345678910111213141516171819202122232425262728293031323334353637//åºåˆ—æ“ä½œç¬¦class MyOperator(private val name: String) : Observable.Operator&lt;String, String&gt; &#123; override fun call(p0: Subscriber&lt;in String&gt;): Subscriber&lt;in String&gt; &#123; return object : Subscriber&lt;String&gt;(p0) &#123; override fun onError(t: Throwable?) &#123; if (!p0.isUnsubscribed) &#123; p0.onError(t) &#125; &#125; override fun onCompleted() &#123; if (!p0.isUnsubscribed) &#123; p0.onCompleted() &#125; &#125; override fun onNext(t: String?) &#123; // å¯¹æ¯ä¸€é¡¹è¿›è¡Œç®€å•çš„æ ‡è®°æ‰“å°æ“ä½œ if (!p0.isUnsubscribed) &#123; println("$name : $t") p0.onNext(t) &#125; &#125; &#125; &#125;&#125;fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf("Hello Kotlin", "Hello RxJava", "Hello Android")) .lift(MyOperator("Opt-1")) .lift(MyOperator("Opt-2")) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š123456MyOperator : Hello KotlinHello KotlinMyOperator : Hello RxJavaHello RxJavaMyOperator : Hello AndroidHello Android è‡ªå®šä¹‰å˜æ¢æ“ä½œç¬¦è¿™é‡Œéœ€è¦è¯´ä¸€ä¸‹ compose æ“ä½œç¬¦ï¼Œå®ƒåŒ lift æ“ä½œç¬¦ç±»ä¼¼ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰æ“ä½œç¬¦ä¸Žæ ‡å‡†çš„ RxJava æ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ã€‚123456789101112131415// å˜æ¢æ“ä½œç¬¦class MyTransformer(private val name: String) : Observable.Transformer&lt;Int, String&gt; &#123; override fun call(p0: Observable&lt;Int&gt;): Observable&lt;String&gt; = p0.map &#123; "$name : $it" &#125;&#125;fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(123, 456, 789)) .compose(MyTransformer("Transformer-1")) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š123Transformer-1 : 123Transformer-1 : 456Transformer-1 : 789]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Java è™šæ‹ŸæœºåŸºç¡€çŸ¥è¯†ï¼ˆä¸€ï¼‰]]></title>
      <url>%2F2017%2F06%2F24%2FBasic-knowledge-of-JVM%2F</url>
      <content type="text"><![CDATA[å”¯æœ‰è¿›å…¥ç»å¸¸å¤±è´¥çš„æœªçŸ¥ç©ºé—´ï¼Œæ‰èƒ½äº§ç”Ÿåˆ›é€ åŠ› æœ¬ç¯‡ä¸»è¦ä»‹ç» Java è™šæ‹Ÿæœºè¿è¡Œæ—¶å†…å­˜åŒºåŸŸçš„åˆ’åˆ†ã€‚ Java è™šæ‹Ÿæœºç‰¹æ€§Java è™šæ‹Ÿæœºå…·æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š å¹³å°æ— å…³æ€§ã€‚Java è™šæ‹Ÿæœºå±è”½äº†ä¸Žå…·ä½“æ“ä½œç³»ç»Ÿå¹³å°ç›¸å…³çš„ä¿¡æ¯ï¼Œä½¿å¾— Java è¯­è¨€ç¼–è¯‘ç¨‹åºåªéœ€ç”Ÿæˆåœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç (å­—èŠ‚ç )ï¼Œå°±å¯ä»¥åœ¨å¤šç§å¹³å°ä¸Šä¸åŠ ä¿®æ”¹åœ°è¿è¡Œã€‚Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œå­—èŠ‚ç æ—¶ï¼Œå®žé™…ä¸Šæœ€ç»ˆè¿˜æ˜¯æŠŠå­—èŠ‚ç è§£é‡Šæˆå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚ è¯­è¨€æ— å…³æ€§ã€‚Java è™šæ‹Ÿæœºä¸å’ŒåŒ…æ‹¬ Java åœ¨å†…çš„ä»»ä½•è¯­è¨€ç»‘å®šï¼Œå®ƒåªä¸Ž .class æ–‡ä»¶è¿™ç§ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ç›¸å…³è”ï¼Œè€Œ Java è™šæ‹Ÿæœºä¸å…³å¿ƒ .class æ–‡ä»¶çš„æ¥æºã€‚åŸºäºŽè¿™ä¸€ç‰¹æ€§å‡ºçŽ°äº†å¾ˆå¤šè¿è¡Œåœ¨ JVM ä¹‹ä¸Šçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ Groovy ï¼Œ JRubyï¼Œ Jyphonï¼Œ Scala ç­‰ã€‚ Java è™šæ‹Ÿæœºè¿è¡Œæ—¶å†…å­˜åŒºåŸŸåˆ’åˆ†ç”±å›¾æ‰€ç¤ºï¼ŒJava è™šæ‹Ÿæœºå°†è¿è¡Œæ—¶æ•°æ®åŒºåˆ’åˆ†ä¸º 5 å—ï¼Œåˆ†åˆ«æ˜¯ï¼š Java å †ï¼Œ æ–¹æ³•åŒºï¼ˆé™æ€å­˜å‚¨åŒºï¼‰ï¼Œè™šæ‹Ÿæœºæ ˆï¼Œæœ¬åœ°æ–¹æ³•æ ˆä»¥åŠç¨‹åºè®¡æ•°å™¨ã€‚ å›¾ç‰‡æ¥è‡ªæžå®¢å­¦é™¢ Java å †Java å †æ˜¯ JVM æ‰€ç®¡ç†å†…å­˜ä¸­çš„æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯è¢«ä¸€ä¸ªè™šæ‹Ÿæœºå†…æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚ Java å †å”¯ä¸€çš„ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®žä¾‹ï¼Œç»å¤§éƒ¨åˆ†å¯¹è±¡å®žä¾‹å’Œæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚Java å †å¯ä»¥å¤„äºŽç‰©ç†ä¸Šä¸è¿žç»­çš„å†…å­˜ç©ºé—´ï¼Œåªéœ€ä¿è¯é€»è¾‘ä¸Šè¿žç»­å³å¯ã€‚å¦‚æžœåœ¨å †ä¸­æ²¡æœ‰å®Œæˆå®žä¾‹çš„å†…å­˜åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ æ–¹æ³•åŒºï¼ˆé™æ€å­˜å‚¨åŒºï¼‰æ–¹æ³•åŒºä¹Ÿæ˜¯çº¿ç¨‹é—´å…±äº«å†…å­˜åŒºåŸŸï¼Œç”¨äºŽå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ä»¥åŠå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„ä»£ç ç­‰æ•°æ®ã€‚ æ–¹æ³•åŒºå¯ä»¥å¤„äºŽç‰©ç†ä¸Šä¸è¿žç»­çš„å†…å­˜ç©ºé—´ã€‚å½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚ Java è™šæ‹Ÿæœºæ ˆJava è™šæ‹Ÿæœºæ ˆä¸ºçº¿ç¨‹ç§æœ‰å†…å­˜åŒºåŸŸï¼Œç”Ÿå‘½å‘¨æœŸä¸Žçº¿ç¨‹ç›¸åŒã€‚ Java è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡åž‹ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œä¸»è¦ç”¨äºŽå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒåŠ¨æ€é“¾æŽ¥ï¼Œæ–¹æ³•å‡ºå£ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»Žè°ƒç”¨åˆ°ç›´è‡³æ‰§è¡Œå®Œçš„è¿‡ç¨‹ï¼Œéƒ½å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆå…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹ Java è™šæ‹Ÿæœºæ ˆè§„å®šäº†ä¸¤ç§å¼‚å¸¸æƒ…å†µï¼š çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºŽè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†ä¼šæŠ›å‡º StackOverflowError å¼‚å¸¸ï¼Œï¼ˆä¸è¿‡çŽ°åœ¨å¤§å¤šæ•°è™šæ‹Ÿæœºéƒ½æ”¯æŒè™šæ‹Ÿæœºæ ˆçš„åŠ¨æ€æ‰©å±•ï¼‰ï¼› è™šæ‹Ÿæœºæ ˆåœ¨è¿›è¡Œæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°†ä¼šæŠ›å‡º OOM å¼‚å¸¸ã€‚ å±€éƒ¨å˜é‡è¡¨å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºŽå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå…¶ä¸­å­˜æ”¾çš„æ•°æ®çš„ç±»åž‹æ˜¯ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»åž‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰å’Œ returnAddress ç±»åž‹ï¼ˆå®ƒæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚ å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ï¼Œå³åœ¨ Java ç¨‹åºè¢«ç¼–è¯‘æˆ Class æ–‡ä»¶æ—¶ï¼Œå°±ç¡®å®šäº†æ‰€éœ€åˆ†é…çš„æœ€å¤§å±€éƒ¨å˜é‡è¡¨çš„å®¹é‡ã€‚å½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨æ ˆä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚ æ“ä½œæ•°æ ˆæ“ä½œæ•°æ ˆåˆå¸¸è¢«ç§°ä¸ºæ“ä½œæ ˆï¼Œæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ä¹Ÿæ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ç¡®å®šäº†ã€‚ åŠ¨æ€é“¾æŽ¥ä¸€èˆ¬æ¥è¯´ï¼Œæ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œè°ƒç”¨è€…çš„ç¨‹åºè®¡æ•°å™¨çš„å€¼å°±å¯ä»¥ä½œä¸ºè¿”å›žåœ°å€ï¼Œæ ˆå¸§ä¸­å¾ˆå¯èƒ½ä¿å­˜äº†è¿™ä¸ªè®¡æ•°å™¨å€¼ï¼Œè€Œæ–¹æ³•å¼‚å¸¸é€€å‡ºæ—¶ï¼Œè¿”å›žåœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸å¤„ç†å™¨æ¥ç¡®å®šçš„ï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚ æœ¬åœ°æ–¹æ³•æ ˆ ï¼ˆNative Method Stackï¼‰æœ¬åœ°æ–¹æ³•æ ˆä¸Ž Java è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨éžå¸¸ç›¸ä¼¼ï¼Œè™šæ‹Ÿæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œçš„ Java æ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡ã€‚ ä¸Žè™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡º StackOverflowError å’Œ OutOfMemoryError å¼‚å¸¸ã€‚ ç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨ä¸ºä¸€å°å—çº¿ç¨‹ç§æœ‰çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹æˆå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œå­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ ç¨‹åºè®¡æ•°å™¨å­˜åœ¨çš„æ„ä¹‰æ˜¯ç¡®ä¿çº¿ç¨‹åˆ‡æ¢åŽæˆ–è€…çº¿ç¨‹è¢« CPU é‡æ–°è°ƒåº¦åŽï¼Œæ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ã€‚å¦‚æžœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ Java æ–¹æ³•ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®ï¼›å¦‚æžœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œåˆ™è®¡æ•°å™¨çš„å€¼ä¸ºç©ºã€‚ç¨‹åºè®¡æ•°å™¨å­˜å‚¨åŒºåŸŸæ˜¯ JVM è§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OutOfMemoeyError æƒ…å†µçš„å”¯ä¸€ä¸€å—åŒºåŸŸã€‚ ç›´æŽ¥å†…å­˜ç›´æŽ¥å†…å­˜ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹ä½¿ç”¨ï¼Œä¹Ÿæ˜¯å¯èƒ½å¯¼è‡´ OutOfMemoryError å¼‚å¸¸çš„å†…å­˜åŒºåŸŸã€‚ åœ¨ JDK1.4 ä¸­æ–°å¼•å…¥äº† NIO æœºåˆ¶ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºŽé€šé“ä¸Žç¼“å†²åŒºçš„æ–° I/O æ–¹å¼ï¼Œå¯ä»¥ç›´æŽ¥ä»Žæ“ä½œç³»ç»Ÿä¸­åˆ†é…ç›´æŽ¥å†…å­˜ï¼Œå³åœ¨å †å¤–åˆ†é…å†…å­˜ï¼Œè¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›žå¤åˆ¶æ•°æ®ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[RxJava for Kotlin å®žè·µï¼ˆäºŒï¼‰]]></title>
      <url>%2F2017%2F06%2F17%2FRxJava-for-Kotlin-practice-transforming-and-combining%2F</url>
      <content type="text"><![CDATA[æ”¾ä¸‹æ‰§ç€ï¼Œå´åˆæˆäº†æ–°çš„æ‰§ç€ æœ¬ç¯‡æ˜¯ RxJava for Kotlin ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œæœ¬ç³»åˆ—ä»Žå¯è§‚å¯Ÿç³»åˆ—çš„åˆ›å»ºã€ç»„åˆå˜æ¢ä»¥åŠç›‘å¬çš„å®žè·µå…¥æ‰‹ï¼Œæœ€åŽä¸€ç›´åˆ° RxJava çš„å®žçŽ°åŽŸç†åˆ†æžã€‚ä¸Šä¸€ç¯‡ä¸»è¦ä»‹ç»äº† RxJava å¯è§‚å¯Ÿåºåˆ—å¸¸ç”¨çš„åˆ›å»ºæ–¹å¼ï¼Œæœ¬ç¯‡ä¸»è¦ç®€å•ä»‹ç»è§‚å¯Ÿåºåˆ—çš„ç»„åˆå˜æ¢ä»¥åŠè¿‡æ»¤æ“ä½œï¼ŒæŽŒæ¡ RxJava å¯è§‚å¯Ÿåºåˆ—çš„ç»„åˆå˜æ¢ä»¥åŠè¿‡æ»¤æ“ä½œï¼Œæ‰èƒ½çœŸæ­£ä½“ä¼š Rx ä¹‹ç¾Žã€‚ RxJava å¯è§‚å¯Ÿåºåˆ—çš„å˜æ¢å¸¸ç”¨çš„æ“ä½œç¬¦ map() : å¯¹åºåˆ—çš„æ¯ä¸€é¡¹éƒ½åº”ç”¨ä¸€ä¸ªå‡½æ•°æ¥å˜æ¢ Observable å‘å°„çš„æ•°æ®åºåˆ—ï¼› flatMap() : concatMap() : å°† Observable å‘å°„çš„æ•°æ®é›†åˆå˜æ¢ä¸º Observables é›†åˆï¼Œç„¶åŽå°†è¿™äº› Observable å‘å°„çš„æ•°æ®å¹³å¦åŒ–çš„æ”¾è¿›ä¸€ä¸ªå•ç‹¬çš„ Observable ï¼› scan() ï¼š å¯¹ Observable å‘å°„çš„æ¯ä¸€é¡¹æ•°æ®åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åŽæŒ‰é¡ºåºä¾æ¬¡å‘å°„æ¯ä¸€ä¸ªå€¼ï¼› groupBy() : å°† Observable åˆ†æ‹†ä¸º Observable é›†åˆï¼Œå°†åŽŸå§‹ Observable å‘å°„çš„æ•°æ®æŒ‰ Key åˆ†ç»„ï¼Œæ¯ä¸€ä¸ª Observable å‘å°„ä¸€ç»„ä¸åŒçš„æ•°æ®ï¼› cast() : åœ¨å‘å°„ä¹‹å‰å¼ºåˆ¶å°† Observable å‘å°„çš„æ‰€æœ‰æ•°æ®è½¬æ¢ä¸ºæŒ‡å®šç±»åž‹. mapmap å¯¹ Observable å‘å°„çš„æ¯ä¸€é¡¹æ•°æ®åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œå˜æ¢æ“ä½œã€‚12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf("Kotlin", "iOS", "Java", "Objective-c")) .map &#123; it -&gt; "Hello $it" &#125; .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š1234Hello KotlinHello iOSHello JavaHello Objective-c flatMapflatMap å°†ä¸€ä¸ªå‘å°„æ•°æ®çš„ Observable å˜æ¢ä¸ºå¤šä¸ª Observables ï¼Œç„¶åŽå°†å®ƒä»¬å‘å°„çš„æ•°æ®åˆå¹¶(ä¸ä¸€å®šæŒ‰æ¬¡åº)åŽæ”¾è¿›ä¸€ä¸ªå•ç‹¬çš„ Observable ã€‚123456789fun main(args: Array&lt;String&gt;) &#123; val list1 = arrayOf("Kotlin", "iOS") val list2 = arrayOf("Java", "Objective-c") val collections = arrayOf(list1, list2) Observable.from(collections) .flatMap &#123; it -&gt; Observable.from(it) &#125; .map &#123; it -&gt; "Hello $it" &#125; .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š1234Hello KotlinHello iOSHello JavaHello Objective-c concatMapconcatMap ç±»ä¼¼äºŽæœ€ç®€å•ç‰ˆæœ¬çš„ flatMap ï¼Œä½†æ˜¯å®ƒæŒ‰æ¬¡åºè¿žæŽ¥è€Œä¸æ˜¯åˆå¹¶é‚£äº›ç”Ÿæˆçš„ Observables ï¼Œç„¶åŽäº§ç”Ÿè‡ªå·±çš„æ•°æ®åºåˆ—ã€‚123456789fun main(args: Array&lt;String&gt;) &#123; val list1 = arrayOf("Kotlin", "iOS") val list2 = arrayOf("Java", "Objective-c") val collections = arrayOf(list1, list2) Observable.from(collections) .concatMap &#123; it -&gt; Observable.from(it) &#125; .map &#123; it -&gt; "Hello $it" &#125; .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š1234Hello KotlinHello iOSHello JavaHello Objective-c scanscan è¿žç»­åœ°å¯¹æ•°æ®åºåˆ—çš„æ¯ä¸€é¡¹åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åŽè¿žç»­å‘å°„ç»“æžœã€‚12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4)) .scan &#123; p0, p1 -&gt; p0 + p1 &#125; .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š123413610 RxJava å¯è§‚å¯Ÿåºåˆ—çš„è¿‡æ»¤å¸¸ç”¨çš„æ“ä½œç¬¦ filter() : è¿‡æ»¤æ•°æ®ï¼› takeLast() : åªå‘å°„æœ€åŽçš„ N é¡¹æ•°æ®ï¼› last() ï¼š åªå‘å°„æœ€åŽçš„ä¸€é¡¹æ•°æ®ï¼› skip() : è·³è¿‡å¼€å§‹çš„ N é¡¹æ•°æ®ï¼› skipLast() : è·³è¿‡æœ€åŽçš„ N é¡¹æ•°æ®ï¼› take() : åªå‘å°„å¼€å§‹çš„ N é¡¹æ•°æ®ï¼› elementAt() : å‘å°„ç¬¬ N é¡¹æ•°æ®ã€‚ filter12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) .filter &#123; it &gt; 5 &amp;&amp; it % 2 == 0 &#125; .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š1236810 takeLast12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) .takeLast(5) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š12345678910 take12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) .take(5) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š1234512345 skip12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) .skip(5) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š12345678910 elementAt12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)) .elementAt(5) .subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š16 RxJava å¯è§‚å¯Ÿåºåˆ—çš„ç»„åˆå¸¸ç”¨çš„æ“ä½œç¬¦ startWith() : åœ¨æ•°æ®åºåˆ—çš„å¼€å¤´å¢žåŠ ä¸€é¡¹æ•°æ®ï¼› merge() : å°†å¤šä¸ª Observable åˆå¹¶ä¸ºä¸€ä¸ªï¼› zip() ï¼š ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ç»„åˆå¤šä¸ª Observable å‘å°„çš„æ•°æ®é›†åˆï¼Œç„¶åŽå†å‘å°„è¿™ä¸ªç»“æžœï¼› switchOnNext() : å°†ä¸€ä¸ªå‘å°„ Observables çš„ Observable è½¬æ¢æˆå¦ä¸€ä¸ª Observable ï¼ŒåŽè€…å‘å°„è¿™äº› Observables æœ€è¿‘å‘å°„çš„æ•°æ®ã€‚ startWithstartWith åœ¨æ•°æ®åºåˆ—çš„å¼€å¤´æ’å…¥ä¸€æ¡æŒ‡å®šçš„é¡¹ã€‚12345fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf("Hello Java", "Hello RxJava")) .startWith("Hello Kotlin") .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š123Hello KotlinHello JavaHello RxJava mergemerge åˆå¹¶å¤šä¸ª Observables çš„å‘å°„ç‰©ã€‚123456fun main(args: Array&lt;String&gt;) &#123; val observable1 = Observable.from(arrayOf(1, 2, 3)) val observable2 = Observable.from(arrayOf(4, 5, 6, 7)) Observable.merge(observable1, observable2) .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š123Hello KotlinHello JavaHello RxJava zip zip é€šè¿‡ä¸€ä¸ªå‡½æ•°å°†å¤šä¸ª Observables çš„å‘å°„ç‰©ç»“åˆåˆ°ä¸€èµ·ï¼ŒåŸºäºŽè¿™ä¸ªå‡½æ•°çš„ç»“æžœä¸ºæ¯ä¸ªç»“åˆä½“å‘å°„å•ä¸ªæ•°æ®é¡¹ã€‚12345678fun main(args: Array&lt;String&gt;) &#123; val observable1 = Observable.from(arrayOf(1, 2, 3)) val observable2 = Observable.from(arrayOf(4, 5, 6, 7)) Observable.zip(observable1, observable2) &#123; p0, p1 -&gt; p0 + p1 &#125;.subscribe&#123; println(it) &#125;&#125; è¾“å‡ºï¼š123579]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[RxJava for Kotlin å®žè·µï¼ˆä¸€ï¼‰]]></title>
      <url>%2F2017%2F06%2F13%2FRxJava-for-Kotlin-practice-Creating-Observable%2F</url>
      <content type="text"><![CDATA[ä»Ž RxJava å¼€å§‹æ‹†è½®å­ æœ¬ç¯‡æ˜¯ RxJava for Kotlin ç³»åˆ—çš„å¼€ç¯‡ï¼Œæœ¬ç³»åˆ—ä»Žå¯è§‚å¯Ÿç³»åˆ—çš„åˆ›å»ºã€ç»„åˆå˜æ¢ä»¥åŠç›‘å¬çš„å®žè·µå…¥æ‰‹ï¼Œæœ€åŽä¸€ç›´åˆ° RxJava çš„å®žçŽ°åŽŸç†åˆ†æžã€‚æœ¬ç¯‡ä¸»è¦ç®€å•ä»‹ç» RxJava ä»¥åŠå¯è§‚å¯Ÿåºåˆ—çš„åˆ›å»ºæ–¹å¼ RxJava ç®€ä»‹Rx æ˜¯ Reactive Extensions çš„ç¼©å†™ï¼Œæœ€åˆæ˜¯ LINQ ï¼ˆè¯­è¨€é›†æˆæŸ¥è¯¢ï¼‰çš„ä¸€ä¸ªæ‰©å±•ï¼Œç”±å¾®è½¯çš„æž¶æž„å¸ˆ Erik Meijer é¢†å¯¼çš„å›¢é˜Ÿå¼€å‘ï¼Œåœ¨ 2012 å¹´å¼€æºï¼ŒRx æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¨¡åž‹ï¼Œç›®æ ‡æ˜¯æä¾›ä¸€è‡´çš„ç¼–ç¨‹æŽ¥å£ï¼Œå¸®åŠ©å¼€å‘è€…æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚æ­¥æ•°æ®æµï¼Œ Rx åº“æ”¯æŒ .NET ã€ JavaScript å’Œ C++ï¼Œæ¯”è¾ƒæµè¡Œçš„æœ‰ RxJavaï¼Œ RxJS ï¼Œä»¥åŠ Rx.NET ã€‚ Rx æ˜¯ä¸€ä¸ªå‡½æ•°åº“ï¼Œå¼€å‘è€…å¯ä»¥ç”¨ Observables è¡¨ç¤ºå¼‚æ­¥æ•°æ®æµï¼Œç”¨ LINQ æ“ä½œç¬¦æŸ¥è¯¢å¼‚æ­¥æ•°æ®æµï¼Œ ç”¨ Schedulers å‚æ•°åŒ–å¼‚æ­¥æ•°æ®æµçš„å¹¶å‘å¤„ç†ï¼Œ Rx å¯ä»¥è¿™æ ·å®šä¹‰ï¼šRx = Observables + LINQ + Schedulers ã€‚ å®˜æ–¹å¯¹ RxJava çš„å®šä¹‰ï¼š Reactive Extensions for the JVM â€“ a library for composing asynchronous and event-based programs using observable sequences for the Java VM.ç”¨äºŽä½¿ç”¨ Java VM çš„å¯è§‚å¯Ÿåºåˆ—ç¼–å†™å¼‚æ­¥å’ŒåŸºäºŽäº‹ä»¶çš„ç¨‹åºçš„åº“ã€‚ RxJava åŒå…¶ä»– Rx ç³»åˆ—ä¸€æ ·ï¼Œå…¶ä½¿ç”¨è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ›å»ºï¼š é€šè¿‡ RxJava API åˆ›å»ºå¯è§‚å¯Ÿäº‹ä»¶åºåˆ—æˆ–è€…æ•°æ®æµï¼› ç»„åˆå˜æ¢ï¼š é€šè¿‡ LINQ å¼æ“ä½œç¬¦å¯¹äº‹ä»¶åºåˆ—æˆ–è€…æ•°æ®æµè¿›è¡Œç»„åˆä»¥åŠå˜æ¢æ“ä½œï¼Œå®žçŽ°ä¸šåŠ¡é€»è¾‘ï¼› ç›‘å¬ï¼š é€šè¿‡è®¢é˜…å¯è§‚å¯Ÿè§‚å¯Ÿäº‹ä»¶åºåˆ—æˆ–è€…æ•°æ®æµï¼Œå¯ä»¥èŽ·å–ç»„åˆå˜æ¢çš„ç»“æžœæˆ–è€…æ‰§è¡Œå…¶ä»–çš„æ“ä½œã€‚ RxJava è®¾è®¡æ¨¡å¼RxJava æ˜¯åŸºäºŽè§‚å¯Ÿè€…æ¨¡å¼ï¼Œåœ¨ RxJava ä¸­æœ‰å››ç§è§’è‰²ï¼š Observable ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ï¼Œä¸€èˆ¬æŒ‡å¯è§‚å¯Ÿäº‹ä»¶åºåˆ—æˆ–è€…æ•°æ®æµï¼› Observer ï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼Œç”¨äºŽç›‘å¬å¯è§‚å¯Ÿäº‹ä»¶åºåˆ—æˆ–è€…æ•°æ®æµï¼› Subscriber ï¼ˆè®¢é˜…è€…ï¼‰ï¼ŒåŸºäºŽ Observer è¿›è¡Œæ‰©å±•ï¼Œå¯å–æ¶ˆè®¢é˜…ï¼› Subject ï¼ˆä¸»é¢˜ï¼‰ï¼Œå³å¯ä½œä¸ºè§‚å¯Ÿè€…ï¼Œä¹Ÿå¯ä½œä¸ºè¢«è§‚å¯Ÿè€…ã€‚ å¯¹æ¯”ä¸€ä¸‹ Observer å’Œ Subscriber æºç ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ä¸€ç›®äº†ç„¶ã€‚ Observer: 1234567public interface Observer&lt;T&gt; &#123; void onCompleted(); void onError(Throwable var1); void onNext(T var1);&#125; Subscriber: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public abstract class Subscriber&lt;T&gt; implements Observer&lt;T&gt;, Subscription &#123; private static final long NOT_SET = -9223372036854775808L; private final SubscriptionList subscriptions; private final Subscriber&lt;?&gt; subscriber; private Producer producer; private long requested; protected Subscriber() &#123; this((Subscriber)null, false); &#125; protected Subscriber(Subscriber&lt;?&gt; subscriber) &#123; this(subscriber, true); &#125; protected Subscriber(Subscriber&lt;?&gt; subscriber, boolean shareSubscriptions) &#123; this.requested = -9223372036854775808L; this.subscriber = subscriber; this.subscriptions = shareSubscriptions &amp;&amp; subscriber != null?subscriber.subscriptions:new SubscriptionList(); &#125; public final void add(Subscription s) &#123; this.subscriptions.add(s); &#125; public final void unsubscribe() &#123; this.subscriptions.unsubscribe(); &#125; public final boolean isUnsubscribed() &#123; return this.subscriptions.isUnsubscribed(); &#125; public void onStart() &#123; &#125; protected final void request(long n) &#123; ... &#125; private void addToRequested(long n) &#123; ... &#125; public void setProducer(Producer p) &#123; ... &#125;&#125; Subscription:12345public interface Subscription &#123; void unsubscribe(); boolean isUnsubscribed();&#125; åˆ›å»ºå¯è§‚å¯Ÿåºåˆ—æ·»åŠ ä¾èµ– 1compile 'io.reactivex:rxjava:1.3.0' Observable æœ‰ä»¥ä¸‹åˆ›å»ºæ–¹å¼ï¼š just() ï¼š å°†ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡è½¬æ¢æˆå‘å°„è¿™ä¸ªæˆ–è¿™äº›å¯¹è±¡çš„ä¸€ä¸ª Observable ï¼› from() ï¼š å°†ä¸€ä¸ª Iterable ï¼Œä¸€ä¸ªFuture ï¼Œæˆ–è€…ä¸€ä¸ªæ•°ç»„è½¬æ¢æˆä¸€ä¸ª Observable ï¼› repeat() ï¼š åˆ›å»ºä¸€ä¸ªé‡å¤å‘å°„æŒ‡å®šæ•°æ®æˆ–æ•°æ®åºåˆ—çš„ Observable ï¼› create() ï¼š ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä»Žå¤´åˆ›å»ºä¸€ä¸ª Observable ï¼› repeatWhen() ï¼š åˆ›å»ºä¸€ä¸ªé‡å¤å‘å°„æŒ‡å®šæ•°æ®æˆ–æ•°æ®åºåˆ—çš„ Observable ï¼Œå®ƒä¾èµ–äºŽå¦ä¸€ä¸ª Observable å‘å°„çš„æ•°æ®ï¼› defer() ï¼š åªæœ‰å½“è®¢é˜…è€…è®¢é˜…æ‰åˆ›å»º Observable ï¼Œä¸ºæ¯ä¸ªè®¢é˜…åˆ›å»ºä¸€ä¸ªæ–°çš„ Observable ï¼› range() ï¼š åˆ›å»ºä¸€ä¸ªå‘å°„æŒ‡å®šèŒƒå›´çš„æ•´æ•°åºåˆ—çš„ Observable ï¼› interval() ï¼š åˆ›å»ºä¸€ä¸ªæŒ‰ç…§ç»™å®šçš„æ—¶é—´é—´éš”å‘å°„æ•´æ•°åºåˆ—çš„ Observable ï¼› timer() ï¼š åˆ›å»ºä¸€ä¸ªåœ¨ç»™å®šçš„å»¶æ—¶ä¹‹åŽå‘å°„å•ä¸ªæ•°æ®çš„ Observable ï¼› empty() ï¼š åˆ›å»ºä¸€ä¸ªä»€ä¹ˆéƒ½ä¸åšç›´æŽ¥é€šçŸ¥å®Œæˆçš„ Observable ï¼› error() ï¼š åˆ›å»ºä¸€ä¸ªä»€ä¹ˆéƒ½ä¸åšç›´æŽ¥é€šçŸ¥é”™è¯¯çš„ Observable ï¼› never() ï¼š åˆ›å»ºä¸€ä¸ªä¸å‘å°„ä»»ä½•æ•°æ®çš„ Observable ï¼› æŽ¥ä¸‹æ¥åªä»‹ç»å‡ ç§å¸¸ç”¨çš„æ–¹å¼ã€‚ justjust å°†ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡è½¬æ¢æˆå‘å°„è¿™ä¸ªæˆ–è¿™äº›å¯¹è±¡çš„ä¸€ä¸ª Observable ,å®ƒæŽ¥å—ä¸€è‡³ä¹ä¸ªå‚æ•°ï¼Œè¿”å›žä¸€ä¸ªæŒ‰å‚æ•°åˆ—è¡¨é¡ºåºå‘å°„è¿™äº›æ•°æ®çš„ Observable ã€‚ just ç±»ä¼¼äºŽfrom ï¼Œä½†æ˜¯ from ä¼šå°†æ•°ç»„æˆ– Iterable çš„æ•°æ®å–å‡ºç„¶åŽé€ä¸ªå‘å°„ï¼Œè€Œ just åªæ˜¯ç®€å•çš„åŽŸæ ·å‘å°„ï¼Œå°†æ•°ç»„æˆ– Iterable å½“åšå•ä¸ªæ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849fun main(args: Array&lt;String&gt;) &#123; val observable = Observable.just("Hello Kotlin", "Hello RxJava", "Android") // è¢«è§‚å¯Ÿè€… val subscriber = object : Subscriber&lt;String&gt;()&#123; override fun onStart() &#123; super.onStart() &#125; override fun onError(p0: Throwable?) &#123; //å½“ Observable é‡åˆ°é”™è¯¯æˆ–è€…æ— æ³•è¿”å›žæœŸæœ›çš„æ•°æ®æ—¶ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œ //è¿™ä¸ªè°ƒç”¨ä¼šç»ˆæ­¢ Observableï¼ŒåŽç»­ä¸ä¼šå†è°ƒç”¨ onNext å’Œ onCompleted println("onError") &#125; override fun onCompleted() &#123; //æ•°æ®å‘å°„æ­£å¸¸ç»ˆæ­¢ println("onCompleted") &#125; override fun onNext(p0: String?) &#123; //Observable è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‘å°„æ•°æ®ï¼Œæ–¹æ³•çš„å‚æ•°å°±æ˜¯ Observable å‘å°„çš„æ•°æ® println(p0) &#125; &#125; // è§‚å¯Ÿè€… observable.subscribe(subscriber) // è®¢é˜… // æˆ–è€…ç”¨æ›´ç®€æ´çš„æ–¹å¼ Observable.just("Hello Kotlin", "Hello RxJava", "Android") .subscribe(object : Subscriber&lt;String&gt;()&#123; override fun onError(p0: Throwable?) &#123; println("onError") &#125; override fun onCompleted() &#123; println("onCompleted") &#125; override fun onNext(p0: String?) &#123; println(p0) &#125; &#125;)&#125; è¾“å‡ºï¼š 1234Hello KotlinHello RxJavaAndroidonCompleted fromfrom å°†ä¸€ä¸ª Iterable, ä¸€ä¸ª Future , æˆ–è€…ä¸€ä¸ªæ•°ç»„è½¬æ¢æˆä¸€ä¸ª Observable ã€‚1234567891011121314151617fun main(args: Array&lt;String&gt;) &#123; Observable.from(arrayOf("Hello Kotlin", "Hello RxJava", "Android")) .subscribe(object : Subscriber&lt;String&gt;() &#123; override fun onError(p0: Throwable?) &#123; &#125; override fun onNext(p0: String?) &#123; println(p0) &#125; override fun onCompleted() &#123; println("onCompleted") &#125; &#125;)&#125; è¾“å‡ºï¼š 123Hello KotlinHello RxJavaAndroid repeatrepeat åˆ›å»ºä¸€ä¸ªé‡å¤å‘å°„æŒ‡å®šæ•°æ®æˆ–æ•°æ®åºåˆ—çš„ Observable ã€‚ 12345fun main(args: Array&lt;String&gt;) &#123; Observable.just("Hello Kotlin") .repeat(3) // é‡å¤æ¬¡æ•° .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š 123Hello KotlinHello KotlinHello Kotlin createcreate ä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä»Žå¤´åˆ›å»ºä¸€ä¸ª Observable ã€‚å»ºè®®ä½ åœ¨ä¼ é€’ç»™ create æ–¹æ³•çš„å‡½æ•°ä¸­æ£€æŸ¥è§‚å¯Ÿè€…çš„ isUnsubscribed çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨æ²¡æœ‰è§‚å¯Ÿè€…çš„æ—¶å€™ï¼Œè®©ä½ çš„ Observable åœæ­¢å‘å°„æ•°æ®æˆ–è€…åšæ˜‚è´µçš„è¿ç®—ã€‚ 1234567891011121314151617181920212223242526fun main(args: Array&lt;String&gt;) &#123; Observable.create(Observable.OnSubscribe&lt;String&gt; &#123; observer -&gt; if (!observer.isUnsubscribed) &#123; observer.onNext("Hello RxJava") observer.onNext("Hello Kotlin") observer.onCompleted() &#125; else &#123; observer.onError(Throwable("No subscriber!")) &#125; &#125;).subscribe(object : Subscriber&lt;String&gt;()&#123; override fun onError(p0: Throwable?) &#123; println("onError") &#125; override fun onCompleted() &#123; println("onCompleted") &#125; override fun onNext(p0: String?) &#123; println(p0) &#125; &#125;)&#125; è¾“å‡ºï¼š 123Hello RxJavaHello KotlinonCompleted rangerange æ“ä½œç¬¦å‘å°„ä¸€ä¸ªä¸€å®šèŒƒå›´å†…çš„æœ‰åºæ•´æ•°åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šèŒƒå›´çš„èµ·å§‹å’Œé•¿åº¦ã€‚1234fun main(args: Array&lt;String&gt;) &#123; Observable.range(0,10) .subscribe&#123; p -&gt; println(p) &#125;&#125; è¾“å‡ºï¼š 123456789100123456789]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Design Pattern - flyweight pattern]]></title>
      <url>%2F2017%2F06%2F12%2FDesign-Pattern-flyweight-pattern%2F</url>
      <content type="text"></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼]]></title>
      <url>%2F2017%2F06%2F04%2FAndroid-design-pattern-observer-pattern%2F</url>
      <content type="text"><![CDATA[2017 ä¸‹åŠå¹´ï¼Œå†³å®šè™è‡ªå·±ä¸€æŠŠï¼ æœ¬ç¯‡å¼€å§‹å°†ä½¿ç”¨ Kotlin ä»£æ›¿ Java æ¥å®Œæˆè®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ï¼Œè¾¾åˆ°æ—¢å­¦ä¹ äº† Kotlin è¯­æ³•ï¼Œç”±å¤ä¹ äº†é¢å‘å¯¹è±¡è¯­è¨€çš„è®¾è®¡æ¨¡å¼ã€‚æœ¬æ–‡æ˜¯ Android è®¾è®¡æ¨¡å¼çš„ç¬¬å››ç¯‡ï¼ŒæŽ¥ä¸‹æ¥ä¼šé™†ç»­æŽ¨å‡ºæ•´ä¸ªå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ç³»åˆ—ã€‚ è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern) ï¼Œ é¡¾åæ€ä¹‰ï¼Œå®šä¹‰äº†å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå½“è¢«è§‚å¯Ÿè€…å¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œä¸Žå…¶ä¾èµ–çš„è§‚å¯Ÿè€…å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥ï¼Œå› æ­¤åˆå«åšå‘å¸ƒ-è®¢é˜…æ¨¡å¼ (Publish/Subscribe) æ¨¡å¼ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºæ¨¡å¼ã€‚ æ¨¡å¼ç»“æž„ Subjectï¼š ç›®æ ‡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ ConcreteSubjectï¼š å…·ä½“ç›®æ ‡ï¼ˆå…·ä½“è¢«è§‚å¯Ÿè€…ï¼‰ Observerï¼šè§‚å¯Ÿè€… ConcreteObserverï¼šå…·ä½“è§‚å¯Ÿè€… ç›—å›¾ æ¨¡å¼å®žçŽ°æŽ¥ä¸‹æ¥åœ¨å®žä¾‹ä¸­æˆ‘ä»¬ä»¥å¸¸è§è­¦åŒªç”µå½±ä¸­çš„åè›‹ (BadGuy) ä½œä¸º Observable ï¼Œä»¥å§åº•è­¦å¯Ÿ ï¼ˆUndercoverï¼‰å’Œæ™®é€šè­¦å¯Ÿ ï¼ˆPoliceManï¼‰ä½œä¸º Observer ã€‚ SubjectJava å¼€å‘åŒ…ä¸­çš„ Observable ç±»ï¼ŒåŸºæœ¬å®žçŽ°å°±æ˜¯ç”¨ä¸€ä¸ª Vector æ¥æŽ¥å—æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå½“è¢«è§‚å¯Ÿè€…çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼ŒéåŽ† Vector å®¹å™¨ï¼Œé€šçŸ¥æ¯ä¸€ä¸ªè§‚å¯Ÿè€…ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public class Observable &#123; private boolean changed = false; private Vector&lt;Observer&gt; obs; /** Construct an Observable with zero Observers. */ public Observable() &#123; obs = new Vector&lt;&gt;(); &#125; public synchronized void addObserver(Observer o) &#123; if (o == null) throw new NullPointerException(); if (!obs.contains(o)) &#123; obs.addElement(o); &#125; &#125; public synchronized void deleteObserver(Observer o) &#123; obs.removeElement(o); &#125; public void notifyObservers() &#123; notifyObservers(null); &#125; public void notifyObservers(Object arg) &#123; Object[] arrLocal; synchronized (this) &#123; if (!changed) return; arrLocal = obs.toArray(); clearChanged(); &#125; for (int i = arrLocal.length-1; i&gt;=0; i--) ((Observer)arrLocal[i]).update(this, arg); &#125; public synchronized void deleteObservers() &#123; obs.removeAllElements(); &#125; protected synchronized void setChanged() &#123; changed = true; &#125; protected synchronized void clearChanged() &#123; changed = false; &#125; public synchronized boolean hasChanged() &#123; return changed; &#125; public synchronized int countObservers() &#123; return obs.size(); &#125;&#125; ConcreteSubject123456789101112131415class BadGuy : Observable() &#123; fun haveBreakfast() &#123; println("BadGuy: å¼€å§‹åƒé¥­äº†ã€‚ã€‚") super.setChanged() super.notifyObservers("åè›‹åœ¨åƒé¥­") &#125; fun commitCrime() &#123; println("BadGuy: å¼€å§‹çŠ¯ç½ªäº†ã€‚ã€‚") super.setChanged() super.notifyObservers("åè›‹åœ¨çŠ¯ç½ªï¼Œå»ºè®®ç«‹å³é‡‡å–è¡ŒåŠ¨") &#125;&#125; Observer1234public interface Observer &#123; void update(Observable o, Object arg);&#125; ConcreteObserverUndercover.kt å§åº•è­¦å¯Ÿ 123456789101112class UnderCover : Observer&#123; override fun update(o: Observable?, arg: Any?) &#123; println("å§åº•è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼") reportLeader(arg.toString()) &#125; fun reportLeader(message: String?) &#123; println("æŠ¥å‘Šé˜Ÿé•¿: $message \n") &#125;&#125; PoliceMan.kt12345678910class PoliceMan : Observer&#123; override fun update(o: Observable?, arg: Any?) &#123; println("è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼") reportLeader(arg.toString()) &#125; fun reportLeader(message: String?) &#123; println("æŠ¥å‘Šé˜Ÿé•¿: $message \n") &#125;&#125; Sample123456789101112fun main(args: Array&lt;String&gt;) &#123; var badGuy = BadGuy() val policeMan = PoliceMan() val underCover = UnderCover() badGuy.addObserver(policeMan) badGuy.addObserver(underCover) badGuy.haveBreakfast() badGuy.commitCrime()&#125; Running 1234567891011121314BadGuy: å¼€å§‹åƒé¥­äº†ã€‚ã€‚å§åº•è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼æŠ¥å‘Šé˜Ÿé•¿: åè›‹åœ¨åƒé¥­ è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼æŠ¥å‘Šé˜Ÿé•¿: åè›‹åœ¨åƒé¥­ BadGuy: å¼€å§‹çŠ¯ç½ªäº†ã€‚ã€‚å§åº•è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼æŠ¥å‘Šé˜Ÿé•¿: åè›‹åœ¨çŠ¯ç½ªï¼Œå»ºè®®ç«‹å³é‡‡å–è¡ŒåŠ¨ è­¦å¯Ÿ: è§‚å¯Ÿåˆ°ç–‘çŠ¯æ´»åŠ¨äº†ï¼Œèµ¶ç´§æŠ¥å‘Šé˜Ÿé•¿ï¼æŠ¥å‘Šé˜Ÿé•¿: åè›‹åœ¨çŠ¯ç½ªï¼Œå»ºè®®ç«‹å³é‡‡å–è¡ŒåŠ¨ è§‚å¯Ÿè€…æ¨¡å¼åœ¨é¢å‘å¯¹è±¡è¯­è¨€ç¼–ç¨‹ä¸­åº”ç”¨ååˆ†å¹¿æ³›ï¼Œå¦‚è‘—çš„ Reactive Extensions (RX) å‡½æ•°åº“ï¼Œå…¶ä¸­ RxJava ï¼Œ RxAndroid éƒ½æ˜¯åŸºäºŽè§‚å¯Ÿè€…æ¨¡å¼ã€‚ åœ¨ Android å¼€å‘ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ä¹Ÿä¼šè¢«ç»å¸¸ä½¿ç”¨ï¼Œå¦‚å››å¤§ç»„ä»¶ä¹‹ä¸€çš„ BroadcastReceiver ä¹Ÿæ˜¯åŸºäºŽè§‚å¯Ÿè€…æ¨¡å¼ã€‚ è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹ ç¬¦åˆå¼€é—­åŽŸåˆ™ å¯ä»¥å®žçŽ°è¡¨ç¤ºå±‚ä¸Žæ•°æ®é€»è¾‘å±‚çš„åˆ†ç¦» è§‚å¯Ÿè€…ä¸Žè¢«è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆæ˜¯æŠ½è±¡çš„ ç¼ºç‚¹ è‹¥ä¸€ä¸ªç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šè§‚å¯Ÿè€…ï¼ŒéåŽ†é€šçŸ¥æ¯ä¸€è§‚å¯Ÿå°†ä¼šå˜å¾—è€—æ—¶å¤ªé•¿ è‹¥ç›®æ ‡å¯¹è±¡ä¸Žè§‚å¯Ÿè€…å¯¹è±¡å­˜åœ¨å¾ªçŽ¯ä¾èµ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Java to Kotlin è¯­æ³•æ¸…å•]]></title>
      <url>%2F2017%2F05%2F25%2FJava-to-Kotlin-Grammar-List%2F</url>
      <content type="text"><![CDATA[æ—¶åˆ»å¯¹æ–°äº‹ç‰©ä¿æŒå¥½å¥‡å¿ƒ Google I/O 2017 å®£å¸ƒåœ¨ Android Studio 3.0 å°†é»˜è®¤æ”¯æŒ Kotlin ç”¨äºŽ Android å¼€å‘. è¯·æ³¨æ„ Google åªæ˜¯å®£å¸ƒ Kotlin ä½œä¸º Android å¼€å‘çš„ä¸€çº§è¯­è¨€ï¼Œå¹¶æ²¡æœ‰è¯´è¦ç”¨å…¶å–ä»£ Java ï¼Œè¿™é‡Œå¾ˆå¤šæ— è„‘åª’ä½“è¿›è¡Œäº†è¿‡åº¦è§£è¯»ã€‚ä½œä¸ºä¸€ååˆæ ¼çš„ç¨‹åºå‘˜ï¼Œé¦–å…ˆè¦ç†æ€§çœ‹å¾…æŠ€æœ¯è¿­ä»£æ›´æ–°ï¼ŒåŒæ—¶è¦å¯¹æ–°äº‹ç‰©ä¿æŒå¼ºçƒˆçš„å¥½å¥‡å¿ƒã€‚ Kotlin ç®€ä»‹Kotlin æ¥è‡ªäºŽæ·å…‹ä¸€å®¶ç‰›é€¼è½¯ä»¶ç ”å‘å…¬å¸ JetBrains ï¼Œå¾ˆå¤šä¼˜ç§€çš„ IDEï¼Œå¦‚ IntelliJ IDEAã€PyCharmã€WebStorm ç­‰éƒ½æ˜¯å®ƒçš„æ°ä½œï¼ŒåŒ…æ‹¬ Google å®˜æ–¹çš„ Android IDE â€“ Android Studio ï¼Œä¹Ÿæ˜¯ IntelliJ IDEA çš„æ’ä»¶ç‰ˆã€‚ Kotlin æºäºŽ JetBrains çš„åœ£å½¼å¾—å ¡å›¢é˜Ÿï¼Œåç§°å–è‡ªåœ£å½¼å¾—å ¡é™„è¿‘çš„ä¸€ä¸ªå°å²› ( Kotlin Island ) ï¼ŒJetBrains åœ¨ 2010 å¹´é¦–æ¬¡æŽ¨å‡º Kotlin ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶åœ¨æ¬¡å¹´å°†ä¹‹å¼€æºã€‚ Kotlin çš„ç‰¹ç‚¹Kotlin æ˜¯ä¸€ä¸ªåŸºäºŽ JVM çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸Ž Java æœ‰å¾ˆæ·±çš„æ¸Šæºã€‚å®ƒèƒ½ä¸Ž Java 100% äº’é€šï¼Œå…·å¤‡è¯¸å¤š Java å°šä¸æ”¯æŒçš„æ–°ç‰¹æ€§ã€‚Kotlin å¯ä»¥ç¼–è¯‘æˆ Java å­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘æˆ JavaScript ï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰ JVM çš„è®¾å¤‡ä¸Šè¿è¡Œï¼Œå¯ç”¨äºŽç§»åŠ¨ç«¯ä»¥åŠ Web å¼€å‘ï¼Œæ˜¯ä¸€ç§å…¨æ ˆå¼å¼€å‘è¯­è¨€ã€‚ Java to Kotlinä¸‹é¢æ˜¯ Java to Kotlin ä¸»è¦è¯­æ³•ï¼Œä»¥ä¾¿äºŽä½ å¿«é€Ÿè®¤è¯† Kotlin è¿™é—¨è¯­è¨€ã€‚ å˜é‡Java123String lan = "Hello Kotlin";final String lan = "Hello Kotlin"; Kotlin123var lan = "Hello Kotlin"val lan = "Hello Kotlin" æ‰“å°å­—ç¬¦ä¸²Java123System.out.print("Hello Kotlin");System.out.println("Hello Kotlin"); Kotlin123print("Hello Kotlin");println("Hello Kotlin"); å­—ç¬¦ä¸²æ¨¡æ¿Java123456789String name = "haohao";int age = 25;String msg = "I am " + name + ", " + age + " years old.";String text = "Hello Kotlin\n" + "Hello Android\n" + "Hello TensorFlow"; Kotlin123456789101112var name = "haohao";var age = 25;var msg = "I am $name , $age years old.";var text = """ |Hello Kotlin |Hello Android |Hello TensorFlow """.trimMargin()// trimMargin() åŽ»é™¤è¿žæŽ¥ç¬¦ `|` ç©ºå£°æ˜ŽJava1String name = null; Kotlin1var name: String? = null // `?` å£°æ˜Žå˜é‡å¯ä¸º null åˆ¤ç©ºJava1234if (name != null) &#123; int len = name.length;&#125; Kotlin1234name?.let&#123; val len = name.length&#125; é€»è¾‘è¡¨è¾¾å¼Java1String y = x &gt; 6 ? "x &gt; 6" : "x &lt;= 6"; Kotlin123var y = if (x &gt; 6) "x &gt; 6" else "x &lt;= 6" ç±»åž‹åˆ¤æ–­åŠè½¬æ¢Java1234if (obj instanceof Person) &#123; Person p = (Person) obj;&#125; Kotlin1234if (obj is Person) &#123; var p = obj //æ™ºèƒ½è½¬æ¢&#125; åŒºé—´Java123456789101112if (value &gt;= 0 &amp;&amp; value &lt;= 100) &#123;&#125;for (int i = 1; i &lt;= 100 ; i++) &#123;&#125;for (int i = 1; i &lt; 100 ; i++) &#123;&#125;for (int i = 100; i &gt;= 0 ; i--) &#123;&#125;for (int i = 1; i &lt;= 100 ; i+=2) &#123;&#125;for (int i = 100; i &gt;= 0 ; i-=2) &#123;&#125; Kotlin123456789101112if (value is 0..100) &#123;&#125;for (i in 1..100 ) &#123;&#125;for (i in 1 until 100) &#123;&#125; // åŠå¼€åŒºé—´ï¼šä¸åŒ…å« 100for (i in 100 downTo 0) &#123;&#125;for (i in 1..100 step 2) &#123;&#125;for (i in 100 donwTo 1 step 2) &#123;&#125; list å’Œ map ( é’ˆå¯¹ Java 8 ä¹‹å‰ç‰ˆæœ¬ )Java1234567891011121314151617181920212223242526List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4);for(Integer value : list) &#123; System.out.println(value);&#125;Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();map.put(1, "Java");map.put(2, "Kotlin");map.put(3, "iOS");map.put(4, "React Native");Iterator&lt;Map.Entry&lt;Integer, String&gt;&gt; iterator = map.entrySet().iterator();while (iterator.hasNext()) &#123; Map.Entry&lt;Integer, String&gt; entry = iterator.next(); System.out.println(entry.getKey() + " , " + entry.getValue());&#125; Kotlin1234567891011121314151617181920var list = listOf(1, 2, 3, 4);list.forEach &#123; println(it)&#125;var map = mapOf(1 to "Java", 2 to "Kotlin", 3 to "iOS", 4 to "React Native")map.forEach &#123; key, value -&gt; println("$key, $value")&#125;// æˆ–è€…for ((key, value) in map) &#123; println("$key, $value")&#125; å¼€å…³è¯­å¥Java123456789101112131415161718192021222324int score = // some score;String result;switch (score) &#123; case 10: case 9: grade = "Excellent"; break; case 8: case 7: case 6: grade = "Good"; break; case 5: case 4: grade = "Ok"; break; case 3: case 2: case 1: grade = "Fail"; break; default: grade = "Fail"; &#125; Kotlin12345678910111213var score = // some scorevar grade = when (score) &#123; 9, 10 -&gt; "Excellent" in 6..8 -&gt; "Good" 4, 5 -&gt; "Ok" in 1..3 -&gt; "Fail" else -&gt; "Fail"&#125; æµæ°´çº¿Java1234567891011121314151617List&lt;String&gt; list = Arrays.asList("java", "c++", "Android", "Kotlin", "iOS");for(int i = 0; i &lt; list.size(); i++ ) &#123; list.set(i, "Hello " + list.get(i)); if (!list.get(i).contains("c")) &#123; System.out.println(list.get(i)); &#125;&#125;//è¾“å‡ºï¼š// Hello java// Hello Android// Hello Kotlin// Hello iOS Kotlin123456789101112131415161718192021var list = arrayOf("java", "c++", "Android", "Kotlin", "iOS")list.map &#123; "Hello $it"&#125;.filter &#123; !it.contains("c")&#125;.forEach &#123; println(it)&#125;//è¾“å‡ºï¼š// Hello java// Hello Android// Hello Kotlin// Hello iOS å‡½æ•°Java123456public final void func() &#123;&#125;public final int func(int value) &#123; return 1 * value;&#125; Kotlin12345678910fun func() &#123;&#125;fun func(value: Int): Int &#123; return 1 * value&#125;// æˆ–è€…fun func(value: Int): Int = 1 * value ç±»Java123456789101112131415public final class Person &#123; private String name = null; private int age = 25; private Person() &#123; &#125; public Person(String name, int age) &#123; this.name = name; this.age = age; &#125;&#125; Kotlin123456789101112class Person private constructor() &#123; private var name: String? = null private var age: Int = 25 constructor (name: String, age: Int): this() &#123; this.name = name this.age = age &#125;&#125; é™æ€æ–¹æ³•ï¼ˆ ä¼´ç”Ÿå¯¹è±¡ ï¼‰Java123456789public final class Manager &#123; private Manager() &#123;&#125; public static Manager getInstance () &#123; return new Manager(); &#125;&#125; Kotlin1234567class Manager private constructor() &#123; companion object &#123; fun getInstance(): Manager = Manager() &#125;&#125; å®žä½“ç±»Java12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455public class Person &#123; public String name; public age; public Person(String name, int age) &#123; this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; Person person = (Person) o; if (age != person.age) return false; return name != null ? name.equals(person.name) : person.name == null; &#125; @Override public int hashCode() &#123; int result = name != null ? name.hashCode() : 0; result = 31 * result + age; return result; &#125; @Override public String toString() &#123; return "Person&#123;" + "name='" + name + '\'' + ", age=" + age + '&#125;'; &#125;&#125; Kotlin1data class Person(var name: String, var age: Int) è§£æž„Java12345Person p = new Person("haohao", 25);String name = p.getName();String age = p.getAge(); Kotlin123var p = Person("name", 25)var (name, age) = p æŽ¥å£Java 1234interface Readable &#123; String getContent();&#125; 12345678public final class Book implements Readable &#123; @override public String getContent() &#123; return "Hello"; &#125;&#125; Kotlin123456789// Kotlin æŽ¥å£ä¸­å¯ä»¥è®¾ç½®æŠ½è±¡å’ŒéžæŠ½è±¡æ–¹æ³•,å¯ä»¥æœ‰å±žæ€§ä½†å¿…é¡»å£°æ˜Žä¸ºæŠ½è±¡æˆ–æä¾›è®¿é—®å™¨å®žçŽ°ã€‚interface Readable &#123; fun getContent(): String fun getVersion(): Int = 0 &#125; 123456789class Book(): Readable &#123; override fun getContent(): String = "Hello" override fun getVersion(): Int &#123; return super.getVersion() &#125;&#125; ç»§æ‰¿Java 123456789101112131415161718public class Person &#123; private String name = null; public Person(String name) &#123; this.name = name; &#125; public void sayHello() &#123; System.out.println("Hello"); &#125; public final void sayGood() &#123; System.out.println("Good"); &#125;&#125; 1234567891011121314151617public final class Student extends Person &#123; private String school = null; public Student(String name, String school) &#123; this.school = school; super(name); &#125; @override public void sayHello() &#123; super.sayHello(); System.out.println("Hello Student"); &#125;&#125; Kotlin1234567open class Person(private var name: String? = null) &#123; open fun sayHello() = println("Hello") fun sayGood() = println("Good")&#125; 12345678class Student(private var school: String? = null, name: String): Person(name) &#123; override fun sayHello() &#123; super.sayHello() println("Hello Student") &#125; &#125; é™æ€ä¸Žéžé™æ€å†…éƒ¨ç±»Java 12345678910111213141516171819202122232425public final class Outer &#123; private int bar = 100; public static class Nester &#123; public final String foo() &#123; return "Hello Kotlin!"; &#125; &#125; public final class Inner &#123; public final int foo() &#123; return bar; // å¯ä»¥è®¿é—®å¤–éƒ¨ç±»æˆå‘˜ &#125; &#125; &#125;System.out.println(new Outer.Nester().foo()); // System.out.println(new Outer().Inner().foo()); ä¸èƒ½åœ¨å…¶ä»–ç±»ä¸­å®žä¾‹åŒ–éžé™æ€å†…éƒ¨ç±» Kotlin123456789101112131415161718192021class Outer &#123; private var bar: Int = 100 // åµŒå¥—ç±» class Nester &#123; // ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»æˆå‘˜ fun foo() = "Hello Kotlin!" &#125; // å†…éƒ¨ç±» inner class Inner &#123; // å¯ä»¥è®¿é—®å¤–éƒ¨ç±»æˆå‘˜ fun foo() = bar &#125;&#125;println(Outer.Nested().foo())println(Outer().Inner().foo()) åŒ¿åå†…éƒ¨ç±»Java12345678view.setOnClickListener(new OnClickListener() &#123; @override onClick(View view)&#123; // to do something. &#125; &#125;); Kotlin1234567891011121314151617interface OnClickListener &#123; fun onClick()&#125;class View()&#123; var listener: OnClickListener? = null fun setOnClickListener(listener: OnClickListener) &#123; this.listener = listener &#125;&#125;view.setOnClickListener(object : OnClickListener&#123; override fun onClick() &#123; TODO("not implemented") &#125;&#125;) æ‰©å±•Java1// Java ç±»ä¸èƒ½ç›´æŽ¥è¿›è¡Œæ‰©å±• Kotlin 12345678910// ä¸€èˆ¬æ‰©å±•class MyClass &#123; fun foo() = println("member")&#125;fun MyClass.bar() = println("extension")MyClass().bar()//è¾“å‡ºï¼š extension 1234567891011121314151617// æ‰©å±•å‡½æ•°ä¸Žæˆå‘˜å‡½æ•°ç›¸åŒclass MyClass &#123; fun foo() = println("member")&#125;fun MyClass.foo() = println("extension") // æ‰©å±•å‡½æ•°ä¸Žæˆå‘˜å‡½æ•°ç›¸åŒæ—¶, æˆå‘˜å‡½æ•°ä¼˜å…ˆfun MyClass.foo(para: Int) = println("extension")MyClass().foo()MyClass().foo(0)//è¾“å‡ºï¼š // member// extension Kotlin Call JavaJava123456789101112131415161718192021222324252627282930313233public class Person &#123; private String name = null; private int age = 0; public Person(String name, int age) &#123; this.name = name; this.age = age; &#125; public Person() &#123; &#125; public String getName() &#123; return name; &#125; public int getAge() &#123; return age; &#125; public void setName(String name) &#123; this.name = name; &#125; public void setAge(int age) &#123; this.age = age; &#125; @Override public String toString() &#123; return "name : " + name + ", age : " + age; &#125;&#125; Kotlin 1234567var p = Person()p.name = "haohao"p.age = 25println(p.toString())// name : haohao, age : 25 Java Call KotlinKotlin 12345678// Example.ktpackage democlass MyClassfun func() &#123;&#125; Java123new demo.MyClass();demo.ExampleKt.func(); æ³›åž‹Java12345678910111213public final class Wrapper&lt;T&gt; &#123; private T item; public Wrapper(T item) &#123; this.item = item; &#125; public T getItem() &#123; return item; &#125;&#125;Wrapper&lt;String&gt; wrapper = new Wrapper&lt;&gt;("Hello Kotlin");System.out.println(wrapper.getItem()); Kotlin1234class Wrapper&lt;T&gt;(val item: T)var wrapper = Wrapper("Hello Kotlin")println(wrapper.item) åŒ¿åå‡½æ•° ( Lambda è¡¨è¾¾å¼ )Java (Java 8)123456789101112131415161718new Thread(() -&gt; &#123; System.out.println("Hello Kotlin"); &#125;).start();// åŒä¸‹new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println("Hello Kotlin"); &#125; &#125;).start(); Kotlin123456789101112131415161718192021222324252627Thread(Runnable &#123; println("Hello Kotlin") &#125;).start()// Kotlin Lambda è¡¨è¾¾å¼è¯­æ³•val sum = &#123;x: Int, y: Int -&gt; x + y &#125;val sum1: (Int, Int) -&gt; Int = &#123;x, y -&gt; x + y &#125;val sum2 = fun(x: Int, y: Int): Int &#123; return x + y&#125;println(sum(2,8))println(sum1(2,8))println(sum2(2,8))//è¾“å‡ºï¼š// 10// 10// 10// Hello Kotlin Kotlin é«˜é˜¶å‡½æ•°Java1// Java ä¸èƒ½ç›´æŽ¥å®žçŽ°é«˜é˜¶å‡½æ•° Kotlin12345678910111213141516171819202122// é«˜é˜¶å‡½æ•°ï¼Œå³ä¸€ä¸ªå‡½æ•°å¯ä½œä¸ºé«˜é˜¶å‡½æ•°çš„å‚æ•°fun superFunc(desc: String?, method: () -&gt; String) &#123; print(desc) println(method())&#125;fun argFun() = "æˆ‘æ˜¯é«˜é˜¶å‡½æ•°çš„å‚æ•°"//ä½¿ç”¨é«˜é˜¶å‡½æ•°superFunc("è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° ", ::argFun)superFunc("è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° ", &#123; argFun() &#125;)superFunc("è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° ") &#123; argFun() &#125;//è¾“å‡ºï¼š// è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° æˆ‘æ˜¯é«˜é˜¶å‡½æ•°çš„å‚æ•°// è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° æˆ‘æ˜¯é«˜é˜¶å‡½æ•°çš„å‚æ•°// è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•° æˆ‘æ˜¯é«˜é˜¶å‡½æ•°çš„å‚æ•° ç®€å•å¼‚æ­¥Java (Java 8)1234567891011new Thread(() -&gt; &#123; data = DataSource.obtain(); //è€—æ—¶æ“ä½œ runOnUiThread(() -&gt; &#123; view.load(data); //æ›´æ–° UI &#125;); &#125;).start(); Kotlin (Kotlin Anko)12345678async &#123; data = DataSource.obtain(); //è€—æ—¶æ“ä½œ uiThread &#123; view.load(data); //æ›´æ–° UI &#125;&#125; æ³›åž‹å‡½æ•°Java1// Java ä¸èƒ½å•ç‹¬å®žçŽ°æ³›åž‹å‡½æ•° Kotlin12345fun &lt;T&gt; singletonList(item: T): List&lt;T&gt; &#123; return arrayListOf(item)&#125;val list = singletonList&lt;String&gt;("kotlin") Kotlin å†…è”å…·ä½“åŒ–Kotlin1234567inline fun &lt;reified T ï¼š Activity&gt; Activity.gotoActivity() &#123; val intent = Intent(this, T::class.java) this.startActivity(intent)&#125;gotoActivity&lt;NewActivity&gt;() Kotlin lazy æ‡’åŠ è½½Kotlin1234567891011121314val lazyValue: String by lazy &#123; println("init") //ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰è¢«åˆå§‹åŒ– "Hello Kotlin"&#125;fun main(args: Array&lt;String&gt;) &#123; println(lazyValue) println(lazyValue)&#125;//è¾“å‡ºï¼š// init// Hello Kotlin// Hello Kotlin Kotlin observable è§‚å¯Ÿè€…Kotlin12345678910111213141516171819class Person&#123; public var name: String by Delegates.observable("init .. ")&#123; property,oldValue,newValue -&gt; println("property : $property, oldValue : $oldValue, newValue : $newValue") &#125;&#125;fun main(args: Array&lt;String&gt;) &#123; val person = Person() println(person.name) person.name = "haohao" person.name = "nannan"&#125;//è¾“å‡ºï¼š// init .. // property : var Person.name: kotlin.String, oldValue : init .. , newValue : haohao// property : var Person.name: kotlin.String, oldValue : haohao, newValue : nannan æŒç»­æ›´æ–°ä¸­â€¦]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è®¾è®¡æ¨¡å¼ä¹‹å¤–è§‚æ¨¡å¼]]></title>
      <url>%2F2017%2F05%2F15%2FAndroid-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%2F</url>
      <content type="text"><![CDATA[æ‰“é€ ä¸ªäººå“ç‰Œæ˜¯çŽ°ä»£èŒä¸šè§„åˆ’çš„è¶‹åŠ¿ åœ¨å½“ä¸‹äº’è”ç½‘é©å‘½çš„æ—¶ä»£ï¼Œæœ‰è¿™æ ·ä¸€ç§è¯´æ³•ï¼Œå¦‚æžœä¸€ä¸ªäººåˆ°ä¸‰åå²ä»¥åŽè¿˜æ˜¯åªæœ‰å·¥èµ„æ”¶å…¥ï¼Œé‚£ä¹ˆå®ƒçš„èŒä¸šè§„åˆ’æ˜¯å¤±è´¥çš„ã€‚æœ¬æ–‡æ˜¯ Android è®¾è®¡æ¨¡å¼çš„ç¬¬ä¸‰ç¯‡ï¼ŒæŽ¥ä¸‹æ¥ä¼šé™†ç»­æŽ¨å‡ºæ•´ä¸ªå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ç³»åˆ—ã€‚ å¤–è§‚æ¨¡å¼å¤–è§‚æ¨¡å¼ (Facade Pattern) ï¼Œåˆåé—¨é¢æ¨¡å¼ï¼Œå½’ç±»ä¸ºå¯¹è±¡ç»“æž„åž‹æ¨¡å¼ï¼Œå¤–éƒ¨å¯¹è±¡ä¸Žä¸€ä¸ªå­ç³»ç»Ÿé€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚å¯¹è±¡è¿›è¡Œã€‚ æ¨¡å¼ç»“æž„ Client å¤–éƒ¨å¯¹è±¡ Facade å¤–è§‚å¯¹è±¡ SubSystem å­ç³»ç»Ÿå¯¹è±¡ ç›—å›¾ æ¨¡å¼å®žçŽ° ç”µè§†é¥æŽ§å™¨æ˜¯çŽ°å®žç”Ÿæ´»ä¸­ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¤–è§‚æ¨¡å¼çš„è¿ç”¨ï¼Œé¥æŽ§å™¨å¯ä»¥æŽ§åˆ¶ç”µæº (Power) çš„ç”µæºã€å£°éŸ³ (Voice) çš„è°ƒæ•´ã€é¢‘é“ (Channel) çš„åˆ‡æ¢ç­‰ã€‚è¿™ä¸ªé¥æŽ§å™¨å°±æ˜¯æˆ‘ä»¬è¿™é‡Œè¯´çš„å¤–è§‚æˆ–è€…é—¨é¢ï¼Œè€Œç”µæºã€å£°éŸ³ã€é¢‘é“åˆ‡æ¢ç³»ç»Ÿå°±æ˜¯æˆ‘ä»¬çš„å­ç³»ç»Ÿã€‚ PowerSystem123456789public class PowerSystem &#123; public void powerOn() &#123; System.out.println("power on"); &#125; public void powerOff() &#123; System.out.println("power off"); &#125;&#125; VoiceSystem123456789public class VoiceSystem &#123; public void turnUp() &#123; System.out.println("voice increasing"); &#125; public void turnDown() &#123; System.out.println("voice reducing"); &#125;&#125; ChannelSystem123456789public class ChannelSystem &#123; public void next() &#123; System.out.println("next channel"); &#125; public void prev() &#123; System.out.println("prev channel"); &#125;&#125; Facade1234567891011121314151617181920212223242526272829public class Facade &#123; private PowerSystem mPowerSystem = new PowerSystem(); private VoiceSystem mVoiceSystem = new VoiceSystem(); private ChannelSystem mChannelSystem = new ChannelSystem(); public void powerOn() &#123; mPowerSystem.powerOn(); &#125; public void powerOff() &#123; mPowerSystem.powerOff(); &#125; public void turnUp() &#123; mVoiceSystem.turnUp(); &#125; public void turnDown() &#123; mVoiceSystem.turnDown(); &#125; public void nextChannel() &#123; mChannelSystem.next(); &#125; public void prevChannel() &#123; mChannelSystem.prev(); &#125;&#125; Client123456public static void main (String[] args) &#123; Facade facade = new Facade(); facade.powerOn(); facade.turnUp(); facade.nextChannel();&#125; Running power on voice increasing next channel Android ä¸­çš„å®žçŽ°åœ¨ Activity ä¸­å¯ä»¥è¿›è¡Œå¾ˆå¤šé‡è¦çš„æ“ä½œï¼Œå¦‚ startService() ï¼ŒstartActivity() ï¼ŒsendBroadcast() ï¼ŒbindService() ä»¥åŠèŽ·å– System Service ã€‚Activity å°±å¯ä»¥ç®€å•åœ°çœ‹ä½œä¸€ä¸ªé—¨é¢ï¼Œä½†æ˜¯è¿™äº›å·¥ä½œå®žé™…ä¸Šå¹¶ä¸æ˜¯ Activity æ¥å®žçŽ°çš„ï¼Œè€Œæ˜¯å§”æ‰˜ Activity çˆ¶ç±» ContextThemeWrapper ä¸­çš„ mBase å¯¹è±¡ï¼ŒmBase å¯¹è±¡çš„å®žçŽ°ç±»æ˜¯ ContextImpl ã€‚ çœ‹ä¸€ä¸‹æºç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788class ContextImpl extends Context &#123; private final static String TAG = "ApplicationContext"; private final static boolean DEBUG = false; private final static boolean DEBUG_ICONS = false; private static final Object sSync = new Object(); private static AlarmManager sAlarmManager; private static PowerManager sPowerManager; private static ConnectivityManager sConnectivityManager; private AudioManager mAudioManager; LoadedApk mPackageInfo; private Resources mResources; private PackageManager mPackageManager; private NotificationManager mNotificationManager = null; private ActivityManager mActivityManager = null; ... @Override public boolean bindService(Intent service, ServiceConnection conn, int flags) &#123; warnIfCallingFromSystemProcess(); return bindServiceCommon(service, conn, flags, mMainThread.getHandler(), Process.myUserHandle()); &#125; @Override public Object getSystemService(String name) &#123; return SystemServiceRegistry.getSystemService(this, name); &#125; @Override public String getSystemServiceName(Class&lt;?&gt; serviceClass) &#123; return SystemServiceRegistry.getSystemServiceName(serviceClass); &#125; @Override public void sendBroadcast(Intent intent) &#123; String resolvedType = intent.resolveTypeIfNeeded(getContentResolver()); try &#123; ActivityManagerNative.getDefault().broadcastIntent( mMainThread.getApplicationThread(), intent, resolvedType, null, Activity.RESULT_OK, null, null, null, false, false); &#125; catch (RemoteException e) &#123; &#125; &#125; @Override public void startActivity(Intent intent) &#123; if ((intent.getFlags()&amp;Intent.FLAG_ACTIVITY_NEW_TASK) == 0) &#123; throw new AndroidRuntimeException( "Calling startActivity() from outside of an Activity " + " context requires the FLAG_ACTIVITY_NEW_TASK flag." + " Is this really what you want?"); &#125; mMainThread.getInstrumentation().execStartActivity( getOuterContext(), mMainThread.getApplicationThread(), null, null, intent, -1); &#125; @Override public ComponentName startService(Intent service) &#123; try &#123; ComponentName cn = ActivityManagerNative.getDefault().startService( mMainThread.getApplicationThread(), service, service.resolveTypeIfNeeded(getContentResolver())); if (cn != null &amp;&amp; cn.getPackageName().equals("!")) &#123; throw new SecurityException( "Not allowed to start service " + service + " without permission " + cn.getClassName()); &#125; return cn; &#125; catch (RemoteException e) &#123; return null; &#125; &#125; @Override public String getPackageName() &#123; if (mPackageInfo != null) &#123; return mPackageInfo.getPackageName(); &#125; throw new RuntimeException("Not supported in system context"); &#125; ...&#125; ContextImpl å†…éƒ¨æœ‰å¾ˆå¤š Manager ç±»çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿå°±æ˜¯å­ç³»ç»Ÿå¯¹è±¡ã€‚ ContextImpl å†…éƒ¨å°è£…äº†ä¸€äº›ç³»ç»Ÿçº§åˆ«çš„æ“ä½œä»¥åŠæä¾›äº†ä¸€äº›è®¿é—®ç³»ç»Ÿçš„æŽ¥å£ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ©ç”¨å…¶è®¿é—®å­ç³»ç»Ÿã€‚ å¤–è§‚æ¨¡å¼çš„ä¼˜ç‚¹ä¸Žç¼ºç‚¹ä¼˜ç‚¹ å±è”½äº†å­ç³»ç»Ÿå†…éƒ¨ç»†èŠ‚ï¼Œä½¿å­ç³»ç»Ÿçš„ä½¿ç”¨æ›´è§ä¾¿åˆ© å‡å°‘å®¢æˆ·ç«¯æ‰€æŒå¯¹è±¡çš„æ•°ç›®ï¼Œé™ä½Žäº†å®¢æˆ·ç«¯ä¸Žå­ç³»ç»Ÿçš„è€¦åˆåº¦ç¼ºç‚¹ å¢žåŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»ï¼Œè¿èƒŒäº†â€œå¼€é—­åŽŸåˆ™â€ å‚è€ƒ https://github.com/simple-android-framework/android_design_patterns_analysis/tree/master/facade/elsdnwn]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è®¾è®¡æ¨¡å¼ä¹‹ Builder æ¨¡å¼]]></title>
      <url>%2F2017%2F05%2F13%2FAndroid-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B-Builder-%E6%A8%A1%E5%BC%8F%2F</url>
      <content type="text"><![CDATA[å¹³å¦çš„è·¯å¾€å¾€åªèƒ½å¸¦ä½ åˆ°å¹³å‡¡çš„åœ°æ–¹ æœ€è¿‘åœ¨ç ”ç©¶ Clean å’Œ Unidirectional ï¼ˆ Android Flux ï¼‰æž¶æž„ï¼Œå›žå¤´æ”¾ä¸€ä¸ªå¤§æ‹›ã€‚æœ¬æ–‡æ˜¯ Android è®¾è®¡æ¨¡å¼çš„ç¬¬äºŒç¯‡ï¼ŒæŽ¥ä¸‹æ¥ä¼šé™†ç»­æŽ¨å‡ºæ•´ä¸ªå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ç³»åˆ—ã€‚ Builder æ¨¡å¼Builder åˆåç”Ÿæˆå™¨æ¨¡å¼ï¼Œæˆ–å»ºé€ ï¼ˆè€…ï¼‰æ¨¡å¼ã€‚å®ƒæ˜¯ä¸€ç§å¯¹è±¡æž„å»ºæ¨¡å¼ï¼Œç”¨äºŽæŠ½è±¡å¤æ‚å¯¹è±¡çš„æž„å»ºè¿‡ç¨‹ï¼Œæž„é€ è¿‡ç¨‹çš„ä¸åŒå®žçŽ°æ–¹æ³•å¯ä»¥æž„å»ºå‡ºå…·æœ‰ä¸åŒè¡¨ç¤ºçš„å¯¹è±¡ã€‚ å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æž„å»ºä¸Žå®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æž„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ æ¨¡å¼ç»“æž„ Product äº§å“ï¼Œè¡¨ç¤ºè¢«æž„é€ çš„å¤æ‚å¯¹è±¡ã€‚ Builder æŠ½è±¡æž„å»ºè€…ï¼Œä¸ºåˆ›å»ºä¸€ä¸ª Product å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶æŒ‡å®šæŠ½è±¡æ–¹æ³•ï¼ˆæŽ¥å£æ–¹æ³•ï¼‰ã€‚ ConcreteBuilder å…·ä½“æž„å»ºè€…ï¼Œå®žçŽ° Builder æŽ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰ä»¥åŠå„ä¸ªæŠ½è±¡æ–¹æ³•ã€‚ Director æŒ‡æŒ¥è€…ï¼Œæž„å»ºå®žçŽ°ï¼ˆç»§æ‰¿ï¼‰ Builder æŽ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰çš„å¯¹è±¡ã€‚ ç›—å›¾ æ¨¡å¼å®žçŽ°æˆ‘ä»¬ä»¥ç”Ÿäº§æ‰‹æœºä¸ºä¾‹ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ‰‹æœºäº§å“é€šå¸¸æ¯”è¾ƒå…³æ³¨å®ƒçš„å“ç‰Œ (Brand) ï¼ŒCPU æ ¸å¿ƒæ•°ç›® (CPU Core)ï¼Œè¿è¡Œå†…å­˜ (RAM) ä»¥åŠæ“ä½œç³»ç»Ÿ (OS)ã€‚ Product1234567891011121314151617181920212223242526272829303132333435363738394041424344public class Phone &#123; private int mCPUCore = 1; private int mRam = 1; private String mOS = "Android"; private String mBrand = "Google"; public int getCPUCore() &#123; return mCPUCore; &#125; public int getRAM() &#123; return mRam; &#125; public String getOS() &#123; return mOS; &#125; public String getBrand() &#123; return mBrand; &#125; public void setCPUCore(int mCPUCore) &#123; this.mCPUCore = mCPUCore; &#125; public void setRAM(int mRam) &#123; this.mRam = mRam; &#125; public void setOS(String mOS) &#123; this.mOS = mOS; &#125; public void setBrand(String mBrand) &#123; this.mBrand = mBrand; &#125; @Override public String toString() &#123; return "Brand : " + getBrand() +", CPUCore : " + getCPUCore() + ", RAM : " + getRAM() + ", OS : " + getOS(); &#125;&#125; Builder æŠ½è±¡ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public abstract class PhoneBuilder &#123; protected Phone mPhone; public void createPhone() &#123; mPhone = new Phone(); &#125; public Phone getPhone() &#123; return mPhone; &#125; public abstract void buildPhoneCpu(); public abstract void buildPhoneRam(); public abstract void buildPhoneOS();&#125;``` #### ConcreteBuilderXiaoMiPhoneBuilder```javapublic class XiaoMiPhoneBuilder extends PhoneBuilder &#123; public XiaoMiPhoneBuilder() &#123; createPhone(); mPhone.setBrand("XiaoMi"); &#125; @Override public void buildPhoneCpu() &#123; mPhone.setCPUCore(4); &#125; @Override public void buildPhoneRam() &#123; mPhone.setRAM(4); &#125; @Override public void buildPhoneOS() &#123; mPhone.setOS("MIUI Android"); &#125;&#125; GooglePhoneBuilder 123456789101112131415161718192021222324public class GooglePhoneBuilder extends PhoneBuilder &#123; public GooglePhoneBuilder() &#123; createPhone(); mPhone.setBrand("Google"); &#125; @Override public void buildPhoneCpu() &#123; mPhone.setCPUCore(8); &#125; @Override public void buildPhoneRam() &#123; mPhone.setRAM(6); &#125; @Override public void buildPhoneOS() &#123; mPhone.setOS("Android"); &#125;&#125; Director12345678910111213141516171819public class PhoneDirector &#123; private PhoneBuilder mPhoneBuilder; public PhoneDirector setPhoneBuilder(PhoneBuilder phoneBuilder) &#123; this.mPhoneBuilder = phoneBuilder; return this; &#125; public Phone getPhone() &#123; return mPhoneBuilder.getPhone(); &#125; public PhoneDirector constructPhone() &#123; mPhoneBuilder.buildPhoneCpu(); mPhoneBuilder.buildPhoneOS(); mPhoneBuilder.buildPhoneRam(); return this; &#125;&#125; Sample12345678910111213141516171819public class BuilderSample &#123; public static void main(String[] args) &#123; PhoneDirector phoneDirector = new PhoneDirector(); PhoneBuilder xiaomiphoneBuilder = new XiaoMiPhoneBuilder(); PhoneBuilder googlePhoneBuilder = new GooglePhoneBuilder(); Phone xiaoMiPhone = phoneDirector.setPhoneBuilder(xiaomiphoneBuilder) .constructPhone() .getPhone(); Phone googlePhone = phoneDirector.setPhoneBuilder(googlePhoneBuilder) .constructPhone() .getPhone(); System.out.println(xiaoMiPhone + "\n" + googlePhone); &#125;&#125; Running Brand : XiaoMi, CPUCore : 4, RAM : 4, OS : MIUI Android Brand : Google, CPUCore : 8, RAM : 6, OS : Android Android ä¸­çš„å®žçŽ°åœ¨ Android å¼€å‘ä¸­æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„å®žçŽ° Builder çš„ç±»æ˜¯ AlertDialog.Builder ï¼ŒBuilder æ˜¯AlertDialog çš„é™æ€å†…éƒ¨ç±»ã€‚åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223AlertDialog.Builder builder = new AlertDialog.Builder(context);builder.setIcon(R.drawable.icon);builder.setTitle("Title");builder.setMessage("Message");builder.setPositiveButton("OK", new DialogInterface.OnClickListener() &#123; public void onClick(DialogInterface dialog, int whichButton) &#123; setTitle("ç‚¹å‡»äº†å¯¹è¯æ¡†ä¸Šçš„ OK æŒ‰é’®"); &#125; &#125;);builder.setNeutralButton("Nothing", new DialogInterface.OnClickListener() &#123; public void onClick(DialogInterface dialog, int whichButton) &#123; setTitle("ç‚¹å‡»äº†å¯¹è¯æ¡†ä¸Šçš„ Nothing æŒ‰é’®"); &#125; &#125;);builder.setNegativeButton("Cancel", new DialogInterface.OnClickListener() &#123; public void onClick(DialogInterface dialog, int whichButton) &#123; setTitle("ç‚¹å‡»äº†å¯¹è¯æ¡†ä¸Šçš„ Cancel æŒ‰é’®"); &#125; &#125;);builder.create().show(); æˆ‘ä»¬çœ‹ä¸€ä¸‹ç®€åŒ–åŽçš„ AlertDialog æºç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899public class AlertDialog extends Dialog implements DialogInterface &#123; // Controller, æŽ¥å— Builder æˆå‘˜å˜é‡Pä¸­çš„å„ä¸ªå‚æ•° private AlertController mAlert; // æž„é€ å‡½æ•° protected AlertDialog(Context context, int theme) &#123; this(context, theme, true); &#125; // æž„é€  AlertDialog AlertDialog(Context context, int theme, boolean createContextWrapper) &#123; super(context, resolveDialogTheme(context, theme), createContextWrapper); mWindow.alwaysReadCloseOnTouchAttr(); mAlert = new AlertController(getContext(), this, getWindow()); &#125; @Override public void setTitle(CharSequence title) &#123; super.setTitle(title); mAlert.setTitle(title); &#125; public void setCustomTitle(View customTitleView) &#123; mAlert.setCustomTitle(customTitleView); &#125; public void setMessage(CharSequence message) &#123; mAlert.setMessage(message); &#125; // Builderå†…éƒ¨ç±» public static class Builder &#123; // å­˜å‚¨ AlertDialog çš„å„ä¸ªå‚æ•°, ä¾‹å¦‚ title ï¼Œ message ï¼Œ icon ç­‰. private final AlertController.AlertParams P; public Builder(Context context) &#123; this(context, resolveDialogTheme(context, 0)); &#125; public Builder(Context context, int theme) &#123; P = new AlertController.AlertParams(new ContextThemeWrapper( context, resolveDialogTheme(context, theme))); mTheme = theme; &#125; ...... public Builder setTitle(CharSequence title) &#123; P.mTitle = title; return this; &#125; public Builder setMessage(CharSequence message) &#123; P.mMessage = message; return this; &#125; public Builder setIcon(int iconId) &#123; P.mIconId = iconId; return this; &#125; public Builder setPositiveButton(CharSequence text, final OnClickListener listener) &#123; P.mPositiveButtonText = text; P.mPositiveButtonListener = listener; return this; &#125; public Builder setView(View view) &#123; P.mView = view; P.mViewSpacingSpecified = false; return this; &#125; // æž„å»º AlertDialog, ä¼ é€’å‚æ•° public AlertDialog create() &#123; final AlertDialog dialog = new AlertDialog(P.mContext, mTheme, false); å°†Pä¸­çš„å‚æ•°åº”ç”¨çš„dialogä¸­çš„mAlertå¯¹è±¡ä¸­ P.apply(dialog.mAlert); dialog.setCancelable(P.mCancelable); if (P.mCancelable) &#123; dialog.setCanceledOnTouchOutside(true); &#125; dialog.setOnCancelListener(P.mOnCancelListener); if (P.mOnKeyListener != null) &#123; dialog.setOnKeyListener(P.mOnKeyListener); &#125; return dialog; &#125; &#125; &#125; ä»Žæºç ä¸­å¯ä»¥çœ‹åˆ° AlertDialog.Builder åŒæ—¶æ‰®æ¼”äº† Builder ï¼Œ ConcreteBuilder ä»¥åŠ Director ä¸‰ä¸ªè§’è‰²ï¼Œæ˜¯ Builder æ¨¡å¼çš„ç®€åŒ–ç‰ˆã€‚ æˆ‘ä»¬ä»Ž AlertDialog çš„æž„å»ºå’Œä½¿ç”¨ä¸­ï¼Œå¯ä»¥ä½“ä¼šåˆ°è¿ç”¨ Builder æ¨¡å¼å¸¦æ¥çš„ç®€ä»‹æ€§å’Œé«˜åº¦çš„å¯å®šåˆ¶æ€§ã€‚ Builder æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹ ä½¿ç”¨ç®€å•ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œå°è£…è‰¯å¥½ï¼› é«˜åº¦çš„å¯å®šåˆ¶æ€§ï¼Œæž„é€ è¿‡ç¨‹å¯ç²¾ç»†åŒ–æŽ§åˆ¶ã€‚ ç¼ºç‚¹ Builder æ¨¡å¼åªé€‚ç”¨äºŽæž„å»ºè¿‡ç¨‹å¤æ‚çš„åŒä¸€ç±» Product ï¼Œæ­¤å¤–è¦è€ƒè™‘å¤šä½™ Builder å’Œ Director å¯¹è±¡å¯¹å†…å­˜çš„å ç”¨ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼]]></title>
      <url>%2F2017%2F05%2F06%2FAndroid-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%2F</url>
      <content type="text"><![CDATA[æ—¶åˆ»å°è¯•èµ°å‡ºèˆ’é€‚åŒº æœ€è¿‘åœ¨åŸ¹å…»è‡ªå·±çš„å¹¿æ³›é˜…è¯»ä¹ æƒ¯ï¼Œæ„Ÿè§‰é˜…è¯»ä¸­æœ€é‡è¦çš„æ˜¯åŠ¨è„‘æ€è€ƒï¼Œé˜…è¯»æ˜¯æŽ¥å—è®¯æ¯ï¼Œæ€è€ƒæ˜¯æ¶ˆåŒ–è®¯æ¯ã€‚æœ¬æ–‡æ˜¯ Android è®¾è®¡æ¨¡å¼çš„å¼€ç¯‡ï¼ŒæŽ¥ä¸‹æ¥ä¼šé™†ç»­æŽ¨å‡ºæ•´ä¸ªå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ç³»åˆ—ã€‚ è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼ç®€è€Œè¨€ä¹‹å°±æ˜¯ä¼˜ç§€çš„ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚è®¾è®¡æ¨¡å¼çš„äº§ç”Ÿæ˜¯ä¸ºäº†æé«˜ä»£ç çš„å¯å¤ç”¨æ€§ï¼Œå¯æ‰©å±•æ€§ä»¥åŠå¯é æ€§ï¼Œä½†æ˜¯å¾€å¾€ä¼šé™ä½Žå¯è¯»æ€§ã€‚ è®¾è®¡æ¨¡å¼åŽŸåˆ™ å•ä¸€èŒè´£åŽŸåˆ™: ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£; é‡Œæ°æ›¿æ¢åŽŸåˆ™: å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŽŸæœ‰çš„åŠŸèƒ½; ä¾èµ–å€’ç½®åŽŸåˆ™: é¢å‘æŽ¥å£ç¼–ç¨‹ï¼Œå°†ä¾èµ–å¯¹è±¡çš„å…±åŒç‰¹å¾æŠ½è±¡æˆæŽ¥å£ï¼› æŽ¥å£éš”ç¦»åŽŸåˆ™: ä¸€ä¸ªç±»ä¸åº”è¯¥å®žçŽ°å®ƒä¸éœ€è¦çš„æŽ¥å£æ–¹æ³•ï¼Œå³å»ºç«‹å•ä¸€æŽ¥å£ï¼Œç»†åŒ–æŽ¥å£ï¼Œå°½é‡å‡å°‘æŽ¥å£ä¸­çš„æ–¹æ³•; è¿ªç±³ç‰¹æ³•åˆ™: ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ï¼Œå³é™ä½Žç±»ä¸Žç±»ä¹‹é—´çš„è€¦åˆï¼› å¼€é—­åŽŸåˆ™: ä¸€ä¸ªç±»å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ è®¾è®¡æ¨¡å¼åˆ†ç±»åˆ›å»ºåž‹è®¾è®¡æ¨¡å¼è®¾è®¡å¯¹è±¡çš„å®žä¾‹åŒ–ï¼Œé¿å…ç”¨æˆ·ç”¨ new è¿ç®—ç¬¦åˆ›å»ºå¯¹è±¡ã€‚ä¾‹å¦‚å•ä¾‹æ¨¡å¼ï¼ŒBuilder æ¨¡å¼ï¼ŒåŽŸåž‹æ¨¡å¼ç­‰ã€‚ è¡Œä¸ºåž‹è®¾è®¡æ¨¡å¼è®¾è®¡å¯¹è±¡ä¹‹é—´çš„é€šä¿¡äº¤äº’ã€‚å¦‚è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè¿­ä»£å™¨æ¨¡å¼ï¼Œè´£ä»»é“¾æ¨¡å¼ç­‰ã€‚ ç»“æž„åž‹è®¾è®¡æ¨¡å¼è®¾è®¡å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡ä»¥å½¢æˆæ›´å¤§çš„ç»“æž„ã€‚å¦‚é€‚é…å™¨æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼ï¼Œæ¡¥æŽ¥æ¨¡å¼ç­‰ã€‚ å•ä¾‹æ¨¡å¼ç®€å•ä»‹ç»å¸¸ç”¨çš„äº”ç§å•ä¾‹æ¨¡å¼çš„å†™æ³•ã€‚ é¥¿æ±‰å¼å•ä¾‹123456789101112public class Person &#123; private static final Person INSTANCE = new Person(); private Person()&#123; &#125; public static Person getInstance() &#123; return INSTANCE; &#125;&#125; ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ã€‚ç¼ºç‚¹ï¼šç±»åŠ è½½çš„æ—¶å€™å°±è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹äºŽåˆå§‹åŒ–é€»è¾‘å¤æ‚çš„ç±»ï¼Œä¼šå¯¼è‡´ç±»åŠ è½½å˜æ…¢ã€‚ (DCL) æ‡’æ±‰å¼å•ä¾‹12345678910111213141516171819public class Person &#123; private static volatile Person sInstance = null; private Person()&#123; &#125; public static Person getInstance() &#123; if (sInstance == null)&#123; synchronized (Person.class) &#123; if (sInstance == null) &#123; sInstance = new Person(); &#125; &#125; &#125; return sInstance; &#125;&#125; ä¼˜ç‚¹ï¼švolatile å£°æ˜Žå•ä¾‹å¼•ç”¨ï¼Œå¯ä»¥é˜²æ­¢å¹¶å‘æ—¶åˆå§‹åŒ–æˆå‘˜å˜é‡å’Œå¯¹è±¡å®žä¾‹åŒ–é¡ºåºå¯èƒ½ä¼šè¢«æ‰“ä¹±ï¼ŒåŒé‡æ£€æŸ¥é”å®šè§£å†³äº†å¤šä½™çš„åŒæ­¥é—®é¢˜ã€‚ç¼ºç‚¹ï¼šJVM åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¼šæ‰§è¡Œ 3 ä¸ªåŽŸå­æ“ä½œï¼Œåœ¨é«˜å¹¶å‘æ—¶ä»å­˜åœ¨æžå°çš„æ¦‚çŽ‡å¯¼è‡´ DCL å¤±æ•ˆã€‚ é™æ€å†…éƒ¨ç±»å•ä¾‹12345678910111213public class Person &#123; private Person()&#123; &#125; private static class Singleton &#123; private static final Person INSTANCE = new Person(); &#125; public static Person getInstance() &#123; return Singleton.INSTANCE; &#125;&#125; ä¼˜ç‚¹ï¼šå……åˆ†ç»“åˆäº†æ‡’æ±‰å¼å•ä¾‹ä¸Žé¥¿æ±‰å¼çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶æœ‰æ•ˆé¿å¼€äº†å®ƒä»¬çš„ç¼ºç‚¹ï¼Œå……åˆ†ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚æŽ¨èç¼ºç‚¹ï¼šä¼šæœ‰çš„ï¼ æžšä¸¾åž‹å•ä¾‹1234567891011public enum PersonEnum &#123; INSTANCE; private PersonEnum() &#123; &#125; public void fun() &#123; // do something &#125;&#125; ä½¿ç”¨æ–¹æ³•ï¼š1PersonEnum.INSTANCE.fun(); ä¼˜ç‚¹ï¼šç®€æ´ï¼Œçº¿ç¨‹å®‰å…¨ã€‚ã€ŠEffective Javaã€‹çš„ä½œè€…åœ¨ä¹¦ä¸­æ˜¯è¿™æ ·å¤¸æžšä¸¾åž‹å•ä¾‹ï¼š è¿™ç§å†™æ³•åœ¨åŠŸèƒ½ä¸Šä¸Žå…±æœ‰åŸŸæ–¹æ³•ç›¸è¿‘ï¼Œä½†æ˜¯å®ƒæ›´ç®€æ´ï¼Œæ— å¿åœ°æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¯¹æ­¤å®žä¾‹åŒ–ï¼Œå³ä½¿æ˜¯åœ¨é¢å¯¹å¤æ‚çš„åºåˆ—åŒ–æˆ–è€…åå°„æ”»å‡»çš„æ—¶å€™ã€‚è™½ç„¶è¿™ä¸­æ–¹æ³•è¿˜æ²¡æœ‰å¹¿æ³›é‡‡ç”¨ï¼Œä½†æ˜¯å•å…ƒç´ çš„æžšä¸¾ç±»åž‹å·²ç»æˆä¸ºå®žçŽ°Singletonçš„æœ€ä½³æ–¹æ³•ã€‚ ç¼ºç‚¹ï¼šGoogle å®˜æ–¹å¼ºçƒˆå»ºè®®å°½é‡ä¸è¦ä½¿ç”¨ enum ï¼Œå®ƒä¼šå¢žåŠ é¢å¤–çš„å†…å­˜å ç”¨ï¼ŒåŒæ—¶å¢žåŠ å¯æ‰§è¡Œæ–‡ä»¶ .dex çš„å¤§å°ï¼Œä¹Ÿä¸é€‚ç”¨ç»§æ‰¿åœºæ™¯ã€‚ å®¹å™¨åž‹å•ä¾‹12345678910111213141516171819202122public class Person &#123; public Person () &#123; &#125;&#125;public class SingletonManager &#123; public static final KEY_SINGLETON = "singleton"; private static Map&lt;String, Object&gt; sInstanceMap = new HashMap&lt;&gt;(); public static void registerSingleton(String key, Object obj) &#123; if (!sInstanceMap.containsKey(key)) &#123; sInstanceMap.put(key, obj); &#125; &#125; public static Person getSingleton(String key) &#123; return (Person) sInstanceMap.get(key); &#125;&#125; ä½¿ç”¨ï¼š12SingletonManager.registerSingleton(KEY_SINGLETON, new Person);Person person = SingletonManager.getSingleton(); ä¼˜ç‚¹ï¼šå¯ä»¥å°†ä¸åŒå•ä¾‹æ³¨å†Œåˆ°ä¸€ä¸ªå®¹å™¨ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œéšè—äº†ç±»çš„å…·ä½“å®žçŽ°ï¼Œé™ä½Žäº†è€¦åˆåº¦ã€‚æŽ¨èç¼ºç‚¹ï¼šä¼šæœ‰çš„ï¼ å•ä¾‹æ¨¡å¼çš„ä¼˜ç‚¹ä¸Žç¼ºç‚¹ä¼˜ç‚¹ï¼šå‡å°‘å†…å­˜å¼€é”€ï¼Œé¿å…èµ„æºé‡ç”¨ã€‚ç¼ºç‚¹ï¼šå•ä¾‹ç±»çš„æ‰©å±•æ€§å¾ˆå·®ï¼ŒæŒæœ‰å¤–éƒ¨å¼•ç”¨æ—¶ï¼Œéžå¸¸å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android è¿›ç¨‹é—´é€šä¿¡æ–¹å¼]]></title>
      <url>%2F2017%2F04%2F27%2FAndroid-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%2F</url>
      <content type="text"><![CDATA[åšå¥½çœ¼å‰çš„äº‹ï¼Œä¿æŒä¸“æ³¨ æˆ‘ä»¬çš„å¤§è„‘æ˜¯ä¸²è¡Œç»“æž„ï¼Œè€Œéžå¹¶è¡Œç»“æž„ï¼Œä½ æ°¸è¿œæ— æ³•çœŸæ­£å°†è‡ªå·±çš„æ³¨æ„åŠ›åŒæ—¶æ”¾åœ¨ä¸¤ä¸ªä»»åŠ¡ä¹‹ä¸­ã€‚ Android ä¸­çš„ IPC æ–¹å¼ä½¿ç”¨ Intent Activityï¼ŒServiceï¼ŒReceiver éƒ½æ”¯æŒåœ¨ Intent ä¸­ä¼ é€’ Bundle æ•°æ®ï¼Œè€Œ Bundle å®žçŽ°äº† Parcelable æŽ¥å£ï¼Œå¯ä»¥åœ¨ä¸åŒçš„è¿›ç¨‹é—´è¿›è¡Œä¼ è¾“ã€‚ åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å¯åŠ¨äº†å¦ä¸€ä¸ªè¿›ç¨‹çš„ Acyivityï¼ŒService å’Œ Receiver ï¼Œå¯ä»¥åœ¨ Bundle ä¸­é™„åŠ è¦ä¼ é€’çš„æ•°æ®é€šè¿‡ Intent å‘é€å‡ºåŽ»ã€‚ ä½¿ç”¨æ–‡ä»¶å…±äº« Windows ä¸Šï¼Œä¸€ä¸ªæ–‡ä»¶å¦‚æžœè¢«åŠ äº†æŽ’æ–¥é”ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹å…¶è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ï¼›è€Œ Android ç³»ç»ŸåŸºäºŽ Linux ï¼Œä½¿å¾—å…¶å¹¶å‘è¯»å–æ–‡ä»¶æ²¡æœ‰é™åˆ¶åœ°è¿›è¡Œï¼Œç”šè‡³å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œå°½ç®¡è¿™æ ·å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚ å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ååºåˆ—åŒ–æ¢å¤è¿™ä¸ªå¯¹è±¡ï¼ˆæ³¨æ„ï¼šå¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯å†…å®¹ç›¸åŒã€‚ï¼‰ã€‚ SharedPreferences æ˜¯ä¸ªç‰¹ä¾‹ï¼Œç³»ç»Ÿå¯¹å®ƒçš„è¯» / å†™æœ‰ä¸€å®šçš„ç¼“å­˜ç­–ç•¥ï¼Œå³å†…å­˜ä¸­ä¼šæœ‰ä¸€ä»½ ShardPreferences æ–‡ä»¶çš„ç¼“å­˜ï¼Œç³»ç»Ÿå¯¹ä»–çš„è¯» / å†™å°±å˜å¾—ä¸å¯é ï¼Œå½“é¢å¯¹é«˜å¹¶å‘çš„è¯»å†™è®¿é—®ï¼ŒSharedPreferences æœ‰å¾ˆå¤šå¤§çš„å‡ çŽ‡ä¸¢å¤±æ•°æ®ã€‚å› æ­¤ï¼ŒIPC ä¸å»ºè®®é‡‡ç”¨ SharedPreferencesã€‚ ä½¿ç”¨ MessengerMessenger æ˜¯ä¸€ç§è½»é‡çº§çš„ IPC æ–¹æ¡ˆï¼Œå®ƒçš„åº•å±‚å®žçŽ°æ˜¯ AIDL ï¼Œå¯ä»¥åœ¨ä¸åŒè¿›ç¨‹ä¸­ä¼ é€’ Message å¯¹è±¡ï¼Œå®ƒä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ï¼ŒæœåŠ¡ç«¯ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œçš„æƒ…å½¢ã€‚ æœåŠ¡ç«¯è¿›ç¨‹ï¼šæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ª Service æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒæ—¶é€šè¿‡ä¸€ä¸ª Handler å¯¹è±¡æ¥å®žä¾‹åŒ–ä¸€ä¸ª Messenger å¯¹è±¡ï¼Œç„¶åŽåœ¨ Service çš„ onBind ä¸­è¿”å›žè¿™ä¸ª Messenger å¯¹è±¡åº•å±‚çš„ Binder å³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142public class MessengerService extends Service &#123; private static final String TAG = MessengerService.class.getSimpleName(); private class MessengerHandler extends Handler &#123; /** * @param msg */ @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case Constants.MSG_FROM_CLIENT: Log.d(TAG, "receive msg from client: msg = [" + msg.getData().getString(Constants.MSG_KEY) + "]"); Toast.makeText(MessengerService.this, "receive msg from client: msg = [" + msg.getData().getString(Constants.MSG_KEY) + "]", Toast.LENGTH_SHORT).show(); Messenger client = msg.replyTo; Message replyMsg = Message.obtain(null, Constants.MSG_FROM_SERVICE); Bundle bundle = new Bundle(); bundle.putString(Constants.MSG_KEY, "æˆ‘å·²ç»æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼Œç¨åŽå›žå¤ä½ ï¼"); replyMsg.setData(bundle); try &#123; client.send(replyMsg); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; break; default: super.handleMessage(msg); &#125; &#125; &#125; private Messenger mMessenger = new Messenger(new MessengerHandler()); @Nullable @Override public IBinder onBind(Intent intent) &#123; return mMessenger.getBinder(); &#125;&#125; å®¢æˆ·ç«¯è¿›ç¨‹ï¼šé¦–å…ˆç»‘å®šæœåŠ¡ç«¯ Service ï¼Œç»‘å®šæˆåŠŸä¹‹åŽç”¨æœåŠ¡ç«¯çš„ IBinder å¯¹è±¡åˆ›å»ºä¸€ä¸ª Messenger ï¼Œé€šè¿‡è¿™ä¸ª Messenger å°±å¯ä»¥å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†ï¼Œæ¶ˆæ¯ç±»åž‹æ˜¯ Message ã€‚å¦‚æžœéœ€è¦æœåŠ¡ç«¯å“åº”ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸€ä¸ª Handler å¹¶é€šè¿‡å®ƒæ¥åˆ›å»ºä¸€ä¸ª Messengerï¼ˆå’ŒæœåŠ¡ç«¯ä¸€æ ·ï¼‰ï¼Œå¹¶é€šè¿‡ Message çš„ replyTo å‚æ•°ä¼ é€’ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯é€šè¿‡ Message çš„ replyTo å‚æ•°å°±å¯ä»¥å›žåº”å®¢æˆ·ç«¯äº†ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485public class MainActivity extends AppCompatActivity &#123; private static final String TAG = MainActivity.class.getSimpleName(); private Messenger mGetReplyMessenger = new Messenger(new MessageHandler()); private Messenger mService; private class MessageHandler extends Handler &#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case Constants.MSG_FROM_SERVICE: Log.d(TAG, "received msg form service: msg = [" + msg.getData().getString(Constants.MSG_KEY) + "]"); Toast.makeText(MainActivity.this, "received msg form service: msg = [" + msg.getData().getString(Constants.MSG_KEY) + "]", Toast.LENGTH_SHORT).show(); break; default: super.handleMessage(msg); &#125; &#125; &#125; @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); &#125; public void bindService(View v) &#123; Intent mIntent = new Intent(this, MessengerService.class); bindService(mIntent, mServiceConnection, Context.BIND_AUTO_CREATE); &#125; public void sendMessage(View v) &#123; Message msg = Message.obtain(null,Constants.MSG_FROM_CLIENT); Bundle data = new Bundle(); data.putString(Constants.MSG_KEY, "Hello! This is client."); msg.setData(data); msg.replyTo = mGetReplyMessenger; try &#123; mService.send(msg); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; @Override protected void onDestroy() &#123; unbindService(mServiceConnection); super.onDestroy(); &#125; private ServiceConnection mServiceConnection = new ServiceConnection() &#123; /** * @param name * @param service */ @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; mService = new Messenger(service); Message msg = Message.obtain(null,Constants.MSG_FROM_CLIENT); Bundle data = new Bundle(); data.putString(Constants.MSG_KEY, "Hello! This is client."); msg.setData(data); // msg.replyTo = mGetReplyMessenger; try &#123; mService.send(msg); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; /** * @param name */ @Override public void onServiceDisconnected(ComponentName name) &#123; &#125; &#125;;&#125; æ³¨æ„ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡æ‹¿åˆ°å¯¹æ–¹çš„ Messenger æ¥å‘é€ Message çš„ã€‚åªä¸è¿‡å®¢æˆ·ç«¯é€šè¿‡ bindService onServiceConnected è€ŒæœåŠ¡ç«¯é€šè¿‡ message.replyTo æ¥èŽ·å¾—å¯¹æ–¹çš„ Messenger ã€‚Messenger ä¸­æœ‰ä¸€ä¸ª Hanlder ä»¥ä¸²è¡Œçš„æ–¹å¼å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ä¸å­˜åœ¨å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬ä¸ç”¨è€ƒè™‘çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚ å›¾ç‰‡æ¥è‡ªã€ŠAndroid å¼€å‘è‰ºæœ¯æŽ¢ç´¢ã€‹ ä½¿ç”¨ AIDLMessenger æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯ï¼Œå¦‚æžœå¤§é‡æ¶ˆæ¯åŒæ—¶å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åªèƒ½ä¸€ä¸ªä¸€ä¸ªå¤„ç†ï¼Œæ‰€ä»¥å¤§é‡å¹¶å‘è¯·æ±‚å°±ä¸é€‚åˆç”¨ Messenger ï¼Œè€Œä¸” Messenger åªé€‚åˆä¼ é€’æ¶ˆæ¯ï¼Œä¸èƒ½è·¨è¿›ç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•ã€‚AIDL å¯ä»¥è§£å†³å¹¶å‘å’Œè·¨è¿›ç¨‹è°ƒç”¨æ–¹æ³•çš„é—®é¢˜ï¼Œè¦çŸ¥é“ Messenger æœ¬è´¨ä¸Šä¹Ÿæ˜¯ AIDL ï¼Œåªä¸è¿‡ç³»ç»Ÿåšäº†å°è£…æ–¹ä¾¿ä¸Šå±‚çš„è°ƒç”¨è€Œå·²ã€‚ AIDL æ–‡ä»¶æ”¯æŒçš„æ•°æ®ç±»åž‹ åŸºæœ¬æ•°æ®ç±»åž‹ï¼› String å’Œ CharSequence ArrayList ï¼Œé‡Œé¢çš„å…ƒç´ å¿…é¡»èƒ½å¤Ÿè¢« AIDL æ”¯æŒï¼› HashMap ï¼Œé‡Œé¢çš„å…ƒç´ å¿…é¡»èƒ½å¤Ÿè¢« AIDL æ”¯æŒï¼› Parcelable ï¼Œå®žçŽ° Parcelable æŽ¥å£çš„å¯¹è±¡ï¼›æ³¨æ„ï¼šå¦‚æžœ AIDL æ–‡ä»¶ä¸­ç”¨åˆ°äº†è‡ªå®šä¹‰çš„ Parcelable å¯¹è±¡ï¼Œå¿…é¡»æ–°å»ºä¸€ä¸ªå’Œå®ƒåŒåçš„ AIDL æ–‡ä»¶ã€‚ AIDL ï¼ŒAIDL æŽ¥å£æœ¬èº«ä¹Ÿå¯ä»¥åœ¨ AIDL æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ æœåŠ¡ç«¯æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ª Service ç”¨æ¥ç›‘å¬å®¢æˆ·ç«¯çš„è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª AIDL æ–‡ä»¶ï¼Œå°†æš´éœ²ç»™å®¢æˆ·ç«¯çš„æŽ¥å£åœ¨è¿™ä¸ª AIDL æ–‡ä»¶ä¸­å£°æ˜Žï¼Œæœ€åŽåœ¨ Service ä¸­å®žçŽ°è¿™ä¸ª AIDL æŽ¥å£å³å¯ã€‚ å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡ç«¯çš„ Service ï¼Œç»‘å®šæˆåŠŸåŽï¼Œå°†æœåŠ¡ç«¯è¿”å›žçš„ Binder å¯¹è±¡è½¬æˆ AIDL æŽ¥å£æ‰€å±žçš„ç±»åž‹ï¼Œç„¶åŽå°±å¯ä»¥è°ƒç”¨ AIDL ä¸­çš„æ–¹æ³•äº†ã€‚å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ–¹æ³•ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ Binder çº¿ç¨‹æ± ä¸­ï¼ŒåŒæ—¶å®¢æˆ·ç«¯çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå¦‚æžœæœåŠ¡ç«¯æ–¹æ³•æ‰§è¡Œæ¯”è¾ƒè€—æ—¶ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯çº¿ç¨‹é•¿æ—¶é—´é˜»å¡žï¼Œå¯¼è‡´ ANR ã€‚å®¢æˆ·ç«¯çš„ onServiceConnected å’Œ onServiceDisconnected æ–¹æ³•éƒ½åœ¨ UI çº¿ç¨‹ä¸­ã€‚ æœåŠ¡ç«¯è®¿é—®æƒé™ç®¡ç† ä½¿ç”¨ Permission éªŒè¯ï¼Œåœ¨ manifest ä¸­å£°æ˜Ž 123&lt;permission android:name="com.jc.ipc.ACCESS_BOOK_SERVICE" android:protectionLevel="normal"/&gt;&lt;uses-permission android:name="com.jc.ipc.ACCESS_BOOK_SERVICE"/&gt; æœåŠ¡ç«¯ onBinder æ–¹æ³•ä¸­ 123456789public IBinder onBind(Intent intent) &#123; //Permission æƒé™éªŒè¯ int check = checkCallingOrSelfPermission("com.jc.ipc.ACCESS_BOOK_SERVICE"); if (check == PackageManager.PERMISSION_DENIED) &#123; return null; &#125; return mBinder;&#125; Pid Uid éªŒè¯ è¯¦ç»†ä»£ç ï¼š1234// Book.aidlpackage com.jc.ipc.aidl;parcelable Book; 123456789101112131415161718192021// IBookManager.aidlpackage com.jc.ipc.aidl;import com.jc.ipc.aidl.Book;import com.jc.ipc.aidl.INewBookArrivedListener;// AIDL æŽ¥å£ä¸­åªæ”¯æŒæ–¹æ³•ï¼Œä¸æ”¯æŒé™æ€å¸¸é‡ï¼ŒåŒºåˆ«äºŽä¼ ç»Ÿçš„æŽ¥å£interface IBookManager &#123; List&lt;Book&gt; getBookList(); // AIDL ä¸­é™¤äº†åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œå…¶ä»–æ•°æ®ç±»åž‹å¿…é¡»æ ‡ä¸Šæ–¹å‘,in,out æˆ–è€… inout // in è¡¨ç¤ºè¾“å…¥åž‹å‚æ•° // out è¡¨ç¤ºè¾“å‡ºåž‹å‚æ•° // inout è¡¨ç¤ºè¾“å…¥è¾“å‡ºåž‹å‚æ•° void addBook(in Book book); void registerListener(INewBookArrivedListener listener); void unregisterListener(INewBookArrivedListener listener);&#125; 123456789// INewBookArrivedListener.aidlpackage com.jc.ipc.aidl;import com.jc.ipc.aidl.Book;// æé†’å®¢æˆ·ç«¯æ–°ä¹¦åˆ°æ¥interface INewBookArrivedListener &#123; void onNewBookArrived(in Book newBook);&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class BookManagerActivity extends AppCompatActivity &#123; private static final String TAG = BookManagerActivity.class.getSimpleName(); private static final int MSG_NEW_BOOK_ARRIVED = 0x10; private Button getBookListBtn,addBookBtn; private TextView displayTextView; private IBookManager bookManager; private Handler mHandler = new Handler()&#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case MSG_NEW_BOOK_ARRIVED: Log.d(TAG, "handleMessage: new book arrived " + msg.obj); Toast.makeText(BookManagerActivity.this, "new book arrived " + msg.obj, Toast.LENGTH_SHORT).show(); break; default: super.handleMessage(msg); &#125; &#125; &#125;; private ServiceConnection mServiceConn = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; bookManager = IBookManager.Stub.asInterface(service); try &#123; bookManager.registerListener(listener); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; @Override public void onServiceDisconnected(ComponentName name) &#123; &#125; &#125;; private INewBookArrivedListener listener = new INewBookArrivedListener.Stub() &#123; @Override public void onNewBookArrived(Book newBook) throws RemoteException &#123; mHandler.obtainMessage(MSG_NEW_BOOK_ARRIVED, newBook).sendToTarget(); &#125; &#125;; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.book_manager); displayTextView = (TextView) findViewById(R.id.displayTextView); Intent intent = new Intent(this, BookManagerService.class); bindService(intent, mServiceConn, BIND_AUTO_CREATE); &#125; public void getBookList(View view) &#123; try &#123; List&lt;Book&gt; list = bookManager.getBookList(); Log.d(TAG, "getBookList: " + list.toString()); displayTextView.setText(list.toString()); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; public void addBook(View view) &#123; try &#123; bookManager.addBook(new Book(3, "å¤©é¾™å…«éƒ¨")); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; @Override protected void onDestroy() &#123; if (bookManager != null &amp;&amp; bookManager.asBinder().isBinderAlive()) &#123; Log.d(TAG, "unregister listener " + listener); try &#123; bookManager.unregisterListener(listener); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; unbindService(mServiceConn); super.onDestroy(); &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101public class BookManagerService extends Service &#123; private static final String TAG = BookManagerService.class.getSimpleName(); // CopyOnWriteArrayList æ”¯æŒå¹¶å‘è¯»å†™ï¼Œå®žçŽ°è‡ªåŠ¨çº¿ç¨‹åŒæ­¥ï¼Œä»–ä¸æ˜¯ç»§æ‰¿è‡ª ArrayList private CopyOnWriteArrayList&lt;Book&gt; mBookList = new CopyOnWriteArrayList&lt;Book&gt;(); //å¯¹è±¡æ˜¯ä¸èƒ½è·¨è¿›ç¨‹ä¼ è¾“çš„ï¼Œå¯¹è±¡çš„è·¨è¿›ç¨‹ä¼ è¾“æœ¬è´¨éƒ½æ˜¯ååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼ŒBinder ä¼šæŠŠå®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„å¯¹è±¡é‡æ–°è½¬åŒ–ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ //RemoteCallbackList æ˜¯ç³»ç»Ÿä¸“é—¨æä¾›çš„ç”¨äºŽåˆ é™¤ç³»ç»Ÿè·¨è¿›ç¨‹ listener çš„æŽ¥å£ï¼Œåˆ©ç”¨åº•å±‚çš„ Binder å¯¹è±¡æ˜¯åŒä¸€ä¸ª //RemoteCallbackList ä¼šåœ¨å®¢æˆ·ç«¯è¿›ç¨‹ç»ˆæ­¢åŽï¼Œè‡ªåŠ¨æº¢å‡ºå®¢æˆ·ç«¯æ³¨å†Œçš„ listener ï¼Œå†…éƒ¨è‡ªåŠ¨å®žçŽ°äº†çº¿ç¨‹åŒæ­¥åŠŸèƒ½ã€‚ private RemoteCallbackList&lt;INewBookArrivedListener&gt; mListeners = new RemoteCallbackList&lt;&gt;(); private AtomicBoolean isServiceDestroied = new AtomicBoolean(false); private Binder mBinder = new IBookManager.Stub() &#123; @Override public List&lt;Book&gt; getBookList() throws RemoteException &#123; return mBookList; &#125; @Override public void addBook(Book book) throws RemoteException &#123; Log.d(TAG, "addBook: " + book.toString()); mBookList.add(book); &#125; @Override public void registerListener(INewBookArrivedListener listener) throws RemoteException &#123; mListeners.register(listener); &#125; @Override public void unregisterListener(INewBookArrivedListener listener) throws RemoteException &#123; mListeners.unregister(listener); &#125; &#125;; @Override public void onCreate() &#123; super.onCreate(); mBookList.add(new Book(1, "è€äººä¸Žæµ·")); mBookList.add(new Book(2, "å“ˆå§†é›·ç‰¹")); new Thread(new ServiceWorker()).start(); &#125; private void onNewBookArrived(Book book) throws RemoteException &#123; mBookList.add(book); int count = mListeners.beginBroadcast(); for (int i = 0; i &lt; count; i++) &#123; INewBookArrivedListener listener = mListeners.getBroadcastItem(i); if (listener != null) &#123; listener.onNewBookArrived(book); &#125; &#125; mListeners.finishBroadcast(); &#125; private class ServiceWorker implements Runnable &#123; @Override public void run() &#123; while (!isServiceDestroied.get()) &#123; try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; int bookId = mBookList.size() +1; Book newBook = new Book(bookId, "new book # " + bookId); try &#123; onNewBookArrived(newBook); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; @Nullable @Override public IBinder onBind(Intent intent) &#123; //Permission æƒé™éªŒè¯ int check = checkCallingOrSelfPermission("com.jc.ipc.ACCESS_BOOK_SERVICE"); if (check == PackageManager.PERMISSION_DENIED) &#123; return null; &#125; return mBinder; &#125; @Override public void onDestroy() &#123; isServiceDestroied.set(true); super.onDestroy(); &#125;&#125; ä½¿ç”¨ ContentProviderç”¨äºŽä¸åŒåº”ç”¨é—´æ•°æ®å…±äº«ï¼Œå’Œ Messenger åº•å±‚å®žçŽ°åŒæ ·æ˜¯ Binder å’Œ AIDLï¼Œç³»ç»Ÿåšäº†å°è£…ï¼Œä½¿ç”¨ç®€å•ã€‚ç³»ç»Ÿé¢„ç½®äº†è®¸å¤š ContentProvider ï¼Œå¦‚é€šè®¯å½•ã€æ—¥ç¨‹è¡¨ï¼Œéœ€è¦è·¨è¿›ç¨‹è®¿é—®ã€‚ä½¿ç”¨æ–¹æ³•ï¼šç»§æ‰¿ ContentProvider ç±»å®žçŽ° 6 ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™å…­ä¸ªæ–¹æ³•å‡è¿è¡Œåœ¨ ContentProvider è¿›ç¨‹ä¸­ï¼Œé™¤ onCreate è¿è¡Œåœ¨ä¸»çº¿ç¨‹é‡Œï¼Œå…¶ä»–äº”ä¸ªæ–¹æ³•å‡ç”±å¤–ç•Œå›žè°ƒè¿è¡Œåœ¨ Binder çº¿ç¨‹æ± ä¸­ã€‚ ContentProvider çš„åº•å±‚æ•°æ®ï¼Œå¯ä»¥æ˜¯ SQLite æ•°æ®åº“ï¼Œå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…å­˜ä¸­çš„æ•°æ®ã€‚ è¯¦è§ä»£ç ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119public class BookProvider extends ContentProvider &#123; private static final String TAG = "BookProvider"; public static final String AUTHORITY = "com.jc.ipc.Book.Provider"; public static final Uri BOOK_CONTENT_URI = Uri.parse("content://" + AUTHORITY + "/book"); public static final Uri USER_CONTENT_URI = Uri.parse("content://" + AUTHORITY + "/user"); public static final int BOOK_URI_CODE = 0; public static final int USER_URI_CODE = 1; private static final UriMatcher sUriMatcher = new UriMatcher(UriMatcher.NO_MATCH); static &#123; sUriMatcher.addURI(AUTHORITY, "book", BOOK_URI_CODE); sUriMatcher.addURI(AUTHORITY, "user", USER_URI_CODE); &#125; private Context mContext; private SQLiteDatabase mDB; @Override public boolean onCreate() &#123; mContext = getContext(); initProviderData(); return true; &#125; private void initProviderData() &#123; //ä¸å»ºè®®åœ¨ UI çº¿ç¨‹ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ mDB = new DBOpenHelper(mContext).getWritableDatabase(); mDB.execSQL("delete from " + DBOpenHelper.BOOK_TABLE_NAME); mDB.execSQL("delete from " + DBOpenHelper.USER_TABLE_NAME); mDB.execSQL("insert into book values(3,'Android');"); mDB.execSQL("insert into book values(4,'iOS');"); mDB.execSQL("insert into book values(5,'Html5');"); mDB.execSQL("insert into user values(1,'haohao',1);"); mDB.execSQL("insert into user values(2,'nannan',0);"); &#125; @Nullable @Override public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) &#123; Log.d(TAG, "query, current thread"+ Thread.currentThread()); String table = getTableName(uri); if (table == null) &#123; throw new IllegalArgumentException("Unsupported URI" + uri); &#125; return mDB.query(table, projection, selection, selectionArgs, null, null, sortOrder, null); &#125; @Nullable @Override public String getType(Uri uri) &#123; Log.d(TAG, "getType"); return null; &#125; @Nullable @Override public Uri insert(Uri uri, ContentValues values) &#123; Log.d(TAG, "insert"); String table = getTableName(uri); if (table == null) &#123; throw new IllegalArgumentException("Unsupported URI" + uri); &#125; mDB.insert(table, null, values); // é€šçŸ¥å¤–ç•Œ ContentProvider ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ– mContext.getContentResolver().notifyChange(uri, null); return uri; &#125; @Override public int delete(Uri uri, String selection, String[] selectionArgs) &#123; Log.d(TAG, "delete"); String table = getTableName(uri); if (table == null) &#123; throw new IllegalArgumentException("Unsupported URI" + uri); &#125; int count = mDB.delete(table, selection, selectionArgs); if (count &gt; 0) &#123; mContext.getContentResolver().notifyChange(uri, null); &#125; return count; &#125; @Override public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) &#123; Log.d(TAG, "update"); String table = getTableName(uri); if (table == null) &#123; throw new IllegalArgumentException("Unsupported URI" + uri); &#125; int row = mDB.update(table, values, selection, selectionArgs); if (row &gt; 0) &#123; getContext().getContentResolver().notifyChange(uri, null); &#125; return row; &#125; private String getTableName(Uri uri) &#123; String tableName = null; switch (sUriMatcher.match(uri)) &#123; case BOOK_URI_CODE: tableName = DBOpenHelper.BOOK_TABLE_NAME; break; case USER_URI_CODE: tableName = DBOpenHelper.USER_TABLE_NAME; break; default: break; &#125; return tableName; &#125;&#125; 123456789101112131415161718192021222324252627282930313233public class DBOpenHelper extends SQLiteOpenHelper &#123; private static final String DB_NAME = "book_provider.db"; public static final String BOOK_TABLE_NAME = "book"; public static final String USER_TABLE_NAME = "user"; private static final int DB_VERSION = 1; private String CREATE_BOOK_TABLE = "CREATE TABLE IF NOT EXISTS " + BOOK_TABLE_NAME + "(_id INTEGER PRIMARY KEY," + "name TEXT)"; private String CREATE_USER_TABLE = "CREATE TABLE IF NOT EXISTS " + USER_TABLE_NAME + "(_id INTEGER PRIMARY KEY," + "name TEXT," + "sex INT)"; public DBOpenHelper(Context context) &#123; super(context, DB_NAME, null, DB_VERSION); &#125; @Override public void onCreate(SQLiteDatabase db) &#123; db.execSQL(CREATE_BOOK_TABLE); db.execSQL(CREATE_USER_TABLE); &#125; @Override public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) &#123; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677public class ProviderActivity extends AppCompatActivity &#123; private static final String TAG = ProviderActivity.class.getSimpleName(); private TextView displayTextView; private Handler mHandler; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_provider); displayTextView = (TextView) findViewById(R.id.displayTextView); mHandler = new Handler(); getContentResolver().registerContentObserver(BookProvider.BOOK_CONTENT_URI, true, new ContentObserver(mHandler) &#123; @Override public boolean deliverSelfNotifications() &#123; return super.deliverSelfNotifications(); &#125; @Override public void onChange(boolean selfChange) &#123; super.onChange(selfChange); &#125; @Override public void onChange(boolean selfChange, Uri uri) &#123; Toast.makeText(ProviderActivity.this, uri.toString(), Toast.LENGTH_SHORT).show(); super.onChange(selfChange, uri); &#125; &#125;); &#125; public void insert(View v) &#123; ContentValues values = new ContentValues(); values.put("_id",1123); values.put("name", "ä¸‰å›½æ¼”ä¹‰"); getContentResolver().insert(BookProvider.BOOK_CONTENT_URI, values); &#125; public void delete(View v) &#123; getContentResolver().delete(BookProvider.BOOK_CONTENT_URI, "_id = 4", null); &#125; public void update(View v) &#123; ContentValues values = new ContentValues(); values.put("_id",1123); values.put("name", "ä¸‰å›½æ¼”ä¹‰æ–°ç‰ˆ"); getContentResolver().update(BookProvider.BOOK_CONTENT_URI, values , "_id = 1123", null); &#125; public void query(View v) &#123; Cursor bookCursor = getContentResolver().query(BookProvider.BOOK_CONTENT_URI, new String[]&#123;"_id", "name"&#125;, null, null, null); StringBuilder sb = new StringBuilder(); while (bookCursor.moveToNext()) &#123; Book book = new Book(bookCursor.getInt(0),bookCursor.getString(1)); sb.append(book.toString()).append("\n"); &#125; sb.append("--------------------------------").append("\n"); bookCursor.close(); Cursor userCursor = getContentResolver().query(BookProvider.USER_CONTENT_URI, new String[]&#123;"_id", "name", "sex"&#125;, null, null, null); while (userCursor.moveToNext()) &#123; sb.append(userCursor.getInt(0)) .append(userCursor.getString(1)).append(" ,") .append(userCursor.getInt(2)).append(" ,") .append("\n"); &#125; sb.append("--------------------------------"); userCursor.close(); displayTextView.setText(sb.toString()); &#125;&#125; ä½¿ç”¨ Socket Socketèµ·æºäºŽ Unixï¼Œè€Œ Unix åŸºæœ¬å“²å­¦ä¹‹ä¸€å°±æ˜¯â€œä¸€åˆ‡çš†æ–‡ä»¶â€ï¼Œéƒ½å¯ä»¥ç”¨â€œæ‰“å¼€ open â€“è¯»å†™ write/read â€“å…³é—­ close â€æ¨¡å¼æ¥æ“ä½œã€‚Socket å°±æ˜¯è¯¥æ¨¡å¼çš„ä¸€ä¸ªå®žçŽ°ï¼Œç½‘ç»œçš„ Socket æ•°æ®ä¼ è¾“æ˜¯ä¸€ç§ç‰¹æ®Šçš„ I/Oï¼ŒSocket ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶æè¿°ç¬¦ã€‚Socket ä¹Ÿå…·æœ‰ä¸€ä¸ªç±»ä¼¼äºŽæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°è°ƒç”¨ï¼š Socket()ï¼Œè¯¥å‡½æ•°è¿”å›žä¸€ä¸ªæ•´åž‹çš„Socket æè¿°ç¬¦ï¼ŒéšåŽçš„è¿žæŽ¥å»ºç«‹ã€æ•°æ®ä¼ è¾“ç­‰æ“ä½œéƒ½æ˜¯é€šè¿‡è¯¥ Socket å®žçŽ°çš„ã€‚ å¸¸ç”¨çš„ Socket ç±»åž‹æœ‰ä¸¤ç§ï¼šæµå¼ Socketï¼ˆSOCK_STREAMï¼‰å’Œæ•°æ®æŠ¥å¼ Socketï¼ˆSOCK_DGRAMï¼‰ã€‚æµå¼æ˜¯ä¸€ç§é¢å‘è¿žæŽ¥çš„ Socketï¼Œé’ˆå¯¹äºŽé¢å‘è¿žæŽ¥çš„ TCP æœåŠ¡åº”ç”¨ï¼›æ•°æ®æŠ¥å¼ Socket æ˜¯ä¸€ç§æ— è¿žæŽ¥çš„ Socket ï¼Œå¯¹åº”äºŽæ— è¿žæŽ¥çš„ UDP æœåŠ¡åº”ç”¨ã€‚ Socket æœ¬èº«å¯ä»¥ä¼ è¾“ä»»æ„å­—èŠ‚æµã€‚ è°ˆåˆ°Socketï¼Œå°±å¿…é¡»è¦è¯´ä¸€è¯´ TCP/IP äº”å±‚ç½‘ç»œæ¨¡åž‹ï¼š åº”ç”¨å±‚ï¼šè§„å®šåº”ç”¨ç¨‹åºçš„æ•°æ®æ ¼å¼ï¼Œä¸»è¦çš„åè®® HTTPï¼ŒFTPï¼ŒWebSocketï¼ŒPOP3 ç­‰ï¼› ä¼ è¾“å±‚ï¼šå»ºç«‹â€œç«¯å£åˆ°ç«¯å£â€ çš„é€šä¿¡ï¼Œä¸»è¦çš„åè®®ï¼šTCPï¼ŒUDPï¼› ç½‘ç»œå±‚ï¼šå»ºç«‹â€ä¸»æœºåˆ°ä¸»æœºâ€çš„é€šä¿¡ï¼Œä¸»è¦çš„åè®®ï¼šIPï¼ŒARP ï¼ŒIP åè®®çš„ä¸»è¦ä½œç”¨ï¼šä¸€ä¸ªæ˜¯ä¸ºæ¯ä¸€å°è®¡ç®—æœºåˆ†é… IP åœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯ç¡®å®šå“ªäº›åœ°å€åœ¨åŒä¸€å­ç½‘ï¼› æ•°æ®é“¾è·¯å±‚ï¼šç¡®å®šç”µä¿¡å·çš„åˆ†ç»„æ–¹å¼ï¼Œä¸»è¦çš„åè®®ï¼šä»¥å¤ªç½‘åè®®ï¼› ç‰©ç†å±‚ï¼šè´Ÿè´£ç”µä¿¡å·çš„ä¼ è¾“ã€‚ Socket æ˜¯è¿žæŽ¥åº”ç”¨å±‚ä¸Žä¼ è¾“å±‚ä¹‹é—´æŽ¥å£ï¼ˆAPIï¼‰ã€‚ å›¾ç‰‡æ¥è‡ªç½‘ç»œ åªå®žçŽ° TCP Socket ã€‚Client ç«¯ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122public class TCPClientActivity extends AppCompatActivity implements View.OnClickListener&#123; private static final String TAG = "TCPClientActivity"; public static final int MSG_RECEIVED = 0x10; public static final int MSG_READY = 0x11; private EditText editText; private TextView textView; private PrintWriter mPrintWriter; private Socket mClientSocket; private Button sendBtn; private StringBuilder stringBuilder; private Handler mHandler = new Handler()&#123; @Override public void handleMessage(Message msg) &#123; switch (msg.what) &#123; case MSG_READY: sendBtn.setEnabled(true); break; case MSG_RECEIVED: stringBuilder.append(msg.obj).append("\n"); textView.setText(stringBuilder.toString()); break; default: super.handleMessage(msg); &#125; &#125; &#125;; @Override protected void onCreate(@Nullable Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.tcp_client_activity); editText = (EditText) findViewById(R.id.editText); textView = (TextView) findViewById(R.id.displayTextView); sendBtn = (Button) findViewById(R.id.sendBtn); sendBtn.setOnClickListener(this); sendBtn.setEnabled(false); stringBuilder = new StringBuilder(); Intent intent = new Intent(TCPClientActivity.this, TCPServerService.class); startService(intent); new Thread()&#123; @Override public void run() &#123; connectTcpServer(); &#125; &#125;.start(); &#125; private String formatDateTime(long time) &#123; return new SimpleDateFormat("(HH:mm:ss)").format(new Date(time)); &#125; private void connectTcpServer() &#123; Socket socket = null; while (socket == null) &#123; try &#123; socket = new Socket("localhost", 8888); mClientSocket = socket; mPrintWriter = new PrintWriter(new BufferedWriter( new OutputStreamWriter(socket.getOutputStream()) ), true); mHandler.sendEmptyMessage(MSG_READY); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; // receive message BufferedReader bufferedReader = null; try &#123; bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream())); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; while (!isFinishing()) &#123; try &#123; String msg = bufferedReader.readLine(); if (msg != null) &#123; String time = formatDateTime(System.currentTimeMillis()); String showedMsg = "server " + time + ":" + msg + "\n"; mHandler.obtainMessage(MSG_RECEIVED, showedMsg).sendToTarget(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; @Override public void onClick(View v) &#123; if (mPrintWriter != null) &#123; String msg = editText.getText().toString(); mPrintWriter.println(msg); editText.setText(""); String time = formatDateTime(System.currentTimeMillis()); String showedMsg = "self " + time + ":" + msg + "\n"; stringBuilder.append(showedMsg); &#125; &#125; @Override protected void onDestroy() &#123; if (mClientSocket != null) &#123; try &#123; mClientSocket.shutdownInput(); mClientSocket.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; super.onDestroy(); &#125;&#125; Server ç«¯ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495public class TCPServerService extends Service &#123; private static final String TAG = "TCPServerService"; private boolean isServiceDestroyed = false; private String[] mMessages = new String[]&#123; "Hello! Body!", "ç”¨æˆ·ä¸åœ¨çº¿ï¼è¯·ç¨åŽå†è”ç³»ï¼", "è¯·é—®ä½ å«ä»€ä¹ˆåå­—å‘€ï¼Ÿ", "åŽ‰å®³äº†ï¼Œæˆ‘çš„å“¥ï¼", "Google ä¸éœ€è¦ç§‘å­¦ä¸Šç½‘æ˜¯çœŸçš„å—ï¼Ÿ", "æ‰Žå¿ƒäº†ï¼Œè€é“ï¼ï¼ï¼" &#125;; @Override public void onCreate() &#123; new Thread(new TCPServer()).start(); super.onCreate(); &#125; @Override public void onDestroy() &#123; isServiceDestroyed = true; super.onDestroy(); &#125; @Nullable @Override public IBinder onBind(Intent intent) &#123; return null; &#125; private class TCPServer implements Runnable &#123; @Override public void run() &#123; ServerSocket serverSocket = null; try &#123; serverSocket = new ServerSocket(8888); &#125; catch (IOException e) &#123; e.printStackTrace(); return; &#125; while (!isServiceDestroyed) &#123; // receive request from client try &#123; final Socket client = serverSocket.accept(); Log.d(TAG, "=============== accept =================="); new Thread()&#123; @Override public void run() &#123; try &#123; responseClient(client); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;.start(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; private void responseClient(Socket client) throws IOException &#123; //receive message BufferedReader in = new BufferedReader( new InputStreamReader(client.getInputStream())); //send message PrintWriter out = new PrintWriter( new BufferedWriter( new OutputStreamWriter( client.getOutputStream())),true); out.println("æ¬¢è¿Žæ¥åˆ°èŠå¤©å®¤ï¼"); while (!isServiceDestroyed) &#123; String str = in.readLine(); Log.d(TAG, "message from client: " + str); if (str == null) &#123; return; &#125; Random random = new Random(); int index = random.nextInt(mMessages.length); String msg = mMessages[index]; out.println(msg); Log.d(TAG, "send Message: " + msg); &#125; out.close(); in.close(); client.close(); &#125;&#125; æ¼”ç¤ºï¼š UDP Socket å¯ä»¥è‡ªå·±å°è¯•ç€å®žçŽ°ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼]]></title>
      <url>%2F2017%2F04%2F22%2FAndroid-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%2F</url>
      <content type="text"><![CDATA[åªä¸ºåˆå¿ƒ ä¸€ä¸ªä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œå¿…é¡»å…·å¤‡ä¸¤ç§èƒ½åŠ›ï¼š å­¦ä¹ èƒ½åŠ› æ—¶é—´ç®¡ç†èƒ½åŠ› Android å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªåº”ç”¨è‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚è¿›ç¨‹ç‹¬äº«å†…å­˜èµ„æºï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥çœ‹ä½œä¸€ä¸ª JVM ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåŽï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸€èˆ¬ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ã€‚åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹å…±äº«å†…å­˜èµ„æºï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æŽ‰å°±å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æ­»æŽ‰ã€‚è¡Œäº†ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹å°±æ‰¯å«©å¿™å¤šã€‚Android æä¾›äº†å››ç§å¸¸ç”¨çš„å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼ï¼š AsyncTask å¼‚æ­¥æ¶ˆæ¯æœºåˆ¶ IntentService ThreadPoolExcutor AsyncTaskæˆ‘ä»¬çš„è€æœ‹å‹ AsyncTask ç±»ï¼Œå®ƒæ˜¯å°è£…å¥½çš„çº¿ç¨‹æ± ï¼Œæ“ä½œ UI çº¿ç¨‹æžå…¶æ–¹ä¾¿ã€‚ çž…ä¸€çœ¼ï¼ŒAsyncTask çš„ä¸‰ä¸ªæ³›åž‹å‚æ•°ï¼š public abstract class AsyncTask&lt;Params, Progress, Result&gt; params ï¼Œä¼ å…¥å‚æ•°ç±»åž‹ï¼Œå³ doInBackground() æ–¹æ³•ä¸­çš„å‚æ•°ç±»åž‹; Progress ï¼Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­è¿”å›žçš„ä»»åŠ¡æ‰§è¡Œè¿›åº¦ç±»åž‹ï¼Œå³ publishProgress() å’ŒonProgressUpdate() æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°ç±»åž‹ï¼› Result ï¼Œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œè¿”å›žçš„ç»“æžœç±»åž‹ï¼Œå³ doInBackground() æ–¹æ³•ä¸­è¿”å›žå€¼çš„ç±»åž‹ã€‚ å››ä¸ªå›žè°ƒæ–¹æ³•ï¼š onPreExecute()ï¼Œåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚ doInBackground()ï¼Œåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œè¯¥æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­å¯ä»¥è°ƒç”¨ publishProgress() æ›´æ–°ä»»åŠ¡è¿›åº¦ã€‚ onProgressUpdate()ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œåœ¨ publishProgress() è°ƒç”¨ä¹‹åŽè¢«å›žè°ƒï¼Œå±•ç¤ºä»»åŠ¡è¿›åº¦ã€‚ onPostExecute()ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡ç»“æŸåŽï¼Œå›žè°ƒæ­¤æ–¹æ³•ï¼Œå¤„ç†è¿”å›žç»“æžœã€‚ æ³¨æ„ï¼š å½“ AsyncTask ä»»åŠ¡è¢«å–æ¶ˆæ—¶ï¼Œå›žè°ƒ onCanceled(obj) ï¼Œæ­¤æ—¶ onPostExecute()ï¼Œä¸ä¼šè¢«è°ƒç”¨ï¼ŒAsyncTask ä¸­çš„ cancel() æ–¹æ³•å¹¶ä¸æ˜¯çœŸæ­£åŽ»å–æ¶ˆä»»åŠ¡ï¼Œåªæ˜¯è®¾ç½®è¿™ä¸ªä»»åŠ¡ä¸ºå–æ¶ˆçŠ¶æ€ï¼Œéœ€è¦åœ¨ doInBackground() ä¸­é€šè¿‡ isCancelled() åˆ¤æ–­ç»ˆæ­¢ä»»åŠ¡ã€‚ AsyncTask å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå®žä¾‹ï¼Œexecute() æ–¹æ³•ä¹Ÿå¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ã€‚ æ¯ä¸ª AsyncTask å®žä¾‹åªèƒ½æ‰§è¡Œä¸€æ¬¡ execute() ï¼Œå¤šæ¬¡æ‰§è¡Œä¼šæŠ¥é”™ï¼Œå¦‚éœ€æ‰§è¡Œå¤šæ¬¡ï¼Œåˆ™éœ€åˆ›å»ºå¤šä¸ªå®žä¾‹ã€‚ Android 3.0 ä¹‹åŽï¼Œ AsyncTask å¯¹è±¡é»˜è®¤æ‰§è¡Œå¤šä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œå³ mAsyncTask.execute() ï¼Œå¹¶å‘æ‰§è¡Œçš„è¯éœ€è¦ä½¿ç”¨ executeOnExecutor() ã€‚ AsyncTask ç”¨çš„æ˜¯çº¿ç¨‹æ± æœºåˆ¶å’Œå¼‚æ­¥æ¶ˆæ¯æœºåˆ¶ï¼ˆåŸºäºŽ ThreadPoolExecutor å’Œ Handler ï¼‰ã€‚Android 2.3 ä»¥å‰ï¼ŒAsyncTask çº¿ç¨‹æ± å®¹é‡æ˜¯ 128 ï¼Œå…¨å±€çº¿ç¨‹æ± åªæœ‰ 5 ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æžœè¿ç”¨ AsyncTask å¯¹è±¡æ¥æ‰§è¡Œå¤šä¸ªå¹¶å‘å¼‚æ­¥ä»»åŠ¡ï¼Œé‚£ä¹ˆåŒä¸€æ—¶é—´æœ€å¤šåªèƒ½æœ‰ 5 ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå…¶ä»–çº¿ç¨‹å°†è¢«é˜»å¡žã€‚Android 3.0 ä¹‹åŽ Google åˆè¿›è¡Œäº†è°ƒæ•´ï¼Œæ–°å¢žæŽ¥å£ executeOnExecutor() ï¼Œå…è®¸è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼ˆé‚£ä¹ˆæ ¸å¿ƒçº¿ç¨‹æ•°ä»¥åŠçº¿ç¨‹å®¹é‡ä¹Ÿå¯è‡ªå®šä¹‰ï¼‰ï¼Œå¹¶æä¾›äº† SERIAL_EXECUTOR å’Œ THREAD_POOL_EXECUTOR é¢„å®šä¹‰çº¿ç¨‹æ± ã€‚åŽæ¥ Google åˆåšäº†ä¸€äº›è°ƒæ•´ï¼ˆä»»ä½•äº‹ç‰©éƒ½ä¸å®Œç¾Žï¼‰ï¼Œå°†çº¿ç¨‹æ± çš„å®¹é‡ä¸Ž CPU çš„æ ¸å¿ƒæ•°è”ç³»èµ·æ¥ï¼Œå¦‚ç›®å‰ SDK 25 ç‰ˆæœ¬ä¸­ï¼Œé¢„å®šä¹‰çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡æœ€å°‘æœ‰ 2 ä¸ªï¼Œæœ€å¤š 4 ä¸ªï¼Œçº¿ç¨‹æ± å®¹é‡èŒƒå›´ 5 ~ 9 ã€‚æ”¹åŠ¨å¦‚ä¸‹ï¼š 1234private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();private static final int CORE_POOL_SIZE = Math.max(2, Math.min(CPU_COUNT - 1, 4));private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;private static final int KEEP_ALIVE_SECONDS = 30; å¼‚æ­¥æ¶ˆæ¯æœºåˆ¶å¼‚æ­¥æ¶ˆæ¯æœºåˆ¶çš„ä¸‰å¤§ä¸»è§’ï¼š Handler ï¼ŒMessage å’Œ Looper ã€‚Looper è´Ÿè´£åˆ›å»º MessageQueue æ¶ˆæ¯å¯¹åˆ—ï¼Œç„¶åŽè¿›å…¥ä¸€ä¸ªæ— é™ for å¾ªçŽ¯ä¸­ï¼Œä¸æ–­åœ°ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œå¦‚æžœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå½“å‰çº¿ç¨‹é˜»å¡žï¼ŒHandler è´Ÿè´£å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ã€‚ LooperLooper æœ‰ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼š prepare() å’Œ loop()ã€‚ prepare() ï¼Œ Looper ä¸Žå½“å‰çº¿ç¨‹ç»‘å®šï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ª Looper å®žä¾‹å’Œä¸€ä¸ª MessageQueue å®žä¾‹ã€‚ 12345678910111213public static final void prepare() &#123; if (sThreadLocal.get() != null) &#123; throw new RuntimeException("Only one Looper may be created per thread"); &#125; sThreadLocal.set(new Looper(true)); ä¿è¯ Looper å¯¹è±¡åœ¨å½“å‰çº¿ç¨‹å”¯ä¸€&#125;// Looper çš„æž„é€ æ–¹æ³•private Looper(boolean quitAllowed) &#123; mQueue = new MessageQueue(quitAllowed); mRun = true; mThread = Thread.currentThread();&#125; loop ï¼Œè¿›å…¥ä¸€ä¸ªæ— é™ for å¾ªçŽ¯ä½“ä¸­ï¼Œä¸æ–­åœ°ä»Žæ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯ï¼Œç„¶åŽäº¤ç»™æ¶ˆæ¯çš„ target å±žæ€§çš„ dispatchMessage æ–¹æ³•åŽ»å¤„ç†ã€‚ 123456789101112131415161718192021222324252627public static void loop() &#123; final Looper me = myLooper(); if (me == null) &#123; throw new RuntimeException("No Looper; Looper.prepare() wasn't called on this thread."); &#125; final MessageQueue queue = me.mQueue; // Make sure the identity of this thread is that of the local process, // and keep track of what that identity token actually is. Binder.clearCallingIdentity(); final long ident = Binder.clearCallingIdentity(); // æ— é™å¾ªçŽ¯ä½“ï¼Œæœ‰æ²¡æœ‰æƒ³è¿‡åœ¨ UI çº¿ç¨‹é‡Œï¼Œæœ‰è¿™æ ·ä¸€ä¸ªæ­»å¾ªçŽ¯ï¼Œä¸ºä»€ä¹ˆç•Œé¢æ²¡å¡æ­»ï¼Ÿï¼Ÿ // ç­”æ¡ˆæœ€åŽæ­æ™“ã€‚ for (;;) &#123; Message msg = queue.next(); // might block if (msg == null) &#123; // No message indicates that the message queue is quitting. return; &#125; msg.target.dispatchMessage(msg); msg.recycle(); &#125;&#125; HandlerHandler è´Ÿè´£å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ã€‚åœ¨ Activity ä¸­æˆ‘ä»¬ç›´æŽ¥å¯ä»¥ new Handler ï¼Œé‚£æ˜¯å› ä¸ºåœ¨ Activity çš„å¯åŠ¨ä»£ç ä¸­ï¼Œå·²ç»åœ¨å½“å‰ UI çº¿ç¨‹ä¸­è°ƒç”¨äº† Looper.prepare() å’Œ Looper.loop() æ–¹æ³•ã€‚ åœ¨å­çº¿ç¨‹ä¸­ new Handler å¿…é¡»è¦åœ¨å½“å‰çº¿ç¨‹ï¼ˆå­çº¿ç¨‹ï¼‰ä¸­åˆ›å»ºå¥½ Looper å¯¹è±¡å’Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»£ç å¦‚ä¸‹ 123456789101112//åœ¨å­çº¿ç¨‹ä¸­Looper.prepare();handler = new Handler() &#123; public void handleMessage(Message msg) &#123; //å¤„ç†æ¶ˆæ¯ &#125;;&#125;;Looper.loop(); ä¹‹åŽï¼Œä½ æ‹¿ç€è¿™ä¸ª Handler å¯¹è±¡å°±å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå¾€è¿™ä¸ªå­çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘æ¶ˆæ¯äº†ã€‚ HandlerThreadHandlerThread å¯ä»¥çœ‹ä½œåœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶çš„ç®€åŒ–ç‰ˆï¼ŒHandlerThread å¯¹è±¡è‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨å·¥ä½œçº¿ç¨‹é‡Œåˆ›å»º Looper å¯¹è±¡å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚ ä½¿ç”¨æ–¹æ³•ï¼š 12345678910mHandlerThread = new HandlerThread("MyHandlerThread");mHandlerThread.start();mHandler = new Handler(mHandlerThread.getLooper())&#123; @Override public void handleMessage(Message msg) &#123; //å¤„ç†æ¶ˆæ¯ &#125;&#125;; ä¹‹åŽä½ å°±å¯ä»¥ä½¿ç”¨ Handler å¯¹è±¡å¾€å·¥ä½œçº¿ç¨‹ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘æ¶ˆæ¯äº†ã€‚ çœ‹ä¸€ä¸‹æºç ç‰‡æ®µï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class HandlerThread extends Thread &#123; int mPriority; int mTid = -1; Looper mLooper; public HandlerThread(String name) &#123; super(name); mPriority = Process.THREAD_PRIORITY_DEFAULT; &#125; protected void onLooperPrepared() &#123; &#125; @Override public void run() &#123; mTid = Process.myTid(); Looper.prepare(); synchronized (this) &#123; mLooper = Looper.myLooper(); notifyAll(); &#125; Process.setThreadPriority(mPriority); onLooperPrepared(); Looper.loop(); mTid = -1; &#125; public Looper getLooper() &#123; if (!isAlive()) &#123; return null; &#125; // If the thread has been started, wait until the looper has been created. synchronized (this) &#123; while (isAlive() &amp;&amp; mLooper == null) &#123; try &#123; wait(); &#125; catch (InterruptedException e) &#123; &#125; &#125; &#125; return mLooper; &#125;&#125; æ³¨æ„ï¼šhandler åœ¨ UI çº¿ç¨‹ä¸­åˆå§‹åŒ–çš„ï¼Œlooper åœ¨ä¸€ä¸ªå­çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬å¿…é¡»ç­‰ mLooper åˆ›å»ºå®Œæˆä¹‹åŽï¼Œæ‰èƒ½è°ƒç”¨ getLooper ï¼Œæºç ä¸­æ˜¯é€šè¿‡ wait å’Œ notify è§£å†³ä¸¤ä¸ªçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ã€‚ IntentServiceIntentService å¯ä»¥çœ‹æˆæ˜¯ Service å’Œ HandlerThread çš„åˆä½“ã€‚å®ƒç»§æ‰¿è‡ª Service ï¼Œå¹¶å¯ä»¥å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ª WorkerThread æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åŽï¼ŒIntentService è‡ªåŠ¨åœæ­¢ã€‚ å¦‚æžœå¤šæ¬¡å¯åŠ¨ IntentService å‘¢ï¼Ÿ çœ‹åˆ° HandlerThread ï¼Œä½ å°±åº”è¯¥æƒ³åˆ°å¤šæ¬¡å¯åŠ¨ IntentService ,å°±æ˜¯å°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åŽåœ¨ onHandlerIntent å›žè°ƒæ–¹æ³•ä¸­ä¸²è¡Œæ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åŽè‡ªåŠ¨ç»“æŸã€‚ ä¸‹é¢å¯¹æºç è¿›è¡Œç®€å•çš„è§£æžï¼ŒIntentService æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879public abstract class IntentService extends Service &#123; private volatile Looper mServiceLooper; private volatile ServiceHandler mServiceHandler; private String mName; private boolean mRedelivery; private final class ServiceHandler extends Handler &#123; public ServiceHandler(Looper looper) &#123; super(looper); &#125; @Override public void handleMessage(Message msg) &#123; //onHandleIntent æ–¹æ³•åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰§è¡Œå®Œè°ƒç”¨ stopSelf() ç»“æŸæœåŠ¡ã€‚ onHandleIntent((Intent)msg.obj); stopSelf(msg.arg1); &#125; &#125; /** * Creates an IntentService. Invoked by your subclass's constructor. * * @param name Used to name the worker thread, important only for debugging. */ public IntentService(String name) &#123; super(); mName = name; &#125; /** * enabled == true æ—¶ï¼Œå¦‚æžœä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œå½“å‰è¿›ç¨‹å°±æ­»æŽ‰äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šä»¤å½“å‰è¿›ç¨‹é‡å¯ã€‚ * ä»»åŠ¡ä¼šè¢«é‡æ–°æ‰§è¡Œã€‚ */ public void setIntentRedelivery(boolean enabled) &#123; mRedelivery = enabled; &#125; @Override public void onCreate() &#123; super.onCreate(); // ä¸Šé¢å·²ç»è®²è¿‡ï¼ŒHandlerThread å¯¹è±¡ start ä¹‹åŽï¼Œä¼šåœ¨å·¥ä½œçº¿ç¨‹é‡Œåˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ— å’Œ Looper å¯¹è±¡ã€‚ HandlerThread thread = new HandlerThread("IntentService[" + mName + "]"); thread.start(); mServiceLooper = thread.getLooper(); // èŽ·å¾— Looper å¯¹è±¡åˆå§‹åŒ– Handler å¯¹è±¡ã€‚ mServiceHandler = new ServiceHandler(mServiceLooper); &#125; @Override public void onStart(@Nullable Intent intent, int startId) &#123; // IntentService æ¯æ¬¡å¯åŠ¨éƒ½ä¼šå¾€å·¥ä½œçº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ Message msg = mServiceHandler.obtainMessage(); msg.arg1 = startId; msg.obj = intent; mServiceHandler.sendMessage(msg); &#125; // å®˜æ–¹å»ºè®® IntentService onStartCommand æ–¹æ³•ä¸åº”è¯¥è¢«é‡å†™ï¼Œæ³¨æ„è¯¥æ–¹æ³•ä¼šè°ƒç”¨ onStart ã€‚ @Override public int onStartCommand(@Nullable Intent intent, int flags, int startId) &#123; onStart(intent, startId); return mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY; &#125; @Override public void onDestroy() &#123; //æœåŠ¡åœæ­¢ä¼šæ¸…é™¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œé™¤äº†å½“å‰æ‰§è¡Œçš„ä»»åŠ¡å¤–ï¼ŒåŽç»­çš„ä»»åŠ¡ä¸ä¼šè¢«æ‰§è¡Œã€‚ mServiceLooper.quit(); &#125; /** * ä¸å»ºè®®é€šè¿‡ bind å¯åŠ¨ IntentService ï¼Œå¦‚æžœé€šè¿‡ bind å¯åŠ¨ IntentService ï¼Œé‚£ä¹ˆ onHandlerIntent æ–¹æ³•ä¸ä¼šè¢«å›žè°ƒã€‚Activity ä¸Ž IntentService ä¹‹é—´çš„é€šä¿¡ä¸€èˆ¬é‡‡ç”¨å¹¿æ’­çš„æ–¹å¼ã€‚ */ @Override @Nullable public IBinder onBind(Intent intent) &#123; return null; &#125; /** * å­ç±»å¿…é¡»è¦å®žçŽ°ï¼Œæ‰§è¡Œå…·ä½“çš„å¼‚æ­¥ä»»åŠ¡é€»è¾‘ï¼Œç”± IntentService è‡ªåŠ¨å›žè°ƒã€‚ */ @WorkerThread protected abstract void onHandleIntent(@Nullable Intent intent);&#125; IntentService æºç å¾ˆå®¹æ˜“ç†è§£ï¼Œä½ ä¹Ÿå¯ä»¥å°±è‡ªå·±çš„åº”ç”¨åœºæ™¯å°è£…è‡ªå·±çš„ IntentService ã€‚ åœºæ™¯ æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¯åŠ¨ IntentService ï¼Œä»»åŠ¡å®Œæˆï¼ŒæœåŠ¡åœæ­¢ï¼› å¼‚æ­¥ä»»åŠ¡å®Œæˆå‰ï¼Œåœæ­¢ IntentService ï¼ŒæœåŠ¡åœæ­¢ï¼Œä½†ä»»åŠ¡è¿˜ä¼šæ‰§è¡Œå®Œæˆï¼Œå®ŒæˆåŽï¼Œå·¥ä½œçº¿ç¨‹ç»“æŸï¼› å¤šæ¬¡å¯åŠ¨ IntentService ï¼Œä»»åŠ¡ä¼šè¢«ä¸€æ¬¡ä¸²è¡Œæ‰§è¡Œï¼Œæ‰§è¡Œç»“æŸåŽï¼ŒæœåŠ¡åœæ­¢ï¼› å¤šæ¬¡å¯åŠ¨ IntentService ï¼Œåœ¨æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œåœæ­¢ IntentService ï¼ŒæœåŠ¡åœæ­¢ï¼Œé™¤äº†å½“å‰æ‰§è¡Œçš„ä»»åŠ¡å¤–ï¼ŒåŽç»­çš„ä»»åŠ¡ä¸ä¼šè¢«æ‰§è¡Œï¼› ThreadPoolExcutor å›¾ç‰‡æ¥è‡ª Jakob Jenkov åšå®¢ ThreadPoolç”¨æ¥ç®¡ç†ä¸€ç»„å·¥ä½œçº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—ï¼ˆ BlockingQueue ï¼‰ä¸­æŒæœ‰çš„ä»»åŠ¡ç­‰å¾…ç€è¢«çº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹æ‰§è¡Œã€‚ å¸¸ç”¨æž„é€ æ–¹æ³•ï¼š1234567ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor( int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue); corePoolSize æ ¸å¿ƒçº¿ç¨‹æ± å®¹é‡ï¼Œå³çº¿ç¨‹æ± ä¸­æ‰€ç»´æŒçº¿ç¨‹çš„æœ€ä½Žæ•°é‡ã€‚corePoolSize åˆå§‹å€¼ä¸º 0 ï¼Œå½“æœ‰æ–°ä»»åŠ¡åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ–°çš„çº¿ç¨‹å°†è¢«åˆ›å»ºï¼Œè¿™ä¸ªæ—¶å€™å³ä½¿çº¿ç¨‹æ± ä¸­å­˜åœ¨ç©ºé—²çº¿ç¨‹ï¼Œåªè¦å½“å‰çº¿ç¨‹æ•°å°äºŽ corePoolSize ï¼Œé‚£ä¹ˆæ–°çš„çº¿ç¨‹ä¾ç„¶è¢«åˆ›å»ºã€‚ maximumPoolSize çº¿ç¨‹æ± ä¸­æ‰€ç»´æŒçº¿ç¨‹çš„æœ€å¤§æ•°é‡ã€‚ keepAliveTime ç©ºé—²çº¿ç¨‹åœ¨æ²¡æœ‰æ–°ä»»åŠ¡åˆ°æ¥æ—¶çš„å­˜æ´»æ—¶é—´ã€‚ unit å‚æ•° keepAliveTime çš„æ—¶é—´å•ä½ã€‚ workQueue ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¿…é¡»æ˜¯ BlockingQueue ã€‚ ç®€å•ä½¿ç”¨åˆ›å»º ThreadFactory ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚1234567private static final ThreadFactory sThreadFactory = new ThreadFactory() &#123; private final AtomicInteger mCount = new AtomicInteger(1); public Thread newThread(Runnable r) &#123; return new Thread(r, "AsyncTask #" + mCount.getAndIncrement()); &#125;&#125;; åˆ›å»º ThreadPoolExecutor ã€‚1234567891011// æ ¹æ® CPU æ ¸å¿ƒæ•°ç¡®å®šçº¿ç¨‹æ± å®¹é‡ã€‚public static final int NUMBER_OF_CORES = Runtime.getRuntime().availableProcessors(); mThreadPoolExecutor = new ThreadPoolExecutor( NUMBER_OF_CORES * 2, NUMBER_OF_CORES * 2 + 1, 60L, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), backgroundPriorityThreadFactory); æ‰§è¡Œ123456789101112131415161718192021222324252627282930313233343536373839404142mThreadPoolExecutor.execute(new Runnable() &#123; @Override public void run() &#123; //do something &#125; &#125;);Future future = mThreadPoolExecutor.submit(new Runnable() &#123; @Override public void run() &#123; //do something &#125; &#125;);//ä»»åŠ¡å¯å–æ¶ˆfuture.cancel(true);Future&lt;Integer&gt; futureInt = mThreadPoolExecutor.submit(new Callable&lt;Integer&gt;() &#123; @override public Integer call() throws Exception &#123; return 0; &#125;&#125;);//èŽ·å–æ‰§è¡Œç»“æžœfutureInt.get();FutureTask&lt;Integer&gt; task = new FutureTask&lt;Integer&gt;(new Callable&lt;Integer&gt;()&#123; @override public Integer call() throws Exception &#123; return 0; &#125; &#125;);mThreadPoolExecutor.submit(task);task.get();]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android Clean æž¶æž„æµ…æž]]></title>
      <url>%2F2017%2F04%2F15%2FAndroid-Clean-%E6%9E%B6%E6%9E%84%E6%B5%85%E6%9E%90%2F</url>
      <content type="text"><![CDATA[æ­»ç£• Android æž¶æž„ä¹Ÿæ˜¯ä¸€ç§å¨±ä¹ Android å¸¸ç”¨çš„æž¶æž„ä¸»è¦æœ‰ MVCï¼ŒMVPï¼ŒMVVM ä»¥åŠ Clean ã€‚ä»¥ä¸Šæž¶æž„è®¾è®¡æ¨¡å¼æ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ä¹‹åˆ†ï¼Œå…³é”®è¦çœ‹å…·ä½“çš„åº”ç”¨åœºæ™¯ã€‚æ›´å¤šå…³äºŽ MVCï¼ŒMVP ä»¥åŠ MVVM ä»‹ç»å¯ä»¥å‚è€ƒMVC,MVP &amp; MVVM ä»€ä¹ˆæ˜¯ Clean æž¶æž„ï¼Ÿ Robert C. Martin (Uncle Bob) Clean æž¶æž„æ˜¯ç”± Uncle Bob åœ¨ 2012 å¹´å‘è¡¨çš„, é’ˆå¯¹ Web App çš„æž¶æž„è®¾è®¡ã€‚ Bobå¤§å”æ€»ç»“äº†å„ç§ç³»ç»Ÿæž¶æž„çš„å…±é€šä¹‹å¤„ä»¥åŠæœ€ç»ˆç›®æ ‡ï¼Œå¹¶æå‡ºåªéœ€ç§‰æŒåˆ†å±‚ä¸Žä¾èµ–è§„åˆ™çš„åŽŸåˆ™, æå‡ºäº† Clean æž¶æž„æ€æƒ³ã€‚ Clean æž¶æž„æµ…æžå•å‘ä¾èµ– å›¾ç‰‡æ¥è‡ª Robert C. Martin (Uncle Bob) Clean æž¶æž„å„å±‚ä¹‹é—´çš„ä¾èµ–æ˜¯å•å‘çš„ï¼Œåªèƒ½æ˜¯å¤–å±‚ä¾èµ–å†…å±‚ã€‚ MVP VS Clean å›¾ç‰‡æ¥è‡ª Google ä»Žä¸Šå›¾å¯ä»¥çœ‹åˆ° Clean æž¶æž„çš„ Android å®žçŽ°ï¼Œå®žé™…ä¸Šæ˜¯å¯¹ç›®å‰æ¯”è¾ƒæµè¡Œçš„ MVP æž¶æž„è¿›è¡Œæ”¹é€ ã€‚ MVP ä¹‹ View å’Œ Presenter å±‚ä½œä¸º Clean æž¶æž„çš„ Presentations Layer, æ–°å¢ž Domain Layer å¤„ç†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ã€‚MVP ä¸­çš„ Model å±‚åŠŸèƒ½è¢«å¼±åŒ–ï¼Œä½œä¸º Data Layer å¯¹å¤–åªæä¾›æŽ¥å£ï¼Œä¸å†æœ‰ä¸šåŠ¡é€»è¾‘ã€‚ ä¸€èˆ¬æ¥è¯´æ¯ä¸€å±‚éƒ½æœ‰ç‹¬ç«‹çš„æ•°æ®æ¨¡åž‹ã€‚ Clean ä¹‹ Presentation å±‚åŒ…å«å¦‚ä¸‹ç±»ï¼š Presenter å’Œ View å±‚ç›¸å…³ç±»ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ MVVP æž¶æž„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹é€ ã€‚ Mapper ç±»ï¼Œè´Ÿè´£å°† Domain å±‚çš„æ•°æ®æ¨¡åž‹è½¬æ¢ä¸º Presentation çš„æ•°æ®æ¨¡åž‹ã€‚ æœ¬å±‚çš„å¼‚å¸¸å°è£…ç±»ã€‚ Clean ä¹‹ Domain å±‚Domain å±‚ä¸ä¾èµ–äºŽ Android ç±»åº“å’Œç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥ç‹¬ç«‹åšå•å…ƒæµ‹è¯•ã€‚ åŒ…å«å¦‚ä¸‹ç±»ï¼š Use Cases (Interactorï¼‰ç±»ï¼Œè´Ÿè´£å®Œæˆå¯¹ Data å±‚çš„æŸä¸€æ“ä½œè¡Œä¸ºã€‚ï¼ˆå¦‚èŽ·å– movie list ,èŽ·å–æŸä¸€ movie çš„ detail info å¯è§†ä¸º 2 ä¸ª Use Case æˆ– Interactorï¼‰ã€‚ Mapper ç±»ï¼Œè´Ÿè´£å°† Data å±‚çš„æ•°æ®æ¨¡åž‹è½¬æ¢ä¸º Domain å±‚çš„æ•°æ®æ¨¡åž‹ã€‚ æœ¬å±‚çš„å¼‚å¸¸å°è£…ç±»ã€‚ Clean ä¹‹ Data å±‚ å›¾ç‰‡æ¥è‡ª Robert C. Martin (Uncle Bob) è¿™å¼ å›¾å°±è¶³å¤Ÿè¯´æ˜Žä¸€åˆ‡äº†ã€‚ åŒ…å«å„ç§ API æŽ¥å£ï¼Œä¸»è¦å¯¹åº”æ•°æ®åº“æ“ä½œï¼Œæ–‡ä»¶æ“ä½œä»¥åŠç½‘ç»œæ•°æ®æ“ä½œï¼Œä¸€äº›å¼‚å¸¸å°è£…ç±»ã€‚Mapper ç±»ï¼Œè´Ÿè´£å°†ç½‘ç»œæ•°æ®æ¨¡åž‹è½¬æ¢ä¸º Data å±‚çš„æ•°æ®æ¨¡åž‹ã€‚ æ³¨æ„ Data å±‚åªæä¾›æŽ¥å£ï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ã€‚ Android Clean æž¶æž„å®žçŽ°ä¸€ä¸ªåŸºäºŽ Clean æž¶æž„ä»¥åŠ Retrofit ï¼Œ RxKotlin ï¼Œ Dagger æ¡†æž¶å®žçŽ°çš„ Kotlin for Android App ã€‚ æ›´å¤š https://github.com/googlesamples/android-architecture/tree/todo-mvp-clean/ https://fernandocejas.com/2014/09/03/architecting-android-the-clean-way/]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[RecyclerView åŠ è½½ä¸Žåˆ·æ–°åŠŸèƒ½å®žçŽ°]]></title>
      <url>%2F2017%2F04%2F13%2FRecyclerView-%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%2F</url>
      <content type="text"><![CDATA[åšæŒå°±æ˜¯è¿›æ­¥ æœ€è¿‘ Kotlin Android å¼€å‘è²Œä¼¼è¦ç«èµ·æ¥ï¼ŒKotlin å…·æœ‰è„šæœ¬è¯­è¨€é£Žæ ¼ï¼Œèƒ½ä¸Ž Java æ— ç¼å…¼å®¹ï¼Œå¹¶ä¸”æœ‰ Google æœ‰æ„æ ½åŸ¹ã€‚ RecyclerView åŠ è½½ä¸Žåˆ·æ–°åŠŸèƒ½å®žçŽ°RecyclerView åŠŸèƒ½åŠçµæ´»æ€§å¼ºå¤§åˆ°ä»¤äººå‘æŒ‡ã€‚åœ¨å¼€å‘ä¸­ï¼Œå®Œå…¨å¯ä»¥ç”¨å®ƒä»£æ›¿ ListView å’Œ GridView ï¼Œå¹¶ä¸”è¿˜å…·æœ‰ç€‘å¸ƒæµå±•ç¤ºåŠŸèƒ½ã€‚ æœ¬æ–‡ä¸»è¦å¯¹ RecyclerView è¿›è¡Œç®€å•çš„å°è£…ï¼Œæ¥å®žçŽ°åŠ è½½ã€åˆ·æ–°ä»¥åŠå¼‚å¸¸çŠ¶æ€å±•ç¤ºå¤šç§åŠŸèƒ½ï¼Œå®žçŽ°åŠå…¶ç®€å•ï¼Œä»£ç é‡å¾ˆå°‘ã€‚ æ•ˆæžœå±•ç¤º Demo ä¸‹è½½ æºç åœ°å€: https://github.com/githubhaohao/JCRecyclerView å…·ä½“å®žçŽ°JCRecyclerView ç»§æ‰¿ RecyclerView ï¼Œä¿ç•™ RecyclerView çš„æ‰€æœ‰ç‰¹æ€§ã€‚ å†…éƒ¨ç±» JCAdapter å¯¹å¤–éƒ¨çš„ RecyclerView Adapter è¿›è¡Œæ‹¦æˆªæ”¹é€ ï¼Œå®žçŽ°æ ¹æ®é…ç½®åœ¨ position = 0 çš„ä½ç½®åŠ è½½ Ad-Slot View ï¼ˆå¹¿å‘Šä½ï¼‰ï¼ŒåŠ è½½æ—¶åœ¨åº•éƒ¨æ˜¾ç¤º Bottom View è¡¨è§†åŠ è½½æ­£åœ¨è¿›è¡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112private class JCAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; &#123; private RecyclerView.Adapter adapter; private static final int TYPE_ADSLOT = 0x10; private static final int TYPE_NORMAL = 0x11; private static final int TYPE_BOTTOM = 0x12; public JCAdapter(RecyclerView.Adapter adapter) &#123; this.adapter = adapter; &#125; @Override public void onViewAttachedToWindow(ViewHolder holder) &#123; super.onViewAttachedToWindow(holder); ViewGroup.LayoutParams layoutParams = holder.itemView.getLayoutParams(); if(layoutParams != null)&#123; if(adSlotView != null) &#123; if(layoutParams instanceof StaggeredGridLayoutManager.LayoutParams &amp;&amp; holder.getLayoutPosition() == 0)&#123; StaggeredGridLayoutManager.LayoutParams p = (StaggeredGridLayoutManager.LayoutParams) layoutParams; p.setFullSpan(true); &#125; &#125; if (bottomView != null &amp;&amp; isLoading) &#123; if(layoutParams instanceof StaggeredGridLayoutManager.LayoutParams &amp;&amp; holder.getLayoutPosition() == getItemCount() - 1)&#123; StaggeredGridLayoutManager.LayoutParams p = (StaggeredGridLayoutManager.LayoutParams) layoutParams; p.setFullSpan(true); &#125; &#125; &#125; if (layoutManager instanceof GridLayoutManager) &#123; final GridLayoutManager gridManager = ((GridLayoutManager) layoutManager); gridManager.setSpanSizeLookup(new GridLayoutManager.SpanSizeLookup() &#123; @Override public int getSpanSize(int position) &#123; boolean spanResult = false; if(adSlotView != null &amp;&amp; bottomView != null) &#123; if (isLoading) &#123; spanResult = (position == 0 || position == getItemCount() - 1); &#125; else &#123; spanResult = (position == 0); &#125; &#125; else if (adSlotView != null) &#123; spanResult = (position==0); &#125; else if (bottomView != null &amp;&amp; isLoading) &#123; spanResult = (position == getItemCount() - 1); &#125; return spanResult ? gridManager.getSpanCount():1; &#125; &#125;); &#125; &#125; @Override public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; if (viewType == TYPE_ADSLOT) &#123; return new JCViewHolder(adSlotView); &#125; else if (viewType == TYPE_BOTTOM) &#123; return new JCViewHolder(bottomView); &#125; return adapter.onCreateViewHolder(parent,viewType); &#125; @Override public void onBindViewHolder(ViewHolder holder, int position) &#123; if (getItemViewType(0) == TYPE_ADSLOT) &#123; if (position == 0) return; int newPosition = --position; if (adapter != null) &#123; if (newPosition &lt; adapter.getItemCount()) &#123; adapter.onBindViewHolder(holder, newPosition); &#125; &#125; return; &#125; else if (getItemViewType(position) == TYPE_BOTTOM) &#123; return; &#125; adapter.onBindViewHolder(holder, position); &#125; @Override public int getItemCount() &#123; int count = adapter.getItemCount(); if (adSlotView != null) &#123; count ++; &#125; if (bottomView != null &amp;&amp; isLoading) &#123; count ++; &#125; return count; &#125; @Override public int getItemViewType(int position) &#123; if (position == 0) &#123; return adSlotView == null ? TYPE_NORMAL : TYPE_ADSLOT; &#125; else if (position == getItemCount() - 1 &amp;&amp; isLoading) &#123; return bottomView == null ? TYPE_NORMAL : TYPE_BOTTOM; &#125; else &#123; return TYPE_NORMAL; &#125; &#125;&#125; å‘å¤–æš´éœ²ä¸€ä¸ªæŽ¥å£ OnLoadMoreListener ï¼Œå®ŒæˆåŠ è½½æ—¶çš„å›žè°ƒã€‚123public interface OnLoadMoreListener &#123; void onLoadMore();&#125; æ•´ä½“æ€è·¯å°±æ˜¯è¿™äº›ï¼Œå®Œæ•´ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268public class JCRecyclerView extends RecyclerView &#123; private static final String TAG = JCRecyclerView.class.getSimpleName(); private LayoutManager layoutManager; private ViewGroup adSlotView; private ViewGroup stateView; private ViewGroup bottomView; private boolean isLoading = false; private JCAdapter jcAdapter; private OnLoadMoreListener onLoadMoreListener; public void addOnLoadMoreListener(OnLoadMoreListener listener) &#123; this.onLoadMoreListener = listener; this.addOnScrollListener(new OnScrollListener() &#123; @Override public void onScrollStateChanged(RecyclerView recyclerView, int newState) &#123; if (recyclerView.getLayoutManager() instanceof StaggeredGridLayoutManager) &#123; StaggeredGridLayoutManager layoutManager = (StaggeredGridLayoutManager) recyclerView.getLayoutManager(); int totalItemCount = recyclerView.getAdapter().getItemCount(); int[] lastVisibleItemPositions = new int[layoutManager.getSpanCount()]; layoutManager.findLastVisibleItemPositions(lastVisibleItemPositions); int visibleItemCount = recyclerView.getChildCount(); int lastVisibleItemPosition = findMaxPosition(lastVisibleItemPositions); if (newState == RecyclerView.SCROLL_STATE_IDLE &amp;&amp; lastVisibleItemPosition == totalItemCount - 1 &amp;&amp; visibleItemCount &gt; 0) &#123; if (bottomView == null || isLoading || stateView != null) return; isLoading = true; jcAdapter.notifyDataSetChanged(); onLoadMoreListener.onLoadMore(); scrollToPosition(jcAdapter.getItemCount() - 1); &#125; &#125; else &#123; LinearLayoutManager lm = (LinearLayoutManager) recyclerView.getLayoutManager(); int totalItemCount = recyclerView.getAdapter().getItemCount(); int lastVisibleItemPosition = lm.findLastVisibleItemPosition(); int visibleItemCount = recyclerView.getChildCount(); if (newState == RecyclerView.SCROLL_STATE_IDLE &amp;&amp; lastVisibleItemPosition == totalItemCount - 1 &amp;&amp; visibleItemCount &gt; 0) &#123; if (bottomView == null || isLoading || stateView != null) return; isLoading = true; jcAdapter.notifyDataSetChanged(); onLoadMoreListener.onLoadMore(); scrollToPosition(jcAdapter.getItemCount() - 1); &#125; &#125; &#125; &#125;); &#125; private int findMaxPosition(int[] positions) &#123; int max = positions[0]; for (int index = 1; index &lt; positions.length; index++) &#123; if (positions[index] &gt; max) &#123; max = positions[index]; &#125; &#125; return max; &#125; public void setBottomView(ViewGroup view) &#123; if (bottomView == null) &#123; this.bottomView = view; &#125; &#125; public void setLoading(boolean flag) &#123; if (!flag) &#123; isLoading = false; jcAdapter.notifyDataSetChanged(); scrollToPosition(jcAdapter.getItemCount() - 1); &#125; &#125; public void setAdSlotView(ViewGroup view) &#123; if (adSlotView == null) &#123; adSlotView = view; if (jcAdapter != null) &#123; jcAdapter.notifyItemInserted(0); scrollToPosition(0); &#125; &#125; &#125; public void setStateView(ViewGroup view) &#123; if (stateView != null) return; if (view == null) return; if (adSlotView != null) &#123; scrollToPosition(0); stateView = view; Rect rect = new Rect(); getGlobalVisibleRect(rect); LinearLayout.LayoutParams layoutParams = new LinearLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, rect.bottom - rect.top - adSlotView.getHeight()); adSlotView.addView(stateView, layoutParams); &#125; else &#123; showToast("You should set the ad-slot view at first."); &#125; &#125; public void removeAdSlotView() &#123; if (adSlotView != null &amp;&amp; jcAdapter != null) &#123; adSlotView = null; jcAdapter.notifyItemRemoved(0); &#125; &#125; public void removeStateView() &#123; if (adSlotView != null &amp;&amp; stateView != null &amp;&amp; jcAdapter != null) &#123; adSlotView.removeView(stateView); stateView = null; &#125; &#125; @Override public void setAdapter(Adapter adapter) &#123; this.jcAdapter = new JCAdapter(adapter); super.setAdapter(this.jcAdapter); &#125; public JCRecyclerView(Context context, AttributeSet attrs) &#123; super(context, attrs); &#125; @Override public void setLayoutManager(LayoutManager layoutManager) &#123; this.layoutManager = layoutManager; super.setLayoutManager(layoutManager); &#125; private class JCAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; &#123; private RecyclerView.Adapter adapter; private static final int TYPE_ADSLOT = 0x10; private static final int TYPE_NORMAL = 0x11; private static final int TYPE_BOTTOM = 0x12; public JCAdapter(RecyclerView.Adapter adapter) &#123; this.adapter = adapter; &#125; @Override public void onViewAttachedToWindow(ViewHolder holder) &#123; super.onViewAttachedToWindow(holder); ViewGroup.LayoutParams layoutParams = holder.itemView.getLayoutParams(); if(layoutParams != null)&#123; if(adSlotView != null) &#123; if(layoutParams instanceof StaggeredGridLayoutManager.LayoutParams &amp;&amp; holder.getLayoutPosition() == 0)&#123; StaggeredGridLayoutManager.LayoutParams p = (StaggeredGridLayoutManager.LayoutParams) layoutParams; p.setFullSpan(true); &#125; &#125; if (bottomView != null &amp;&amp; isLoading) &#123; if(layoutParams instanceof StaggeredGridLayoutManager.LayoutParams &amp;&amp; holder.getLayoutPosition() == getItemCount() - 1)&#123; StaggeredGridLayoutManager.LayoutParams p = (StaggeredGridLayoutManager.LayoutParams) layoutParams; p.setFullSpan(true); &#125; &#125; &#125; if (layoutManager instanceof GridLayoutManager) &#123; final GridLayoutManager gridManager = ((GridLayoutManager) layoutManager); gridManager.setSpanSizeLookup(new GridLayoutManager.SpanSizeLookup() &#123; @Override public int getSpanSize(int position) &#123; boolean spanResult = false; if(adSlotView != null &amp;&amp; bottomView != null) &#123; if (isLoading) &#123; spanResult = (position == 0 || position == getItemCount() - 1); &#125; else &#123; spanResult = (position == 0); &#125; &#125; else if (adSlotView != null) &#123; spanResult = (position==0); &#125; else if (bottomView != null &amp;&amp; isLoading) &#123; spanResult = (position == getItemCount() - 1); &#125; return spanResult ? gridManager.getSpanCount():1; &#125; &#125;); &#125; &#125; @Override public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; if (viewType == TYPE_ADSLOT) &#123; return new JCViewHolder(adSlotView); &#125; else if (viewType == TYPE_BOTTOM) &#123; return new JCViewHolder(bottomView); &#125; return adapter.onCreateViewHolder(parent,viewType); &#125; @Override public void onBindViewHolder(ViewHolder holder, int position) &#123; if (getItemViewType(0) == TYPE_ADSLOT) &#123; if (position == 0) return; int newPosition = --position; if (adapter != null) &#123; if (newPosition &lt; adapter.getItemCount()) &#123; adapter.onBindViewHolder(holder, newPosition); &#125; &#125; return; &#125; else if (getItemViewType(position) == TYPE_BOTTOM) &#123; return; &#125; adapter.onBindViewHolder(holder, position); &#125; @Override public int getItemCount() &#123; int count = adapter.getItemCount(); if (adSlotView != null) &#123; count ++; &#125; if (bottomView != null &amp;&amp; isLoading) &#123; count ++; &#125; return count; &#125; @Override public int getItemViewType(int position) &#123; if (position == 0) &#123; return adSlotView == null ? TYPE_NORMAL : TYPE_ADSLOT; &#125; else if (position == getItemCount() - 1 &amp;&amp; isLoading) &#123; return bottomView == null ? TYPE_NORMAL : TYPE_BOTTOM; &#125; else &#123; return TYPE_NORMAL; &#125; &#125; &#125; private class JCViewHolder extends RecyclerView.ViewHolder &#123; public JCViewHolder(View itemView) &#123; super(itemView); &#125; &#125; private void showToast(String msg) &#123; Toast.makeText(getContext(),msg,Toast.LENGTH_SHORT).show(); &#125; public interface OnLoadMoreListener &#123; void onLoadMore(); &#125;&#125; 200 å¤šè¡Œä»£ç ï¼Œè½»æ¾å®žçŽ° RecyclerView åˆ·æ–°ã€åŠ è½½ä»¥åŠå¼‚å¸¸çŠ¶æ€çš„å±•ç¤ºåŠŸèƒ½ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android jar ä¸Ž aar]]></title>
      <url>%2F2017%2F04%2F01%2FAndroid-jar-%E4%B8%8E-aar%2F</url>
      <content type="text"><![CDATA[æ„šäººèŠ‚ä¸æ„šäºº æœ€è¿‘å¼€å§‹æžæœºå™¨å­¦ä¹ ï¼ŒåŒæ—¶é¡¹ç›®ä¹Ÿä¸åœçš„ç»´æŠ¤ç€ï¼å˜¿å˜¿ï¼Œæ˜Žå¤©å°±æ˜¯å°é•¿å‡äº†ã€‚ Android jar ä¸Ž aarjar (Java Application Resource) æ˜¯ä¸€ç§å½’æ¡£æ–‡ä»¶ï¼Œä»¥ ZIP æ ¼å¼æž„å»ºï¼Œä»¥ .jar ä¸ºæ–‡ä»¶æ‰©å±•åã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨JDKè‡ªå¸¦çš„ jar å‘½ä»¤åˆ›å»ºæˆ–æå– JAR æ–‡ä»¶ã€‚jar æ–‡ä»¶åªåŒ…å« class æ–‡ä»¶å’Œ é…ç½®æ–‡ä»¶ã€‚ aar (Android Application Resource) æ˜¯ android ä¸­ç‰¹æœ‰çš„å½’æ¡£æ–‡ä»¶ï¼Œæ—¢åŒ…å« class æ–‡ä»¶ä¹ŸåŒ…å« android çš„ res èµ„æºæ–‡ä»¶ã€‚ Android Studio ç”Ÿæˆ jar å’Œ aar æ–‡ä»¶æ–°å»ºä¸€ä¸ª ModuleAndroid studio èœå• File -&gt; New -&gt; New Module -&gt; Android Module ã€‚ åˆ›å»ºåä¸º mylibrary çš„ moduleã€‚ åœ¨ mylibrary ä¸‹æ–°å»ºä¸€ä¸ªç±» Person ,ç­‰ä¼šåœ¨ app module ä¸‹è®¿é—®å®ƒã€‚ ç”Ÿæˆ jar å’Œ aar æ–‡ä»¶ç›´æŽ¥ Rebuild æˆ–è€…è¿è¡Œ mylibrary task å¦‚ä¸‹å›¾ï¼š Build Successful ä¹‹åŽå¯åœ¨ä¸‹å›¾çš„ç›®å½•ä¸‹æ‰¾åˆ° jar å’Œ arr æ–‡ä»¶ã€‚ å¼•å…¥ jar å°† jar æ–‡ä»¶æ‹·è´åˆ° app çš„ lib æ–‡ä»¶å¤¹ä¸‹ï¼› å³å‡» jar æ–‡ä»¶ï¼Œé€‰æ‹© Add As Library ï¼Œæ·»åŠ åˆ° app module ä¸‹ï¼Œç„¶åŽ Android Studio ä¼šè‡ªåŠ¨ç¼–è¯‘ã€‚ å¼•å…¥ aar å°† aar æ–‡ä»¶æ‹·è´åˆ° app çš„ lib æ–‡ä»¶å¤¹ä¸‹ (å¯ä»¥ä¿®æ”¹ aar æ–‡ä»¶åå­—ï¼Œæœ¬ä¾‹ä¸­ä¿®æ”¹ä¸º mylibrary )ï¼› ä¿®æ”¹ build.gradle é…ç½®æ–‡ä»¶ï¼š12345678910111213android &#123; ...... repositories &#123; flatDir &#123; dirs 'libs' &#125; &#125;&#125;dependencies &#123; ...... compile(name: 'mylibrary', ext: 'aar') &#125; Async Project å¤§å·¥å‘Šæˆã€‚ åŒæ ·ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å…¶ä»–å·¥ç¨‹ä¸­å¼•å…¥ jar æˆ– aar æ–‡ä»¶ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android å››å¤§ç»„ä»¶ä¹‹ Activity]]></title>
      <url>%2F2017%2F03%2F01%2FAndroid-%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6%E4%B9%8B-Activity%2F</url>
      <content type="text"><![CDATA[å”‰ï¼æœ€è¿‘æ‹–å»¶ç—‡åˆçŠ¯äº† æœ€è¿‘çœŸçš„æ˜¯è¶Šæ¥è¶Šæ‡’äº†ï¼Œæ€»æ˜¯æ‰¾å„ç§ç†ç”±ä¸å†™åšå®¢ã€‚è™½ç„¶æœ€è¿‘å„ç§äº‹ï¼Œåˆæžè®ºæ–‡ï¼Œåˆæžé¡¹ç›®çš„ï¼Œå†æ‹–ä¸‹åŽ»å®žåœ¨æ˜¯å¯¹ä¸ä½ â€œä¸å¿˜åˆå¿ƒâ€ è¿™ä¸€å¥è¯ã€‚æƒ­æ„§ï¼è™½ç„¶å…³äºŽ Activity å·²ç»è¢«å†™çƒ‚äº†ï¼Œä½†æ˜¯ä»Žæœ¬ç¯‡æ–‡ç« é‡Œï¼Œä½ ä¸€å®šä¼šå‘çŽ°ä¸åŒçš„ä¸œè¥¿ã€‚ Activity ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬æƒ…å†µä¸‹ 12345678910111213public class Activity extends ApplicationContext &#123; protected void onCreate(Bundle savedInstanceState); protected void onStart(); protected void onResume(); protected void onPause(); protected void onStop(); protected void onDestroy();&#125; å¼‚å¸¸æƒ…å†µä¸‹ç³»ç»Ÿé…ç½®å˜åŒ–å¯¼è‡´Activityé”€æ¯é‡å»º æ—‹è½¬å±å¹•ï¼ŒActivity é”€æ¯å¹¶é‡æ–°åˆ›å»ºï¼Œåœ¨å¼‚å¸¸æƒ…å†µä¸‹ç³»ç»Ÿä¼šåœ¨ onStop ä¹‹å‰è°ƒç”¨ onSaveInstanceState æ¥ä¿å­˜çŠ¶æ€ã€‚Activity é‡æ–°åˆ›å»ºåŽï¼Œä¼šåœ¨ onStart ä¹‹åŽè°ƒç”¨ onRestoreInstanceState æ¢å¤ä¹‹å‰ä¿å­˜çš„æ•°æ®ã€‚ ç³»ç»Ÿåªåœ¨ Activity å¼‚å¸¸ç»ˆæ­¢çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ onSaveInstanceState å’Œ onRestoreInstanceState æ–¹æ³•ã€‚å…¶ä»–æƒ…å†µä¸ä¼šè§¦å‘ã€‚ èµ„æºå†…å­˜ä¸è¶³å¯¼è‡´ä½Žä¼˜å…ˆçº§çš„ Activity è¢«å›žæ”¶ å‰å°- å¯è§éžå‰å°ï¼ˆè¢«å¯¹è¯æ¡†é®æŒ¡çš„ Activity ï¼‰-åŽå°ï¼Œè¿™ä¸‰ç§ Activity ä¼˜å…ˆçº§ä»Žé«˜åˆ°ä½Žã€‚ android:configChanges=&quot;orientation&quot; åœ¨ manifest ä¸­æŒ‡å®š configChanges åœ¨ç³»ç»Ÿé…ç½®å˜åŒ–åŽä¸é‡æ–°åˆ›å»º Activityï¼Œä¹Ÿä¸ä¼šæ‰§è¡ŒonSaveInstanceState å’Œ onRestoreInstanceState æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒç”¨ onConfigurationChnaged æ–¹æ³•ã€‚ configChanges ä¸€èˆ¬å¸¸ç”¨ä¸‰ä¸ªé€‰é¡¹ï¼š locale ç³»ç»Ÿè¯­è¨€å˜åŒ– keyborardHidden é”®ç›˜çš„å¯è®¿é—®æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œæ¯”å¦‚ç”¨æˆ·è°ƒå‡ºäº†é”®ç›˜ orientation å±å¹•æ–¹å‘å˜åŒ– åœºæ™¯é¦–æ¬¡å¯åŠ¨ Activity123MainActivity onCreateMainActivity onStartMainActivity onResume è·³è½¬åˆ° SecondActivity12345MainActivity onPauseSecondActivity onCreateSecondActivity onStartSecondActivity onResumeMainActivity onStop Back è¿”å›ž MainActivity123456SecondActivity onPauseMainActivity onRestartMainActivity onStartMainActivity onResumeSecondActivity onStopSecondActivity onDestroy Home å›žé€€æ¡Œé¢12MainActivity onPauseMainActivity onStop æ¡Œé¢è¿”å›žå¯è§123MainActivity onRestartMainActivity onStartMainActivity onResume é”å±12MainActivity onPauseMainActivity onStop è§£é”å±123MainActivity onRestartMainActivity onStartMainActivity onResume æ³¨æ„onStart å¼€å§‹åˆ° onStop ä¹‹å‰ï¼Œ Activity å¯è§ã€‚onResume å¼€å§‹åˆ° onPause ä¹‹å‰ï¼Œ Activity å¯æŽ¥å—ç”¨æˆ·äº¤äº’ã€‚åœ¨æ–°Activityå¯åŠ¨ä¹‹å‰ï¼Œæ ˆé¡¶çš„Activityéœ€è¦å…ˆonPauseåŽï¼Œæ–°Activityæ‰èƒ½å¯åŠ¨ã€‚æ‰€ä»¥ä¸èƒ½åœ¨onPauseæ‰§è¡Œè€—æ—¶æ“ä½œã€‚ Activity æ•°æ®ä¼ é€’Activity ä¼ é€’æ•°æ®ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š Intent ä¼ é€’æ•°æ®MainActivity 123456Intent intent=new Intent(); intent.setClass(MainActivity.this, OtherActivity.class); Bundle bundle = new Bundle(); bundle.putString(KEY, VALUE);intent.putExtras(bundle); startActivityï¼ˆintentï¼‰; OtherActivity 123Intent intent = getIntent(); Bundle bundle = intent.getEtras(); String value = bundle.getString(KEY); åˆ©ç”¨ Intent å¯¹è±¡åœ¨ Activity ä¹‹é—´ä¼ é€’æ•°æ®æ˜¯ Android å¼€å‘æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚åˆ©ç”¨ Intent å¯¹è±¡å¯ä»¥ä¼ é€’åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œä»¥åŠä¸€äº›å¯åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ public åž‹çš„é™æ€å˜é‡public åž‹çš„é™æ€å˜é‡ï¼Œåœ¨ç±»è¢«åŠ è½½çš„æ—¶å€™ï¼Œå°±è¢«åˆ›å»ºåœ¨é™æ€å­˜å‚¨åŒºï¼Œä¸ä¾èµ–äºŽå¯¹è±¡ã€‚ Application å¯¹è±¡åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å°±ä¸€ä¸ªApplicationå•ä¾‹ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ªç¨‹åºï¼Œå †å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡å®žä¾‹ï¼Œæ‰€ä»¥ç¨‹åºå†…æ‰€æœ‰å®ƒçš„å¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€å—å †å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸åŒactivityå¯¹applicationå®žä¾‹å˜é‡è¿›è¡Œå€¼çš„å­˜å–ã€‚ä¸æŽ¨èã€‚ Clipboard å‰ªåˆ‡æ¿ClipboardManagerï¼šè¯¥ç±»æ˜¯ç³»ç»Ÿå‰ªåˆ‡æ¿æœåŠ¡çš„æŽ¥å£ï¼Œç”¨æ¥æ”¾å…¥æˆ–å–å‡ºå…¨å±€å‰ªåˆ‡æ¿ä¸­çš„æ–‡æœ¬ã€‚ 1234ClipboardManager clipboardManager = (ClipboardManager)getSystemService(Context.CLIPBOARD_SERVICE);clipboardManager.setText(DATA.toString());&#125; 12ClipboardManager clipboardManager = (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE); String data = clipboardManager.getText().toString(); Clipboard ä¹Ÿå¯ä»¥ä¼ é€’å¯åºåˆ—åŒ–å¯¹è±¡ã€‚ æ–‡ä»¶ä¼ å€¼é€šè¿‡å‘æœ¬åœ°æ–‡ä»¶å†™å…¥å’Œè¯»å–æ¥ä¼ é€’æ•°æ®ã€‚å¸¸ç”¨çš„å¦‚ SharedPrefrences å¯¹è±¡ç­‰ã€‚ æ•°æ®åº“ä½ è‡ªå·±æƒ³å§ï¼ Activity å¯åŠ¨æ¨¡å¼å¯åŠ¨æ¨¡å¼,ç®€å•åœ°è¯´å°±æ˜¯ Activity å¯åŠ¨æ—¶çš„ç­–ç•¥ï¼Œåœ¨AndroidManifest.xml ä¸­çš„æ ‡ç­¾çš„ android:launchMode å±žæ€§è®¾ç½®ï¼› å¯åŠ¨æ¨¡å¼æœ‰4ç§ï¼Œåˆ†åˆ«ä¸º standardã€singleTopã€singleTaskã€singleInstanceï¼› standard æ¨¡å¼æ¯æ¬¡ startActivity æ—¶ï¼Œéƒ½åˆ›å»º Activity å®žä¾‹ï¼Œå¹¶æ”¾å…¥ä»»åŠ¡æ ˆï¼Œè¯¥ä»»åŠ¡æ ˆä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªåŒç±» Activity çš„å®žä¾‹ã€‚ åº”ç”¨åœºæ™¯ï¼šYour ideaã€‚ singleTop æ¨¡å¼æ ˆé¡¶ä¸æ˜¯è¯¥ç±»åž‹çš„ Activityï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ Activityã€‚å¦åˆ™ï¼Œå›žè°ƒè¯¥ Activity å®žä¾‹çš„ onNewIntent æ–¹æ³•ã€‚ åº”ç”¨åœºæ™¯ï¼šæŽ¥æ”¶é€šçŸ¥æ¶ˆæ¯å¯åŠ¨çš„é¡µé¢ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºŽæŽ¨é€æ¯”è¾ƒé¢‘ç¹çš„åº”ç”¨ï¼Œå¦‚æžœæ”¶åˆ°å¤šä¸ªæŽ¨é€ï¼Œæ¯æ¬¡éƒ½æ‰“å¼€ä¸€ä¸ªé¡µé¢æ˜¾ç¤ºå†…å®¹æ˜¯ä¸å¦¥çš„ã€‚ singleTask æ¨¡å¼ä»»åŠ¡æ ˆä¸­ä¸å­˜åœ¨å¯åŠ¨ Activity çš„å®žä¾‹ï¼Œåˆ™åˆ›å»º Activity æ”¾å…¥ä»»åŠ¡æ ˆã€‚å¦åˆ™ï¼Œå›žè°ƒè¯¥ Activity çš„ onNewIntent æ–¹æ³•ï¼Œå¹¶å°†è¯¥ Activity ç½®äºŽæ ˆé¡¶ï¼Œå…¶ä»¥ä¸Šçš„ Activity éƒ½è¢«å¼¹å‡º (pop)ã€‚[onNewIntent + clearTop] åº”ç”¨åœºæ™¯ï¼šä½œä¸ºåº”ç”¨çš„å…¥å£ç‚¹ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºŽæµè§ˆå™¨çš„ä¸»ç•Œé¢ï¼Œä¸ç®¡ä»Žå¤šå°‘ä¸ªåº”ç”¨å¯åŠ¨æµè§ˆå™¨ï¼Œåªä¼šå¯åŠ¨ä¸»ç•Œé¢ä¸€æ¬¡ï¼Œå…¶ä½™æƒ…å†µéƒ½ä¼šèµ° onNewIntent ï¼Œå¹¶ä¸”ä¼šæ¸…ç©ºä¸»ç•Œé¢ä¸Šé¢çš„å…¶ä»–é¡µé¢ã€‚ singleInstance æ¨¡å¼å›žé€€æ ˆä¸­ï¼Œåªæœ‰è¿™ä¸€ä¸ªActivityï¼Œæ²¡æœ‰å…¶ä»–Activityã€‚ åº”ç”¨åœºæ™¯ï¼šé—¹é“ƒçš„å“é“ƒç•Œé¢ã€‚æ­£åœ¨è¿›è¡Œ QQ èŠå¤©å®¤æ—¶ï¼Œé—¹é“ƒå“äº†ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯å½¢å¼çš„ï¼ˆä»¥ SingleInstance åŠ è½½æ¨¡å¼æ‰“å¼€çš„ï¼‰AlarmActivityï¼ŒæŒ‰äº†è¿”å›žé”®ä¹‹åŽå›žåˆ° QQ èŠå¤©ç•Œé¢ï¼Œè¿™æ˜¯å› ä¸º Alarm Activity æ‰€åœ¨çš„ä»»åŠ¡æ ˆåªæœ‰å®ƒä¸€ä¸ªå…ƒç´ ï¼Œ å› æ­¤é€€å‡ºä¹‹åŽè¿™ä¸ªä»»åŠ¡æ ˆç©ºäº†ã€‚å¦‚æžœæ˜¯ä»¥ SingleTask æ‰“å¼€ AlarmActivityï¼Œé‚£ä¹ˆå½“é—¹é“ƒå“äº†çš„æ—¶å€™ï¼ŒæŒ‰è¿”å›žé”®åº”è¯¥è¿›å…¥é—¹é“ƒè®¾ç½®ç•Œé¢ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Android ä¸»é¢˜åˆ‡æ¢å’Œå¤šä¸»é¢˜å®žçŽ°]]></title>
      <url>%2F2017%2F02%2F17%2FAndroid%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E5%92%8C%E5%A4%9A%E4%B8%BB%E9%A2%98%E5%AE%9E%E7%8E%B0%2F</url>
      <content type="text"><![CDATA[åˆæ˜¯ä¸€ä¸ªå‘¨æœ« ç™½å¤©å’Œå¤œé—´æ¨¡å¼Androidå®˜æ–¹åœ¨SupportåŒ…ä»Ž23.2ç‰ˆæœ¬å¼€å§‹æä¾›æ”¯æŒç™½å¤©å¤œé—´æ¨¡å¼çš„ä¸»é¢˜ Theme.AppCompat.DayNightï¼Œä¹Ÿå°±æ˜¯ DayNight Mode ï¼Œè½»æ¾å®žçŽ°ä¸»ä½“æ— ç¼åˆ‡æ¢ã€‚ Theme.AppCompat.DayNight å¯ä»¥æ ¹æ®ç³»ç»Ÿæ—¶é—´åˆ‡æ¢ Theme.AppCompat (æš—è‰²) å’Œ Theme.AppCompat.Light ( äº®è‰² ) ä¸¤ç§ä¸»é¢˜ã€‚è¿™å°†å¤§å¤§æé«˜äº†é˜…è¯»ç±»åº”ç”¨çš„ç”¨æˆ·ä½“éªŒ åŒæ—¶è¿˜æ”¯æŒ Material Designã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç‰¹æ€§åªæ”¯æŒ API v14 åŠä»¥ä¸Šçš„ Android è®¾å¤‡ï¼Œåœ¨ API v14 ä»¥ä¸‹çš„è®¾å¤‡åˆ™ä¼šé»˜è®¤ä½¿ç”¨äº®è‰²çš„ä¸»é¢˜ã€‚ æ•ˆæžœé¢„è§ˆ å…·ä½“è¿‡ç¨‹1. å¼•å…¥ support-v7:23.2+ ç‰ˆæœ¬çš„ä¾èµ–1compile 'com.android.support:appcompat-v7:25.1.1' ä¸ºä¿è¯ä¸»é¢˜é£Žæ ¼çš„ç»Ÿä¸€ï¼Œæ‰€æœ‰çš„ Activity ç±»åº”ç»§æ‰¿ AppCompatActivity ã€‚ 2. è‡ªå®šä¹‰å®žçŽ° DayNight ä¸»é¢˜ res ç›®å½•ä¸‹æ–°å»º values-night æ–‡ä»¶ï¼Œæ‹·è´ä¿®æ”¹ colors.xml å’Œ styles.xml æ–‡ä»¶åˆ° values-nightï¼Œä¸º Night Model ä¸‹ç³»ç»ŸåŠ è½½çš„ colorèµ„æºï¼ŒåŒæ ·åœ°ä¹Ÿå¯ä»¥æŒ‡å®š Night Model ä¸‹åŠ è½½çš„ drawable èµ„æºåœ¨ drawable-night æ–‡ä»¶å¤¹ä¸­ï¼ŒåŒç† layout mipmap èµ„æºåŠ è½½ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ 123456&lt;style name="MyApp.DayNight.NoActionBar.Theme" parent="Theme.AppCompat.DayNight.NoActionBar"&gt; &lt;item name="colorPrimary"&gt;@color/colorPrimary&lt;/item&gt; &lt;item name="colorPrimaryDark"&gt;@color/colorPrimaryDark&lt;/item&gt; &lt;item name="colorAccent"&gt;@color/colorAccent&lt;/item&gt; &lt;item name="android:textColorPrimary"&gt;@color/colorAccent&lt;/item&gt;&lt;/style&gt; å…·ä½“ä½ç½®é¢œè‰²è®¾ç½®çœ‹å›¾ï¼š åœ¨ AndroidManifest.xml ä¸­å£°æ˜Žï¼Œå•ä¸ª Activity çš„ä¸»é¢˜ã€‚ 1234567891011121314151617&lt;application android:name=".MyApplication" android:allowBackup="true" android:icon="@mipmap/ic_launcher" android:label="@string/app_name" android:supportsRtl="true"&gt; &lt;activity android:name=".MainActivity" android:label="@string/app_name" android:theme="@style/MyApp.DayNight.NoActionBar.Theme"&gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.MAIN" /&gt; &lt;category android:name="android.intent.category.LAUNCHER" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt;&lt;/application&gt; æˆ–è€…æ•´ä¸ª App çš„ä¸»é¢˜ 12345678910111213141516171819&lt;application android:name=".MyApplication" android:allowBackup="true" android:icon="@mipmap/ic_launcher" android:label="@string/app_name" android:supportsRtl="true" android:theme="@style/MyApp.DayNight.NoActionBar.Theme"&gt; &lt;activity android:name=".MainActivity" android:label="@string/app_name" &gt; &lt;intent-filter&gt; &lt;action android:name="android.intent.action.MAIN" /&gt; &lt;category android:name="android.intent.category.LAUNCHER" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt;&lt;/application&gt; 3 è®¾ç½® DayNight ä¸»é¢˜åˆå§‹åŒ–ä¸»é¢˜: 1234567891011private void initAppTheme() &#123; if (getThemeSharedPref().getBoolean(KEY_NIGHT_THEME, false)) &#123; getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_YES); &#125; else &#123; getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_NO); &#125;&#125;private SharedPreferences getThemeSharedPref() &#123; return getSharedPreferences("APP_THEME", Context.MODE_PRIVATE);&#125; åˆå§‹åŒ–ä¸»é¢˜åº”è¯¥åœ¨ super.onCreate() ä¹‹å‰æ‰§è¡Œï¼Œä¸ç„¶ Activity ä¼šå¯åŠ¨ 2 æ¬¡,ä¸‹å›¾ä¸ºè¯ï¼š åˆ‡æ¢ä¸»é¢˜ï¼š 1234567if (id == R.id.set_day_theme) &#123; getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_NO); getThemeSharedPref().edit().putBoolean(KEY_NIGHT_THEME,false).apply();&#125; else if (id == R.id.set_night_theme) &#123; getDelegate().setLocalNightMode(AppCompatDelegate.MODE_NIGHT_YES); getThemeSharedPref().edit().putBoolean(KEY_NIGHT_THEME, true).apply();&#125; åˆ‡æ¢ä¸»é¢˜ä¼šé‡å¯ Activityã€‚ DayNight Theme æœ‰ 4 ç§ Model ï¼Œåˆ†åˆ«æ˜¯ï¼š MODE_NIGHT_NO. ä½¿ç”¨ Day ä¸»é¢˜ MODE_NIGHT_YES. ä½¿ç”¨æš—è‰² Night ä¸»é¢˜ MODE_NIGHT_AUTO. æ ¹æ®ç³»ç»Ÿæ—¶é—´è‡ªåŠ¨åˆ‡æ¢ MODE_NIGHT_FOLLOW_SYSTEM(é»˜è®¤é€‰é¡¹). è®¾ç½®ä¸ºè·Ÿéšç³»ç»Ÿ å¤šä¸»é¢˜å®žçŽ°ä»‹ç»å‡ ç§æ¢è‚¤çš„ç¬¬ä¸‰æ–¹åº“ã€‚ MultipleTheme çœŸæ­£çš„æ”¯æŒæ— ç¼æ¢è‚¤ï¼å¤œé—´æ¨¡å¼çš„Androidæ¡†æž¶ï¼Œé…åˆthemeå’Œæ¢è‚¤æŽ§ä»¶æ¡†æž¶å¯ä»¥åšåˆ°æ— ç¼åˆ‡æ¢æ¢è‚¤ï¼ˆæ— éœ€é‡å¯åº”ç”¨å’Œå½“å‰é¡µé¢ï¼‰ã€‚ è¯¥åº”ç”¨æ¡†æž¶å¯ä»¥å®žçŽ°æ— ç¼æ¢è‚¤ï¼åˆ‡æ¢å¤œé—´æ¨¡å¼çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨æ¢è‚¤ï¼åˆ‡æ¢å¤œé—´æ¨¡å¼çš„ç•Œé¢åªéœ€è¦ä½¿ç”¨æ¡†æž¶é‡Œçš„è‡ªå°è£…æŽ§ä»¶ï¼Œå…¶ä»–ç•Œé¢çš„æŽ§ä»¶ä½¿ç”¨åŽŸç”ŸandroidæŽ§ä»¶å³å¯ã€‚ ç¼ºé™·ï¼šå„ç§æŽ§ä»¶éƒ½éœ€è¦é‡å®šä¹‰ã€‚ä¼˜åŠ¿ï¼šæ‰©å±•æ€§å¼ºï¼Œæ— éœ€é‡å¯ Activityã€‚ Colorful [æŽ¨è] Colorful is a dynamic theme library allowing you to change your appsâ€™ color schemes easily. ç¼ºé™·ï¼šä¸»é¢˜é¢œè‰²å¯å®šåˆ¶æ€§å·®ï¼Œä¸æ”¯æŒ Material Design é£Žæ ¼ã€‚ä¼˜åŠ¿ï¼šä½¿ç”¨æ–¹ä¾¿ã€‚ Prism Prism ä¸‹å«æœ‰ä¸‰ä¸ªåº“ï¼š prsim åº“å«æœ‰ä¸€äº›æ ¸å¿ƒåŠŸèƒ½ï¼› prism-viewpager åº“å®žçŽ°äº†æ ¸å¿ƒåº“ä¸Ž ViewPager çš„å¯¹æŽ¥ï¼› prism-palette åº“å®žçŽ°äº†æ ¸å¿ƒåº“ä¸Ž Palette çš„å¯¹æŽ¥ã€‚ åˆ†æˆä¸‰ä¸ªåº“æ˜¯ä¸ºäº†åŒºåˆ†ä¾èµ–æ¡ä»¶ï¼šæ ¸å¿ƒåº“ä¸ä¾èµ–å¤–éƒ¨æ¡ä»¶ï¼Œå®ƒèƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°æ·»åŠ åˆ°ä½ çš„å·¥ç¨‹ä¹‹ä¸­ï¼›ä½†æ˜¯ prism-viewpager å’Œ prism-palette éœ€è¦ä¾èµ–ç›¸åº”çš„supportåº“ã€‚æ‰€ä»¥å½“ä½ çš„ç¨‹åºä¸ä½¿ç”¨è¿™äº›ä¾èµ–åº“æ—¶ï¼Œä½ å¯ä»¥åªä½¿ç”¨ prism åº“æ¥çœåŽ»ä¸å¿…è¦çš„ä¾èµ–æ¡ä»¶ã€‚ä¸è¿‡å½“ä½ çš„ç¨‹åºä¸­ä½¿ç”¨äº† ViewPager æ—¶ï¼Œå³å·²ç»å¯¹ç›¸å…³çš„supportåº“æœ‰äº†ä¾èµ–ï¼Œé‚£ä¹ˆæ·»åŠ  prism-viewpager åº“å°±ä¸éœ€è¦é¢å¤–çš„ä¾èµ–æ¡ä»¶ã€‚ ä½†æ˜¯ï¼Œä½œè€…å·²åœæ­¢æ›´æ–°ã€‚ Android-Skin-Loader [æŽ¨è]çœ‹æ•ˆæžœ é¡¹ç›®ç›®å½•ï¼š Android-Skin-Loaderâ”œâ”€â”€ android-skin-loader-lib // çš®è‚¤åŠ è½½åº“â”œâ”€â”€ android-skin-loader-sample // çš®è‚¤åº“åº”ç”¨å®žä¾‹â”œâ”€â”€ android-skin-loader-skin // çš®è‚¤åŒ…ç”Ÿæˆdemoâ””â”€â”€ skin-package // çš®è‚¤åŒ…è¾“å‡ºç›®å½• å¯ä»¥å°†çš®è‚¤æ–‡ä»¶æ‰“åŒ…åˆ†ç¦»ï¼Œæ”¯æŒåœ¨çº¿æ¢è‚¤ï¼Œçš®è‚¤å…±äº«ï¼Œä¸ä¼šé‡å¯ Activity æˆ– Fragment ã€‚çš®è‚¤åŒ…ï¼ˆ åŽç¼€åä¸º.skin ï¼‰çš„æœ¬è´¨æ˜¯ä¸€ä¸ªapkæ–‡ä»¶ï¼Œè¯¥apkæ–‡ä»¶ä¸åŒ…å«ä»£ç ï¼ŒåªåŒ…å«èµ„æºæ–‡ä»¶ã€‚ ç¼ºé™·ï¼šæ¯ä¸ªæ¢è‚¤çš„ View éƒ½è¦è®¾ç½® skin:enable=&quot;true&quot; ç¹ç ( åæ­£æˆ‘æ„Ÿè§‰æŒºçƒ¦çš„ )ï¼Œä¸æ”¯æŒ Material Design é£Žæ ¼ã€‚ ä¸è¿‡ï¼Œè¿˜å¥½ ThemeSkinning è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ”¯æŒ Material Design å’Œå­—ä½“çš„åˆ‡æ¢ã€‚ ç¤ºä¾‹ï¼š]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[MVVMï¼ŒRxJava å’Œ Retrofit çš„ä¸€æ¬¡å®žè·µ]]></title>
      <url>%2F2017%2F02%2F12%2FMVVM%EF%BC%8CRxJava%E5%92%8CRetrofit%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%9E%E8%B7%B5%2F</url>
      <content type="text"><![CDATA[æ˜¥èŠ‚åŽçš„ç¬¬ä¸€ç¯‡åšå®¢ æœ¬æ–‡å·²æŽˆæƒå¾®ä¿¡å…¬ä¼—å·ï¼šé¸¿æ´‹ï¼ˆhongyangAndroidï¼‰åŽŸåˆ›é¦–å‘ã€‚åŽŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜Žå‡ºå¤„:haohaochang.cn æ•ˆæžœé¢„è§ˆ Demo ä¸‹è½½ å‡†å¤‡çŸ¥è¯†MVC è§†å›¾å±‚ï¼ˆViewï¼‰ï¼šç”¨æˆ·ç•Œé¢ã€‚ æŽ§åˆ¶å™¨å±‚ï¼ˆControllerï¼‰ï¼šä¸šåŠ¡é€»è¾‘ æ¨¡åž‹å±‚ï¼ˆModelï¼‰ï¼šæ•°æ®ä¿å­˜ View å±‚ä¼ é€æŒ‡ä»¤åˆ° Controller å±‚ Controller å±‚å®Œæˆä¸šåŠ¡é€»è¾‘åŽï¼Œè¦æ±‚ Model å±‚æ”¹å˜çŠ¶æ€ Model å±‚å°†æ–°çš„æ•°æ®å‘é€åˆ° Viewå±‚ï¼Œä½¿ç”¨æˆ·å¾—åˆ°åé¦ˆ ç¼ºé™·:View å±‚å’Œ Model å±‚æ˜¯ç›¸äº’å¯çŸ¥ï¼Œè€¦åˆæ€§å¤§ï¼Œåƒ Activity æˆ–è€… Fragment æ—¢åœ¨ Controller å±‚ï¼Œåˆåœ¨ View å±‚ï¼Œé€ æˆå·¥ç¨‹çš„å¯æ‰©å±•æ€§å¯ç»´æŠ¤æ€§éžå¸¸å·®ã€‚ MVP åœ¨ MVP æž¶æž„æ¨¡å¼ä¸­ï¼ŒController å±‚å˜æˆäº† Presenter å±‚ã€‚ MVP æ¨¡å¼å„å±‚ä¹‹é—´çš„é€šä¿¡ï¼Œéƒ½æ˜¯åŒå‘çš„ã€‚ View å±‚ä¸Ž Model å±‚ä¸ç›´æŽ¥å‘ç”Ÿè”ç³»ï¼Œéƒ½é€šè¿‡ Presenter å±‚è¿›è¡Œé—´æŽ¥é€šä¿¡ã€‚ Model å±‚ä¸Ž Presenter å±‚ï¼ŒPresenter å±‚ä¸Ž View å±‚ä¹‹é—´é€šè¿‡æŽ¥å£å»ºç«‹è”ç³»ã€‚ é‡‡ç”¨ MVP æž¶æž„ï¼ŒActivityï¼ŒFragment ä»¥åŠè‡ªå®šä¹‰ View åªä½äºŽ View å±‚ã€‚View å±‚ï¼šè´Ÿè´£æ•°æ®å±•ç¤ºå’Œç”¨æˆ·äº¤äº’ï¼›Presenter å±‚ï¼šå……å½“ä¸­é—´äººçš„è§’è‰²ï¼Œç”¨æ¥éš”ç¦» Model å±‚å’Œ View å±‚ï¼Œè´Ÿè´£å°† View å±‚çš„è¯·æ±‚åˆ†å‘ç»™ Model å¤„ç†ï¼Œå°† Model å±‚çš„åé¦ˆä¼ é€’ç»™ View å±‚ï¼›Model å±‚ï¼šå°è£…æ•°æ®æ¥æºï¼Œå¦‚ç½‘ç»œæ•°æ®ï¼Œæœ¬åœ°æ•°æ®åº“æ•°æ®ã€‚ MVP çš„ä¼˜åŠ¿: æ˜“äºŽç»´æŠ¤ï¼Œæµ‹è¯•ï¼ŒåŠŸèƒ½æ‰©å±•ï¼› æ˜“äºŽåˆ†å·¥åä½œç¼–ç¨‹ï¼› MVP çš„ç¼ºé™·: ç”±äºŽæˆ‘ä»¬ä½¿ç”¨äº†æŽ¥å£çš„æ–¹å¼åŽ»è¿žæŽ¥ View å±‚å’Œ Presenter å±‚ï¼Œè¿™æ ·å°±å¯¼è‡´äº†ç‰¹å®šåœºæ™¯ä¸‹çš„ä¸€äº›é—®é¢˜ï¼Œå½“ä½ çš„é¡µé¢é€»è¾‘å¾ˆå¤æ‚çš„æ—¶å€™ï¼Œä½ çš„ View å±‚å®žçŽ°çš„æŽ¥å£ä¼šæœ‰å¾ˆå¤šï¼Œå¦‚æžœä½ çš„ App ä¸­æœ‰å¾ˆå¤šä¸ªè¿™æ ·å¤æ‚çš„é¡µé¢ï¼Œç»´æŠ¤æŽ¥å£çš„æˆæœ¬å°±ä¼šå˜çš„éžå¸¸çš„å¤§ã€‚ å¢žåŠ ä»£ç ç±»çš„æ•°é‡ï¼Œå¯è¯»æ€§å·®ã€‚ MVVM MVVM æ¨¡å¼å°† Presenter æ”¹åä¸º ViewModelï¼ŒåŸºæœ¬ä¸Šä¸Ž MVP æ¨¡å¼å®Œå…¨ä¸€è‡´ã€‚åŒºåˆ«åœ¨äºŽ: View å±‚ä¸Ž ViewModel å±‚é€šè¿‡ DataBinding ç›¸äº’ç»‘å®šï¼ŒView å±‚çš„å˜åŠ¨ï¼Œè‡ªåŠ¨åæ˜ åœ¨ ViewModel å±‚ï¼Œåä¹‹äº¦ç„¶ã€‚ Cleanæœ¬ç¯‡åªç€é‡è®²åŸºäºŽ RxJava å’Œ Retrofit æ¡†æž¶å®žçŽ° MVVM æž¶æž„è®¾è®¡ï¼Œæƒ³è¦äº†è§£ Clean æž¶æž„çš„åŒå­¦ï¼Œç§»æ­¥Android Clean æž¶æž„æµ…æžã€‚ å¦å¤–è¿™é‡Œæœ‰ä¸€ä¸ªåŸºäºŽ Kotlin å®žçŽ°çš„ Android æž¶æž„çš„ä¾‹å­ â€“ ä¸€ä¸ªåŸºäºŽ Clean æž¶æž„ä»¥åŠ Retrofit ï¼Œ RxKotlin ï¼Œ Dagger æ¡†æž¶å®žçŽ°çš„ Kotlin for Android Appã€‚ RxJava Rx æ˜¯å¾®è½¯ .Net çš„ä¸€ä¸ªå“åº”å¼æ‰©å±•ï¼ŒRx å€ŸåŠ©å¯è§‚æµ‹çš„åºåˆ—æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥åˆ›å»ºå¼‚æ­¥çš„ï¼ŒåŸºäºŽäº‹ä»¶é©±åŠ¨çš„ç¨‹åºã€‚2012 å¹´ Netflix ä¸ºäº†åº”å¯¹ä¸æ–­å¢žé•¿çš„ä¸šåŠ¡éœ€æ±‚å¼€å§‹å°† .NET Rx è¿ç§»åˆ° JVM ä¸Šé¢ã€‚å¹¶äºŽ 13 å¹´äºŒæœˆä»½æ­£å¼å‘å¤–å±•ç¤ºäº† RxJava ã€‚ ä»Žè¯­ä¹‰çš„è§’åº¦æ¥çœ‹ï¼Œ RxJava å°±æ˜¯ .NET Rx ã€‚ä»Žè¯­æ³•çš„è§’åº¦æ¥çœ‹ï¼Œ Netflix è€ƒè™‘åˆ°äº†å¯¹åº”æ¯ä¸ª Rx æ–¹æ³•,ä¿ç•™äº† Java ä»£ç è§„èŒƒå’ŒåŸºæœ¬çš„æ¨¡å¼ã€‚ RxJava åœ¨ GitHub ä¸»é¡µçš„ä»‹ç»æ˜¯ï¼š RxJava is a Java VM implementation of Reactive Extensions: a library for composing asynchronous and event-based programs by using observable sequences. ä¸€ä¸ªåœ¨ Java VM ä¸Šä½¿ç”¨å¯è§‚æµ‹çš„åºåˆ—æ¥ç»„æˆå¼‚æ­¥çš„ã€åŸºäºŽäº‹ä»¶ç¨‹åºçš„åº“ã€‚ RxJava æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œåº“ï¼Œæ˜¯ä¸€ä¸ªèƒ½è®©ä½ ç”¨æžå…¶ç®€æ´çš„é€»è¾‘åŽ»å¤„ç†ç¹çå¤æ‚ä»»åŠ¡çš„å¼‚æ­¥äº‹ä»¶åº“ã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒRxJava å¯ä»¥ç”¨å‡ ä¸ªå…³é”®å­—æ¦‚æ‹¬ï¼šç®€æ´ï¼Œé˜Ÿåˆ—åŒ–ï¼Œå¼‚æ­¥ã€‚ Retrofit ä¸€ä¸ª Android å’Œ Java ä¸Š HTTP åº“ï¼ˆåˆ©ç”¨æ³¨è§£å’Œ OKHttp æ¥å®žçŽ°å’ŒæœåŠ¡å™¨çš„æ•°æ®äº¤äº’ï¼‰ã€‚ Retrofit åŸºäºŽ OKHttp å¹¶å¼•å…¥æ³¨è§£ï¼Œä½¿ç”¨ç®€å•ï¼Œæ˜“æ‰©å±•ï¼Œæ˜“ç»´æŠ¤ã€‚ Retrofit å®˜æ–¹æ–‡æ¡£:http://square.github.io/retrofit/ DataBinding åœ¨Google IO 2015 ä¸­ï¼ŒGoogle åœ¨ support-v7 ä¸­æ–°å¢žäº† Data Bindingï¼Œä½¿ç”¨ Data Bindingå¯ä»¥ç›´æŽ¥åœ¨å¸ƒå±€çš„ xml ä¸­ç»‘å®šå¸ƒå±€ä¸Žæ•°æ®ï¼Œä»Žè€Œç®€åŒ–ä»£ç ï¼ŒAndroid Data Bindingæ˜¯Android çš„ MVVM æ¡†æž¶ã€‚å› ä¸º Data Binding æ˜¯åŒ…å«åœ¨ support-v7 åŒ…é‡Œé¢çš„ï¼Œæ‰€ä»¥å¯ä»¥å‘ä¸‹å…¼å®¹åˆ°æœ€ä½Ž Android 2.1 (API level 7+). Data Binding æ˜¯å®žçŽ° xml æ–‡ä»¶ä¸Ž java ä»£ç äº¤äº’çš„å·¥å…·ç±»åº“ï¼Œé€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼ Observable å˜é‡é›†å®žçŽ° ViewModel å±‚å’Œ View å±‚çš„ç›¸äº’ç›‘å¬ï¼Œè‡ªåŠ¨äº¤äº’ã€‚ å®žè·µç›´æŽ¥ä¸Šä»£ç ã€‚ ä¾èµ–çš„ç¬¬ä¸‰æ–¹ç±»åº“123456compile 'io.reactivex:rxjava:1.1.0'compile 'io.reactivex:rxandroid:1.1.0'compile 'com.squareup.retrofit2:retrofit:2.0.0-beta4'compile 'com.squareup.retrofit2:converter-gson:2.0.0-beta4'compile 'com.squareup.retrofit2:adapter-rxjava:2.0.0-beta4'compile 'com.github.bumptech.glide:glide:3.7.0' API https://api.douban.com/v2/movie/top250?start=0&amp;count=20 å¼•å…¥DataBinding1234567android &#123; ...... dataBinding &#123; enabled = true &#125;&#125; å·¥ç¨‹ç›®å½•ç»“æž„ è¯¦ç»†æºç ï¼šhttps://github.com/githubhaohao/MVVMRxJavaRetrofitSample MVVM ä¹‹ ViewMainActivity.java 1getFragmentManager().beginTransaction().add(R.id.movie_fragment, MovieFragment.getInstance()).commit(); MovieFragment.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class MovieFragment extends Fragment implements CompletedListener,SwipeRefreshLayout.OnRefreshListener&#123; private static String TAG = MovieFragment.class.getSimpleName(); private MainViewModel viewModel; private MovieFragmentBinding movieFragmentBinding; private MovieAdapter movieAdapter; public static MovieFragment getInstance() &#123; return new MovieFragment(); &#125; @Nullable @Override public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) &#123; View contentView = inflater.inflate(R.layout.movie_fragment, container, false); movieFragmentBinding = MovieFragmentBinding.bind(contentView); initData(); return contentView; &#125; private void initData() &#123; movieAdapter = new MovieAdapter(); movieFragmentBinding.recyclerView.setLayoutManager(new LinearLayoutManager(getActivity(), LinearLayoutManager.VERTICAL, false)); movieFragmentBinding.recyclerView.setItemAnimator(new DefaultItemAnimator()); movieFragmentBinding.recyclerView.setAdapter(movieAdapter); movieFragmentBinding.swipeRefreshLayout.setColorSchemeResources(R.color.colorAccent, R.color.colorPrimary, R.color.colorPrimaryDark); movieFragmentBinding.swipeRefreshLayout.setOnRefreshListener(this); viewModel = new MainViewModel(movieAdapter,this); movieFragmentBinding.setViewModel(viewModel); &#125; @Override public void onRefresh() &#123; movieAdapter.clearItems(); viewModel.refreshData(); &#125; @Override public void onCompleted() &#123; if (movieFragmentBinding.swipeRefreshLayout.isRefreshing()) &#123; movieFragmentBinding.swipeRefreshLayout.setRefreshing(false); &#125; &#125;&#125; activity_main.xml 1234567891011121314151617181920&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;android.support.design.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" android:fitsSystemWindows="true" tools:context=".view.MainActivity"&gt; &lt;!-- ... --&gt; &lt;FrameLayout android:layout_marginTop="?attr/actionBarSize" android:layout_width="match_parent" android:layout_height="match_parent" android:id="@+id/movie_fragment"/&gt; &lt;!-- ... --&gt;&lt;/android.support.design.widget.CoordinatorLayout&gt; movie_fragment.xml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;layout xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;data&gt; &lt;variable name="viewModel" type="com.jc.mvvmrxjavaretrofitsample.viewModel.MainViewModel"/&gt; &lt;/data&gt; &lt;RelativeLayout android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;android.support.v4.widget.SwipeRefreshLayout android:visibility="@&#123;viewModel.contentViewVisibility&#125;" android:id="@+id/swipe_refresh_layout" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;android.support.v7.widget.RecyclerView android:id="@+id/recycler_view" android:background="#ddd" android:layout_width="match_parent" android:layout_height="match_parent" android:padding="8dp"&gt; &lt;/android.support.v7.widget.RecyclerView&gt; &lt;/android.support.v4.widget.SwipeRefreshLayout&gt; &lt;ProgressBar style="?android:attr/progressBarStyleLarge" android:id="@+id/progress_bar" android:visibility="@&#123;viewModel.progressBarVisibility&#125;" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_centerInParent="true"/&gt; &lt;LinearLayout android:layout_width="match_parent" android:id="@+id/error_info_layout" android:visibility="@&#123;viewModel.errorInfoLayoutVisibility&#125;" android:orientation="vertical" android:layout_height="match_parent"&gt; &lt;TextView android:layout_gravity="center" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="@&#123;viewModel.exception&#125;"/&gt; &lt;/LinearLayout&gt; &lt;/RelativeLayout&gt;&lt;/layout&gt; movie_item.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;layout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/tools"&gt; &lt;data&gt; &lt;variable name="viewModel" type="com.jc.mvvmrxjavaretrofitsample.viewModel.MovieViewModel"/&gt; &lt;/data&gt; &lt;android.support.v7.widget.CardView xmlns:card_view="http://schemas.android.com/apk/res-auto" android:id="@+id/card_view" android:layout_width="match_parent" android:layout_height="wrap_content" card_view:cardCornerRadius="4dp" card_view:cardBackgroundColor="@color/background" card_view:cardUseCompatPadding="true"&gt; &lt;LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal"&gt; &lt;ImageView android:layout_margin="8dp" android:layout_width="60dp" android:layout_height="100dp" android:src="@drawable/cover" app:imageUrl="@&#123;viewModel.imageUrl&#125;" android:id="@+id/cover"/&gt; &lt;LinearLayout android:layout_width="wrap_content" android:layout_height="match_parent" android:layout_margin="8dp" android:orientation="vertical"&gt; &lt;TextView android:textColor="@android:color/black" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="@&#123;viewModel.title&#125;" android:textSize="12sp"/&gt; &lt;LinearLayout android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginTop="4dp" android:orientation="horizontal"&gt; &lt;android.support.v7.widget.AppCompatRatingBar android:id="@+id/ratingBar" style="?android:attr/ratingBarStyleSmall" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center_vertical" android:isIndicator="true" android:max="10" android:numStars="5" android:rating="@&#123;viewModel.rating&#125;" /&gt; &lt;TextView android:id="@+id/rating_text" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_gravity="center_vertical" android:layout_marginLeft="6dp" android:text="@&#123;viewModel.ratingText&#125;" android:textColor="?android:attr/textColorSecondary" android:textSize="10sp" /&gt; &lt;/LinearLayout&gt; &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:textColor="?android:attr/textColorSecondary" android:textSize="10sp" android:text="@&#123;viewModel.movieType&#125;" android:id="@+id/movie_type_text" android:layout_marginTop="6dp" /&gt; &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:textColor="?android:attr/textColorSecondary" android:textSize="10sp" android:text="@&#123;viewModel.year&#125;" android:id="@+id/year_text" android:layout_marginTop="6dp" /&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; &lt;/android.support.v7.widget.CardView&gt;&lt;/layout&gt; MovieAdapter.java 12345678910111213141516171819202122232425262728293031323334353637383940414243public class MovieAdapter extends RecyclerView.Adapter&lt;MovieAdapter.BindingHolder&gt; &#123; private List&lt;Movie&gt; movies; public MovieAdapter() &#123; movies = new ArrayList&lt;&gt;(); &#125; @Override public BindingHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123; MovieItemBinding itemBinding = DataBindingUtil.inflate(LayoutInflater.from(parent.getContext()), R.layout.movie_item, parent, false); return new BindingHolder(itemBinding); &#125; @Override public void onBindViewHolder(BindingHolder holder, int position) &#123; MovieViewModel movieViewModel = new MovieViewModel(movies.get(position)); holder.itemBinding.setViewModel(movieViewModel); &#125; @Override public int getItemCount() &#123; return movies.size(); &#125; public void addItem(Movie movie) &#123; movies.add(movie); notifyItemInserted(movies.size() - 1); &#125; public void clearItems() &#123; movies.clear(); notifyDataSetChanged(); &#125; public static class BindingHolder extends RecyclerView.ViewHolder &#123; private MovieItemBinding itemBinding; public BindingHolder(MovieItemBinding itemBinding) &#123; super(itemBinding.cardView); this.itemBinding = itemBinding; &#125; &#125;&#125; å›žè°ƒæŽ¥å£ CompletedListener.java 123public interface CompletedListener &#123; void onCompleted();&#125; MVVM ä¹‹ ViewModelMainViewModel.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public class MainViewModel &#123; public ObservableField&lt;Integer&gt; contentViewVisibility; public ObservableField&lt;Integer&gt; progressBarVisibility; public ObservableField&lt;Integer&gt; errorInfoLayoutVisibility; public ObservableField&lt;String&gt; exception; private Subscriber&lt;Movie&gt; subscriber; private MovieAdapter movieAdapter; private CompletedListener completedListener; public MainViewModel(MovieAdapter movieAdapter,CompletedListener completedListener) &#123; this.movieAdapter = movieAdapter; this.completedListener = completedListener; initData(); getMovies(); &#125; private void getMovies() &#123; subscriber = new Subscriber&lt;Movie&gt;() &#123; @Override public void onCompleted() &#123; Log.d("[MainViewModel]", "onCompleted"); hideAll(); contentViewVisibility.set(View.VISIBLE); completedListener.onCompleted(); &#125; @Override public void onError(Throwable e) &#123; hideAll(); errorInfoLayoutVisibility.set(View.VISIBLE); exception.set(e.getMessage()); &#125; @Override public void onNext(Movie movie) &#123; movieAdapter.addItem(movie); &#125; &#125;; RetrofitHelper.getInstance().getMovies(subscriber, 0, 20); &#125; public void refreshData() &#123; getMovies(); &#125; private void initData() &#123; contentViewVisibility = new ObservableField&lt;&gt;(); progressBarVisibility = new ObservableField&lt;&gt;(); errorInfoLayoutVisibility = new ObservableField&lt;&gt;(); exception = new ObservableField&lt;&gt;(); contentViewVisibility.set(View.GONE); errorInfoLayoutVisibility.set(View.GONE); progressBarVisibility.set(View.VISIBLE); &#125; private void hideAll()&#123; contentViewVisibility.set(View.GONE); errorInfoLayoutVisibility.set(View.GONE); progressBarVisibility.set(View.GONE); &#125;&#125; MovieViewModel.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class MovieViewModel extends BaseObservable &#123; private Movie movie; public MovieViewModel(Movie movie) &#123; this.movie = movie; &#125; public String getCoverUrl() &#123; return movie.getImages().getSmall(); &#125; public String getTitle() &#123; return movie.getTitle(); &#125; public float getRating() &#123; return movie.getRating().getAverage(); &#125; public String getRatingText()&#123; return String.valueOf(movie.getRating().getAverage()); &#125; public String getYear() &#123; return movie.getYear(); &#125; public String getMovieType() &#123; StringBuilder builder = new StringBuilder(); for (String s : movie.getGenres()) &#123; builder.append(s + " "); &#125; return builder.toString(); &#125; public String getImageUrl() &#123; return movie.getImages().getSmall(); &#125; @BindingAdapter(&#123;"app:imageUrl"&#125;) public static void loadImage(ImageView imageView,String url) &#123; Glide.with(imageView.getContext()) .load(url) .placeholder(R.drawable.cover) .error(R.drawable.cover) .into(imageView); &#125;&#125; MVVM ä¹‹ ModelDouBanMovieService.java 123456public interface DouBanMovieService &#123; String BASE_URL = "https://api.douban.com/v2/movie/"; @GET("top250") Observable&lt;Response&lt;List&lt;Movie&gt;&gt;&gt; getMovies(@Query("start") int start, @Query("count") int count);&#125; RetrofitHelper.java12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class RetrofitHelper &#123; private static final int DEFAULT_TIMEOUT = 10; private Retrofit retrofit; private DouBanMovieService movieService; OkHttpClient.Builder builder; /** * èŽ·å–RetrofitHelperå¯¹è±¡çš„å•ä¾‹ * */ private static class Singleton &#123; private static final RetrofitHelper INSTANCE = new RetrofitHelper(); &#125; public static RetrofitHelper getInstance() &#123; return Singleton.INSTANCE; &#125; public RetrofitHelper() &#123; builder = new OkHttpClient.Builder(); builder.connectTimeout(DEFAULT_TIMEOUT, TimeUnit.SECONDS); retrofit = new Retrofit.Builder() .client(builder.build()) .addConverterFactory(GsonConverterFactory.create()) .addCallAdapterFactory(RxJavaCallAdapterFactory.create()) .baseUrl(DouBanMovieService.BASE_URL) .build(); movieService = retrofit.create(DouBanMovieService.class); &#125; public void getMovies(Subscriber&lt;Movie&gt; subscriber, int start, int count) &#123; movieService.getMovies(start, count) .map(new Func1&lt;Response&lt;List&lt;Movie&gt;&gt;, List&lt;Movie&gt;&gt;() &#123; @Override public List&lt;Movie&gt; call(Response&lt;List&lt;Movie&gt;&gt; listResponse) &#123; return listResponse.getSubjects(); &#125; &#125;) .flatMap(new Func1&lt;List&lt;Movie&gt;, Observable&lt;Movie&gt;&gt;() &#123; @Override public Observable&lt;Movie&gt; call(List&lt;Movie&gt; movies) &#123; return Observable.from(movies); &#125; &#125;) .subscribeOn(Schedulers.io()) .observeOn(AndroidSchedulers.mainThread()) .subscribe(subscriber); &#125;&#125; è¿˜æœ‰ entity ç±»ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†ã€‚ è¯¦ç»†æºç ï¼šhttps://github.com/githubhaohao/MVVMRxJavaRetrofitSample]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ES6å…¥é—¨: éœ€è¦æŽŒæ¡çš„åŸºæœ¬è¯­æ³•]]></title>
      <url>%2F2017%2F01%2F25%2FES6%E5%85%A5%E9%97%A8-%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%2F</url>
      <content type="text"><![CDATA[ES6æ˜¯ä»€ä¹ˆ1. ES (ECMAScript) å’ŒJavaScriptçš„å…³ç³» ECMAScriptå’ŒJavaScriptçš„å…³ç³»æ˜¯ï¼Œå‰è€…æ˜¯åŽè€…çš„è§„æ ¼ï¼ŒåŽè€…æ˜¯å‰è€…çš„ä¸€ç§å®žçŽ°ï¼ˆå¦å¤–çš„ECMAScriptæ–¹è¨€è¿˜æœ‰Jscriptå’ŒActionScriptï¼‰ã€‚æ—¥å¸¸åœºåˆï¼Œè¿™ä¸¤ä¸ªè¯æ˜¯å¯ä»¥äº’æ¢çš„ã€‚ 2. ES6å’ŒECMAScript 2015çš„å…³ç³»ES6ï¼Œä¸€èˆ¬æ˜¯æŒ‡ECMAScript 2015æ ‡å‡†ï¼Œä½†æœ‰æ—¶ä¹Ÿè¡¨ç¤ºä¸€ç§æ³›æŒ‡ï¼Œæ˜¯æŒ‡JavaScriptè¯­è¨€çš„ä¸‹ä¸€ä»£æ ‡å‡†ã€‚æ¶µç›–äº†ECMAScript 2015ï¼Œ2016ï¼Œ2017ç­‰ç‰ˆæœ¬ï¼Œè€ŒECMAScript 2015åˆ™æ˜¯æ­£å¼åç§°ï¼Œç‰¹æŒ‡è¯¥å¹´å‘å¸ƒçš„æ­£å¼ç‰ˆæœ¬çš„è¯­è¨€æ ‡å‡†ã€‚ Babelè½¬ç å™¨ Babelæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ES6è½¬ç å™¨ï¼Œå¯ä»¥å°†ES6ä»£ç è½¬ä¸ºES5ä»£ç ï¼Œä»Žè€Œåœ¨çŽ°æœ‰çŽ¯å¢ƒæ‰§è¡Œã€‚åŽ»å®˜ç½‘é€‰æ‹©è‡ªå·±ä¹ æƒ¯çš„å·¥å…·æ¥ä½¿ç”¨ä½¿ç”¨Babelå§ï¼ letå’Œconstå‘½ä»¤letå’Œconstä¸Žvarç±»ä¼¼éƒ½æ˜¯ç”¨æ¥å£°æ˜Žå˜é‡çš„ï¼Œä½†åˆæœ‰å„è‡ªä¸åŒçš„ç”¨é€”ã€‚letä¸Žvarå¯¹æ¯”ï¼Œçœ‹ä»£ç ï¼š 12345678var name = 'haohao';if(true)&#123; var name = 'jack'; console.log(name) //jack&#125; console.log(name) //jack ES5åªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå—çº§ä½œç”¨åŸŸï¼Œå¯¼è‡´å†…å±‚å˜é‡è¦†ç›–å¤–å±‚å˜é‡ï¼Œä½¿å¾—ä¸¤æ¬¡è¾“å‡ºçš„éƒ½æ˜¯jackã€‚è€Œletä¸ºJSæ–°å¢žäº†å—çº§ä½œç”¨åŸŸï¼Œå› æ­¤å®ƒå£°æ˜Žçš„å˜é‡åªåœ¨letå‘½ä»¤æ‰€åœ¨çš„ä»£ç å—æœ‰æ•ˆï¼Œå…·ä½“çœ‹ä»£ç ï¼š 12345678let name = 'haohao';if(true)&#123; let name = 'jack'; console.log(name) //jack&#125; console.log(name) //haohao constç”¨æ¥å£°æ˜Žå¸¸é‡ï¼Œä¸€æ—¦å£°æ˜Žå°±ä¸èƒ½æ”¹å˜ã€‚å½“æˆ‘ä»¬å°è¯•æ”¹å˜constå£°æ˜Žçš„å¸¸é‡æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ã€‚ 123const PI = Math.PI PI = 23 //Module build failed: SyntaxError: /es6/app.js: "PI" is read-only å¼•ç”¨å…¶ä»–Moduleä¸­å£°æ˜Žçš„å˜é‡ï¼Œç”¨constæ¥å£°æ˜Žå¯ä»¥é¿å…å¯¹å…¶é‡å‘½åè€Œå¯¼è‡´å‡ºçŽ°BUGã€‚ 1const &#123;width, height&#125; = window.get('Dimension'); è§£æž„ (Destructuring)è§£æž„ (Destructuring) æ˜¯æŒ‡æŒ‰ç…§æŸç§æ¨¡å¼ï¼Œä»Žå¯¹è±¡æˆ–æ•°ç»„ä¸­æå–å€¼å¯¹æŒ‡å®šçš„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚ ES6ä¹‹å‰ä¸ºå˜é‡èµ‹å€¼ï¼š 123let name = 'jack';let addr = 'cn';let sex = 'male'; ES6å¯ä»¥è¿™æ ·ï¼š 12345let [name,addr,sex] = ['jack','cn','male'];name //jackaddr //cnsex //male é»˜è®¤å€¼: 12345let [name,addr,sex = 'male'] = ['jack','cn'];name //jackaddr //cnsex //male å…³äºŽå¯¹è±¡ä»¥å‰è¿™æ ·ï¼š 1234567let name = 'jack';let addr = 'cn';let sex = 'male';let student = &#123; name:name, addr:addr, sex:sex &#125;console.log(student);//Object &#123; name:'jack', addr:'cn', sex:'male' &#125; ES6å¯ä»¥è¿™æ ·ï¼š 1234567let name = 'jack';let addr = 'cn';let sex = 'male';let student = &#123; name, addr, sex &#125;console.log(student);//Object &#123; name:'jack', addr:'cn', sex:'male' &#125; è¿˜æœ‰è¿™æ ·: 123456let student = &#123; name:'kene', addr:'us', sex:'male' &#125;let &#123; name, sex &#125; = student;let &#123; addr &#125; = student;console.log(name, addr, sex);//kene us male æ¨¡æ¿å­—ç¬¦ä¸² (template string)ä¼ ç»Ÿæ¨¡æ¿å­—ç¬¦ä¸²ï¼š 12345$('#showId').append( "Helloï¼Œeveryone!" + "I am Jack."+ "I like eat " + fruits + "!" ); ES6æ¨¡æ¿å­—ç¬¦ä¸²ï¼š 12345$('#showId').append(` Helloï¼Œeveryone! I am Jack. I like eat $&#123;fruits&#125;! `); åå¼•å·æ ‡è¯†èµ·å§‹ï¼Œ${}å¼•å…¥å˜é‡ï¼Œæ‰€æœ‰çš„ç©ºæ ¼ç¼©è¿›ä¿å­˜è¾“å‡ºã€‚ ç®­å¤´å‡½æ•° (arrow functions)ES6å…è®¸ä½¿ç”¨â€œç®­å¤´â€ï¼ˆ=&gt;ï¼‰å®šä¹‰å‡½æ•°ã€‚ 12var func = i =&gt; i + 1;var func = (a, b) =&gt; &#123;a++; b++; return a + b;&#125; ä¸Šé¢çš„ç®­å¤´å‡½æ•°ç­‰åŒäºŽï¼š 123456789var func = function(i) &#123; return i + 1;&#125;;var func = function(a, b) &#123; a++; b++; return a + b;&#125; å½“æˆ‘ä»¬ä½¿ç”¨ç®­å¤´å‡½æ•°æ—¶ï¼Œå‡½æ•°ä½“å†…çš„thiså¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚å¹¶ä¸æ˜¯å› ä¸ºç®­å¤´å‡½æ•°å†…éƒ¨æœ‰ç»‘å®šthisçš„æœºåˆ¶ï¼Œå®žé™…åŽŸå› æ˜¯ç®­å¤´å‡½æ•°æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„thisï¼Œå®ƒçš„thisæ˜¯ç»§æ‰¿å¤–é¢çš„ï¼Œå› æ­¤å†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisã€‚æœ‰ä¸€ç§ä½¿ç”¨åœºæ™¯ï¼š 123456789101112131415class Person &#123; constructor()&#123; this.name = 'person'; &#125; sayHello()&#123; setTimeout(function()&#123; console.log(this.name + 'says hello.'); &#125;); &#125;&#125;let p = new Person();p.sayHello();//undefined says hello. è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸ºsetTimeoutä¸­çš„thisæŒ‡å‘çš„æ˜¯å…¨å±€å¯¹è±¡ã€‚æœ‰äº†ç®­å¤´å‡½æ•°ä¸Šè¿°é—®é¢˜ä¾¿å¯è¿Žåˆƒè€Œè§£ï¼š 123456789101112131415class Person &#123; constructor()&#123; this.name = 'person'; &#125; sayHello()&#123; setTimeout(() =&gt; &#123; console.log(this.name + 'says hello.'); &#125;); &#125;&#125;let p = new Person();p.sayHello();//person says hello. ç±» (Class)ES6æä¾›äº†æ›´æŽ¥è¿‘ä¼ ç»Ÿè¯­è¨€çš„å†™æ³•ï¼Œå¼•å…¥äº†Classï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µã€‚æ–°çš„classå†™æ³•è®©å¯¹è±¡åŽŸåž‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•ï¼Œä¹Ÿæ›´åŠ é€šä¿—æ˜“æ‡‚ã€‚ 123456789101112131415class Person &#123; constructor()&#123; this.name = 'person'; &#125; sayHello()&#123; setTimeout(() =&gt; &#123; console.log(this.name + 'says hello.'); &#125;); &#125;&#125;let p = new Person();p.sayHello();//person says hello. ä¸Šé¢ä»£ç é¦–å…ˆç”¨classå®šä¹‰äº†ä¸€ä¸ªâ€œç±»â€ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€ä¸ªconstructoræ–¹æ³•ï¼Œè¿™å°±æ˜¯æž„é€ æ–¹æ³•ï¼Œè€Œthiså…³é”®å­—åˆ™ä»£è¡¨å®žä¾‹å¯¹è±¡ã€‚ç®€å•åœ°è¯´ï¼Œconstructorå†…å®šä¹‰çš„æ–¹æ³•å’Œå±žæ€§æ˜¯å®žä¾‹å¯¹è±¡è‡ªå·±çš„ï¼Œè€Œconstructorå¤–å®šä¹‰çš„æ–¹æ³•å’Œå±žæ€§åˆ™æ˜¯æ‰€æœ‰å®žä¾‹å¯¹è±¡å¯ä»¥å…±äº«çš„ã€‚ ES6çš„ç»§æ‰¿æœºåˆ¶ï¼Œå®žè´¨æ˜¯å…ˆåˆ›é€ çˆ¶ç±»çš„å®žä¾‹å¯¹è±¡thisï¼ˆæ‰€ä»¥å¿…é¡»å…ˆè°ƒç”¨superæ–¹æ³•ï¼‰ï¼Œç„¶åŽå†ç”¨å­ç±»çš„æž„é€ å‡½æ•°ä¿®æ”¹thisã€‚ 1234567891011class Student extends Person &#123; constructor()&#123; super(); this.name = 'student'; &#125;&#125;let s = new Student();s.sayHello();//student says hello. ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªStudentç±»ï¼Œè¯¥ç±»é€šè¿‡extendså…³é”®å­—ï¼Œç»§æ‰¿äº†Personç±»çš„æ‰€æœ‰å±žæ€§å’Œæ–¹æ³•ã€‚ å­ç±»Studentå¿…é¡»åœ¨constructoræ–¹æ³•ä¸­è°ƒç”¨superæ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®žä¾‹æ—¶ä¼šæŠ¥é”™,å­ç±»å°±å¾—ä¸åˆ°thiså¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºå­ç±»æ²¡æœ‰è‡ªå·±çš„thiså¯¹è±¡ï¼Œè€Œæ˜¯ç»§æ‰¿çˆ¶ç±»çš„thiså¯¹è±¡ï¼Œç„¶åŽå¯¹å…¶è¿›è¡ŒåŠ å·¥ã€‚ exportå’ŒimportES6çš„æ¨¡å—åŒ–åŠŸèƒ½ã€‚ä»¥å‰è¿™æ ·å†™ï¼š 12345678//content.jsmodule.exports = 'apple';//index.jsvar fruits = require('./content.js');console.log(fruits);//apple ES6è¿™æ ·ï¼š 12345678//content.jsexport default 'apple';//index.jsimport fruits from './content.js';console.log(fruits);//apple æ·±å…¥ç‚¹ï¼Œçœ‹ä»£ç ï¼š 12345678910111213141516171819//content.jsexport const KIND = 'Thailand Apple';export default 'apple';export function say()&#123; return 'I like apple!';&#125; //index.jsimport fruits, &#123; say, KIND &#125; from './content.js';//å¦‚æžœåªå¯¼å…¥say //import &#123; say &#125; from './content.js';console.log(fruits);console.log(KIND);say();//apple //Thailand Apple//I like apple! ä¿®æ”¹å˜é‡åã€‚ 123456789101112131415161718//content.jsexport const KIND = 'Thailand Apple';export default 'apple';export function say()&#123; return 'I like apple!';&#125; //index.jsimport fruits, &#123; say, KIND as type &#125; from './content.js';console.log(fruits);console.log(type);say();//apple //Thailand Apple//I like apple! æ•´ä½“åŠ è½½,*ä¸ºæŒ‡å®šçš„ä¸€ä¸ªå¯¹è±¡ã€‚ 123456789101112131415161718//content.jsexport const KIND = 'Thailand Apple';export default 'apple';export function say()&#123; return 'I like apple!';&#125; //index.jsimport fruits, * as content from './content.js';console.log(fruits);console.log(content.type);content.say();//apple //Thailand Apple//I like apple!]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[åˆ†åˆ†é’ŸæŽ¥å…¥Tinker]]></title>
      <url>%2F2017%2F01%2F18%2F%E5%88%86%E5%88%86%E9%92%9F%E6%8E%A5%E5%85%A5Tinker%2F</url>
      <content type="text"><![CDATA[Tinkeræ˜¯ä»€ä¹ˆ Tinkeræ˜¯å¾®ä¿¡å®˜æ–¹çš„Androidçƒ­è¡¥ä¸è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ”¯æŒåŠ¨æ€ä¸‹å‘ä»£ç ã€Soåº“ä»¥åŠèµ„æºï¼Œè®©åº”ç”¨èƒ½å¤Ÿåœ¨ä¸éœ€è¦é‡æ–°å®‰è£…çš„æƒ…å†µä¸‹å®žçŽ°æ›´æ–°ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Tinkeræ¥æ›´æ–°ä½ çš„æ’ä»¶ã€‚å®ƒä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š 1.gradleç¼–è¯‘æ’ä»¶: tinker-patch-gradle-plugin 2.æ ¸å¿ƒsdkåº“: tinker-android-lib 3.éžgradleç¼–è¯‘ç”¨æˆ·çš„å‘½ä»¤è¡Œç‰ˆæœ¬: tinker-patch-cli.jar å¼•å…¥ä¾èµ–å’Œæ’ä»¶åœ¨ä½ é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ build.gradle æ–‡ä»¶ä¸­æ·»åŠ : 12345buildscript &#123; dependencies &#123; classpath ('com.tencent.tinker:tinker-patch-gradle-plugin:1.7.6') &#125;&#125; åœ¨ app/build.gradle æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–å’Œæ’ä»¶ï¼š 1234567891011dependencies &#123; //optional, help to generate the final application provided('com.tencent.tinker:tinker-android-anno:1.7.6') //tinker's main Android lib compile('com.tencent.tinker:tinker-android-lib:1.7.6') compile "com.android.support:multidex:1.0.1"&#125;......apply plugin: 'com.tencent.tinker.patch' æ·»åŠ taskæ·»åŠ task tinkerPatch åœ¨ app/build.gradle æ–‡ä»¶ä¸­,å…¶ä¸­ oldApk è·¯å¾„ä¸ºå‡ºçŽ°BUGçš„APKè·¯å¾„ï¼ˆè‡ªå®šä¹‰ï¼‰ï¼Œæ·»åŠ å®Œä¹‹åŽAsync Projectã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142tinkerPatch &#123; oldApk = "J://tinkerSample/app-debug.apk" ignoreWarning = true useSign = true buildConfig &#123; applyMapping = null applyResourceMapping = null tinkerId = "tinkerId" &#125; dex &#123; dexMode = "jar" usePreGeneratedPatchDex = false pattern = ["classes*.dex", "assets/secondary-dex-?.jar"] loader = ["com.tencent.tinker.loader.*", "com.jc.tinkersample.SimpleApp", "com.jc.tinkersample.BaseBuildInfo" ] &#125; lib &#123; pattern = ["lib/armeabi/*.so"] &#125; res &#123; pattern = ["res/*", "assets/*", "resources.arsc", "AndroidManifest.xml"] ignoreChange = ["assets/sample_meta.txt"] largeModSize = 100 &#125; packageConfig &#123; configField("patchMessage", "tinker is sample to use") configField("platform", "all") configField("patchVersion", "1.0") &#125; sevenZip &#123; zipArtifact = "com.tencent.mm:SevenZip:1.1.10" &#125;&#125; æŽ¥å…¥Tinkerè‡ªå®šä¹‰Applicationç»§æ‰¿ DefaultApplicationLike ç±»ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ‰©å±•ã€‚ 12345678910111213141516171819202122@DefaultLifeCycle( application = "com.jc.tinkersample.SimpleApp", flags = ShareConstants.TINKER_ENABLE_ALL, loadVerifyFlag = false)public class SimpleAppLike extends DefaultApplicationLike &#123; public SimpleAppLike(Application application, int tinkerFlags, boolean tinkerLoadVerifyFlag, long applicationStartElapsedTime, long applicationStartMillisTime, Intent tinkerResultIntent, Resources[] resources, ClassLoader[] classLoader, AssetManager[] assetManager) &#123; super(application, tinkerFlags, tinkerLoadVerifyFlag, applicationStartElapsedTime, applicationStartMillisTime, tinkerResultIntent, resources, classLoader, assetManager); &#125; @Override public void onBaseContextAttached(Context base) &#123; super.onBaseContextAttached(base); MultiDex.install(base); TinkerInstaller.install(this); &#125; @TargetApi(Build.VERSION_CODES.ICE_CREAM_SANDWICH) public void registerActivityLifecycleCallbacks(Application.ActivityLifecycleCallbacks callback) &#123; getApplication().registerActivityLifecycleCallbacks(callback); &#125;&#125; è¿è¡Œå®‰è£…åˆ°ä½ çš„æ‰‹æœºé‡Œï¼Œç„¶åŽæŠŠ app-debug.apk æ”¾åˆ° oldApk å¯¹åº”çš„è·¯å¾„ä¸‹ï¼Œç”¨äºŽç”Ÿæˆ patch.apkã€‚ ç„¶åŽï¼Œä¿®å¤ä½ é¡¹ç›®çš„bugï¼ˆè¿™é‡Œåªæ˜¯è±¡å¾æ€§åœ°ä¿®æ”¹äº†ä¸€ä¸‹Textï¼‰ï¼Œæ‰“å¼€Android Studio å³ä¾§çš„gradle project è¿è¡Œ tinkerPatchDebug taskç”Ÿæˆpatch.apkã€‚ æ‰¾åˆ°patch_signed_7zip.apk æ–‡ä»¶ã€‚ å¤åˆ¶ patch_signed_7zip.apk æ–‡ä»¶æŠŠå®ƒæ”¾åˆ°æ‰‹æœºå¤–éƒ¨å­˜å‚¨ç›®å½•ä¸‹ ï¼ˆè¿™é‡Œä¸ºæ ¹ç›®å½•ï¼‰ã€‚ 12345678String path = Environment.getExternalStorageDirectory().getAbsolutePath() + "/patch_signed_7zip.apk";File file = new File(path);if (file.exists())&#123; Toast.makeText(this, "patch.apk is existing.", Toast.LENGTH_SHORT).show(); TinkerInstaller.onReceiveUpgradePatch(getApplicationContext(), path);&#125;else&#123; Toast.makeText(this,"patch.apk is inexistent.", Toast.LENGTH_SHORT).show();&#125; è°ƒç”¨Tinker API TinkerInstaller.onReceiveUpgradePatch(getApplicationContext(), path); è¿›è¡Œçƒ­ä¿®å¤ï¼Œé‡å¯appçƒ­ä¿®å¤å®Œæˆã€‚ è¯¦ç»†ä»£ç https://github.com/githubhaohao/TinkerSample æ›´å¤š å¾®ä¿¡Androidçƒ­è¡¥ä¸å®žè·µæ¼”è¿›ä¹‹è·¯ Android Næ··åˆç¼–è¯‘ä¸Žå¯¹çƒ­è¡¥ä¸å½±å“æ·±åº¦è§£æž å¾®ä¿¡Tinkerçš„ä¸€åˆ‡éƒ½åœ¨è¿™é‡Œï¼ŒåŒ…æ‹¬æºç ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>%2F2016%2F12%2F01%2FHello-World%2F</url>
      <content type="text"><![CDATA[åˆæŠ±ä¹‹æœ¨ï¼Œç”ŸäºŽæ¯«æœ«ï¼›ä¹å±‚ä¹‹å°ï¼Œèµ·äºŽç´¯åœŸï¼›åƒé‡Œä¹‹è¡Œï¼Œå§‹äºŽè¶³ä¸‹ã€‚ ä¸å¿˜åˆå¿ƒï¼Œä¸æƒ§æœªæ¥ã€‚haohao2017/01/14]]></content>
    </entry>

    
  
  
</search>

<html>
  <head>
    <title>Android 设计模式之单例模式 - haohao</title>
    <link href='/images/ic_small.png' rel='shortcut icon'>
<link href='/atom.xml' rel='alternate' type='application/rss+xml'>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type'>


	<script src="/prettify/prettify.js" type="text/javascript"></script>
	<link rel="stylesheet" href="/themes/tomorrow-night-eighties.css" type="text/css">
  </head>
  <body>
    <header>
  <a id='go-back-home' href='/'><img src='/images/ic_middle.png' alt='Home' width='96' height='96'></a>
  <p>haohao</p>
  <p>不忘初心，不惧未来</p>
</header>

    <div id='container'>
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='/me'>About</a>
  
    <a class='main' href='mailto:haohaochang86@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/githubhaohao'>Github</a>
  
</div>

      <section class='paging'>
  
    <div class='left'>
      <a href='/2017/05/13/Android-设计模式之-Builder-模式/'>
        ‹
      </a>
    </div>
  
  
    <div class='right'>
      <a href='/2017/04/27/Android-进程间通信方式/'>
        ›
      </a>
    </div>
  
</section>

      <div class='content'>
        <section class='post'>
          <h1>
            <div class='date'>2017-05-06</div>
            Android 设计模式之单例模式
          </h1>
          <p align="center"><img src="http://i4.buimg.com/588795/9d67959bff9222b9.jpg" alt="Markdown"></p>

<p align="center">时刻尝试走出舒适区</p>


<blockquote>
<p>最近在培养自己的广泛阅读习惯，感觉阅读中最重要的是动脑思考，阅读是接受讯息，思考是消化讯息。<br>本文是 Android 设计模式的开篇，接下来会陆续推出整个常用的设计模式系列。</p>
</blockquote>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><p>设计模式简而言之就是优秀的代码设计经验的总结。设计模式的产生是为了提高代码的可复用性，可扩展性，可靠性以及可读性。</p>
<h2 id="设计模式原则"><a href="#设计模式原则" class="headerlink" title="设计模式原则"></a>设计模式原则</h2><ul>
<li>单一职责原则: 一个类只负责一项职责;</li>
<li>里氏替换原则: 子类可以扩展父类的功能，但不能改变父类原有的功能;</li>
<li>依赖倒置原则: 面向接口编程，将依赖对象的共同特征抽象成接口；</li>
<li>接口隔离原则: 一个类不应该实现它不需要的接口方法，即建立单一接口，细化接口，尽量减少接口中的方法;</li>
<li>迪米特法则: 一个对象应该对其他对象保持最少的了解，即降低类与类之间的耦合；</li>
<li>开闭原则: 一个类对扩展开放，对修改关闭。</li>
</ul>
<h2 id="设计模式分类"><a href="#设计模式分类" class="headerlink" title="设计模式分类"></a>设计模式分类</h2><h3 id="创建型设计模式"><a href="#创建型设计模式" class="headerlink" title="创建型设计模式"></a>创建型设计模式</h3><p>设计对象的实例化，避免用户用 new 运算符创建对象。例如单例模式，Builder 模式，原型模式等。</p>
<h3 id="行为型设计模式"><a href="#行为型设计模式" class="headerlink" title="行为型设计模式"></a>行为型设计模式</h3><p>设计对象之间的通信交互。如观察者模式，迭代器模式，责任链模式等。</p>
<h3 id="结构型设计模式"><a href="#结构型设计模式" class="headerlink" title="结构型设计模式"></a>结构型设计模式</h3><p>设计如何组合类和对象以形成更大的结构。如适配器模式，代理模式，桥接模式等。</p>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>简单介绍常用的五种单例模式的写法。</p>
<h3 id="饿汉式单例"><a href="#饿汉式单例" class="headerlink" title="饿汉式单例"></a>饿汉式单例</h3><pre><code class="java">public class Person {

    private static final INSTANCE = new Person();

    private Person(){

    }

    public static Person getInstance() {
      return INSTANCE;
    }
}
</code></pre>
<p>优点：线程安全。<br>缺点：类加载的时候就进行初始化，对于初始化逻辑复杂的类，会导致类加载变慢。</p>
<h3 id="DCL-懒汉式单例"><a href="#DCL-懒汉式单例" class="headerlink" title="(DCL) 懒汉式单例"></a>(DCL) 懒汉式单例</h3><pre><code class="java">public class Person {
    private static volatile sInstance = new Person();

    private Person(){

    }

    public static Person getInstance() {
        if (sInstance == null){
            synchronized (Person.class) {
                if (sInstance == null) {
                    sInstance = new Person();

                }
            }
        }

        return sInstance;
    }
}
</code></pre>
<p>优点：volatile 声明单例引用，可以防止并发时初始化成员变量和对象实例化顺序可能会被打乱，双重校验锁定解决了多余的同步问题。<br>缺点：并发时存在极小的概率导致 DCL 失效，据说是百万分之一。</p>
<h3 id="静态内部类单例"><a href="#静态内部类单例" class="headerlink" title="静态内部类单例"></a>静态内部类单例</h3><pre><code class="java">public class Person {

    private Person(){

    }

    private static class Singleton {
        private static final Person INSTANCE = new Person();
    }

    public static Person getInstance() {
        return Singleton.INSTANCE;
    }
}
</code></pre>
<p>优点：充分结合了懒汉式单例与饿汉式的优点，同时有效避开了它们的缺点，充分保证线程安全。<strong><em>推荐</em></strong><br>缺点：会有的！</p>
<h3 id="枚举型单例"><a href="#枚举型单例" class="headerlink" title="枚举型单例"></a>枚举型单例</h3><pre><code class="java">public enum PersonEnum {
    INSTANCE;

    private PersonEnum() {

    }

    public void fun() {
         // do something
    }
}
</code></pre>
<p>使用方法：</p>
<pre><code class="java">PersonEnum.INSTANCE.fun();
</code></pre>
<p>优点：简洁，线程安全。<br>《Effective Java》的作者在书中是这样夸枚举型单例：</p>
<blockquote>
<p>这种写法在功能上与共有域方法相近，但是它更简洁，无偿地提供了序列化机制，绝对防止对此实例化，即使是在面对复杂的序列化或者反射攻击的时候。<br>虽然这中方法还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。</p>
</blockquote>
<p>缺点：Google 官方强烈建议尽量不要使用 enum ，它会增加额外的内存占用，同时增加可执行文件 .dex 的大小，也不适用继承场景。</p>
<h3 id="容器型单例"><a href="#容器型单例" class="headerlink" title="容器型单例"></a>容器型单例</h3><pre><code class="java">public class Person {

    public Person () {

    }
}

public class SingletonManager {

    public static final KEY_SINGLETON = &quot;singleton&quot;;

    private static Map&lt;String, Object&gt; sInstanceMap = new HashMap&lt;&gt;();

    public static void registerSingleton(String key, Object obj) { 
        if (!sInstanceMap.containsKey(key)) {
            sInstanceMap.put(key, obj);     
        }
    }

    public static Person getSingleton(String key) {
        return (Person) sInstanceMap.get(key);   
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="java">SingletonManager.registerSingleton(KEY_SINGLETON, new Person);
Person person = SingletonManager.getSingleton();
</code></pre>
<p>优点：可以将不同单例注册到一个容器中统一管理，隐藏了类的具体实现，降低了耦合度。<strong><em>推荐</em></strong><br>缺点：会有的！</p>
<h2 id="单例模式的优点与缺点"><a href="#单例模式的优点与缺点" class="headerlink" title="单例模式的优点与缺点"></a>单例模式的优点与缺点</h2><p>优点：减少内存开销，避免资源重用。<br>缺点：单例类的扩展性很差，持有外部引用时，非常容易造成内存泄漏。</p>

          <br>
<p align="center">haohao</p>
<div class='date' align="center">2017-05-06</div>

        </section>
      </div>
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='/me'>About</a>
  
    <a class='main' href='mailto:haohaochang86@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/githubhaohao'>Github</a>
  
</div>

    </div>
    <footer>
  <span class='muted'>&copy; 2017 Powered by haohao</span><br>
  <br>

</footer>

	<script type="text/javascript">
	  $(window).load(function(){
         $('pre').addClass('prettyprint').attr('style', 'overflow:auto;');
         prettyPrint();
      })
	  
	  $(".block .main").hover(function() {
          $(this).css({"background-color" : "#ddd"});
        },function() {
          $(this).css({"background-color" : "white"});
		});	
	</script>
  </body>
</html>

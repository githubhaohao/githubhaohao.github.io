<html>
  <head>
    <title>Android 设计模式之 Builder 模式 - haohao</title>
    <link href='/images/ic_small.png' rel='shortcut icon'>
<link href='/atom.xml' rel='alternate' type='application/rss+xml'>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type'>


	<script src="/prettify/prettify.js" type="text/javascript"></script>
	<link rel="stylesheet" href="/themes/tomorrow-night-eighties.css" type="text/css">
  </head>
  <body>
    <header>
  <a id='go-back-home' href='/'><img src='/images/ic_middle.png' alt='Home' width='96' height='96'></a>
  <p>haohao</p>
  <p>不忘初心，不惧未来</p>
</header>

    <div id='container'>
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='/custom'>About</a>
  
    <a class='main' href='mailto:haohaochang86@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/githubhaohao'>Github</a>
  
</div>

      <section class='paging'>
  
    <div class='left'>
      <a href='/2017/05/15/Android-设计模式之外观模式/'>
        ‹
      </a>
    </div>
  
  
    <div class='right'>
      <a href='/2017/05/06/Android-设计模式之单例模式/'>
        ›
      </a>
    </div>
  
</section>

      <div class='content'>
        <section class='post'>
          <h1>
            <div class='date'>2017-05-13</div>
            Android 设计模式之 Builder 模式
          </h1>
          <p align="center"><img src="http://i1.piimg.com/588795/85663beb3ea340b0.jpg" alt="Markdown"></p>

<p align="center">平坦的路往往只能带你到平凡的地方</p>

<blockquote>
<p>最近在研究 Clean 和 Unidirectional （ Android Flux ）架构，回头放一个大招。<br>本文是 Android 设计模式的第二篇，接下来会陆续推出整个常用的设计模式系列。</p>
</blockquote>
<h2 id="Builder-模式"><a href="#Builder-模式" class="headerlink" title="Builder 模式"></a>Builder 模式</h2><p>Builder 又名生成器模式，或建造（者）模式。它是一种对象构建模式，用于抽象复杂对象的构建过程，构造过程的不同实现方法可以构建出具有不同表示的对象。</p>
<blockquote>
<p>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
</blockquote>
<h3 id="模式结构"><a href="#模式结构" class="headerlink" title="模式结构"></a>模式结构</h3><ul>
<li>Product 产品，表示被构造的复杂对象。</li>
<li>Builder 抽象构建者，为创建一个 Product 对象的各个部件指定抽象方法（接口方法）。</li>
<li>ConcreteBuilder 具体构建者，实现 Builder 接口（抽象类）以及各个抽象方法。</li>
<li>Director 指挥者，构建实现（继承） Builder 接口（抽象类）的对象。</li>
</ul>
<p align="center"><img src="http://design-patterns.readthedocs.io/zh_CN/latest/_images/Builder.jpg" alt=""><br></p><br><p align="center">盗图</p>

<h3 id="模式实现"><a href="#模式实现" class="headerlink" title="模式实现"></a>模式实现</h3><p>我们以生产手机为例，当我们拿到一个手机产品通常比较关注它的品牌 (Brand) ，CPU 核心数目 (CPU Core)，运行内存 (RAM) 以及操作系统 (OS)。</p>
<h4 id="Product"><a href="#Product" class="headerlink" title="Product"></a>Product</h4><pre><code class="java">public class Phone {
    private int mCPUCore = 1;
    private int mRam = 1;
    private String mOS = &quot;Android&quot;;
    private String mBrand = &quot;Google&quot;;

    public int getCPUCore() {
        return mCPUCore;
    }

    public int getRAM() {
        return mRam;
    }

    public String getOS() {
        return mOS;
    }

    public String getBrand() {
        return mBrand;
    }

    public void setCPUCore(int mCPUCore) {
        this.mCPUCore = mCPUCore;
    }

    public void setRAM(int mRam) {
        this.mRam = mRam;
    }

    public void setOS(String mOS) {
        this.mOS = mOS;
    }

    public void setBrand(String mBrand) {
        this.mBrand = mBrand;
    }

    @Override
    public String toString() {
        return &quot;Brand : &quot; + getBrand() +&quot;, CPUCore : &quot; + getCPUCore() +
                &quot;, RAM : &quot; + getRAM() + &quot;, OS : &quot; + getOS();
    }
}
</code></pre>
<h4 id="Builder-抽象类"><a href="#Builder-抽象类" class="headerlink" title="Builder 抽象类"></a>Builder 抽象类</h4><pre><code class="java">
public abstract class PhoneBuilder {
    protected Phone mPhone;
    public void createPhone() {
        mPhone = new Phone();
    }

    public Phone getPhone() {
        return mPhone;
    }

    public abstract void buildPhoneCpu();

    public abstract void buildPhoneRam();

    public abstract void buildPhoneOS();

}
</code></pre>
<h4 id="ConcreteBuilder"><a href="#ConcreteBuilder" class="headerlink" title="ConcreteBuilder"></a>ConcreteBuilder</h4><p>XiaoMiPhoneBuilder</p>
<pre><code class="java">public class XiaoMiPhoneBuilder extends PhoneBuilder {

    public XiaoMiPhoneBuilder() {
        createPhone();
        mPhone.setBrand(&quot;XiaoMi&quot;);
    }


    @Override
    public void buildPhoneCpu() {
        mPhone.setCPUCore(4);

    }

    @Override
    public void buildPhoneRam() {
        mPhone.setRAM(4);
    }

    @Override
    public void buildPhoneOS() {
        mPhone.setOS(&quot;MIUI Android&quot;);
    }
}
</code></pre>
<p>GooglePhoneBuilder</p>
<pre><code class="java">public class GooglePhoneBuilder extends PhoneBuilder {

    public GooglePhoneBuilder() {
        createPhone();
        mPhone.setBrand(&quot;Google&quot;);
    }

    @Override
    public void buildPhoneCpu() {
        mPhone.setCPUCore(8);

    }

    @Override
    public void buildPhoneRam() {
        mPhone.setRAM(6);

    }

    @Override
    public void buildPhoneOS() {
        mPhone.setOS(&quot;Android&quot;);
    }
}
</code></pre>
<h4 id="Director"><a href="#Director" class="headerlink" title="Director"></a>Director</h4><pre><code class="java">public class PhoneDirector {
    private PhoneBuilder mPhoneBuilder;

    public PhoneDirector setPhoneBuilder(PhoneBuilder phoneBuilder) {
        this.mPhoneBuilder = phoneBuilder;
        return this;
    }

    public Phone getPhone() {
        return mPhoneBuilder.getPhone();
    }

    public PhoneDirector constructPhone() {
        mPhoneBuilder.buildPhoneCpu();
        mPhoneBuilder.buildPhoneOS();
        mPhoneBuilder.buildPhoneRam();
        return this;
    }
}
</code></pre>
<h4 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h4><pre><code class="java">public class BuilderSample {
    public static void main(String[] args) {
        PhoneDirector phoneDirector = new PhoneDirector();

        PhoneBuilder xiaomiphoneBuilder = new XiaoMiPhoneBuilder();
        PhoneBuilder googlePhoneBuilder = new GooglePhoneBuilder();


        Phone xiaoMiPhone = phoneDirector.setPhoneBuilder(xiaomiphoneBuilder)
                .constructPhone()
                .getPhone();

        Phone googlePhone = phoneDirector.setPhoneBuilder(googlePhoneBuilder)
                .constructPhone()
                .getPhone();
        System.out.println(xiaoMiPhone + &quot;\n&quot; + googlePhone);

    }
}
</code></pre>
<p>Running</p>
<blockquote>
<p>Brand : XiaoMi, CPUCore : 4, RAM : 4, OS : MIUI Android</p>
<p>Brand : Google, CPUCore : 8, RAM : 6, OS : Android</p>
</blockquote>
<h3 id="Android-中的实现"><a href="#Android-中的实现" class="headerlink" title="Android 中的实现"></a>Android 中的实现</h3><p>在 Android 开发中我们最常用到的实现 Builder 的类是 AlertDialog.Builder ，Builder 是AlertDialog 的静态内部类。基本用法如下：</p>
<pre><code class="java">AlertDialog.Builder builder = new AlertDialog.Builder(context);
builder.setIcon(R.drawable.icon);
builder.setTitle(&quot;Title&quot;);
builder.setMessage(&quot;Message&quot;);
builder.setPositiveButton(&quot;OK&quot;,
        new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int whichButton) {
                setTitle(&quot;点击了对话框上的 OK 按钮&quot;);
            }
        });
builder.setNeutralButton(&quot;Nothing&quot;,
        new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int whichButton) {
                setTitle(&quot;点击了对话框上的 Nothing 按钮&quot;);
            }
        });
builder.setNegativeButton(&quot;Cancel&quot;,
        new DialogInterface.OnClickListener() {
            public void onClick(DialogInterface dialog, int whichButton) {
                setTitle(&quot;点击了对话框上的 Cancel 按钮&quot;);
            }
        });
builder.create().show();
</code></pre>
<p>我们看一下简化后的 AlertDialog 源码：</p>
<pre><code class="java">public class AlertDialog extends Dialog implements DialogInterface {
    // Controller, 接受 Builder 成员变量P中的各个参数
    private AlertController mAlert;

    // 构造函数
    protected AlertDialog(Context context, int theme) {
        this(context, theme, true);
    }

    // 构造 AlertDialog
    AlertDialog(Context context, int theme, boolean createContextWrapper) {
        super(context, resolveDialogTheme(context, theme), createContextWrapper);
        mWindow.alwaysReadCloseOnTouchAttr();
        mAlert = new AlertController(getContext(), this, getWindow());
    }

    @Override
    public void setTitle(CharSequence title) {
        super.setTitle(title);
        mAlert.setTitle(title);
    }

    public void setCustomTitle(View customTitleView) {
        mAlert.setCustomTitle(customTitleView);
    }

    public void setMessage(CharSequence message) {
        mAlert.setMessage(message);
    }



   // Builder内部类
    public static class Builder {
        // 存储 AlertDialog 的各个参数, 例如 title ， message ， icon 等.
        private final AlertController.AlertParams P;

        public Builder(Context context) {
            this(context, resolveDialogTheme(context, 0));
        }


        public Builder(Context context, int theme) {
            P = new AlertController.AlertParams(new ContextThemeWrapper(
                    context, resolveDialogTheme(context, theme)));
            mTheme = theme;
        }

        ......

        public Builder setTitle(CharSequence title) {
            P.mTitle = title;
            return this;
        }


        public Builder setMessage(CharSequence message) {
            P.mMessage = message;
            return this;
        }

        public Builder setIcon(int iconId) {
            P.mIconId = iconId;
            return this;
        }

        public Builder setPositiveButton(CharSequence text, final OnClickListener listener) {
            P.mPositiveButtonText = text;
            P.mPositiveButtonListener = listener;
            return this;
        }


        public Builder setView(View view) {
            P.mView = view;
            P.mViewSpacingSpecified = false;
            return this;
        }

        // 构建 AlertDialog, 传递参数
        public AlertDialog create() {

            final AlertDialog dialog = new AlertDialog(P.mContext, mTheme, false);

            将P中的参数应用的dialog中的mAlert对象中
            P.apply(dialog.mAlert);
            dialog.setCancelable(P.mCancelable);
            if (P.mCancelable) {
                dialog.setCanceledOnTouchOutside(true);
            }
            dialog.setOnCancelListener(P.mOnCancelListener);
            if (P.mOnKeyListener != null) {
                dialog.setOnKeyListener(P.mOnKeyListener);
            }
            return dialog;
        }
    }

}
</code></pre>
<p>从源码中可以看到 AlertDialog.Builder 同时扮演了 Builder ， ConcreteBuilder 以及 Director 三个角色，是 Builder 模式的简化版。</p>
<p>我们从 AlertDialog 的构建和使用中，可以体会到运用 Builder 模式带来的简介性和高度的可定制性。</p>
<h3 id="Builder-模式的优点和缺点"><a href="#Builder-模式的优点和缺点" class="headerlink" title="Builder 模式的优点和缺点"></a>Builder 模式的优点和缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>使用简单，可扩展性强，封装良好；</li>
<li>高度的可定制性，构造过程可精细化控制。</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>Builder 模式只适用于构建过程复杂的同一类 Product ，此外要考虑多余 Builder 和 Director 对象对内存的占用。 </li>
</ul>

          <br>
<p align="center">haohao</p>
<div class='date' align="center">2017-05-13</div>

        </section>
      </div>
      <div class='block'>
  
    <a class='main' href='/'>Home</a>
  
    <a class='main' href='/custom'>About</a>
  
    <a class='main' href='mailto:haohaochang86@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/githubhaohao'>Github</a>
  
</div>

    </div>
    <footer>
  <span class='muted'>&copy; 2017 Powered by haohao</span><br>
  <br>

</footer>

	<script type="text/javascript">
	  $(window).load(function(){
         $('pre').addClass('prettyprint').attr('style', 'overflow:auto;');
         prettyPrint();
      })
	  
	  $(".block .main").hover(function() {
          $(this).css({"background-color" : "#ddd"});
        },function() {
          $(this).css({"background-color" : "white"});
		});	
	</script>
  </body>
</html>
